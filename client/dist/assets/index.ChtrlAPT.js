const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BookmarkNav.C-AY-f8K.js","assets/vendor.hYViCx_o.js","assets/react-interactions.CDNIj_P0.js","assets/markdown_highlight.Dt5gy-Cs.js","assets/validation.CgW5gGeX.js","assets/math-katex.DxUdIsOj.js","assets/math-katex.DAKDMjqk.css","assets/radix-ui.zUF2t8pu.js","assets/tanstack-vendor.CcfA9pap.js","assets/utilities.D3AhyVZJ.js","assets/animations.C9kiQ0P7.js","assets/headlessui.CpNfReFM.js","assets/locales.CneDv1Po.js","assets/i18n.B6o-Gbrg.js","assets/routing.D6ZJbNew.js","assets/http-client.B1ynDCuQ.js","assets/date-utils.CHq2fTxU.js","assets/forms.CgWlvBRM.js","assets/framer-motion.BeyjVqYH.js","assets/advanced-inputs.oQ6kIoBT.js","assets/security-ui.MEypZJRJ.js","assets/markdown-processing.TTzZ1vwl.js","assets/avatars.zbie9GOZ.js","assets/virtualization.CzFJ0wKU.js","assets/heic-converter.CBfFuDy-.js","assets/sandpack.DtKLOr2o.js","assets/codemirror-core.K3HVILnM.js","assets/codemirror-state.ClnsKiKb.js","assets/codemirror-view.yuH3vRs8.js","assets/codemirror-language.B5LqEgWw.js","assets/AccountSettings.BX_UYV36.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,n,s)=>((t,n,s)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s)(t,"symbol"!=typeof n?n+"":n,s);import{r as n,bq as s,br as a,ae as r,bs as o,bt as i,j as l,bu as c,bv as d,bk as u,b as m,bw as p,bx as h,by as x,bz as f,bA as g,bB as v,bC as b,bD as y,bE as _,bF as j,bG as w,aJ as N,bH as C,aK as k,bI as S,bJ as T,bK as R,bL as I,bM as E,bN as M,bO as P,bP as L,bQ as A,bR as O,bS as D,bT as z,bU as F,bV as V,bW as $,bX as B,bY as U,bZ as H,b_ as K,b$ as G,c0 as W,c1 as q,c2 as Q,c3 as Z,c4 as J,c5 as Y,c6 as X,c7 as ee,c8 as te,c9 as ne,ca as se,cb as ae,cc as re,cd as oe,ce as ie,cf as le,cg as ce,ch as de,ci as ue,cj as me,ck as pe,cl as he,cm as xe,cn as fe,co as ge,cp as ve,cq as be,cr as ye,cs as _e,ct as je,cu as we,cv as Ne,cw as Ce,cx as ke,cy as Se,cz as Te,cA as Re,cB as Ie,cC as Ee,cD as Me,cE as Pe,cF as Le,cG as Ae,cH as Oe,cI as De,cJ as ze,cK as Fe,cL as Ve,cM as $e,cN as Be,cO as Ue,cP as He,cQ as Ke,cR as Ge,cS as We,cT as qe,cU as Qe,cV as Ze,cW as Je,cX as Ye,cY as Xe,cZ as et,c_ as tt,c$ as nt,d0 as st,d1 as at,d2 as rt,d3 as ot,d4 as it,d5 as lt,d6 as ct,d7 as dt,d8 as ut,d9 as mt,da as pt,as as ht,db as xt,dc as ft,dd as gt,de as vt,df as bt,dg as yt,dh as _t,di as jt,dj as wt,dk as Nt,dl as Ct,dm as kt,dn as St,dp as Tt,dq as Rt,dr as It,ds as Et,dt as Mt,du as Pt,dv as Lt,dw as At,dx as Ot,dy as Dt,dz as zt,dA as Ft,dB as Vt,dC as $t,dD as Bt,dE as Ut,dF as Ht,dG as Kt,dH as Gt,dI as Wt,dJ as qt,dK as Qt,dL as Zt,dM as Jt,dN as Yt,dO as Xt,dP as en,dQ as tn,dR as nn,dS as sn,dT as an,dU as rn,dV as on,dW as ln,dX as cn,dY as dn,dZ as un,d_ as mn,d$ as pn,e0 as hn,e1 as xn,e2 as fn,e3 as gn,e4 as vn,e5 as bn,e6 as yn,e7 as _n,e8 as jn,e9 as wn,ea as Nn,eb as Cn,ec as kn,ed as Sn,ee as Tn,ef as Rn,eg as In,eh as En,ei as Mn,ej as Pn,ek as Ln,el as An,em as On,en as Dn,eo as zn,ep as Fn,eq as Vn,er as $n,es as Bn,et as Un,eu as Hn,ev as Kn,ew as Gn,ex as Wn,ey as qn,ez as Qn,eA as Zn,eB as Jn,eC as Yn,eD as Xn,eE as es,eF as ts,eG as ns,eH as ss}from"./vendor.hYViCx_o.js";import"./locales.CneDv1Po.js";import{c as as,u as rs,L as os,a as is,R as ls}from"./routing.D6ZJbNew.js";import{R as cs,n as ds,O as us,o as ms,T as ps,p as hs,q as xs,r as fs,s as gs,S as vs,t as bs,v as ys,w as _s,x as js,y as ws,z as Ns,I as Cs,B as ks,E as Ss,G as Ts,L as Rs,H as Is,J as Es,K as Ms,M as Ps,N as Ls,Q as As,U as Os,W as Ds,X as zs,Y as Fs,Z as Vs,_ as $s,$ as Bs,a0 as Us,a1 as Hs,a2 as Ks,a3 as Gs,a4 as Ws,a5 as qs,a6 as Qs,a7 as Zs,a8 as Js,a9 as Ys,aa as Xs,ab as ea,ac as ta,ad as na,ae as sa,af as aa,ag as ra,ah as oa,ai as ia,aj as la,ak as ca,al as da,am as ua,an as ma,ao as pa,ap as ha,aq as xa,ar as fa,as as ga,at as va,au as ba,av as ya,aw as _a,ax as ja,ay as wa,az as Na,aA as Ca,aB as ka}from"./radix-ui.zUF2t8pu.js";import{u as Sa,F as Ta,b as Ra,h as Ia,v as Ea,D as Ma,H as Pa}from"./react-interactions.CDNIj_P0.js";import{u as La,b as Aa,c as Oa,d as Da,f as za,g as Fa,h as Va,i as $a,j as Ba,k as Ua,l as Ha,m as Ka,n as Ga,Q as Wa,p as qa,q as Qa,R as Za}from"./tanstack-vendor.CcfA9pap.js";import{e as Ja,o as Ya,s as Xa,n as er,u as tr,b as nr,a as sr,c as ar,l as rr,d as or,f as ir,r as lr,g as cr,h as dr,Z as ur,i as mr,j as pr}from"./validation.CgW5gGeX.js";import{a as hr}from"./http-client.B1ynDCuQ.js";import{p as xr,i as fr,a as gr,s as vr,b as br,c as yr,f as _r,g as jr,d as wr}from"./date-utils.CHq2fTxU.js";import{l as Nr,d as Cr,t as kr,k as Sr}from"./utilities.D3AhyVZJ.js";import{u as Tr}from"./i18n.B6o-Gbrg.js";import{u as Rr,C as Ir,a as Er,b as Mr,c as Pr,d as Lr,F as Ar}from"./forms.CgWlvBRM.js";import{A as Or,m as Dr}from"./framer-motion.BeyjVqYH.js";import{T as zr,I as Fr,S as Vr,a as $r,P as Br,C as Ur,V as Hr,L as Kr,b as Gr,c as Wr,d as qr,e as Qr}from"./advanced-inputs.oQ6kIoBT.js";import{u as Zr,a as Jr,C as Yr,T as Xr,e as eo}from"./animations.C9kiQ0P7.js";import{T as to,Q as no}from"./security-ui.MEypZJRJ.js";import{M as so,r as ao,a as ro,s as oo,b as io,c as lo,d as co}from"./markdown-processing.TTzZ1vwl.js";import{c as uo,i as mo}from"./avatars.zbie9GOZ.js";import{w as po,a as ho,V as xo,z as fo,B as go,k as vo,b as bo,R as yo,I as _o,L as jo,q as wo,c as No,H as Co}from"./headlessui.CpNfReFM.js";import{C as ko,a as So,A as To,L as Ro,u as Io}from"./virtualization.CzFJ0wKU.js";import{v as Eo,E as Mo}from"./heic-converter.CBfFuDy-.js";import{S as Po,u as Lo,a as Ao,b as Oo,c as Do,_ as zo}from"./sandpack.DtKLOr2o.js";import"./math-katex.DxUdIsOj.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class Fo{constructor(e){t(this,"mediaSource",new MediaSource),t(this,"audioChunks",[]),t(this,"sourceBuffer"),this.mediaSource.addEventListener("sourceopen",async()=>{this.sourceBuffer=this.mediaSource.addSourceBuffer(e),this.sourceBuffer.addEventListener("updateend",()=>{this.tryAppendNextChunk()})})}tryAppendNextChunk(){null!=this.sourceBuffer&&!this.sourceBuffer.updating&&this.audioChunks.length>0&&this.sourceBuffer.appendBuffer(this.audioChunks.shift())}addBase64Data(e){this.addData(Uint8Array.from(atob(e),e=>e.charCodeAt(0)).buffer)}addData(e){this.audioChunks.push(e),this.tryAppendNextChunk()}close(){"open"===this.mediaSource.readyState&&this.mediaSource.endOfStream()}get mediaSourceUrl(){return URL.createObjectURL(this.mediaSource)}}var Vo=(e=>(e.SIMPLE="simple",e.ADVANCED="advanced",e))(Vo||{}),$o=(e=>(e.browser="browser",e.external="external",e))($o||{});const Bo="prompt-textarea",Uo="global-audio";var Ho=(e=>(e.landing="landing",e.menuItem="menu-item",e.nav="nav",e.message="message",e))(Ho||{}),Ko=(e=>(e.advanced="advanced",e.builder="builder",e.actions="actions",e.model="model",e.version="version",e.mcp="mcp",e))(Ko||{});var Go=(e=>(e.Top="top",e.Right="right",e.Bottom="bottom",e.Left="left",e))(Go||{}),Wo=(e=>(e.INFO="info",e.SUCCESS="success",e.WARNING="warning",e.ERROR="error",e))(Wo||{});function qo(e){const t={};for(const n of e){if(null==n)continue;const e=n.toolCallId||"";0!==e.length&&(t[e]||(t[e]=[]),t[e].push(n))}return t}function Qo(e){const t={};for(const n of e)t[n.file_id]=n;return t}function Zo(e){const t={};for(const n of e)t[n.id]=n;return t}function Jo(e){return e.reduce((e,t)=>(e[t.pluginKey]=t,e),{})}const Yo=e=>e?{list:e,map:Jo(e)}:{list:[],map:{}};function Xo(e,t){return e.map(e=>"string"==typeof e?null==t?void 0:t[e]:e).filter(e=>void 0!==e)}function ei(e){try{JSON.parse(e)}catch(t){return!1}return!0}function ti(e){try{return JSON.stringify(JSON.parse(e),null,2)}catch(t){return e}}var ni={};const si=/^\${(.+)}$/;function ai(e){if(!e)return e;const t=e.trim(),n=t.match(si);if(n){const e=n[1];return ni[e]||t}const s=/\${([^}]+)}/g;let a=t;const r=[];let o;for(;null!==(o=s.exec(t));)r.push({fullMatch:o[0],varName:o[1],index:o.index});for(let i=r.length-1;i>=0;i--){const{fullMatch:e,varName:t,index:n}=r[i],s=ni[t]||e;a=a.substring(0,n)+s+a.substring(n+e.length)}return a}var ri=(e=>(e.execute_code="execute_code",e.code_interpreter="code_interpreter",e.file_search="file_search",e.web_search="web_search",e.retrieval="retrieval",e.function="function",e.memory="memory",e))(ri||{}),oi=(e=>(e.code_interpreter="code_interpreter",e.execute_code="execute_code",e.file_search="file_search",e.image_edit="image_edit",e.ocr="ocr",e))(oi||{});const ii="_action_",li={order:"desc",limit:100},ci=[{key:"not_matched",label:"com_ui_feedback_tag_not_matched",direction:"thumbsDown",icon:"AlertCircle"},{key:"inaccurate",label:"com_ui_feedback_tag_inaccurate",direction:"thumbsDown",icon:"AlertCircle"},{key:"bad_style",label:"com_ui_feedback_tag_bad_style",direction:"thumbsDown",icon:"PenTool"},{key:"missing_image",label:"com_ui_feedback_tag_missing_image",direction:"thumbsDown",icon:"ImageOff"},{key:"unjustified_refusal",label:"com_ui_feedback_tag_unjustified_refusal",direction:"thumbsDown",icon:"Ban"},{key:"not_helpful",label:"com_ui_feedback_tag_not_helpful",direction:"thumbsDown",icon:"ThumbsDown"},{key:"other",label:"com_ui_feedback_tag_other",direction:"thumbsDown",icon:"HelpCircle"},{key:"accurate_reliable",label:"com_ui_feedback_tag_accurate_reliable",direction:"thumbsUp",icon:"CheckCircle"},{key:"creative_solution",label:"com_ui_feedback_tag_creative_solution",direction:"thumbsUp",icon:"Lightbulb"},{key:"clear_well_written",label:"com_ui_feedback_tag_clear_well_written",direction:"thumbsUp",icon:"PenTool"},{key:"attention_to_detail",label:"com_ui_feedback_tag_attention_to_detail",direction:"thumbsUp",icon:"Search"}];function di(e){return ci.filter(t=>t.direction===e)}const ui=Ja(["not_matched","inaccurate","bad_style","missing_image","unjustified_refusal","not_helpful","other","accurate_reliable","creative_solution","clear_well_written","attention_to_detail"]),mi=Ja(["thumbsUp","thumbsDown"]),pi=Ya({rating:mi,tag:ui,text:Xa().max(1024).optional()});function hi(e){if((null==e?void 0:e.rating)&&(null==e?void 0:e.tag)&&e.tag.key)return{rating:e.rating,tag:e.tag.key,text:e.text}}function xi(e){if(e)return ci.find(t=>t.key===e)}Xa().uuid();var fi=(e=>(e.OVERRIDE_AUTH="override_auth",e.USER_PROVIDED="user_provided",e.SYSTEM_DEFINED="system_defined",e))(fi||{});const gi=er(fi);var vi=(e=>(e.azureOpenAI="azureOpenAI",e.openAI="openAI",e.google="google",e.anthropic="anthropic",e.assistants="assistants",e.azureAssistants="azureAssistants",e.agents="agents",e.custom="custom",e.bedrock="bedrock",e.chatGPTBrowser="chatGPTBrowser",e.gptPlugins="gptPlugins",e))(vi||{});const bi=new Set(["agents","openAI","bedrock","azureOpenAI","anthropic","custom","google"]);var yi=(e=>(e.AI21="ai21",e.Amazon="amazon",e.Anthropic="anthropic",e.Cohere="cohere",e.Meta="meta",e.MistralAI="mistral",e.StabilityAI="stability",e.DeepSeek="deepseek",e))(yi||{});const _i=(e,t)=>{const n=e,s=((e,t)=>{if("bedrock"===e){const e=t.split(".");return[e[0],e[1]].find(e=>Object.values(yi).includes(e))??e[0]}return t})(n,t);return[`${n}-${s}`,n]},ji=e=>{const t=e??"";return!!t&&t.toLowerCase().endsWith("assistants")},wi=e=>{const t=e??"";return!!t&&"agents"===t},Ni=(e,t)=>!!bi.has(e)||null!=t&&bi.has(t);var Ci=(e=>(e.low="low",e.auto="auto",e.high="high",e))(Ci||{}),ki=(e=>(e.low="low",e.medium="medium",e.high="high",e))(ki||{});const Si=er(Ci),Ti=er(ki),Ri={assistant:"",id:"",name:"",description:"",instructions:"",conversation_starters:[],model:"",functions:[],code_interpreter:!1,image_vision:!1,retrieval:!1,append_current_datetime:!1},Ii={agent:{},id:"",name:"",description:"",instructions:"",model:"",model_parameters:{},tools:[],provider:{},projectIds:[],artifacts:"",isCollaborative:!1,recursion_limit:void 0,[ri.execute_code]:!1,[ri.file_search]:!1,[ri.web_search]:!1},Ei={type:ri.function,[ri.function]:{name:"image_vision",description:"Get detailed text descriptions for all current image attachments.",parameters:{type:"object",properties:{},required:[]}}},Mi=e=>{var t,n;return"function"===e.type&&(null==(t=e.function)?void 0:t.name)===(null==(n=Ei.function)?void 0:n.name)},Pi={model:{default:"gpt-4o-mini"},temperature:{min:0,max:2,step:.01,default:1},top_p:{min:0,max:1,step:.01,default:1},presence_penalty:{min:0,max:2,step:.01,default:0},frequency_penalty:{min:0,max:2,step:.01,default:0},resendFiles:{default:!0},maxContextTokens:{default:void 0},max_tokens:{default:void 0},imageDetail:{default:"auto",min:0,max:2,step:1}},Li={model:{default:"gemini-1.5-flash-latest"},maxOutputTokens:{min:1,max:64e3,step:1,default:8192},temperature:{min:0,max:2,step:.01,default:1},topP:{min:0,max:1,step:.01,default:.95},topK:{min:1,max:40,step:1,default:40},thinking:{default:!0},thinkingBudget:{min:-1,max:32768,step:1,default:-1}},Ai=4096,Oi={model:{default:"claude-3-5-sonnet-latest"},temperature:{min:0,max:1,step:.01,default:1},promptCache:{default:!0},thinking:{default:!0},thinkingBudget:{min:1024,step:100,max:2e5,default:2e3},maxOutputTokens:{min:1,max:128e3,step:1,default:8192,reset:e=>/claude-3[-.]5-sonnet/.test(e)||/claude-3[-.]7/.test(e)?8192:4096,set:(e,t)=>!/claude-3[-.]5-sonnet/.test(t)&&!/claude-3[-.]7/.test(t)&&e>Ai?Ai:e},topP:{min:0,max:1,step:.01,default:.7},topK:{min:1,max:40,step:1,default:5},resendFiles:{default:!0},maxContextTokens:{default:void 0},legacy:{maxOutputTokens:{min:1,max:Ai,step:1,default:Ai}}},Di={model:{default:"gpt-3.5-turbo-test"},temperature:{min:0,max:1,step:.01,default:1},top_p:{min:0,max:1,step:.01,default:1},presence_penalty:{min:0,max:2,step:.01,default:0},frequency_penalty:{min:0,max:2,step:.01,default:0},resendFiles:{default:!0},maxContextTokens:{default:void 0},max_tokens:{default:void 0},imageDetail:{default:"auto"}},zi={openAI:Pi,google:Li,anthropic:Oi,agents:Di,bedrock:Di},Fi=zi.google,Vi=er(vi),$i=tr([Vi,Xa()]),Bi=Ya({authField:Xa(),label:Xa(),description:Xa()}),Ui=Ya({name:Xa(),pluginKey:Xa(),description:Xa().optional(),icon:Xa().optional(),authConfig:sr(Bi).optional(),authenticated:nr().optional(),chatMenu:nr().optional(),isButton:nr().optional(),toolkit:nr().optional()}),Hi=Ya({input:Ya({content:Xa()}),output:Ya({content:Xa()})});var Ki=(e=>(e.functions="functions",e.classic="classic",e))(Ki||{});const Gi={default:0},Wi={default:!0};er(Ki);const qi=Ya({agent:Xa().default("functions"),skipCompletion:nr().default(Wi.default),model:Xa(),temperature:ar().default(Gi.default)}),Qi=Ya({messageId:Xa(),endpoint:Xa().optional(),clientId:Xa().nullable().optional(),conversationId:Xa().nullable(),parentMessageId:Xa().nullable(),responseMessageId:Xa().nullable().optional(),overrideParentMessageId:Xa().nullable().optional(),bg:Xa().nullable().optional(),model:Xa().nullable().optional(),title:Xa().nullable().or(rr("New Chat")).default("New Chat"),sender:Xa().optional(),text:Xa(),generation:Xa().nullable().optional(),isCreatedByUser:nr(),error:nr().optional(),clientTimestamp:Xa().optional(),createdAt:Xa().optional().default(()=>(new Date).toISOString()),updatedAt:Xa().optional().default(()=>(new Date).toISOString()),current:nr().optional(),unfinished:nr().optional(),searchResult:nr().optional(),finish_reason:Xa().optional(),thread_id:Xa().optional(),iconURL:Xa().nullable().optional(),feedback:pi.optional()}),Zi=tr([ar(),Xa()]).transform(e=>"string"==typeof e?""===e.trim()?void 0:parseFloat(e):e),Ji=or(()=>tr([ir(),nr(),ar(),Xa(),sr(or(()=>Ji)),lr(or(()=>Ji))])),Yi=Ya({conversationId:Xa().nullable(),endpoint:Vi.nullable(),endpointType:Vi.nullable().optional(),isArchived:nr().optional(),title:Xa().nullable().or(rr("New Chat")).default("New Chat"),user:Xa().optional(),messages:sr(Xa()).optional(),tools:tr([sr(Ui),sr(Xa())]).optional(),modelLabel:Xa().nullable().optional(),userLabel:Xa().optional(),model:Xa().nullable().optional(),promptPrefix:Xa().nullable().optional(),temperature:ar().optional(),topP:ar().optional(),topK:ar().optional(),top_p:ar().optional(),frequency_penalty:ar().optional(),presence_penalty:ar().optional(),parentMessageId:Xa().optional(),maxOutputTokens:Zi.optional(),maxContextTokens:Zi.optional(),max_tokens:Zi.optional(),promptCache:nr().optional(),system:Xa().optional(),thinking:nr().optional(),thinkingBudget:Zi.optional(),artifacts:Xa().optional(),context:Xa().nullable().optional(),examples:sr(Hi).optional(),tags:sr(Xa()).optional(),createdAt:Xa(),updatedAt:Xa(),resendFiles:nr().optional(),file_ids:sr(Xa()).optional(),imageDetail:Si.optional(),reasoning_effort:Ti.optional(),assistant_id:Xa().optional(),agent_id:Xa().optional(),region:Xa().optional(),maxTokens:Zi.optional(),additionalModelRequestFields:Ji.optional(),instructions:Xa().optional(),additional_instructions:Xa().optional(),append_current_datetime:nr().optional(),presetOverride:lr(cr()).optional(),stop:sr(Xa()).optional(),greeting:Xa().optional(),spec:Xa().nullable().optional(),iconURL:Xa().nullable().optional(),expiredAt:Xa().nullable().optional(),resendImages:nr().optional(),agentOptions:qi.nullable().optional(),chatGptLabel:Xa().nullable().optional()}),Xi=Yi.omit({conversationId:!0,createdAt:!0,updatedAt:!0,title:!0}).merge(Ya({conversationId:Xa().nullable().optional(),presetId:Xa().nullable().optional(),title:Xa().nullable().optional(),defaultPreset:nr().optional(),order:ar().optional(),endpoint:$i.nullable()})),el=Yi.merge(Ya({endpoint:$i.nullable(),createdAt:Xa().optional(),updatedAt:Xa().optional()})),tl=Yi.pick({spec:!0,maxContextTokens:!0,resendFiles:!0,imageDetail:!0,promptPrefix:!0,model:!0,temperature:!0,presence_penalty:!0,frequency_penalty:!0,stop:!0,top_p:!0,max_tokens:!0,topP:!0,topK:!0,maxOutputTokens:!0,promptCache:!0,thinking:!0,thinkingBudget:!0,region:!0,maxTokens:!0,agent_id:!0,assistant_id:!0,append_current_datetime:!0,instructions:!0}).merge(Ya({endpoint:$i.nullable()}));Ya({conversationId:Xa(),shareId:Xa(),messages:sr(Xa()),isPublic:nr(),title:Xa(),createdAt:Xa(),updatedAt:Xa()}),Ya({_id:Xa(),user:Xa(),tag:Xa(),description:Xa().optional(),createdAt:Xa(),updatedAt:Xa(),count:ar(),position:ar()});const nl=Yi.pick({model:!0,modelLabel:!0,promptPrefix:!0,examples:!0,temperature:!0,maxOutputTokens:!0,artifacts:!0,topP:!0,topK:!0,thinking:!0,thinkingBudget:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0}),sl=nl.transform(e=>ol(e)).catch(()=>({}));Ya({maxOutputTokens:Zi.optional(),temperature:Zi.optional(),topP:Zi.optional(),topK:Zi.optional(),presencePenalty:Zi.optional(),frequencyPenalty:Zi.optional(),stopSequences:sr(Xa()).optional(),thinkingConfig:Ya({includeThoughts:nr().optional(),thinkingBudget:Zi.optional()}).optional()}).strip().optional();const al=Yi.pick({model:!0,modelLabel:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,artifacts:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,tools:!0,agentOptions:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0}),rl=al.transform(e=>{const t={...e,model:e.model??"gpt-3.5-turbo",chatGptLabel:e.chatGptLabel??e.modelLabel??null,promptPrefix:e.promptPrefix??null,temperature:e.temperature??.8,top_p:e.top_p??1,presence_penalty:e.presence_penalty??0,frequency_penalty:e.frequency_penalty??0,tools:e.tools??[],agentOptions:e.agentOptions??{agent:"functions",skipCompletion:!0,model:"gpt-3.5-turbo",temperature:0},iconURL:e.iconURL??void 0,greeting:e.greeting??void 0,spec:e.spec??void 0,maxContextTokens:e.maxContextTokens??void 0};return null!=e.modelLabel&&""!==e.modelLabel&&(t.modelLabel=null),t}).catch(()=>({model:"gpt-3.5-turbo",chatGptLabel:null,promptPrefix:null,temperature:.8,top_p:1,presence_penalty:0,frequency_penalty:0,tools:[],agentOptions:{agent:"functions",skipCompletion:!0,model:"gpt-3.5-turbo",temperature:0},iconURL:void 0,greeting:void 0,spec:void 0,maxContextTokens:void 0}));function ol(e,t){const n={...e};return Object.keys(n).forEach(e=>{const t=n[e];null==t&&delete n[e]}),n}const il=Yi.pick({model:!0,assistant_id:!0,instructions:!0,artifacts:!0,promptPrefix:!0,iconURL:!0,greeting:!0,spec:!0,append_current_datetime:!0}).transform(e=>({...e,model:e.model??Pi.model.default,assistant_id:e.assistant_id??void 0,instructions:e.instructions??void 0,promptPrefix:e.promptPrefix??null,iconURL:e.iconURL??void 0,greeting:e.greeting??void 0,spec:e.spec??void 0,append_current_datetime:e.append_current_datetime??!1})).catch(()=>({model:Pi.model.default,assistant_id:void 0,instructions:void 0,promptPrefix:null,iconURL:void 0,greeting:void 0,spec:void 0,append_current_datetime:!1})),ll=Yi.pick({model:!0,assistant_id:!0,instructions:!0,promptPrefix:!0,artifacts:!0,iconURL:!0,greeting:!0,spec:!0}).transform(e=>ol(e)).catch(()=>({}));Yi.pick({model:!0,modelLabel:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendFiles:!0,imageDetail:!0,agent_id:!0,instructions:!0,promptPrefix:!0,iconURL:!0,greeting:!0,maxContextTokens:!0}).transform(e=>({...e,model:e.model??Di.model.default,modelLabel:e.modelLabel??null,temperature:e.temperature??1,top_p:e.top_p??1,presence_penalty:e.presence_penalty??0,frequency_penalty:e.frequency_penalty??0,resendFiles:"boolean"==typeof e.resendFiles?e.resendFiles:Di.resendFiles.default,imageDetail:e.imageDetail??"auto",agent_id:e.agent_id??void 0,instructions:e.instructions??void 0,promptPrefix:e.promptPrefix??null,iconURL:e.iconURL??void 0,greeting:e.greeting??void 0,maxContextTokens:e.maxContextTokens??void 0})).catch(()=>({model:Di.model.default,modelLabel:null,temperature:1,top_p:1,presence_penalty:0,frequency_penalty:0,resendFiles:Di.resendFiles.default,imageDetail:"auto",agent_id:void 0,instructions:void 0,promptPrefix:null,iconURL:void 0,greeting:void 0,maxContextTokens:void 0}));const cl=Yi.pick({model:!0,modelLabel:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendFiles:!0,artifacts:!0,imageDetail:!0,stop:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0,max_tokens:!0,reasoning_effort:!0}).transform(e=>ol(e)).catch(()=>({})),dl=nl.transform(e=>{const t={...e};return t.temperature===Fi.temperature.default&&delete t.temperature,t.maxOutputTokens===Fi.maxOutputTokens.default&&delete t.maxOutputTokens,t.topP===Fi.topP.default&&delete t.topP,t.topK===Fi.topK.default&&delete t.topK,ol(t)}).catch(()=>({})),ul=Yi.pick({model:!0,modelLabel:!0,promptPrefix:!0,temperature:!0,maxOutputTokens:!0,topP:!0,topK:!0,resendFiles:!0,promptCache:!0,thinking:!0,thinkingBudget:!0,artifacts:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0}).transform(e=>ol(e)).catch(()=>({})),ml=al.transform(e=>{var t;const n={...e};return null===n.modelLabel&&delete n.modelLabel,null===n.chatGptLabel&&delete n.chatGptLabel,null===n.promptPrefix&&delete n.promptPrefix,.8===n.temperature&&delete n.temperature,1===n.top_p&&delete n.top_p,0===n.presence_penalty&&delete n.presence_penalty,0===n.frequency_penalty&&delete n.frequency_penalty,0===(null==(t=n.tools)?void 0:t.length)&&delete n.tools,n.agentOptions&&"functions"===n.agentOptions.agent&&!0===n.agentOptions.skipCompletion&&"gpt-3.5-turbo"===n.agentOptions.model&&0===n.agentOptions.temperature&&delete n.agentOptions,ol(n)}).catch(()=>({}));Ya({bannerId:Xa(),message:Xa(),displayFrom:Xa(),displayTo:Xa(),createdAt:Xa(),updatedAt:Xa(),isPublic:nr()});const pl=Yi.pick({spec:!0,iconURL:!0,greeting:!0,agent_id:!0,instructions:!0,additional_instructions:!0}).transform(e=>ol(e)).catch(()=>({})),hl=Ya({name:Xa(),label:Xa(),preset:Xi,order:ar().optional(),default:nr().optional(),description:Xa().optional(),showIconInMenu:nr().optional(),showIconInHeader:nr().optional(),iconURL:tr([Xa(),Vi]).optional(),authType:gi.optional()}),xl=Ya({enforce:nr().default(!1),prioritize:nr().default(!0),list:sr(hl).min(1),addedEndpoints:sr(tr([Xa(),Vi])).optional()}),fl={[vi.openAI]:!0,[vi.google]:!0,[vi.assistants]:!0,[vi.azureAssistants]:!0,[vi.agents]:!0,[vi.azureOpenAI]:!0,[vi.anthropic]:!0,[vi.custom]:!0,[vi.bedrock]:!0},gl=/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i,vl=/^application\/(vnd\.ms-excel|msexcel|x-msexcel|x-ms-excel|x-excel|x-dos_ms_excel|xls|x-xls|vnd\.openxmlformats-officedocument\.spreadsheetml\.sheet)$/,bl=[/^(text\/(x-c|x-csharp|tab-separated-values|x-c\+\+|x-h|x-java|html|markdown|x-php|x-python|x-script\.python|x-ruby|x-tex|plain|css|vtt|javascript|csv))$/,vl,/^(application\/(epub\+zip|csv|json|pdf|x-tar|typescript|vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|presentationml\.presentation|spreadsheetml\.sheet)|xml|zip))$/,/^image\/(jpeg|gif|png|webp|heic|heif)$/,/^image\/(svg|svg\+xml)$/],yl={c:"text/x-c",cs:"text/x-csharp",cpp:"text/x-c++",h:"text/x-h",md:"text/markdown",php:"text/x-php",py:"text/x-python",rb:"text/x-ruby",tex:"text/x-tex",js:"text/javascript",sh:"application/x-sh",ts:"application/typescript",tar:"application/x-tar",zip:"application/zip",yml:"application/x-yaml",yaml:"application/x-yaml",log:"text/plain",tsv:"text/tab-separated-values"},_l=[/^(text\/(x-c|x-c\+\+|x-h|html|x-java|markdown|x-php|x-python|x-script\.python|x-ruby|x-tex|plain|vtt|xml))$/,/^(application\/(json|pdf|vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|presentationml\.presentation)))$/],jl=1048576,wl=e=>e*jl,Nl=wl(512),Cl={fileLimit:10,fileSizeLimit:Nl,totalSizeLimit:Nl,supportedMimeTypes:bl,disabled:!1},kl={endpoints:{[vi.assistants]:Cl,[vi.azureAssistants]:Cl,[vi.agents]:Cl,default:{fileLimit:10,fileSizeLimit:Nl,totalSizeLimit:Nl,supportedMimeTypes:bl,disabled:!1}},serverFileSizeLimit:Nl,avatarSizeLimit:wl(2),clientImageResize:{enabled:!1,maxWidth:1900,maxHeight:1900,quality:.92},checkType:function(e,t=bl){return t.some(t=>t.test(e))}},Sl=sr(dr()).optional().refine(e=>!e||e.every(e=>e instanceof RegExp||"string"==typeof e),{message:"Each mimeType must be a string or a RegExp object."}),Tl=Ya({disabled:nr().optional(),fileLimit:ar().min(0).optional(),fileSizeLimit:ar().min(0).optional(),totalSizeLimit:ar().min(0).optional(),supportedMimeTypes:Sl.optional()}),Rl=Ya({endpoints:lr(Tl).optional(),serverFileSizeLimit:ar().min(0).optional(),avatarSizeLimit:ar().min(0).optional(),imageGeneration:Ya({percentage:ar().min(0).max(100).optional(),px:ar().min(0).optional()}).optional(),clientImageResize:Ya({enabled:nr().optional(),maxWidth:ar().min(0).optional(),maxHeight:ar().min(0).optional(),quality:ar().min(0).max(1).optional()}).optional()}),Il=e=>e.reduce((e,t)=>{try{const n=new RegExp(t);e.push(n)}catch(n){console.error(`Invalid regex pattern "${t}" skipped.`,n)}return e},[]);function El(e){const t=kl;if(!e)return t;if(void 0!==e.serverFileSizeLimit&&(t.serverFileSizeLimit=wl(e.serverFileSizeLimit)),void 0!==e.avatarSizeLimit&&(t.avatarSizeLimit=wl(e.avatarSizeLimit)),void 0!==e.clientImageResize&&(t.clientImageResize={...t.clientImageResize,...e.clientImageResize}),!e.endpoints)return t;for(const n in e.endpoints){const s=e.endpoints[n];t.endpoints[n]||(t.endpoints[n]={});const a=t.endpoints[n];if(!0===s.disabled){a.disabled=!0,a.fileLimit=0,a.fileSizeLimit=0,a.totalSizeLimit=0,a.supportedMimeTypes=[];continue}void 0!==s.fileSizeLimit&&(a.fileSizeLimit=wl(s.fileSizeLimit)),void 0!==s.totalSizeLimit&&(a.totalSizeLimit=wl(s.totalSizeLimit));["fileLimit"].forEach(e=>{void 0!==s[e]&&(a[e]=s[e])}),s.supportedMimeTypes&&(a.supportedMimeTypes=Il(s.supportedMimeTypes))}return t}var Ml=(e=>(e.local="local",e.firebase="firebase",e.azure="azure",e.azure_blob="azure_blob",e.openai="openai",e.s3="s3",e.vectordb="vectordb",e.execute_code="execute_code",e.mistral_ocr="mistral_ocr",e.azure_mistral_ocr="azure_mistral_ocr",e.text="text",e))(Ml||{});var Pl=(e=>(e.avatar="avatar",e.unknown="unknown",e.agents="agents",e.assistants="assistants",e.execute_code="execute_code",e.image_generation="image_generation",e.assistants_output="assistants_output",e.message_attachment="message_attachment",e.filename="filename",e.updatedAt="updatedAt",e.source="source",e.filterSource="filterSource",e.context="context",e.bytes="bytes",e))(Pl||{}),Ll=(e=>(e.ServiceHttp="service_http",e.OAuth="oauth",e.None="none",e))(Ll||{}),Al=(e=>(e.Bearer="bearer",e.Basic="basic",e.Custom="custom",e))(Al||{}),Ol=(e=>(e.DefaultPost="default_post",e.BasicAuthHeader="basic_auth_header",e))(Ol||{});const Dl=Ya({iconPath:Xa().optional(),timeout:ar().optional(),initTimeout:ar().optional(),chatMenu:nr().optional(),serverInstructions:tr([nr(),Xa()]).optional(),oauth:Ya({authorization_url:Xa().url().optional(),token_url:Xa().url().optional(),client_id:Xa().optional(),client_secret:Xa().optional(),scope:Xa().optional(),redirect_uri:Xa().url().optional(),token_exchange_method:er(Ol).optional()}).optional(),customUserVars:lr(Xa(),Ya({title:Xa(),description:Xa()})).optional()}),zl=Dl.extend({type:rr("stdio").optional(),command:Xa(),args:sr(Xa()),env:lr(Xa(),Xa()).optional().transform(e=>{if(!e)return e;const t={};for(const[n,s]of Object.entries(e))t[n]=ai(s);return t}),stderr:dr().optional()}),Fl=Dl.extend({type:rr("websocket").optional(),url:Xa().transform(e=>ai(e)).pipe(Xa().url()).refine(e=>{const t=new URL(e).protocol;return"ws:"===t||"wss:"===t},{message:"WebSocket URL must start with ws:// or wss://"})}),Vl=Dl.extend({type:rr("sse").optional(),headers:lr(Xa(),Xa()).optional(),url:Xa().transform(e=>ai(e)).pipe(Xa().url()).refine(e=>{const t=new URL(e).protocol;return"ws:"!==t&&"wss:"!==t},{message:"SSE URL must not start with ws:// or wss://"})}),$l=Dl.extend({type:rr("streamable-http"),headers:lr(Xa(),Xa()).optional(),url:Xa().transform(e=>ai(e)).pipe(Xa().url()).refine(e=>{const t=new URL(e).protocol;return"ws:"!==t&&"wss:"!==t},{message:"Streamable HTTP URL must not start with ws:// or wss://"})}),Bl=tr([zl,Fl,Vl,$l]),Ul=lr(Xa(),Bl),Hl=new Set(["conversationId","title","iconURL","greeting","endpoint","endpointType","createdAt","updatedAt","expiredAt","messages","isArchived","tags","user","__v","_id","tools","model","files","spec","disableParams"]);var Kl=(e=>(e.default="default",e.advanced="advanced",e))(Kl||{});const Gl=er(Ml);const Wl=Ya({deploymentName:Xa().optional(),version:Xa().optional(),assistants:nr().optional()}).or(nr()),ql=Ya({apiKey:Xa(),serverless:nr().optional(),instanceName:Xa().optional(),deploymentName:Xa().optional(),assistants:nr().optional(),addParams:lr(dr()).optional(),dropParams:sr(Xa()).optional(),forcePrompt:nr().optional(),version:Xa().optional(),baseURL:Xa().optional(),additionalHeaders:lr(dr()).optional()}),Ql=Ya({group:Xa(),models:lr(Xa(),Wl)}).required().and(ql),Zl=sr(Ql).min(1);var Jl=(e=>(e.code_interpreter="code_interpreter",e.image_vision="image_vision",e.retrieval="retrieval",e.actions="actions",e.tools="tools",e))(Jl||{}),Yl=(e=>(e.hide_sequential_outputs="hide_sequential_outputs",e.end_after_tools="end_after_tools",e.execute_code="execute_code",e.file_search="file_search",e.web_search="web_search",e.artifacts="artifacts",e.actions="actions",e.tools="tools",e.chain="chain",e.ocr="ocr",e))(Yl||{});const Xl={[vi.assistants]:2,[vi.azureAssistants]:1},ec=Ya({streamRate:ar().optional(),baseURL:Xa().optional(),titlePrompt:Xa().optional(),titleModel:Xa().optional()});ec.merge(Ya({availableRegions:sr(Xa()).optional()}));const tc=ec.merge(Ya({disableBuilder:nr().optional(),pollIntervalMs:ar().optional(),timeoutMs:ar().optional(),version:tr([Xa(),ar()]).default(2),supportedIds:sr(Xa()).min(1).optional(),excludedIds:sr(Xa()).min(1).optional(),privateAssistants:nr().optional(),retrievalModels:sr(Xa()).min(1).optional().default(["gpt-4o","o1-preview-2024-09-12","o1-preview","o1-mini-2024-09-12","o1-mini","o3-mini","chatgpt-4o-latest","gpt-4o-2024-05-13","gpt-4o-2024-08-06","gpt-4o-mini","gpt-4o-mini-2024-07-18","gpt-4-turbo-preview","gpt-3.5-turbo-0125","gpt-4-0125-preview","gpt-4-1106-preview","gpt-3.5-turbo-1106","gpt-3.5-turbo-0125","gpt-4-turbo","gpt-4-0125","gpt-4-1106"]),capabilities:sr(er(Jl)).optional().default(["code_interpreter","image_vision","retrieval","actions","tools"]),apiKey:Xa().optional(),models:Ya({default:sr(Xa()).min(1),fetch:nr().optional(),userIdQuery:nr().optional()}).optional(),titleConvo:nr().optional(),titleMethod:tr([rr("completion"),rr("functions")]).optional(),headers:lr(dr()).optional()})),nc=["execute_code","file_search","web_search","artifacts","actions","tools","chain","ocr"],sc=ec.merge(Ya({recursionLimit:ar().optional(),disableBuilder:nr().optional().default(!1),maxRecursionLimit:ar().optional(),allowedProviders:sr(tr([Xa(),Vi])).optional(),capabilities:sr(er(Yl)).optional().default(nc)})).default({disableBuilder:!1,capabilities:nc}),ac=ec.merge(Ya({name:Xa().refine(e=>!Vi.safeParse(e).success,{message:`Value cannot be one of the default endpoint (EModelEndpoint) values: ${Object.values(vi).join(", ")}`}),apiKey:Xa(),baseURL:Xa(),models:Ya({default:sr(Xa()).min(1),fetch:nr().optional(),userIdQuery:nr().optional()}),titleConvo:nr().optional(),titleMethod:tr([rr("completion"),rr("functions")]).optional(),summarize:nr().optional(),summaryModel:Xa().optional(),forcePrompt:nr().optional(),modelDisplayLabel:Xa().optional(),headers:lr(dr()).optional(),addParams:lr(dr()).optional(),dropParams:sr(Xa()).optional(),customParams:Ya({defaultParamsEndpoint:Xa().default("custom"),paramDefinitions:sr(lr(dr())).optional()}).strict(),customOrder:ar().optional(),directEndpoint:nr().optional(),titleMessageRole:Xa().optional()})),rc=Ya({groups:Zl,plugins:nr().optional(),assistants:nr().optional()}).and(ac.pick({streamRate:!0,titleConvo:!0,titleMethod:!0,titleModel:!0,summarize:!0,summaryModel:!0,customOrder:!0}).partial()),oc=Ya({url:Xa().optional(),apiKey:Xa(),model:Xa(),voices:sr(Xa())}),ic=Ya({instanceName:Xa(),apiKey:Xa(),deploymentName:Xa(),apiVersion:Xa(),model:Xa(),voices:sr(Xa())}),lc=Ya({url:Xa().optional(),websocketUrl:Xa().optional(),apiKey:Xa(),model:Xa(),voices:sr(Xa()),voice_settings:Ya({similarity_boost:ar().optional(),stability:ar().optional(),style:ar().optional(),use_speaker_boost:nr().optional()}).optional(),pronunciation_dictionary_locators:sr(Xa()).optional()}),cc=Ya({url:Xa(),apiKey:Xa().optional(),voices:sr(Xa()),backend:Xa()}),dc=Ya({openai:oc.optional(),azureOpenAI:ic.optional(),elevenlabs:lc.optional(),localai:cc.optional()}),uc=Ya({url:Xa().optional(),apiKey:Xa(),model:Xa()}),mc=Ya({instanceName:Xa(),apiKey:Xa(),deploymentName:Xa(),apiVersion:Xa()}),pc=Ya({openai:uc.optional(),azureOpenAI:mc.optional()}),hc=Ya({conversationMode:nr().optional(),advancedMode:nr().optional(),speechToText:nr().optional().or(Ya({engineSTT:Xa().optional(),languageSTT:Xa().optional(),autoTranscribeAudio:nr().optional(),decibelValue:ar().optional(),autoSendText:ar().optional()})).optional(),textToSpeech:nr().optional().or(Ya({engineTTS:Xa().optional(),voice:Xa().optional(),languageTTS:Xa().optional(),automaticPlayback:nr().optional(),playbackRate:ar().optional(),cacheTTS:nr().optional()})).optional()}).optional(),xc=Ya({fileUploads:Ya({ipMax:ar().optional(),ipWindowInMinutes:ar().optional(),userMax:ar().optional(),userWindowInMinutes:ar().optional()}).optional(),conversationsImport:Ya({ipMax:ar().optional(),ipWindowInMinutes:ar().optional(),userMax:ar().optional(),userWindowInMinutes:ar().optional()}).optional(),tts:Ya({ipMax:ar().optional(),ipWindowInMinutes:ar().optional(),userMax:ar().optional(),userWindowInMinutes:ar().optional()}).optional(),stt:Ya({ipMax:ar().optional(),ipWindowInMinutes:ar().optional(),userMax:ar().optional(),userWindowInMinutes:ar().optional()}).optional()});var fc=(e=>(e.PNG="png",e.WEBP="webp",e.JPEG="jpeg",e))(fc||{});const gc=Ya({externalUrl:Xa().optional(),openNewTab:nr().optional(),modalAcceptance:nr().optional(),modalTitle:Xa().optional(),modalContent:Xa().or(sr(Xa())).optional()}),vc=Ya({placeholder:Xa().optional()}),bc=Ya({privacyPolicy:Ya({externalUrl:Xa().optional(),openNewTab:nr().optional()}).optional(),termsOfService:gc.optional(),customWelcome:Xa().optional(),mcpServers:vc.optional(),endpointsMenu:nr().optional(),modelSelect:nr().optional(),parameters:nr().optional(),sidePanel:nr().optional(),multiConvo:nr().optional(),bookmarks:nr().optional(),memories:nr().optional(),presets:nr().optional(),prompts:nr().optional(),agents:nr().optional(),temporaryChat:nr().optional(),temporaryChatRetention:ar().min(1).max(8760).optional(),runCode:nr().optional(),webSearch:nr().optional()}).default({endpointsMenu:!0,modelSelect:!0,parameters:!0,sidePanel:!0,presets:!0,multiConvo:!0,bookmarks:!0,memories:!0,prompts:!0,agents:!0,temporaryChat:!0,runCode:!0,webSearch:!0}),yc=Ya({language:Xa().default("auto"),size:Ja(["normal","compact","flexible","invisible"]).default("normal")}).default({language:"auto",size:"normal"}),_c=Ya({siteKey:Xa(),options:yc.optional()});var jc=(e=>(e.MISTRAL_OCR="mistral_ocr",e.CUSTOM_OCR="custom_ocr",e.AZURE_MISTRAL_OCR="azure_mistral_ocr",e))(jc||{}),wc=(e=>(e.PROVIDERS="providers",e.SCRAPERS="scrapers",e.RERANKERS="rerankers",e))(wc||{}),Nc=(e=>(e.SERPER="serper",e.SEARXNG="searxng",e))(Nc||{}),Cc=(e=>(e.FIRECRAWL="firecrawl",e.SERPER="serper",e))(Cc||{}),kc=(e=>(e.JINA="jina",e.COHERE="cohere",e))(kc||{}),Sc=(e=>(e[e.OFF=0]="OFF",e[e.MODERATE=1]="MODERATE",e[e.STRICT=2]="STRICT",e))(Sc||{});const Tc=Ya({serperApiKey:Xa().optional().default("${SERPER_API_KEY}"),firecrawlApiKey:Xa().optional().default("${FIRECRAWL_API_KEY}"),firecrawlApiUrl:Xa().optional().default("${FIRECRAWL_API_URL}"),jinaApiKey:Xa().optional().default("${JINA_API_KEY}"),cohereApiKey:Xa().optional().default("${COHERE_API_KEY}"),searchProvider:er(Nc).optional(),scraperType:er(Cc).optional(),rerankerType:er(kc).optional(),scraperTimeout:ar().optional(),safeSearch:er(Sc).default(1)}),Rc=Ya({mistralModel:Xa().optional(),apiKey:Xa().optional().default("${OCR_API_KEY}"),baseURL:Xa().optional().default("${OCR_BASEURL}"),strategy:er(jc).default("mistral_ocr")}),Ic=Ya({enabled:nr().optional().default(!1),startBalance:ar().optional().default(2e4),autoRefillEnabled:nr().optional().default(!1),refillIntervalValue:ar().optional().default(30),refillIntervalUnit:Ja(["seconds","minutes","hours","days","weeks","months"]).optional().default("days"),refillAmount:ar().optional().default(1e4)}),Ec=Ya({disabled:nr().optional(),validKeys:sr(Xa()).optional(),tokenLimit:ar().optional(),personalize:nr().default(!0),messageWindowSize:ar().optional().default(5),agent:tr([Ya({id:Xa()}),Ya({provider:Xa(),model:Xa(),instructions:Xa().optional(),model_parameters:lr(dr()).optional()})]).optional()}),Mc=Ya({version:Xa(),cache:nr().default(!0),ocr:Rc.optional(),webSearch:Tc.optional(),memory:Ec.optional(),secureImageLinks:nr().optional(),imageOutputType:er(fc).default("png"),includedTools:sr(Xa()).optional(),filteredTools:sr(Xa()).optional(),mcpServers:Ul.optional(),interface:bc,turnstile:_c.optional(),fileStrategy:Gl.default(Ml.local),actions:Ya({allowedDomains:sr(Xa()).optional()}).optional(),registration:Ya({socialLogins:sr(Xa()).optional(),allowedDomains:sr(Xa()).optional()}).default({socialLogins:["google","facebook","openid","github","discord","saml"]}),balance:Ic.optional(),speech:Ya({tts:dc.optional(),stt:pc.optional(),speechTab:hc.optional()}).optional(),rateLimits:xc.optional(),fileConfig:Rl.optional(),modelSpecs:xl.optional(),endpoints:Ya({all:ec.optional(),[vi.openAI]:ec.optional(),[vi.google]:ec.optional(),[vi.anthropic]:ec.optional(),[vi.gptPlugins]:ec.optional(),[vi.azureOpenAI]:rc.optional(),[vi.azureAssistants]:tc.optional(),[vi.assistants]:tc.optional(),[vi.agents]:sc.optional(),[vi.custom]:sr(ac.partial()).optional(),[vi.bedrock]:ec.optional()}).strict().refine(e=>Object.keys(e).length>0,{message:"At least one `endpoints` field must be provided."}).optional()}),Pc=()=>function(e){const t=e.shape,n=Object.entries(t).map(([e,t])=>t instanceof ur?[e,t._def.defaultValue()]:[e,void 0]);return Object.fromEntries(n)}(Mc);var Lc=(e=>(e.anyscale="anyscale",e.apipie="apipie",e.cohere="cohere",e.fireworks="fireworks",e.deepseek="deepseek",e.groq="groq",e.huggingface="huggingface",e.mistral="mistral",e.mlx="mlx",e.ollama="ollama",e.openrouter="openrouter",e.perplexity="perplexity",e.shuttleai="shuttleai",e["together.ai"]="together.ai",e.unify="unify",e.xai="xai",e))(Lc||{});const Ac=[vi.openAI,vi.assistants,vi.azureAssistants,vi.azureOpenAI,vi.agents,vi.chatGPTBrowser,vi.gptPlugins,vi.google,vi.anthropic,vi.custom,vi.bedrock],Oc={[vi.openAI]:"OpenAI",[vi.assistants]:"Assistants",[vi.agents]:"Agents",[vi.azureAssistants]:"Azure Assistants",[vi.azureOpenAI]:"Azure OpenAI",[vi.chatGPTBrowser]:"ChatGPT",[vi.gptPlugins]:"Plugins",[vi.google]:"Google",[vi.anthropic]:"Anthropic",[vi.custom]:"Custom",[vi.bedrock]:"AWS Bedrock",ollama:"Ollama",deepseek:"DeepSeek",xai:"xAI"},Dc=["gpt-4o-mini","gpt-4o","gpt-4.5-preview","gpt-4.5-preview-2025-02-27","gpt-3.5-turbo","gpt-3.5-turbo-0125","gpt-4-turbo","gpt-4-turbo-2024-04-09","gpt-4-0125-preview","gpt-4-turbo-preview","gpt-4-1106-preview","gpt-3.5-turbo-1106","gpt-3.5-turbo-16k-0613","gpt-3.5-turbo-16k","gpt-4","gpt-4-0314","gpt-4-32k-0314","gpt-4-0613","gpt-3.5-turbo-0613"],zc={[vi.azureAssistants]:Dc,[vi.assistants]:[...Dc,"chatgpt-4o-latest"],[vi.agents]:Dc,[vi.google]:["gemini-2.0-flash-001","gemini-2.0-flash-exp","gemini-2.0-flash-lite","gemini-2.0-pro-exp-02-05","gemini-1.5-flash-001","gemini-1.5-flash-002","gemini-1.5-pro-001","gemini-1.5-pro-002","gemini-1.0-pro-001"],[vi.anthropic]:["model-1","model-2"],[vi.openAI]:[...Dc,"chatgpt-4o-latest","gpt-4-vision-preview","gpt-3.5-turbo-instruct-0914","gpt-3.5-turbo-instruct"],[vi.bedrock]:["anthropic.claude-3-5-sonnet-20241022-v2:0","anthropic.claude-3-5-sonnet-20240620-v1:0","anthropic.claude-3-5-haiku-20241022-v1:0","anthropic.claude-3-haiku-20240307-v1:0","anthropic.claude-3-opus-20240229-v1:0","anthropic.claude-3-sonnet-20240229-v1:0","anthropic.claude-v2","anthropic.claude-v2:1","anthropic.claude-instant-v1","cohere.command-r-v1:0","cohere.command-r-plus-v1:0","meta.llama2-13b-chat-v1","meta.llama2-70b-chat-v1","meta.llama3-8b-instruct-v1:0","meta.llama3-70b-instruct-v1:0","meta.llama3-1-8b-instruct-v1:0","meta.llama3-1-70b-instruct-v1:0","meta.llama3-1-405b-instruct-v1:0","mistral.mistral-7b-instruct-v0:2","mistral.mixtral-8x7b-instruct-v0:1","mistral.mistral-large-2402-v1:0","mistral.mistral-large-2407-v1:0","mistral.mistral-small-2402-v1:0","ai21.jamba-instruct-v1:0","amazon.titan-text-lite-v1","amazon.titan-text-express-v1","amazon.titan-text-premier-v1:0"]},Fc=zc[vi.openAI],Vc={initial:[],[vi.openAI]:Fc,[vi.assistants]:Fc.filter(e=>/gpt-4|gpt-3\\.5/i.test(e)&&!/vision|instruct/i.test(e)),[vi.agents]:Fc,[vi.gptPlugins]:Fc,[vi.azureOpenAI]:Fc,[vi.chatGPTBrowser]:["text-davinci-002-render-sha"],[vi.google]:zc[vi.google],[vi.anthropic]:zc[vi.anthropic],[vi.bedrock]:zc[vi.bedrock]},$c={[vi.assistants]:"/api/assistants/v2/chat",[vi.azureAssistants]:"/api/assistants/v1/chat",[vi.agents]:`/api/${vi.agents}/chat`},Bc=new Set([vi.gptPlugins,vi.anthropic,vi.google,vi.openAI,vi.azureOpenAI,vi.custom,vi.agents,vi.bedrock]);vi.custom,vi.openAI,vi.anthropic,vi.gptPlugins,vi.assistants,vi.agents,vi.azureAssistants,vi.azureOpenAI,vi.bedrock;const Uc=new Set(["dalle","dall-e","stable-diffusion","flux"]);var Hc=(e=>(e.PROMPT_GROUPS="promptGroups",e.SHARED_LINKS="sharedLinks",e))(Hc||{}),Kc=(e=>(e[e.ONE_HOUR=36e5]="ONE_HOUR",e[e.THIRTY_MINUTES=18e5]="THIRTY_MINUTES",e[e.TEN_MINUTES=6e5]="TEN_MINUTES",e[e.FIVE_MINUTES=3e5]="FIVE_MINUTES",e[e.TWO_MINUTES=12e4]="TWO_MINUTES",e[e.ONE_MINUTE=6e4]="ONE_MINUTE",e[e.THIRTY_SECONDS=3e4]="THIRTY_SECONDS",e))(Kc||{}),Gc=(e=>(e.FILE_UPLOAD_LIMIT="file_upload_limit",e.ILLEGAL_MODEL_REQUEST="illegal_model_request",e.TOKEN_BALANCE="token_balance",e.BAN="ban",e.TTS_LIMIT="tts_limit",e.STT_LIMIT="stt_limit",e.RESET_PASSWORD_LIMIT="reset_password_limit",e.VERIFY_EMAIL_LIMIT="verify_email_limit",e.CONVO_ACCESS="convo_access",e.TOOL_CALL_LIMIT="tool_call_limit",e))(Gc||{}),Wc=(e=>(e.NO_USER_KEY="no_user_key",e.EXPIRED_USER_KEY="expired_user_key",e.INVALID_USER_KEY="invalid_user_key",e.NO_BASE_URL="no_base_url",e.MODERATION="moderation",e.INPUT_LENGTH="INPUT_LENGTH",e.INVALID_REQUEST="invalid_request_error",e.INVALID_ACTION="invalid_action_error",e.NO_SYSTEM_MESSAGES="no_system_messages",e.GOOGLE_ERROR="google_error",e.INVALID_AGENT_PROVIDER="invalid_agent_provider",e))(Wc||{}),qc=(e=>(e.GOOGLE_SERVICE_KEY="GOOGLE_SERVICE_KEY",e.GOOGLE_API_KEY="GOOGLE_API_KEY",e))(qc||{}),Qc=(e=>(e.GENERAL="general",e.CHAT="chat",e.SPEECH="speech",e.BETA="beta",e.DATA="data",e.BALANCE="balance",e.ACCOUNT="account",e.COMMANDS="commands",e.PERSONALIZATION="personalization",e))(Qc||{}),Zc=(e=>(e.VERSION="v0.7.8",e.CONFIG_VERSION="1.2.8",e.NO_PARENT="00000000-0000-0000-0000-000000000000",e.NEW_CONVO="new",e.PENDING_CONVO="PENDING",e.SEARCH="search",e[e.ENCODED_DOMAIN_LENGTH=10]="ENCODED_DOMAIN_LENGTH",e.CURRENT_MODEL="current_model",e.COMMON_DIVIDER="__",e[e.COMMANDS_MAX_LENGTH=56]="COMMANDS_MAX_LENGTH",e[e.DEFAULT_STREAM_RATE=1]="DEFAULT_STREAM_RATE",e.SAVED_TAG="Saved",e[e.MAX_CONVO_STARTERS=4]="MAX_CONVO_STARTERS",e.GLOBAL_PROJECT_NAME="instance",e.mcp_delimiter="_mcp_",e.mcp_prefix="mcp_",e.EPHEMERAL_AGENT_ID="ephemeral",e))(Zc||{}),Jc=(e=>(e.APP_TITLE="appTitle",e.LAST_CONVO_SETUP="lastConversationSetup",e.LAST_MODEL="lastSelectedModel",e.LAST_TOOLS="lastSelectedTools",e.LAST_SPEC="lastSelectedSpec",e.FILES_TO_DELETE="filesToDelete",e.ASST_ID_PREFIX="assistant_id__",e.AGENT_ID_PREFIX="agent_id__",e.FORK_SETTING="forkSetting",e.REMEMBER_FORK_OPTION="rememberDefaultFork",e.FORK_SPLIT_AT_TARGET="splitAtTarget",e.TEXT_DRAFT="textDraft_",e.FILES_DRAFT="filesDraft_",e.LAST_PROMPT_CATEGORY="lastPromptCategory",e.ENABLE_USER_MSG_MARKDOWN="enableUserMsgMarkdown",e.SHOW_ANALYSIS_CODE="showAnalysisCode",e.LAST_MCP_="LAST_MCP_",e.LAST_CODE_TOGGLE_="LAST_CODE_TOGGLE_",e.LAST_WEB_SEARCH_TOGGLE_="LAST_WEB_SEARCH_TOGGLE_",e.LAST_FILE_SEARCH_TOGGLE_="LAST_FILE_SEARCH_TOGGLE_",e.LAST_AGENT_PROVIDER="lastAgentProvider",e.LAST_AGENT_MODEL="lastAgentModel",e.PIN_MCP_="PIN_MCP_",e.PIN_WEB_SEARCH_="PIN_WEB_SEARCH_",e.PIN_CODE_INTERPRETER_="PIN_CODE_INTERPRETER_",e))(Jc||{}),Yc=(e=>(e.DIRECT_PATH="directPath",e.INCLUDE_BRANCHES="includeBranches",e.TARGET_LEVEL="targetLevel",e.DEFAULT="default",e))(Yc||{}),Xc=(e=>(e.ALL="sys__all__sys",e.MY_PROMPTS="sys__my__prompts__sys",e.NO_CATEGORY="sys__no__category__sys",e.SHARED_PROMPTS="sys__shared__prompts__sys",e))(Xc||{});vi.openAI,vi.openAI,vi.bedrock,vi.bedrock,vi.anthropic,vi.anthropic,vi.azureOpenAI,vi.azureOpenAI;const ed={current_date:!0,current_user:!0,iso_datetime:!0,current_datetime:!0};var td=(e=>(e.TEXT="text",e.THINK="think",e.TEXT_DELTA="text_delta",e.TOOL_CALL="tool_call",e.IMAGE_FILE="image_file",e.IMAGE_URL="image_url",e.AGENT_UPDATE="agent_update",e.ERROR="error",e))(td||{}),nd=(e=>(e.TOOL_CALLS="tool_calls",e.MESSAGE_CREATION="message_creation",e))(nd||{}),sd=(e=>(e.FUNCTION="function",e.RETRIEVAL="retrieval",e.FILE_SEARCH="file_search",e.CODE_INTERPRETER="code_interpreter",e.TOOL_CALL="tool_call",e))(sd||{});const ad=Yi.pick({modelLabel:!0,promptPrefix:!0,resendFiles:!0,iconURL:!0,greeting:!0,spec:!0,maxOutputTokens:!0,maxContextTokens:!0,artifacts:!0,region:!0,system:!0,model:!0,maxTokens:!0,temperature:!0,topP:!0,stop:!0,thinking:!0,thinkingBudget:!0,topK:!0,additionalModelRequestFields:!0}).transform(e=>{var t,n;if(null!=(null==(t=e.additionalModelRequestFields)?void 0:t.thinking)){const t=e;e.thinking=!!t.additionalModelRequestFields.thinking,e.thinkingBudget="object"==typeof t.additionalModelRequestFields.thinking?null==(n=t.additionalModelRequestFields.thinking)?void 0:n.budget_tokens:void 0,delete e.additionalModelRequestFields}return ol(e)}).catch(()=>({}));Yi.pick({modelLabel:!0,promptPrefix:!0,resendFiles:!0,iconURL:!0,greeting:!0,spec:!0,artifacts:!0,maxOutputTokens:!0,maxContextTokens:!0,region:!0,model:!0,maxTokens:!0,temperature:!0,topP:!0,stop:!0,thinking:!0,thinkingBudget:!0,topK:!0,additionalModelRequestFields:!0}).catchall(dr()).transform(e=>{const t=["modelLabel","promptPrefix","resendFiles","iconURL","greeting","spec","maxOutputTokens","artifacts","additionalModelRequestFields","region","model","maxTokens","temperature","topP","stop"],n={},s=e;return Object.entries(s).forEach(([e,a])=>{t.includes(e)||("topK"===e?n.top_k=a:n[e]=a,delete s[e])}),"string"==typeof s.model&&(s.model.includes("anthropic.claude-3-7-sonnet")||/anthropic\.claude-(?:[4-9](?:\.\d+)?(?:-\d+)?-(?:sonnet|opus|haiku)|(?:sonnet|opus|haiku)-[4-9])/.test(s.model))?(void 0===n.thinking?n.thinking=!0:!1===n.thinking&&(delete n.thinking,delete n.thinkingBudget),!0===n.thinking&&void 0===n.thinkingBudget&&(n.thinkingBudget=2e3),n.anthropic_beta=["output-128k-2025-02-19"]):null==n.thinking&&null==n.thinkingBudget||(delete n.thinking,delete n.thinkingBudget),Object.keys(n).length>0&&(s.additionalModelRequestFields={...s.additionalModelRequestFields||{},...n}),void 0!==s.maxOutputTokens?s.maxTokens=s.maxOutputTokens:void 0!==s.maxTokens&&(s.maxOutputTokens=s.maxTokens),ol(s)}).catch(()=>({}));const rd={[vi.openAI]:cl,[vi.azureOpenAI]:cl,[vi.custom]:cl,[vi.google]:sl,[vi.anthropic]:ul,[vi.gptPlugins]:rl,[vi.assistants]:il,[vi.azureAssistants]:il,[vi.agents]:pl,[vi.bedrock]:ad};function od(e){let t;for(const n of e)if(n){t=n;break}return t}function id(e){for(const t of e)if(t&&""!==t.trim())return t}const ld=({endpoint:e,endpointType:t,conversation:n,possibleValues:s})=>{let a=rd[e];if(!a&&!t)throw new Error(`Unknown endpoint: ${e}`);!a&&t&&(a=rd[t]);const r=null==a?void 0:a.parse(n),{models:o,secondaryModels:i}=s??{};return o&&r&&(r.model=od(o)??r.model),i&&(null==r?void 0:r.agentOptions)&&(r.agentOptions.model=od(i)??r.agentOptions.model),r},cd=e=>{const t=e.match(/gpt-(\d+(?:\.\d+)?)([a-z])?/i);if(t){return`GPT-${t[1]}${t[2]||""}`}return""},dd=e=>{const t=e.match(/\bo(\d+(?:\.\d+)?)\b/i);if(t){return`o${t[1]}`}return""},ud={[vi.openAI]:cl,[vi.azureOpenAI]:cl,[vi.custom]:cl,[vi.assistants]:ll,[vi.azureAssistants]:ll,[vi.agents]:pl,[vi.google]:dl,[vi.bedrock]:ad,[vi.anthropic]:ul,[vi.gptPlugins]:ml};function md(e,t=!1){let n="";for(const s of e)if(s.type)if(s.type===td.TEXT){const e="string"==typeof s.text?s.text:s.text.value;n.length>0&&e.length>0&&" "!==n[n.length-1]&&" "!==e[0]&&(n+=" "),n+=e}else if(s.type===td.THINK&&!t){const e="string"==typeof s.think?s.think:"";n.length>0&&e.length>0&&" "!==n[n.length-1]&&" "!==e[0]&&(n+=" "),n+=e}return n}function pd({text:e,user:t}){let n=e;if(!n)return n;const a=s().format("YYYY-MM-DD"),r=s().day(),o=`${a} (${r})`;n=n.replace(/{{current_date}}/gi,o);const i=s().format("YYYY-MM-DD HH:mm:ss");n=n.replace(/{{current_datetime}}/gi,`${i} (${r})`);const l=s().toISOString();return n=n.replace(/{{iso_datetime}}/gi,l),t&&t.name&&(n=n.replace(/{{current_user}}/gi,t.name)),n}var hd=(e=>(e.DEFAULT="default",e.SHADCNUI="shadcnui",e.CUSTOM="custom",e))(hd||{});const xd={utils:'\nimport { type ClassValue, clsx } from "clsx"\nimport { twMerge } from "tailwind-merge"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n',accordian:'import * as React from "react"\nimport * as AccordionPrimitive from "@radix-ui/react-accordion"\nimport { ChevronDown } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn("border-b", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = "AccordionItem"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className="flex">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"\n    {...props}\n  >\n    <div className={cn("pb-4 pt-0", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n',alertDialog:'import * as React from "react"\nimport * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"\n\nimport { cn } from "../../lib/utils"\nimport { buttonVariants } from "./button"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-gray-200 bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg dark:border-gray-800 dark:bg-gray-950",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      "flex flex-col space-y-2 text-center sm:text-left",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = "AlertDialogHeader"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = "AlertDialogFooter"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn("text-lg font-semibold", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn("text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: "outline" }),\n      "mt-2 sm:mt-0",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n',alert:'import * as React from "react"\nimport { cva, type VariantProps } from "class-variance-authority"\n\nimport { cn } from "../../lib/utils"\n\nconst alertVariants = cva(\n  "relative w-full rounded-lg border border-gray-200 p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-gray-950 dark:border-gray-800 dark:[&>svg]:text-gray-50",\n  {\n    variants: {\n      variant: {\n        default: "bg-white text-gray-950 dark:bg-gray-950 dark:text-gray-50",\n        destructive:\n          "border-red-500/50 text-red-500 dark:border-red-500 [&>svg]:text-red-500 dark:border-red-900/50 dark:text-red-900 dark:dark:border-red-900 dark:[&>svg]:text-red-900",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role="alert"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = "Alert"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn("mb-1 font-medium leading-none tracking-tight", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = "AlertTitle"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn("text-sm [&_p]:leading-relaxed", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = "AlertDescription"\n\nexport { Alert, AlertTitle, AlertDescription }\n\n',avatar:'import * as React from "react"\nimport * as AvatarPrimitive from "@radix-ui/react-avatar"\n\nimport { cn } from "../../lib/utils"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn("aspect-square h-full w-full", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      "flex h-full w-full items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n\n',badge:'import * as React from "react"\nimport { cva, type VariantProps } from "class-variance-authority"\n\nimport { cn } from "../../lib/utils"\n\nconst badgeVariants = cva(\n  "inline-flex items-center rounded-full border border-gray-200 px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 dark:border-gray-800 dark:focus:ring-gray-300",\n  {\n    variants: {\n      variant: {\n        default:\n          "border-transparent bg-gray-900 text-gray-50 hover:bg-gray-900/80 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50/80",\n        secondary:\n          "border-transparent bg-gray-100 text-gray-900 hover:bg-gray-100/80 dark:bg-gray-800 dark:text-gray-50 dark:hover:bg-gray-800/80",\n        destructive:\n          "border-transparent bg-red-500 text-gray-50 hover:bg-red-500/80 dark:bg-red-900 dark:text-gray-50 dark:hover:bg-red-900/80",\n        outline: "text-gray-950 dark:text-gray-50",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n\n',breadcrumb:'import * as React from "react"\nimport { Slot } from "@radix-ui/react-slot"\nimport { ChevronRight, MoreHorizontal } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<"nav"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />)\nBreadcrumb.displayName = "Breadcrumb"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<"ol">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      "flex flex-wrap items-center gap-1.5 break-words text-sm text-gray-500 sm:gap-2.5 dark:text-gray-400",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = "BreadcrumbList"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<"li">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn("inline-flex items-center gap-1.5", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = "BreadcrumbItem"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<"a"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : "a"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn("transition-colors hover:text-gray-950 dark:hover:text-gray-50", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = "BreadcrumbLink"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<"span">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role="link"\n    aria-disabled="true"\n    aria-current="page"\n    className={cn("font-normal text-gray-950 dark:text-gray-50", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = "BreadcrumbPage"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<"li">) => (\n  <li\n    role="presentation"\n    aria-hidden="true"\n    className={cn("[&>svg]:size-3.5", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = "BreadcrumbSeparator"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<"span">) => (\n  <span\n    role="presentation"\n    aria-hidden="true"\n    className={cn("flex h-9 w-9 items-center justify-center", className)}\n    {...props}\n  >\n    <MoreHorizontal className="h-4 w-4" />\n    <span className="sr-only">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = "BreadcrumbElipssis"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n\n',button:'import * as React from "react"\nimport { Slot } from "@radix-ui/react-slot"\nimport { cva, type VariantProps } from "class-variance-authority"\n\nimport { cn } from \'../../lib/utils\';\n\nconst buttonVariants = cva(\n  "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300",\n  {\n    variants: {\n      variant: {\n        default: "bg-gray-900 text-gray-50 hover:bg-gray-900/90 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50/90",\n        destructive:\n          "bg-red-500 text-gray-50 hover:bg-red-500/90 dark:bg-red-900 dark:text-gray-50 dark:hover:bg-red-900/90",\n        outline:\n          "border border-gray-200 bg-white hover:bg-gray-100 hover:text-gray-900 dark:border-gray-800 dark:bg-gray-950 dark:hover:bg-gray-800 dark:hover:text-gray-50",\n        secondary:\n          "bg-gray-100 text-gray-900 hover:bg-gray-100/80 dark:bg-gray-800 dark:text-gray-50 dark:hover:bg-gray-800/80",\n        ghost: "hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-800 dark:hover:text-gray-50",\n        link: "text-gray-900 underline-offset-4 hover:underline dark:text-gray-50",\n      },\n      size: {\n        default: "h-10 px-4 py-2",\n        sm: "h-9 rounded-md px-3",\n        lg: "h-11 rounded-md px-8",\n        icon: "h-10 w-10",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n      size: "default",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : "button"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = "Button"\n\nexport { Button, buttonVariants }\n',calendar:'import * as React from "react"\nimport { ChevronLeft, ChevronRight } from "lucide-react"\nimport { DayPicker } from "react-day-picker"\n\nimport { cn } from "../../lib/utils"\nimport { buttonVariants } from "./button"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn("p-3", className)}\n      classNames={{\n        months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",\n        month: "space-y-4",\n        caption: "flex justify-center pt-1 relative items-center",\n        caption_label: "text-sm font-medium",\n        nav: "space-x-1 flex items-center",\n        nav_button: cn(\n          buttonVariants({ variant: "outline" }),\n          "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"\n        ),\n        nav_button_previous: "absolute left-1",\n        nav_button_next: "absolute right-1",\n        table: "w-full border-collapse space-y-1",\n        head_row: "flex",\n        head_cell:\n          "text-gray-500 rounded-md w-9 font-normal text-[0.8rem] dark:text-gray-400",\n        row: "flex w-full mt-2",\n        cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-gray-100/50 [&:has([aria-selected])]:bg-gray-100 first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20 dark:[&:has([aria-selected].day-outside)]:bg-gray-800/50 dark:[&:has([aria-selected])]:bg-gray-800",\n        day: cn(\n          buttonVariants({ variant: "ghost" }),\n          "h-9 w-9 p-0 font-normal aria-selected:opacity-100"\n        ),\n        day_range_end: "day-range-end",\n        day_selected:\n          "bg-gray-900 text-gray-50 hover:bg-gray-900 hover:text-gray-50 focus:bg-gray-900 focus:text-gray-50 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50 dark:hover:text-gray-900 dark:focus:bg-gray-50 dark:focus:text-gray-900",\n        day_today: "bg-gray-100 text-gray-900 dark:bg-gray-800 dark:text-gray-50",\n        day_outside:\n          "day-outside text-gray-500 opacity-50 aria-selected:bg-gray-100/50 aria-selected:text-gray-500 aria-selected:opacity-30 dark:text-gray-400 dark:aria-selected:bg-gray-800/50 dark:aria-selected:text-gray-400",\n        day_disabled: "text-gray-500 opacity-50 dark:text-gray-400",\n        day_range_middle:\n          "aria-selected:bg-gray-100 aria-selected:text-gray-900 dark:aria-selected:bg-gray-800 dark:aria-selected:text-gray-50",\n        day_hidden: "invisible",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ ...props }) => <ChevronLeft className="h-4 w-4" />,\n        IconRight: ({ ...props }) => <ChevronRight className="h-4 w-4" />,\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = "Calendar"\n\nexport { Calendar }\n\n',card:'import * as React from \'react\';\n\nimport { cn } from \'../../lib/utils\';\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      "rounded-lg border border-gray-200 bg-white text-gray-950 shadow-sm dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = "Card"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn("flex flex-col space-y-1.5 p-6", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = "CardHeader"\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      "text-2xl font-semibold leading-none tracking-tight",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = "CardTitle"\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn("text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = "CardDescription"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />\n))\nCardContent.displayName = "CardContent"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn("flex items-center p-6 pt-0", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = "CardFooter"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n',carousel:'import * as React from "react"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from "embla-carousel-react"\nimport { ArrowLeft, ArrowRight } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\nimport { Button } from "./button"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: "horizontal" | "vertical"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error("useCarousel must be used within a <Carousel />")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = "horizontal",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === "horizontal" ? "x" : "y",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === "ArrowLeft") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === "ArrowRight") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on("reInit", onSelect)\n      api.on("select", onSelect)\n\n      return () => {\n        api?.off("select", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn("relative", className)}\n          role="region"\n          aria-roledescription="carousel"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = "Carousel"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className="overflow-hidden">\n      <div\n        ref={ref}\n        className={cn(\n          "flex",\n          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = "CarouselContent"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role="group"\n      aria-roledescription="slide"\n      className={cn(\n        "min-w-0 shrink-0 grow-0 basis-full",\n        orientation === "horizontal" ? "pl-4" : "pt-4",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = "CarouselItem"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = "outline", size = "icon", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        "absolute  h-8 w-8 rounded-full",\n        orientation === "horizontal"\n          ? "-left-12 top-1/2 -translate-y-1/2"\n          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className="h-4 w-4" />\n      <span className="sr-only">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = "CarouselPrevious"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = "outline", size = "icon", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        "absolute h-8 w-8 rounded-full",\n        orientation === "horizontal"\n          ? "-right-12 top-1/2 -translate-y-1/2"\n          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className="h-4 w-4" />\n      <span className="sr-only">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = "CarouselNext"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n\n',checkbox:'import * as React from "react"\nimport * as CheckboxPrimitive from "@radix-ui/react-checkbox"\nimport { Check } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      "peer h-4 w-4 shrink-0 rounded-sm border border-gray-200 dark:border-gray-900 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-gray-900 data-[state=checked]:text-gray-50  dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300 dark:data-[state=checked]:bg-gray-50 dark:data-[state=checked]:text-gray-900",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn("flex items-center justify-center text-current")}\n    >\n      <Check className="h-4 w-4" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n\n',collapsible:'import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n\n',dialog:'import * as React from "react"\nimport * as DialogPrimitive from "@radix-ui/react-dialog"\nimport { X } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-gray-200 bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg dark:border-gray-800 dark:bg-gray-950",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-white transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-gray-100 data-[state=open]:text-gray-500 dark:ring-offset-gray-950 dark:focus:ring-gray-300 dark:data-[state=open]:bg-gray-800 dark:data-[state=open]:text-gray-400">\n        <X className="h-4 w-4" />\n        <span className="sr-only">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      "flex flex-col space-y-1.5 text-center sm:text-left",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = "DialogHeader"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = "DialogFooter"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      "text-lg font-semibold leading-none tracking-tight",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn("text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n\n',drawer:'import * as React from "react"\nimport { Drawer as DrawerPrimitive } from "vaul"\n\nimport { cn } from "../../lib/utils"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = "Drawer"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn("fixed inset-0 z-50 bg-black/80", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        "fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950",\n        className\n      )}\n      {...props}\n    >\n      <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-gray-100 dark:bg-gray-800" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = "DrawerContent"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn("grid gap-1.5 p-4 text-center sm:text-left", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = "DrawerHeader"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn("mt-auto flex flex-col gap-2 p-4", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = "DrawerFooter"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      "text-lg font-semibold leading-none tracking-tight",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn("text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n\n',dropdownMenu:'import * as React from "react"\nimport * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"\nimport { Check, ChevronRight, Circle } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-gray-100 data-[state=open]:bg-gray-100 dark:focus:bg-gray-800 dark:data-[state=open]:bg-gray-800",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className="ml-auto h-4 w-4" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      "z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        "z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className="h-4 w-4" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className="h-2 w-2 fill-current" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      "px-2 py-1.5 text-sm font-semibold",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn("-mx-1 my-1 h-px bg-gray-100 dark:bg-gray-800", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = "DropdownMenuShortcut"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n\n',input:'import * as React from "react"\nimport { cn } from "../../lib/utils"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          "flex h-10 w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-gray-300",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = "Input"\n\nexport { Input }\n',label:"import * as React from 'react';\nimport * as LabelPrimitive from '@radix-ui/react-label';\nimport { cva, type VariantProps } from 'class-variance-authority';\n\nimport { cn } from '../../lib/utils';\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n",menuBar:'\nimport * as React from "react"\nimport * as MenubarPrimitive from "@radix-ui/react-menubar"\nimport { Check, ChevronRight, Circle } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst MenubarMenu = MenubarPrimitive.Menu\n\nconst MenubarGroup = MenubarPrimitive.Group\n\nconst MenubarPortal = MenubarPrimitive.Portal\n\nconst MenubarSub = MenubarPrimitive.Sub\n\nconst MenubarRadioGroup = MenubarPrimitive.RadioGroup\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      "flex h-10 items-center space-x-1 rounded-md border border-gray-200 bg-white p-1 dark:border-gray-800 dark:bg-gray-950",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      "flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-gray-100 focus:text-gray-900 data-[state=open]:bg-gray-100 data-[state=open]:text-gray-900 dark:focus:bg-gray-800 dark:focus:text-gray-50 dark:data-[state=open]:bg-gray-800 dark:data-[state=open]:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[state=open]:bg-gray-100 data-[state=open]:text-gray-900 dark:focus:bg-gray-800 dark:focus:text-gray-50 dark:data-[state=open]:bg-gray-800 dark:data-[state=open]:text-gray-50",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className="ml-auto h-4 w-4" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      "z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = "start", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          "z-50 min-w-[12rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className="h-4 w-4" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className="h-2 w-2 fill-current" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      "px-2 py-1.5 text-sm font-semibold",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn("-mx-1 my-1 h-px bg-gray-100 dark:bg-gray-800", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        "ml-auto text-xs tracking-widest text-gray-500 dark:text-gray-400",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = "MenubarShortcut"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n\n',navigationMenu:'import * as React from "react"\nimport * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"\nimport { cva } from "class-variance-authority"\nimport { ChevronDown } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      "relative z-10 flex max-w-max flex-1 items-center justify-center",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      "group flex flex-1 list-none items-center justify-center space-x-1",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  "group inline-flex h-10 w-max items-center justify-center rounded-md bg-white px-4 py-2 text-sm font-medium transition-colors hover:bg-gray-100 hover:text-gray-900 focus:bg-gray-100 focus:text-gray-900 focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-gray-100/50 data-[state=open]:bg-gray-100/50 dark:bg-gray-950 dark:hover:bg-gray-800 dark:hover:text-gray-50 dark:focus:bg-gray-800 dark:focus:text-gray-50 dark:data-[active]:bg-gray-800/50 dark:data-[state=open]:bg-gray-800/50"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), "group", className)}\n    {...props}\n  >\n    {children}{""}\n    <ChevronDown\n      className="relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180"\n      aria-hidden="true"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn("absolute left-0 top-full flex justify-center")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border border-gray-200 bg-white text-gray-950 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)] dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",\n      className\n    )}\n    {...props}\n  >\n    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-gray-200 shadow-md dark:bg-gray-800" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n\n',pagination:'import * as React from "react"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\nimport { ButtonProps, buttonVariants } from "./button"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (\n  <nav\n    role="navigation"\n    aria-label="pagination"\n    className={cn("mx-auto flex w-full justify-center", className)}\n    {...props}\n  />\n)\nPagination.displayName = "Pagination"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<"ul">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn("flex flex-row items-center gap-1", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = "PaginationContent"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<"li">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn("", className)} {...props} />\n))\nPaginationItem.displayName = "PaginationItem"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, "size"> &\n  React.ComponentProps<"a">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = "icon",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? "page" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? "outline" : "ghost",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = "PaginationLink"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label="Go to previous page"\n    size="default"\n    className={cn("gap-1 pl-2.5", className)}\n    {...props}\n  >\n    <ChevronLeft className="h-4 w-4" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = "PaginationPrevious"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label="Go to next page"\n    size="default"\n    className={cn("gap-1 pr-2.5", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className="h-4 w-4" />\n  </PaginationLink>\n)\nPaginationNext.displayName = "PaginationNext"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<"span">) => (\n  <span\n    aria-hidden\n    className={cn("flex h-9 w-9 items-center justify-center", className)}\n    {...props}\n  >\n    <MoreHorizontal className="h-4 w-4" />\n    <span className="sr-only">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = "PaginationEllipsis"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n\n',popover:'import * as React from "react"\nimport * as PopoverPrimitive from "@radix-ui/react-popover"\n\nimport { cn } from "../../lib/utils"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        "z-50 w-72 rounded-md border border-gray-200 bg-white p-4 text-gray-950 shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n\n',progress:'import * as React from "react"\nimport * as ProgressPrimitive from "@radix-ui/react-progress"\n\nimport { cn } from "../../lib/utils"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      "relative h-4 w-full overflow-hidden rounded-full bg-gray-100 dark:bg-gray-800",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className="h-full w-full flex-1 bg-gray-900 transition-all dark:bg-gray-50"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n',radioGroup:'import * as React from "react"\nimport * as RadioGroupPrimitive from "@radix-ui/react-radio-group"\nimport { Circle } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn("grid gap-2", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        "aspect-square h-4 w-4 rounded-full border border-gray-200 dark:border-gray-900 text-gray-900 ring-offset-white focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50  dark:text-gray-50 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">\n        <Circle className="h-2.5 w-2.5 fill-current text-current" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n\n',select:'import * as React from "react"\nimport * as SelectPrimitive from "@radix-ui/react-select"\nimport { Check, ChevronDown, ChevronUp } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      "flex h-10 w-full items-center justify-between rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus:ring-gray-300",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className="h-4 w-4 opacity-50" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      "flex cursor-default items-center justify-center py-1",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className="h-4 w-4" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      "flex cursor-default items-center justify-center py-1",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className="h-4 w-4" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = "popper", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        "relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white text-gray-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n        position === "popper" &&\n          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          "p-1",\n          position === "popper" &&\n            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <SelectPrimitive.ItemIndicator>\n        <Check className="h-4 w-4" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn("-mx-1 my-1 h-px bg-gray-100 dark:bg-gray-800", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n\n',separator:'import * as React from "react"\nimport * as SeparatorPrimitive from "@radix-ui/react-separator"\n\nimport { cn } from "../../lib/utils"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = "horizontal", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        "shrink-0 bg-gray-200 dark:bg-gray-800",\n        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n\n',skeleton:'import { cn } from "../../lib/utils"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn("animate-pulse rounded-md bg-gray-100 dark:bg-gray-800", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n',slider:'import * as React from "react"\nimport * as SliderPrimitive from "@radix-ui/react-slider"\n\nimport { cn } from "../../lib/utils"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      "relative flex w-full touch-none select-none items-center",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-gray-100 dark:bg-gray-800">\n      <SliderPrimitive.Range className="absolute h-full bg-gray-900 dark:bg-gray-50" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-gray-900 bg-white ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:border-gray-50 dark:bg-gray-950 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n\n',switchComponent:'import * as React from "react"\nimport * as SwitchPrimitives from "@radix-ui/react-switch"\n\nimport { cn } from "../../lib/utils"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 focus-visible:ring-offset-white disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-gray-900 data-[state=unchecked]:bg-gray-200 dark:focus-visible:ring-gray-300 dark:focus-visible:ring-offset-gray-950 dark:data-[state=checked]:bg-gray-50 dark:data-[state=unchecked]:bg-gray-800",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        "pointer-events-none block h-5 w-5 rounded-full bg-white shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0 dark:bg-gray-950"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n\n',table:'import * as React from "react"\n\nimport { cn } from "../../lib/utils"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className="relative w-full overflow-auto">\n    <table\n      ref={ref}\n      className={cn("w-full caption-bottom text-sm", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = "Table"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />\n))\nTableHeader.displayName = "TableHeader"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn("[&_tr:last-child]:border-0", className)}\n    {...props}\n  />\n))\nTableBody.displayName = "TableBody"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      "border-t bg-gray-100/50 font-medium [&>tr]:last:border-b-0 dark:bg-gray-800/50",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = "TableFooter"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      "border-b transition-colors hover:bg-gray-100/50 data-[state=selected]:bg-gray-100 dark:hover:bg-gray-800/50 dark:data-[state=selected]:bg-gray-800",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = "TableRow"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      "h-12 px-4 text-left align-middle font-medium text-gray-500 [&:has([role=checkbox])]:pr-0 dark:text-gray-400",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = "TableHead"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}\n    {...props}\n  />\n))\nTableCell.displayName = "TableCell"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn("mt-4 text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = "TableCaption"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n\n',tabs:'import * as React from "react"\nimport * as TabsPrimitive from "@radix-ui/react-tabs"\n\nimport { cn } from "../../lib/utils"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      "inline-flex h-10 items-center justify-center rounded-md bg-gray-100 p-1 text-gray-500 dark:bg-gray-800 dark:text-gray-400",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-950 data-[state=active]:shadow-sm dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300 dark:data-[state=active]:bg-gray-950 dark:data-[state=active]:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      "mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n\n',textarea:'import * as React from "react"\n\nimport { cn } from "../../lib/utils"\n\nexport interface TextareaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          "flex min-h-[80px] w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-gray-300",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nTextarea.displayName = "Textarea"\n\nexport { Textarea }\n\n',toast:'import * as React from "react"\nimport * as ToastPrimitives from "@radix-ui/react-toast"\nimport { cva, type VariantProps } from "class-variance-authority"\nimport { X } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border border-gray-200 p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full dark:border-gray-800",\n  {\n    variants: {\n      variant: {\n        default: "border bg-white text-gray-950 dark:bg-gray-950 dark:text-gray-50",\n        destructive:\n          "destructive group border-red-500 bg-red-500 text-gray-50 dark:border-red-900 dark:bg-red-900 dark:text-gray-50",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border border-gray-200 bg-transparent px-3 text-sm font-medium ring-offset-white transition-colors hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-gray-100/40 group-[.destructive]:hover:border-red-500/30 group-[.destructive]:hover:bg-red-500 group-[.destructive]:hover:text-gray-50 group-[.destructive]:focus:ring-red-500 dark:border-gray-800 dark:ring-offset-gray-950 dark:hover:bg-gray-800 dark:focus:ring-gray-300 dark:group-[.destructive]:border-gray-800/40 dark:group-[.destructive]:hover:border-red-900/30 dark:group-[.destructive]:hover:bg-red-900 dark:group-[.destructive]:hover:text-gray-50 dark:group-[.destructive]:focus:ring-red-900",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      "absolute right-2 top-2 rounded-md p-1 text-gray-950/50 opacity-0 transition-opacity hover:text-gray-950 focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600 dark:text-gray-50/50 dark:hover:text-gray-50",\n      className\n    )}\n    toast-close=""\n    {...props}\n  >\n    <X className="h-4 w-4" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn("text-sm font-semibold", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn("text-sm opacity-90", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n\n',toaster:'import {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from "./toast"\nimport { useToast } from "./use-toast"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className="grid gap-1">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n\n',toggleGroup:'import * as React from "react"\nimport * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"\nimport { type VariantProps } from "class-variance-authority"\n\nimport { cn } from "../../lib/utils"\nimport { toggleVariants } from "./toggle"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: "default",\n  variant: "default",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn("flex items-center justify-center gap-1", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n\n',toggle:'import * as React from "react"\nimport * as TogglePrimitive from "@radix-ui/react-toggle"\nimport { cva, type VariantProps } from "class-variance-authority"\n\nimport { cn } from "../../lib/utils"\n\nconst toggleVariants = cva(\n  "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-white transition-colors hover:bg-gray-100 hover:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-gray-100 data-[state=on]:text-gray-900 dark:ring-offset-gray-950 dark:hover:bg-gray-800 dark:hover:text-gray-400 dark:focus-visible:ring-gray-300 dark:data-[state=on]:bg-gray-800 dark:data-[state=on]:text-gray-50",\n  {\n    variants: {\n      variant: {\n        default: "bg-transparent",\n        outline:\n          "border border-gray-200 bg-transparent hover:bg-gray-100 hover:text-gray-900 dark:border-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-50",\n      },\n      size: {\n        default: "h-10 px-3",\n        sm: "h-9 px-2.5",\n        lg: "h-11 px-5",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n      size: "default",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n\n',tooltip:'import * as React from "react"\nimport * as TooltipPrimitive from "@radix-ui/react-tooltip"\n\nimport { cn } from "../../lib/utils"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      "z-50 overflow-hidden rounded-md border border-gray-200 bg-white px-3 py-1.5 text-sm text-gray-950 shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n\n',useToast:'import * as React from "react"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from "./toast"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: "ADD_TOAST",\n  UPDATE_TOAST: "UPDATE_TOAST",\n  DISMISS_TOAST: "DISMISS_TOAST",\n  REMOVE_TOAST: "REMOVE_TOAST",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType["ADD_TOAST"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType["UPDATE_TOAST"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType["DISMISS_TOAST"]\n      toastId?: ToasterToast["id"]\n    }\n  | {\n      type: ActionType["REMOVE_TOAST"]\n      toastId?: ToasterToast["id"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: "REMOVE_TOAST",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case "ADD_TOAST":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case "UPDATE_TOAST":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case "DISMISS_TOAST": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I\'ll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case "REMOVE_TOAST":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, "id">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: "UPDATE_TOAST",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })\n\n  dispatch({\n    type: "ADD_TOAST",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),\n  }\n}\n\nexport { useToast, toast }\n'};var fd=(e=>(e.Input="input",e.Textarea="textarea",e.Slider="slider",e.Checkbox="checkbox",e.Switch="switch",e.Dropdown="dropdown",e.Combobox="combobox",e.Tags="tags",e))(fd||{}),gd=(e=>(e.Conversation="conversation",e.Model="model",e.Custom="custom",e))(gd||{});const vd={providers:{serper:{serperApiKey:1}},scrapers:{firecrawl:{firecrawlApiKey:1,firecrawlApiUrl:0}},rerankers:{jina:{jinaApiKey:1},cohere:{cohereApiKey:1}}};!function(){const e=[];for(const t of Object.keys(vd)){const n=vd[t];for(const t of Object.keys(n)){const s=n[t];for(const t of Object.keys(s))e.push(t)}}}();var bd=(e=>(e.PROMPTS="PROMPTS",e.BOOKMARKS="BOOKMARKS",e.AGENTS="AGENTS",e.MEMORIES="MEMORIES",e.MULTI_CONVO="MULTI_CONVO",e.TEMPORARY_CHAT="TEMPORARY_CHAT",e.RUN_CODE="RUN_CODE",e.WEB_SEARCH="WEB_SEARCH",e))(bd||{}),yd=(e=>(e.SHARED_GLOBAL="SHARED_GLOBAL",e.USE="USE",e.CREATE="CREATE",e.UPDATE="UPDATE",e.READ="READ",e.READ_AUTHOR="READ_AUTHOR",e.SHARE="SHARE",e.OPT_OUT="OPT_OUT",e))(yd||{});const _d=Ya({SHARED_GLOBAL:nr().default(!1),USE:nr().default(!0),CREATE:nr().default(!0)}),jd=Ya({USE:nr().default(!0)}),wd=Ya({USE:nr().default(!0),CREATE:nr().default(!0),UPDATE:nr().default(!0),READ:nr().default(!0),OPT_OUT:nr().default(!0)}),Nd=Ya({SHARED_GLOBAL:nr().default(!1),USE:nr().default(!0),CREATE:nr().default(!0)}),Cd=Ya({USE:nr().default(!0)}),kd=Ya({USE:nr().default(!0)}),Sd=Ya({USE:nr().default(!0)}),Td=Ya({USE:nr().default(!0)}),Rd=Ya({PROMPTS:_d,BOOKMARKS:jd,MEMORIES:wd,AGENTS:Nd,MULTI_CONVO:Cd,TEMPORARY_CHAT:kd,RUN_CODE:Sd,WEB_SEARCH:Td});var Id=(e=>(e.ADMIN="ADMIN",e.USER="USER",e))(Id||{});const Ed=Ya({name:Xa(),permissions:Rd}),Md=Ya({ADMIN:Ed.extend({name:rr("ADMIN"),permissions:Rd.extend({[bd.PROMPTS]:_d.extend({[yd.SHARED_GLOBAL]:nr().default(!0),[yd.USE]:nr().default(!0),[yd.CREATE]:nr().default(!0)}),[bd.BOOKMARKS]:jd.extend({[yd.USE]:nr().default(!0)}),[bd.MEMORIES]:wd.extend({[yd.USE]:nr().default(!0),[yd.CREATE]:nr().default(!0),[yd.UPDATE]:nr().default(!0),[yd.READ]:nr().default(!0),[yd.OPT_OUT]:nr().default(!0)}),[bd.AGENTS]:Nd.extend({[yd.SHARED_GLOBAL]:nr().default(!0),[yd.USE]:nr().default(!0),[yd.CREATE]:nr().default(!0)}),[bd.MULTI_CONVO]:Cd.extend({[yd.USE]:nr().default(!0)}),[bd.TEMPORARY_CHAT]:kd.extend({[yd.USE]:nr().default(!0)}),[bd.RUN_CODE]:Sd.extend({[yd.USE]:nr().default(!0)}),[bd.WEB_SEARCH]:Td.extend({[yd.USE]:nr().default(!0)})})}),USER:Ed.extend({name:rr("USER"),permissions:Rd})}).parse({ADMIN:{name:"ADMIN",permissions:{[bd.PROMPTS]:{[yd.SHARED_GLOBAL]:!0,[yd.USE]:!0,[yd.CREATE]:!0},[bd.BOOKMARKS]:{[yd.USE]:!0},[bd.MEMORIES]:{[yd.USE]:!0,[yd.CREATE]:!0,[yd.UPDATE]:!0,[yd.READ]:!0,[yd.OPT_OUT]:!0},[bd.AGENTS]:{[yd.SHARED_GLOBAL]:!0,[yd.USE]:!0,[yd.CREATE]:!0},[bd.MULTI_CONVO]:{[yd.USE]:!0},[bd.TEMPORARY_CHAT]:{[yd.USE]:!0},[bd.RUN_CODE]:{[yd.USE]:!0},[bd.WEB_SEARCH]:{[yd.USE]:!0}}},USER:{name:"USER",permissions:{[bd.PROMPTS]:{},[bd.BOOKMARKS]:{},[bd.MEMORIES]:{},[bd.AGENTS]:{},[bd.MULTI_CONVO]:{},[bd.TEMPORARY_CHAT]:{},[bd.RUN_CODE]:{},[bd.WEB_SEARCH]:{}}}});var Pd=(e=>(e.messages="messages",e.sharedMessages="sharedMessages",e.sharedLinks="sharedLinks",e.allConversations="allConversations",e.archivedConversations="archivedConversations",e.searchConversations="searchConversations",e.conversation="conversation",e.searchEnabled="searchEnabled",e.user="user",e.name="name",e.models="models",e.balance="balance",e.endpoints="endpoints",e.presets="presets",e.searchResults="searchResults",e.tokenCount="tokenCount",e.availablePlugins="availablePlugins",e.startupConfig="startupConfig",e.assistants="assistants",e.assistant="assistant",e.agents="agents",e.agent="agent",e.endpointsConfigOverride="endpointsConfigOverride",e.files="files",e.fileConfig="fileConfig",e.tools="tools",e.toolAuth="toolAuth",e.toolCalls="toolCalls",e.agentTools="agentTools",e.actions="actions",e.assistantDocs="assistantDocs",e.agentDocs="agentDocs",e.fileDownload="fileDownload",e.voices="voices",e.customConfigSpeech="customConfigSpeech",e.prompts="prompts",e.prompt="prompt",e.promptGroups="promptGroups",e.allPromptGroups="allPromptGroups",e.promptGroup="promptGroup",e.categories="categories",e.randomPrompts="randomPrompts",e.roles="roles",e.conversationTags="conversationTags",e.health="health",e.userTerms="userTerms",e.banner="banner",e.memories="memories",e.brandConfig="brandConfig",e))(Pd||{}),Ld=(e=>(e.fileUpload="fileUpload",e.fileDelete="fileDelete",e.updatePreset="updatePreset",e.deletePreset="deletePreset",e.loginUser="loginUser",e.logoutUser="logoutUser",e.refreshToken="refreshToken",e.avatarUpload="avatarUpload",e.speechToText="speechToText",e.textToSpeech="textToSpeech",e.assistantAvatarUpload="assistantAvatarUpload",e.agentAvatarUpload="agentAvatarUpload",e.updateAction="updateAction",e.updateAgentAction="updateAgentAction",e.deleteAction="deleteAction",e.deleteAgentAction="deleteAgentAction",e.revertAgentVersion="revertAgentVersion",e.deleteUser="deleteUser",e.updateRole="updateRole",e.enableTwoFactor="enableTwoFactor",e.verifyTwoFactor="verifyTwoFactor",e.updateMemoryPreferences="updateMemoryPreferences",e))(Ld||{});function Ad(e){hr.defaults.headers.common.Authorization="Bearer "+e}const Od=e=>{const t=Object.entries(e).filter(([,e])=>Array.isArray(e)?e.length>0:null!=e&&""!==e).map(([e,t])=>Array.isArray(t)?t.map(t=>`${e}=${encodeURIComponent(t)}`).join("&"):`${e}=${encodeURIComponent(String(t))}`).join("&");return t?`?${t}`:""},Dd=e=>{const{conversationId:t,messageId:n,...s}=e;return t&&n?`/api/messages/${t}/${n}`:t?`/api/messages/${t}`:`/api/messages${Od(s)}`},zd="/api/share",Fd=e=>`${zd}/${e}`,Vd="/api/keys",$d="/api/convos",Bd=()=>`${$d}/update`,Ud=()=>"/api/prompts",Hd=({path:e="",options:t,version:n,endpoint:s,isAvatar:a})=>{let r=!0===a?`${Gd()}/assistants`:`/api/assistants/v${n}`;if(e&&""!==e&&(r+=`/${e}`),s&&(t={...t??{},endpoint:s}),t&&Object.keys(t).length>0){r+=`?${new URLSearchParams(t).toString()}`}return r},Kd=({path:e="",options:t})=>{let n="/api/agents";if(e&&""!==e&&(n+=`/${e}`),t&&Object.keys(t).length>0){n+=`?${new URLSearchParams(t).toString()}`}return n},Gd=()=>"/api/files/images",Wd=e=>`/api/prompts/groups/${e}`,qd=Ud,Qd=Wd,Zd=Wd,Jd=e=>`/api/roles/${e.toLowerCase()}`,Yd=e=>"/api/tags"+(null!=e&&e?`/${encodeURIComponent(e)}`:""),Xd=e=>`/api/memories/${encodeURIComponent(e)}`;async function eu(e,t){return(await hr.post(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})).data}let tu=!1,nu=[];const su=e=>eu((e=>"/api/auth/refresh"+(!0===e?"?retry=true":""))(e)),au=e=>{Ad(e),window.dispatchEvent(new CustomEvent("tokenUpdated",{detail:e}))},ru=(e,t=null)=>{nu.forEach(n=>{e?n.reject(e):n.resolve(t)}),nu=[]};hr.interceptors.response.use(e=>e,async e=>{var t,n,s;const a=e.config;if(!e.response)return Promise.reject(e);if(!0===(null==(t=a.url)?void 0:t.includes("/api/auth/2fa")))return Promise.reject(e);if(!0===(null==(n=a.url)?void 0:n.includes("/api/auth/logout")))return Promise.reject(e);if(401===e.response.status&&!a._retry){if(console.warn("401 error, refreshing token"),a._retry=!0,tu)try{const e=await new Promise((e,t)=>{nu.push({resolve:e,reject:t})});return a.headers.Authorization="Bearer "+e,await hr(a)}catch(r){return Promise.reject(r)}tu=!0;try{const e=await su(!0===(null==(s=a.url)?void 0:s.includes("api/auth/refresh"))),t=(null==e?void 0:e.token)??"";if(t)return a.headers.Authorization="Bearer "+t,au(t),ru(null,t),await hr(a);window.location.href.includes("share/")?console.log(`Refresh token failed from shared link, attempting request to ${a.url}`):window.location.href="/login"}catch(r){return ru(r,null),Promise.reject(r)}finally{tu=!1}}return Promise.reject(e)});const ou={get:async function(e,t){return(await hr.get(e,{...t})).data},getResponse:async function(e,t){return await hr.get(e,{...t})},post:eu,postMultiPart:async function(e,t,n){return(await hr.post(e,t,{...n,headers:{"Content-Type":"multipart/form-data"}})).data},postTTS:async function(e,t,n){return(await hr.post(e,t,{...n,headers:{"Content-Type":"multipart/form-data"},responseType:"arraybuffer"})).data},put:async function(e,t){return(await hr.put(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})).data},delete:async function(e){return(await hr.delete(e)).data},deleteWithOptions:async function(e,t){return(await hr.delete(e,{...t})).data},patch:async function(e,t){return(await hr.patch(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})).data},refreshToken:su,dispatchTokenUpdatedEvent:au};function iu(e){return ou.delete((e=>`${Vd}/${e}`)(e))}function lu(){return ou.delete(`${Vd}?all=true`)}const cu=async e=>{const{pageSize:t,isPublic:n,sortBy:s,sortDirection:a,search:r,cursor:o}=e;return ou.get(((e,t,n,s,a,r)=>`${zd}?pageSize=${e}&isPublic=${t}&sortBy=${n}&sortDirection=${s}${a?`&search=${a}`:""}${r?`&cursor=${r}`:""}`)(t,n,s,a,r,o))};function du(e){return ou.get((e=>`${zd}/link/${e}`)(e))}function uu(e){return ou.post((e=>`${zd}/${e}`)(e))}function mu(e){return ou.patch((e=>`${zd}/${e}`)(e))}function pu(e){const{value:t}=e;if(!t)throw new Error("value is required");return ou.put(Vd,e)}const hu=e=>ou.get((e=>`${Vd}?name=${e}`)(e));const xu=(e,t)=>{const n=t?{signal:t}:void 0;return ou.postMultiPart("/api/files",e,n)};const fu=({agent_id:e,version_index:t})=>ou.post((e=>`${Kd({path:`${e}/revert`})}`)(e),{version_index:t}),gu=e=>ou.postMultiPart(`${$d}/import`,e),vu=e=>ou.postMultiPart(`${Gd()}/avatar`,e);function bu(e){return ou.post(`${$d}/duplicate`,e)}function yu(e){return ou.post(`${$d}/fork`,e)}function _u(e){return ou.deleteWithOptions(`${$d}`,{data:{arg:e}})}function ju(){return ou.delete(`${$d}/all`)}const wu=e=>ou.get((e=>`${$d}${Od(e)}`)(e??{}));function Nu(e){return ou.get((e=>`${$d}/${e}`)(e))}function Cu(e){return ou.post(`${$d}/gen_title`,e)}function ku(e){return ou.get((e=>{let t="/api/prompts";Object.keys(e).length>0&&(t+=`?${new URLSearchParams(e).toString()}`);return t})(e))}function Su(e){return ou.get((e=>{let t="/api/prompts/groups";Object.keys(e).length>0&&(t+=`?${new URLSearchParams(e).toString()}`);return t})(e))}function Tu(e){return ou.put((t=e.roleName,`${Jd(t)}/prompts`),e.updates);var t}function Ru(e){return ou.put((t=e.roleName,`${Jd(t)}/agents`),e.updates);var t}function Iu(e){return ou.put((t=e.roleName,`${Jd(t)}/memories`),e.updates);var t}function Eu(){return ou.get(Yd())}function Mu(e,t){return ou.put((e=>`${Yd()}/convo/${e}`)(e),t)}const Pu={string:e=>{if(e.enum)return Ja(e.enum);let t=Xa();return void 0!==e.minLength&&(t=t.min(e.minLength)),void 0!==e.maxLength&&(t=t.max(e.maxLength)),t},number:e=>{let t=ar();return void 0!==e.minimum&&(t=t.min(e.minimum)),void 0!==e.maximum&&(t=t.max(e.maximum)),t},integer:e=>Pu.number(e).int(),boolean:()=>nr(),array:e=>{if(e.items){const t=Lu(e.items);return sr(t?t:cr())}return sr(cr())},object:e=>{const t={};return e.properties&&Object.entries(e.properties).forEach(([n,s])=>{const a=Lu(s);t[n]=a||cr(),e.required&&e.required.includes(n)?t[n]=t[n].describe(s.description||""):t[n]=t[n].optional().describe(s.description||"")}),Ya(t)}};function Lu(e){if("object"===e.type&&0===Object.keys(e.properties||{}).length)return;return(Pu[e.type]||(()=>cr()))(e)}class Au{constructor(e,t,n,s){this.name=e,this.description=t,this.parameters=n,this.strict=s??!1}toObjectTool(){const e={...this.parameters,additionalProperties:!this.strict&&void 0};return{type:ri.function,function:{name:this.name,description:this.description,parameters:e,...this.strict?{strict:this.strict}:{}}}}}class Ou{constructor(e,t,n,s,a,r,o){this.domain=e,this.basePath=t,this.method=n,this.operation=s,this.isConsequential=a,this.contentType=r,this.parameterLocations=o}}class Du{constructor(e){this.config=e,this.authHeaders={},this.path=e.basePath}setParams(e){var t;if(this.operationHash=(t=JSON.stringify(e),o.createHash("sha1").update(t).digest("hex")),this.params={...e},this.config.parameterLocations){for(const[n,s]of Object.entries(e))if("path"===this.config.parameterLocations[n]){const e=`{${n}}`;this.path.includes(e)&&(this.path=this.path.replace(e,encodeURIComponent(String(s))),delete this.params[n])}}else for(const[n,s]of Object.entries(e)){const e=`{${n}}`;this.path.includes(e)&&(this.path=this.path.replace(e,encodeURIComponent(String(s))),delete this.params[n])}return this}async setAuth(e){if(!e.auth)return this;const{type:t,authorization_type:n,custom_auth_header:s,authorization_url:a,client_url:o,scope:i,token_exchange_method:l}=e.auth,{api_key:c,oauth_client_id:d,oauth_client_secret:u,oauth_token_expires_at:m,oauth_access_token:p=""}=e,h=null!=c&&c.length>0&&t===Ll.ServiceHttp,x=!!(null!=d&&d&&null!=u&&u&&t===Ll.OAuth&&null!=a&&a&&null!=o&&o&&null!=i&&i&&l);if(h&&n===Al.Basic){const e=r.from(c).toString("base64");this.authHeaders.Authorization=`Basic ${e}`}else if(h&&n===Al.Bearer)this.authHeaders.Authorization=`Bearer ${c}`;else if(h&&n===Al.Custom&&null!=s&&s)this.authHeaders[s]=c;else if(x){const e=new Date;if(!p)throw new Error("No access token found. Please log in first.");if(m&&e>=new Date(m))throw new Error("Access token is expired. Please re-login.");this.authToken=p,this.authHeaders.Authorization=`Bearer ${this.authToken}`}return this}async execute(){const e=function(e,t){const n=e.replace(/\/$/,""),s=t.replace(/^\//,"");return new i(`${n}/${s}`).toString()}(this.config.domain,this.path),t={...this.authHeaders,...this.config.contentType?{"Content-Type":this.config.contentType}:{}},n=this.config.method.toLowerCase(),s=hr.create(),a={},r={};if(this.config.parameterLocations&&this.params)for(const o of Object.keys(this.params)){const e=this.config.parameterLocations[o]||("get"===n?"query":"body"),s=this.params[o];"query"===e?a[o]=s:"header"===e?t[o]=String(s):"body"===e&&(r[o]=s)}else this.params&&(Object.assign(a,this.params),Object.assign(r,this.params));if("get"===n)return s.get(e,{headers:t,params:a});if("post"===n)return s.post(e,r,{headers:t,params:a});if("put"===n)return s.put(e,r,{headers:t,params:a});if("delete"===n)return s.delete(e,{headers:t,data:r,params:a});if("patch"===n)return s.patch(e,r,{headers:t,params:a});throw new Error(`Unsupported HTTP method: ${n}`)}getConfig(){return this.config}}class zu{constructor(e,t,n,s,a,r,o){this.config=new Ou(e,t,n,s,a,r,o)}get domain(){return this.config.domain}get path(){return this.config.basePath}get method(){return this.config.method}get operation(){return this.config.operation}get isConsequential(){return this.config.isConsequential}get contentType(){return this.config.contentType}createExecutor(){return new Du(this.config)}setParams(e){const t=this.createExecutor();return t.setParams(e),t}async setAuth(e){return this.createExecutor().setAuth(e)}async execute(){return this.createExecutor().execute()}}function Fu(e,t){if("$ref"in e&&t){const n=e.$ref.replace(/^#\/components\//,"").split("/");let s=t;for(const t of n){if("object"!=typeof s||null===s||!(t in s))throw new Error(`Could not resolve reference: ${e.$ref}`);s=s[t]}return Fu(s,t)}return e}function Vu(e){return e.replace(/[^a-zA-Z0-9_-]/g,"")}function $u(e,t=!1){var n,s,a;const r=[],o={},i={},l=(null==(s=null==(n=e.servers)?void 0:n[0])?void 0:s.url)??"";for(const[c,d]of Object.entries(e.paths))for(const[n,s]of Object.entries(d)){const d={},u=s,m=`${n}_${c}`,p=u.operationId||Vu(m),h=u.summary||u.description||"",x=u["x-strict"]??!1,f={type:"object",properties:{},required:[]};if(u.parameters)for(const t of u.parameters??[]){const n=Fu(t,e.components),s=n.name;if(!s||!n.schema)continue;const a=Fu(n.schema,e.components);f.properties[s]=a,n.required&&f.required.push(s),d[s]="query"===n.in||"path"===n.in||"header"===n.in||"body"===n.in?n.in:"query"}if(u.requestBody){const t=u.requestBody.content,n=Object.keys(t??{})[0],s=Fu(null==(a=null==t?void 0:t[n])?void 0:a.schema,e.components);if(f.properties={...f.properties,...s.properties},s.required&&f.required.push(...s.required),s.properties)for(const e in s.properties)d[e]="body"}const g=new Au(p,h,f,x);r.push(g);const v=new zu(l,c,n,p,!!u["x-openai-isConsequential"],u.requestBody?"application/json":"",d);if(o[p]=v,t&&Object.keys(f.properties).length>0){const e=Lu(f);e&&(i[p]=e)}}return{functionSignatures:r,requestBuilders:o,zodSchemas:i}}function Bu(e){var t;try{let n;try{n=JSON.parse(e)}catch{n=a(e)}if(!n.servers||!Array.isArray(n.servers)||0===n.servers.length)return{status:!1,message:"Could not find a valid URL in `servers`"};if(!n.servers[0].url)return{status:!1,message:"Could not find a valid URL in `servers`"};const s=n.paths;if(!s||"object"!=typeof s||0===Object.keys(s).length)return{status:!1,message:"No paths found in the OpenAPI spec."};const r=(null==(t=n.components)?void 0:t.schemas)||{},o=[];for(const[e,t]of Object.entries(s))for(const[n,s]of Object.entries(t)){const{responses:t}=s;if("object"==typeof s&&t)for(const[s,a]of Object.entries(t)){const t=a.content;if(t&&t["application/json"]&&t["application/json"].schema){const a=t["application/json"].schema;if("$ref"in a&&"string"==typeof a.$ref){const t=a.$ref.split("/").pop();t&&!r[t]&&o.push(`In context=('paths', '${e}', '${n}', '${s}', 'response', 'content', 'application/json', 'schema'), reference to unknown component ${t}; using empty schema`)}}}}return{status:!0,message:o.join("\n")||"OpenAPI spec is valid.",spec:n}}catch(n){return console.error(n),{status:!1,message:"Error parsing OpenAPI spec."}}}const Uu={model:{key:"model",label:"com_ui_model",labelCode:!0,type:"string",component:"dropdown",optionType:"model",selectPlaceholder:"com_ui_select_model",searchPlaceholder:"com_ui_select_search_model",searchPlaceholderCode:!0,selectPlaceholderCode:!0,columnSpan:4},temperature:{key:"temperature",label:"com_endpoint_temperature",labelCode:!0,description:"com_endpoint_openai_temp",descriptionCode:!0,type:"number",component:"slider",optionType:"model",columnSpan:4},topP:{key:"topP",label:"com_endpoint_top_p",labelCode:!0,description:"com_endpoint_anthropic_topp",descriptionCode:!0,type:"number",component:"slider",optionType:"model",columnSpan:4},stop:{key:"stop",label:"com_endpoint_stop",labelCode:!0,description:"com_endpoint_openai_stop",descriptionCode:!0,placeholder:"com_endpoint_stop_placeholder",placeholderCode:!0,type:"array",default:[],component:"tags",optionType:"conversation",minTags:0,maxTags:4},imageDetail:{key:"imageDetail",label:"com_endpoint_plug_image_detail",labelCode:!0,description:"com_endpoint_openai_detail",descriptionCode:!0,type:"enum",default:Ci.auto,component:"slider",options:[Ci.low,Ci.auto,Ci.high],optionType:"conversation",columnSpan:2}},Hu=(e,t)=>({...e,...t}),Ku={modelLabel:{key:"modelLabel",label:"com_endpoint_custom_name",labelCode:!0,type:"string",default:"",component:"input",placeholder:"com_endpoint_openai_custom_name_placeholder",placeholderCode:!0,optionType:"conversation"},maxContextTokens:{key:"maxContextTokens",label:"com_endpoint_context_tokens",labelCode:!0,type:"number",component:"input",placeholder:"com_nav_theme_system",placeholderCode:!0,description:"com_endpoint_context_info",descriptionCode:!0,optionType:"model",columnSpan:2},resendFiles:{key:"resendFiles",label:"com_endpoint_plug_resend_files",labelCode:!0,description:"com_endpoint_openai_resend_files",descriptionCode:!0,type:"boolean",default:!0,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2},promptPrefix:{key:"promptPrefix",label:"com_endpoint_prompt_prefix",labelCode:!0,type:"string",default:"",component:"textarea",placeholder:"com_endpoint_openai_prompt_prefix_placeholder",placeholderCode:!0,optionType:"model"}},Gu={chatGptLabel:{...Ku.modelLabel},temperature:Hu(Uu.temperature,{default:Pi.temperature.default,range:{min:Pi.temperature.min,max:Pi.temperature.max,step:Pi.temperature.step}}),top_p:Hu(Uu.topP,{key:"top_p",default:Pi.top_p.default,range:{min:Pi.top_p.min,max:Pi.top_p.max,step:Pi.top_p.step}}),frequency_penalty:{key:"frequency_penalty",label:"com_endpoint_frequency_penalty",labelCode:!0,description:"com_endpoint_openai_freq",descriptionCode:!0,type:"number",default:Pi.frequency_penalty.default,range:{min:Pi.frequency_penalty.min,max:Pi.frequency_penalty.max,step:Pi.frequency_penalty.step},component:"slider",optionType:"model",columnSpan:4},presence_penalty:{key:"presence_penalty",label:"com_endpoint_presence_penalty",labelCode:!0,description:"com_endpoint_openai_pres",descriptionCode:!0,type:"number",default:Pi.presence_penalty.default,range:{min:Pi.presence_penalty.min,max:Pi.presence_penalty.max,step:Pi.presence_penalty.step},component:"slider",optionType:"model",columnSpan:4},max_tokens:{key:"max_tokens",label:"com_endpoint_max_output_tokens",labelCode:!0,type:"number",component:"input",description:"com_endpoint_openai_max_tokens",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,optionType:"model",columnSpan:2},reasoning_effort:{key:"reasoning_effort",label:"com_endpoint_reasoning_effort",labelCode:!0,description:"com_endpoint_openai_reasoning_effort",descriptionCode:!0,type:"enum",default:ki.medium,component:"slider",options:[ki.low,ki.medium,ki.high],optionType:"model",columnSpan:4}},Wu={maxOutputTokens:{key:"maxOutputTokens",label:"com_endpoint_max_output_tokens",labelCode:!0,type:"number",component:"input",description:"com_endpoint_anthropic_maxoutputtokens",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,range:{min:Oi.maxOutputTokens.min,max:Oi.maxOutputTokens.max,step:Oi.maxOutputTokens.step},optionType:"model",columnSpan:2},temperature:Hu(Uu.temperature,{default:Oi.temperature.default,range:{min:Oi.temperature.min,max:Oi.temperature.max,step:Oi.temperature.step}}),topP:Hu(Uu.topP,{default:Oi.topP.default,range:{min:Oi.topP.min,max:Oi.topP.max,step:Oi.topP.step}}),topK:{key:"topK",label:"com_endpoint_top_k",labelCode:!0,description:"com_endpoint_anthropic_topk",descriptionCode:!0,type:"number",default:Oi.topK.default,range:{min:Oi.topK.min,max:Oi.topK.max,step:Oi.topK.step},component:"slider",optionType:"model",columnSpan:4},promptCache:{key:"promptCache",label:"com_endpoint_prompt_cache",labelCode:!0,description:"com_endpoint_anthropic_prompt_cache",descriptionCode:!0,type:"boolean",default:Oi.promptCache.default,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2},thinking:{key:"thinking",label:"com_endpoint_thinking",labelCode:!0,description:"com_endpoint_anthropic_thinking",descriptionCode:!0,type:"boolean",default:Oi.thinking.default,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2},thinkingBudget:{key:"thinkingBudget",label:"com_endpoint_thinking_budget",labelCode:!0,description:"com_endpoint_anthropic_thinking_budget",descriptionCode:!0,type:"number",component:"input",default:Oi.thinkingBudget.default,range:{min:Oi.thinkingBudget.min,max:Oi.thinkingBudget.max,step:Oi.thinkingBudget.step},optionType:"conversation",columnSpan:2}},qu={system:{key:"system",label:"com_endpoint_prompt_prefix",labelCode:!0,type:"string",default:"",component:"textarea",placeholder:"com_endpoint_openai_prompt_prefix_placeholder",placeholderCode:!0,optionType:"model"},region:{key:"region",type:"string",label:"com_ui_region",labelCode:!0,component:"combobox",optionType:"conversation",selectPlaceholder:"com_ui_select_region",searchPlaceholder:"com_ui_select_search_region",searchPlaceholderCode:!0,selectPlaceholderCode:!0,columnSpan:2},maxTokens:{key:"maxTokens",label:"com_endpoint_max_output_tokens",labelCode:!0,type:"number",component:"input",placeholder:"com_endpoint_anthropic_maxoutputtokens",placeholderCode:!0,optionType:"model",columnSpan:2},temperature:Hu(Uu.temperature,{default:1,range:{min:0,max:1,step:.01}}),topK:Hu(Wu.topK,{range:{min:0,max:500,step:1}}),topP:Hu(Uu.topP,{default:.999,range:{min:0,max:1,step:.01}})},Qu={temperature:Hu(Uu.temperature,{default:.7,range:{min:0,max:1,step:.01}}),topP:Hu(Uu.topP,{range:{min:0,max:1,step:.01}})},Zu={temperature:Hu(Uu.temperature,{default:.3,range:{min:0,max:1,step:.01}}),topP:Hu(Uu.topP,{default:.75,range:{min:.01,max:.99,step:.01}})},Ju={temperature:Hu(Uu.temperature,{default:.5,range:{min:0,max:1,step:.01}}),topP:Hu(Uu.topP,{default:.9,range:{min:0,max:1,step:.01}})},Yu={temperature:Hu(Uu.temperature,{default:Li.temperature.default,range:{min:Li.temperature.min,max:Li.temperature.max,step:Li.temperature.step}}),topP:Hu(Uu.topP,{default:Li.topP.default,range:{min:Li.topP.min,max:Li.topP.max,step:Li.topP.step}}),topK:{key:"topK",label:"com_endpoint_top_k",labelCode:!0,description:"com_endpoint_google_topk",descriptionCode:!0,type:"number",default:Li.topK.default,range:{min:Li.topK.min,max:Li.topK.max,step:Li.topK.step},component:"slider",optionType:"model",columnSpan:4},maxOutputTokens:{key:"maxOutputTokens",label:"com_endpoint_max_output_tokens",labelCode:!0,type:"number",component:"input",description:"com_endpoint_google_maxoutputtokens",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,default:Li.maxOutputTokens.default,range:{min:Li.maxOutputTokens.min,max:Li.maxOutputTokens.max,step:Li.maxOutputTokens.step},optionType:"model",columnSpan:2},thinking:{key:"thinking",label:"com_endpoint_thinking",labelCode:!0,description:"com_endpoint_google_thinking",descriptionCode:!0,type:"boolean",default:Li.thinking.default,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2},thinkingBudget:{key:"thinkingBudget",label:"com_endpoint_thinking_budget",labelCode:!0,description:"com_endpoint_google_thinking_budget",descriptionCode:!0,placeholder:"com_ui_auto",placeholderCode:!0,type:"number",component:"input",range:{min:Li.thinkingBudget.min,max:Li.thinkingBudget.max,step:Li.thinkingBudget.step},optionType:"conversation",columnSpan:2}},Xu=[Ku.modelLabel,Ku.promptPrefix,Ku.maxContextTokens,Yu.maxOutputTokens,Yu.temperature,Yu.topP,Yu.topK,Ku.resendFiles,Yu.thinking,Yu.thinkingBudget],em=[Uu.model,Ku.modelLabel,Ku.promptPrefix],tm=[Ku.maxContextTokens,Yu.maxOutputTokens,Yu.temperature,Yu.topP,Yu.topK,Ku.resendFiles,Yu.thinking,Yu.thinkingBudget],nm=[Ku.modelLabel,Ku.promptPrefix,Ku.maxContextTokens,Gu.max_tokens,Gu.temperature,Gu.top_p,Gu.frequency_penalty,Gu.presence_penalty,Uu.stop,Ku.resendFiles,Uu.imageDetail,Gu.reasoning_effort],sm=[Uu.model,Ku.modelLabel,Ku.promptPrefix],am=[Ku.maxContextTokens,Gu.max_tokens,Gu.temperature,Gu.top_p,Gu.frequency_penalty,Gu.presence_penalty,Uu.stop,Gu.reasoning_effort,Ku.resendFiles,Uu.imageDetail],rm=[Ku.modelLabel,Ku.promptPrefix,Ku.maxContextTokens,Wu.maxOutputTokens,Wu.temperature,Wu.topP,Wu.topK,Ku.resendFiles,Wu.promptCache,Wu.thinking,Wu.thinkingBudget],om=[Uu.model,Ku.modelLabel,Ku.promptPrefix],im=[Ku.maxContextTokens,Wu.maxOutputTokens,Wu.temperature,Wu.topP,Wu.topK,Ku.resendFiles,Wu.promptCache,Wu.thinking,Wu.thinkingBudget],lm=[Ku.modelLabel,qu.system,Ku.maxContextTokens,qu.maxTokens,qu.temperature,qu.topP,qu.topK,Uu.stop,Ku.resendFiles,qu.region,Wu.thinking,Wu.thinkingBudget],cm=[Ku.modelLabel,Ku.promptPrefix,Ku.maxContextTokens,qu.maxTokens,Qu.temperature,Qu.topP,Ku.resendFiles,qu.region],dm=[Ku.modelLabel,Ku.promptPrefix,Ku.maxContextTokens,qu.maxTokens,Zu.temperature,Zu.topP,Ku.resendFiles,qu.region],um=[Ku.modelLabel,Ku.promptPrefix,Ku.maxContextTokens,Ju.temperature,Ju.topP,Ku.resendFiles,qu.region],mm=[Uu.model,Ku.modelLabel,qu.system,Uu.stop],pm=[Ku.maxContextTokens,qu.maxTokens,qu.temperature,qu.topP,qu.topK,Ku.resendFiles,qu.region,Wu.thinking,Wu.thinkingBudget],hm=[Uu.model,Ku.modelLabel,Ku.promptPrefix],xm=[Ku.maxContextTokens,qu.maxTokens,Qu.temperature,Qu.topP,Ku.resendFiles,qu.region],fm=[Uu.model,Ku.modelLabel,Ku.promptPrefix],gm=[Ku.maxContextTokens,qu.maxTokens,Zu.temperature,Zu.topP,Ku.resendFiles,qu.region],vm=[Uu.model,Ku.modelLabel,Ku.promptPrefix],bm=[Ku.maxContextTokens,Ju.temperature,Ju.topP,Ku.resendFiles,qu.region],ym={[vi.openAI]:nm,[vi.azureOpenAI]:nm,[vi.custom]:nm,[vi.anthropic]:rm,[`${vi.bedrock}-${yi.Anthropic}`]:lm,[`${vi.bedrock}-${yi.MistralAI}`]:cm,[`${vi.bedrock}-${yi.Cohere}`]:dm,[`${vi.bedrock}-${yi.Meta}`]:um,[`${vi.bedrock}-${yi.AI21}`]:um,[`${vi.bedrock}-${yi.Amazon}`]:um,[`${vi.bedrock}-${yi.DeepSeek}`]:um,[vi.google]:Xu},_m={col1:sm,col2:am},jm={col1:vm,col2:bm},wm={[vi.openAI]:_m,[vi.azureOpenAI]:_m,[vi.custom]:_m,[vi.anthropic]:{col1:om,col2:im},[`${vi.bedrock}-${yi.Anthropic}`]:{col1:mm,col2:pm},[`${vi.bedrock}-${yi.MistralAI}`]:{col1:hm,col2:xm},[`${vi.bedrock}-${yi.Cohere}`]:{col1:fm,col2:gm},[`${vi.bedrock}-${yi.Meta}`]:jm,[`${vi.bedrock}-${yi.AI21}`]:jm,[`${vi.bedrock}-${yi.Amazon}`]:jm,[`${vi.bedrock}-${yi.DeepSeek}`]:jm,[vi.google]:{col1:em,col2:tm}},Nm=Object.entries(wm).reduce((e,[t,n])=>(n&&(e[t]=n.col2),e),{});function Cm(){return l.jsxs(l.Fragment,{children:[l.jsx("path",{d:"M21.333 23L26.333 18L21.333 13",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),l.jsx("path",{d:"M14.667 13L9.66699 18L14.667 23",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})]})}const km=["text/x-"],Sm={paths:function(){return l.jsxs(l.Fragment,{children:[l.jsx("path",{d:"M19.6663 9.66663H12.9997C12.5576 9.66663 12.1337 9.84222 11.8212 10.1548C11.5086 10.4673 11.333 10.8913 11.333 11.3333V24.6666C11.333 25.1087 11.5086 25.5326 11.8212 25.8451C12.1337 26.1577 12.5576 26.3333 12.9997 26.3333H22.9997C23.4417 26.3333 23.8656 26.1577 24.1782 25.8451C24.4907 25.5326 24.6663 25.1087 24.6663 24.6666V14.6666L19.6663 9.66663Z",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),l.jsx("path",{d:"M19.667 9.66663V14.6666H24.667",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),l.jsx("path",{d:"M21.3337 18.8334H14.667",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),l.jsx("path",{d:"M21.3337 22.1666H14.667",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),l.jsx("path",{d:"M16.3337 15.5H15.5003H14.667",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})]})},fill:"#FF5588",title:"Document"},Tm={paths:function(){return l.jsx(l.Fragment,{children:l.jsx("path",{d:"M15.5 10.5H12.1667C11.2462 10.5 10.5 11.2462 10.5 12.1667V13.5V18M15.5 10.5H23.8333C24.7538 10.5 25.5 11.2462 25.5 12.1667V13.5V18M15.5 10.5V25.5M15.5 25.5H18H23.8333C24.7538 25.5 25.5 24.7538 25.5 23.8333V18M15.5 25.5H12.1667C11.2462 25.5 10.5 24.7538 10.5 23.8333V18M10.5 18H25.5",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})})},fill:"#6b7280",title:"Spreadsheet"},Rm={file:{paths:function(){return l.jsxs(l.Fragment,{children:[l.jsx("path",{d:"M18.833 9.66663H12.9997C12.5576 9.66663 12.1337 9.84222 11.8212 10.1548C11.5086 10.4673 11.333 10.8913 11.333 11.3333V24.6666C11.333 25.1087 11.5086 25.5326 11.8212 25.8451C12.1337 26.1577 12.5576 26.3333 12.9997 26.3333H22.9997C23.4417 26.3333 23.8656 26.1577 24.1782 25.8451C24.4907 25.5326 24.6663 25.1087 24.6663 24.6666V15.5L18.833 9.66663Z",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"}),l.jsx("path",{d:"M18.833 9.66663V15.5H24.6663",stroke:"white",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})]})},fill:"#0000FF",title:"File"},text:Sm,txt:Sm,csv:Tm,"application/pdf":Sm,pdf:Sm,"text/x-":{paths:Cm,fill:"#FF6E3C",title:"Code"},artifact:{paths:Cm,fill:"#2D305C",title:"Code"}},Im=(e="")=>{if(Rm[e])return Rm[e];if(vl.test(e))return Tm;const t=km.find(t=>e.includes(t));if(t&&Rm[t])return Rm[t];const n=e.split("/")[0]||"text";return Rm[n]?Rm[n]:Rm.file};function Em(e,t=!1){if(!e)return"";const n=new Date(e);if(t)return n.toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"2-digit"});return`${n.getDate()} ${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()]} ${n.getFullYear()}`}function Mm(e,t){const n=e.getQueryData([Pd.files]);if(!n)return void console.warn("No current files found in cache, skipped updating file query cache");n.findIndex(e=>e.file_id===t.file_id)>-1?console.warn("File already exists in cache, skipped updating file query cache"):e.setQueryData([Pd.files],[{...t},...n])}function Pm(e,t=2){if(0===e)return 0;const n=t<0?0:t,s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(n))}const{checkType:Lm}=kl,Am=/\$\\ce\{/g,Om=/\$\\pu\{/g,Dm=/\$\\\\ce\{[^}]*\}\$/g,zm=/\$\\\\pu\{[^}]*\}\$/g,Fm=new RegExp("(?<![\\\\$])\\$(?!\\$)(?=\\d{1,3}(?:,\\d{3})*(?:\\.\\d{1,2})?(?:\\s|$|[^a-zA-Z\\d]))","g"),Vm=new RegExp("(?<!\\\\)\\$(?!\\$)((?:[^$\\n]|\\\\[$])+?)(?<!\\\\)\\$(?!\\$)","g");function $m(e,t){let n=0,s=t.length-1;for(;n<=s;){const a=Math.floor((n+s)/2),[r,o]=t[a];if(e>=r&&e<=o)return!0;e<r?s=a-1:n=a+1}return!1}function Bm(e){if(!e.includes("$"))return e;let t=e;(e.includes("\\ce{")||e.includes("\\pu{"))&&(t=function(e){let t=e.replace(Am,"$\\\\ce{");return t=t.replace(Om,"$\\\\pu{"),t=t.replace(Dm,e=>`$${e}$`),t=t.replace(zm,e=>`$${e}$`),t}(e));const n=function(e){const t=[];let n=-1,s=-1;for(let a=0;a<e.length;a++){const r=e[a];"`"===r&&a+2<e.length&&"`"===e[a+1]&&"`"===e[a+2]?-1===s?(s=a,a+=2):(t.push([s,a+2]),s=-1,a+=2):"`"===r&&-1===s&&(-1===n?n=a:(t.push([n,a]),n=-1))}return t}(t),s=[];let a,r=0;for(Fm.lastIndex=0;null!==(a=Fm.exec(t));)$m(a.index,n)||(s.push(t.substring(r,a.index)),s.push("\\$"),r=a.index+1);s.push(t.substring(r)),t=s.join("");const o=[];for(r=0,Vm.lastIndex=0;null!==(a=Vm.exec(t));)$m(a.index,n)||(o.push(t.substring(r,a.index)),o.push(`$$${a[1]}$$`),r=a.index+a[0].length);return o.push(t.substring(r)),o.join("")}const Um=e=>{const t=document.documentElement;switch(e.split("-")[1]){case"xs":t.style.setProperty("--markdown-font-size","0.75rem");break;case"sm":t.style.setProperty("--markdown-font-size","0.875rem");break;case"base":t.style.setProperty("--markdown-font-size","1rem");break;case"lg":t.style.setProperty("--markdown-font-size","1.125rem");break;case"xl":t.style.setProperty("--markdown-font-size","1.25rem")}},Hm=()=>{if("undefined"!=typeof window&&window.localStorage){const e=window.localStorage.getItem("color-theme");if("string"==typeof e)return e;if(window.matchMedia("(prefers-color-scheme: dark)").matches)return"dark"}return"light"},Km=e=>t=>{t?"string"!=typeof t?t.value&&e(t.value+""):e(t):e("")},Gm=e=>({label:Oc[e]??e,value:e}),Wm=()=>({...Ii,model:localStorage.getItem(Jc.LAST_AGENT_MODEL)??"",provider:Gm(localStorage.getItem(Jc.LAST_AGENT_PROVIDER)??"")}),qm=({agent:e,fileMap:t,instanceProjectId:n})=>{var s,a,r,o,i,d,u,m,p,h,x,f,g;const v=(null!=n&&(null==(s=null==e?void 0:e.projectIds)?void 0:s.includes(n)))??!1,b={...e??{},label:(null==e?void 0:e.name)??"",value:(null==e?void 0:e.id)??"",icon:v?l.jsx(c,{className:"icon-md text-black dark:text-white"}):null,context_files:(null==(r=null==(a=null==e?void 0:e.tool_resources)?void 0:a.ocr)?void 0:r.file_ids)?[]:void 0,knowledge_files:(null==(i=null==(o=null==e?void 0:e.tool_resources)?void 0:o.file_search)?void 0:i.file_ids)?[]:void 0,code_files:(null==(u=null==(d=null==e?void 0:e.tool_resources)?void 0:d.execute_code)?void 0:u.file_ids)?[]:void 0};if(!t)return b;const y=({file_id:e,tool_resource:n,list:s})=>{const a=t[e],r=n===oi.file_search?Ml.vectordb:(null==a?void 0:a.source)??Ml.local;a?null==s||s.push([e,{file_id:a.file_id,type:a.type,filepath:a.filepath,filename:a.filename,width:a.width,height:a.height,size:a.bytes,preview:a.filepath,metadata:a.metadata,progress:1,source:r}]):null==s||s.push([e,{file_id:e,type:"",filename:"",size:1,progress:1,filepath:vi.agents,source:r}])};return b.context_files&&(null==(p=null==(m=null==e?void 0:e.tool_resources)?void 0:m.ocr)?void 0:p.file_ids)&&e.tool_resources.ocr.file_ids.forEach(e=>y({file_id:e,list:b.context_files,tool_resource:oi.ocr})),b.knowledge_files&&(null==(x=null==(h=null==e?void 0:e.tool_resources)?void 0:h.file_search)?void 0:x.file_ids)&&e.tool_resources.file_search.file_ids.forEach(e=>y({file_id:e,list:b.knowledge_files,tool_resource:oi.file_search})),b.code_files&&(null==(g=null==(f=null==e?void 0:e.tool_resources)?void 0:f.execute_code)?void 0:g.file_ids)&&e.tool_resources.execute_code.file_ids.forEach(e=>y({file_id:e,list:b.code_files,tool_resource:oi.execute_code})),b},Qm={today:"com_ui_date_today",yesterday:"com_ui_date_yesterday",previous7Days:"com_ui_date_previous_7_days",previous30Days:"com_ui_date_previous_30_days",january:"com_ui_date_january",february:"com_ui_date_february",march:"com_ui_date_march",april:"com_ui_date_april",may:"com_ui_date_may",june:"com_ui_date_june",july:"com_ui_date_july",august:"com_ui_date_august",september:"com_ui_date_september",october:"com_ui_date_october",november:"com_ui_date_november",december:"com_ui_date_december"},Zm=new Map([["december",11],["november",10],["october",9],["september",8],["august",7],["july",6],["june",5],["may",4],["april",3],["march",2],["february",1],["january",0]]),Jm=Object.fromEntries(Object.entries(Qm).map(([e,t])=>[t,e])),Ym=new Set([Qm.today,Qm.yesterday,Qm.previous7Days,Qm.previous30Days]),Xm=e=>{if(!Array.isArray(e))return[];const t=new Set,n=new Map,s=new Date(Date.now());e.forEach(e=>{if(!e||t.has(e.conversationId))return;let a;t.add(e.conversationId),a=e.updatedAt?xr(e.updatedAt):s;const r=(e=>{const t=new Date(Date.now());if(fr(e))return Qm.today;if(gr(e,{start:vr(br(t,1)),end:t}))return Qm.yesterday;if(gr(e,{start:br(t,7),end:t}))return Qm.previous7Days;if(gr(e,{start:br(t,30),end:t}))return Qm.previous30Days;if(gr(e,{start:yr(t),end:t})){const t=_r(e,"MMMM").toLowerCase();return Qm[t]}return" "+jr(e).toString()})(a);n.has(r)||n.set(r,[]),n.get(r).push(e)});const a=new Map;Ym.forEach(e=>{n.has(e)&&a.set(e,n.get(e))});return Array.from(n.keys()).filter(e=>!Ym.has(e)).sort((e,t)=>{const[n,s]=[parseInt(e.trim()),parseInt(t.trim())];if(n!==s)return s-n;const[a,r]=[Jm[e],Jm[t]];return(Zm.get(r)??-1)-(Zm.get(a)??-1)}).forEach(e=>{a.set(e,n.get(e))}),a.forEach(e=>{e.sort((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime())}),Array.from(a,([e,t])=>[e,t])};function ep(e,t){if(e)for(const n of e.pages){const e=n.conversations.find(e=>e.conversationId===t);if(e)return e}}function tp(e,t){const n=e.getQueryCache().findAll([Pd.allConversations],{exact:!1});for(const s of n)e.setQueryData(s.queryKey,e=>e?e.pages.some(e=>e.conversations.some(e=>e.conversationId===t.conversationId))?e:{...e,pages:[{...e.pages[0],conversations:[t,...e.pages[0].conversations]},...e.pages.slice(1)]}:e)}function np(e,t,n){const s=e.getQueryCache().findAll([Pd.allConversations],{exact:!1});for(const a of s)e.setQueryData(a.queryKey,e=>e?{...e,pages:e.pages.map(e=>({...e,conversations:e.conversations.map(e=>e.conversationId===t?n(e):e)}))}:e)}function sp(e,t){const n=e.getQueryCache().findAll([Pd.allConversations],{exact:!1});for(const s of n)e.setQueryData(s.queryKey,e=>e?{...e,pages:e.pages.map(e=>({...e,conversations:e.conversations.filter(e=>e.conversationId!==t)})).filter(e=>e.conversations.length>0)}:e)}const ap=(e,t)=>{const{endpoint:n,title:s,model:a,tools:r,promptPrefix:o,chatGptLabel:i,modelLabel:l}=e,c=a??"";let d="",u="";return l&&(u=l),u&&null!=s&&s&&u.toLowerCase().includes(s.toLowerCase())?(d=u+": ",u=""):null!=s&&s&&"New Chat"!==s.trim()&&(d=s+": "),!0===t?`${c}${u?` | ${u}`:""}${null!=o&&o?` | ${o}`:""}${r?` | ${r.map(e=>"string"==typeof e?e:e.pluginKey).join(", ")}`:""}`:`${d}${c}${u?` (${u})`:""}`.trim()},rp=(e,t)=>{const n={...e};return n.tools&&n.tools.length>0&&(n.tools=n.tools.filter(e=>{let n;return"string"==typeof e?n=e:({pluginKey:n}=e),!!t[n]}).map(e=>"string"==typeof e?e:e.pluginKey)),n},op=e=>Array.from(e.matchAll(/{{([^{}]+?)}}/gi)).map(e=>e[1].trim().toLowerCase()).some(e=>!ed[e]),ip=e=>`{{${e}}}`;function lp(e,t){if(e.focus(),window.getSelection()&&document.queryCommandSupported("insertText"))document.execCommand("insertText",!1,t);else{console.warn("insertTextAtCursor: document.execCommand is not supported");const n=e.selectionStart,s=e.selectionEnd,a=e.value.substring(0,n),r=e.value.substring(s);e.value=a+t+r,e.selectionStart=e.selectionEnd=n+t.length;const o=new Event("input",{bubbles:!0});e.dispatchEvent(o)}}const cp=e=>{e&&(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)};function dp(e,t){e.value.endsWith(t)&&(e.value=e.value.slice(0,-1),e.setSelectionRange(e.value.length,e.value.length),e.dispatchEvent(new Event("input",{bubbles:!0}))),e.focus()}const up=e=>!!e&&e.scrollHeight>e.clientHeight,mp=(e,t)=>{if(!e)return"";if(e.text)return e.text;if(e.content&&e.content.length>0)for(let n=e.content.length-1;n>=0;n--){const s=e.content[n];if(s&&s.type!==td.TEXT)continue;const a=("string"==typeof(null==s?void 0:s.text)?s.text:null==s?void 0:s.text.value)??"";if(a.length>0)return!0===t?`${a}-${n}`:a}return""},pp=(e,t)=>{if(!e)return"";const n=mp(e,!0);return`${e.messageId??""}${Zc.COMMON_DIVIDER}${s=n,"string"!=typeof s||0===s.length?"0":`${s.length}${s.slice(-10)}`}${Zc.COMMON_DIVIDER}${e.conversationId??t}`;var s},hp=["python","javascript","java","go","bash","c","cpp","csharp","css","diff","graphql","json","kotlin","less","lua","makefile","markdown","objectivec","perl","php","php-template","plaintext","python-repl","r","ruby","rust","scss","shell","sql","swift","typescript","vbnet","wasm","xml","yaml"],xp={c:"c",cpp:"cpp","c++":"cpp",cplusplus:"cpp",d:"d",f90:"f90",fortran:"f90",fortran90:"f90",go:"go",golang:"go",java:"java",js:"js",javascript:"js",node:"js",nodejs:"js",php:"php",py:"py",python:"py",python3:"py",rs:"rs",rust:"rs",ts:"ts",typescript:"ts"};function fp(e,t,n){if(!e||null==t)return;const s=e[t];return s?s[n]:void 0}function gp(e){const t=(e=>{const t={};if(!e)return t;for(const n of Object.keys(e))t[n]=!!e[n];return t})(e);return((e,t)=>{var n,s;const a=new Set(Ac),r=[];for(const o in t)(e[o]||(null==(n=t[o])?void 0:n.type)&&a.has(null==(s=t[o])?void 0:s.type))&&r.push(o);return r})(t,e).sort((t,n)=>{var s,a;return((null==(s=null==e?void 0:e[t])?void 0:s.order)??0)-((null==(a=null==e?void 0:e[n])?void 0:a.order)??0)})}const vp=Jc.LAST_CONVO_SETUP+"_0";function bp(e){const{conversation:t,newEndpoint:n,endpointsConfig:s,modularChat:a=!1}=e,r=null==t?void 0:t.endpoint,o={...t,endpoint:n,conversationId:"new"},i=ji(n)&&ji(r)&&r===n,l=(null==t?void 0:t.conversationId)??"",c=!(!l||"new"===l),d=fp(s,r,"type")??r,u=fp(s,n,"type")??n,m=Bc.has(r??""),p=Bc.has(d??""),h=m||p||i,x=Bc.has(n??""),f=Bc.has(u??"");return{template:o,shouldSwitch:r===n||a||i,isExistingConversation:c,isCurrentModular:h,newEndpointType:u,isNewModular:x||f||i}}function yp(e){const{modelSpecs:t,interface:n}=e??{},{list:s,prioritize:a}=t??{};if(!s)return;const r=null==s?void 0:s.find(e=>e.default);if(!0===a||!(null==n?void 0:n.modelSelect)){const e=localStorage.getItem(Jc.LAST_SPEC),t=null==s?void 0:s.find(t=>t.name===e);return r||t||(null==s?void 0:s[0])}if(r)return r;const o=JSON.parse(localStorage.getItem(Jc.LAST_CONVO_SETUP+"_0")??"{}");return o.spec?null==s?void 0:s.find(e=>e.name===o.spec):void 0}function _p(e){if(e)return{...e.preset,spec:e.name,iconURL:jp(e)}}function jp(e){return e.iconURL??e.preset.iconURL??e.preset.endpoint??""}function wp({endpointsConfig:e,iconURL:t,endpoint:n}){return((null==e?void 0:e[t??""])?t??n:n)??""}function Np({endpoint:e,endpointType:t,endpointsConfig:n,endpointIconURL:s}){const a=t??fp(n,e,"type")??"",r=s??fp(n,e,"iconURL")??"";return r&&null!=vi[r]?r:a?"unknown":e??"unknown"}const Cp=({endpoint:e,assistant_id:t,agent_id:n,agentsMap:s,assistantMap:a})=>{var r;const o=wi(e),i=ji(e);if(o){return{entity:null==s?void 0:s[n??""],isAgent:o,isAssistant:i}}if(i){return{entity:null==(r=null==a?void 0:a[e??""])?void 0:r[t??""],isAgent:o,isAssistant:i}}return{entity:null,isAgent:o,isAssistant:i}};function kp(){const e={lastSelectedModel:localStorage.getItem(Jc.LAST_MODEL)??"",lastSelectedTools:localStorage.getItem(Jc.LAST_TOOLS)??"",lastConversationSetup:localStorage.getItem(Jc.LAST_CONVO_SETUP+"_0")??""};return{lastSelectedModel:e.lastSelectedModel?JSON.parse(e.lastSelectedModel):{},lastSelectedTools:e.lastSelectedTools?JSON.parse(e.lastSelectedTools):[],lastConversationSetup:e.lastConversationSetup?JSON.parse(e.lastConversationSetup):{}}}function Sp(){Object.keys(localStorage).forEach(e=>{(e.startsWith(Jc.LAST_MCP_)||e.startsWith(Jc.LAST_CODE_TOGGLE_)||e.startsWith(Jc.TEXT_DRAFT)||e.startsWith(Jc.ASST_ID_PREFIX)||e.startsWith(Jc.AGENT_ID_PREFIX)||e.startsWith(Jc.LAST_CONVO_SETUP))&&localStorage.removeItem(e)})}function Tp(e,t){for(let n=0;n<e.pages.length;n++){const s=t(e.pages[n]);if(-1!==s)return{pageIndex:n,index:s}}return{pageIndex:-1,index:-1}}const Rp=(e,t,n,s)=>{const a=JSON.parse(JSON.stringify(e)),{pageIndex:r,index:o}=Tp(e,s);return-1!==r&&-1!==o&&(a.pages[r][t].splice(o,1),a.pages[0][t].unshift({...n,updatedAt:(new Date).toISOString()})),a};const Ip=(e,t)=>((e,t,n,s)=>{const a=JSON.parse(JSON.stringify(e)),{pageIndex:r,index:o}=Tp(e,s);return-1!==r&&-1!==o?Rp(e,t,n,s):(a.pages[0][t].unshift({...n,updatedAt:(new Date).toISOString()}),a)})(e,Hc.PROMPT_GROUPS,t,e=>e.promptGroups.findIndex(e=>e._id===t._id)),Ep=(e,t)=>((e,t,n)=>{const s=JSON.parse(JSON.stringify(e)),{pageIndex:a,index:r}=Tp(s,n);return-1!==a&&-1!==r&&s.pages[a][t].splice(r,1),s})(e,Hc.PROMPT_GROUPS,e=>e.promptGroups.findIndex(e=>e._id===t)),Mp=(e,t,n)=>((e,t,n,s,a)=>{const r=JSON.parse(JSON.stringify(e)),{pageIndex:o,index:i}=Tp(r,e=>e[n].findIndex(e=>e[s]===t[s]));if(-1!==o&&-1!==i){const e={...r.pages[o][n].splice(i,1)[0],...t,updatedAt:(new Date).toISOString()};a&&a(e),r.pages[0][n].unshift(e)}return r})(e,t,Hc.PROMPT_GROUPS,"_id",n),Pp=(e,t)=>((e,t,n)=>{const{pageIndex:s,index:a}=Tp(e,e=>e[t].findIndex(n));if(-1!==s&&-1!==a)return e.pages[s][t][a]})(e,Hc.PROMPT_GROUPS,t),Lp=(e,t)=>{!function({queryClient:e,queryKey:t,searchProperty:n,updateData:s,searchValue:a}){e.setQueryData(t,e=>e?e.map(e=>e[n]===a?{...e,...s}:e):e)}({queryClient:e,queryKey:[Pd.allPromptGroups],searchProperty:"_id",updateData:t,searchValue:t._id})},Ap=(e,t)=>{!function(e,t,n,s){e.setQueryData(t,e=>e?e.filter(e=>e[n]!==s):e)}(e,[Pd.allPromptGroups],"_id",t)};function Op(...e){return d(u(e))}const Dp={log:(...e)=>{},dir:(...e)=>{},warn:(...e)=>{},info:(...e)=>{},error:(...e)=>{},debug:(...e)=>{}};function zp({messages:e,fileMap:t}){if(null===e)return null;const n={},s=[],a={};return e.forEach(e=>{const r=e.parentMessageId??"";a[r]=(a[r]||0)+1;const o={...e,children:[],depth:0,siblingIndex:a[r]-1};e.files&&t&&(o.files=e.files.map(e=>t[e.file_id??""]??e)),n[e.messageId]=o;const i=n[r];i?(i.children.push(o),o.depth=i.depth+1):s.push(o)}),s}function Fp({originalWidth:e,originalHeight:t,containerRef:n}){var s;const a=(null==(s=n.current)?void 0:s.offsetWidth)??0;if(0===a||null==e||null==t)return{width:"auto",height:"auto"};const r=e/t,o=Math.min(a,e);return{width:`${o}px`,height:`${o/r}px`}}const Vp=e=>{const t="com_auth_error_login";if(!e)return t;switch(!0){case e.includes("429"):return"com_auth_error_login_rl";case e.includes("403"):return"com_auth_error_login_ban";case e.includes("500"):return"com_auth_error_login_server";case e.includes("422"):return"com_auth_error_login_unverified";default:return t}},$p=({preset:e})=>{const{endpoint:t,endpointType:n}=e??{};if(null==t||""===t)return console.error(`Unknown endpoint ${t}`,e),{endpoint:null,presetId:(null==e?void 0:e.presetId)??null,title:(null==e?void 0:e.title)??"New Preset"};const{presetOverride:s={},...a}=e??{},r={...a,...s};r.chatGptLabel&&r.modelLabel?delete r.chatGptLabel:r.chatGptLabel&&!r.modelLabel?(r.modelLabel=r.chatGptLabel,delete r.chatGptLabel):"chatGptLabel"in r&&delete r.chatGptLabel;const o=ld({endpoint:t,endpointType:n,conversation:r});return{presetId:(null==e?void 0:e.presetId)??null,...o,endpoint:t,endpointType:n,title:(null==e?void 0:e.title)??"New Preset"}},Bp=({models:e,conversation:t,endpoint:n=null,lastConversationSetup:s})=>{var a;const{lastSelectedModel:r,lastSelectedTools:o}=kp(),i=(null==s?void 0:s.endpointType)??t.endpointType;if(!n)return{...t,endpointType:i,endpoint:n};const l=e,c=(null==s?void 0:s.model)??(null==r?void 0:r[n])??"",d=n===vi.gptPlugins?(null==(a=null==s?void 0:s.agentOptions)?void 0:a.model)??(null==r?void 0:r.secondaryModel)??null:null;let u,m;u=l.includes(c)?[c,...l]:[...l],m=null!=d&&""!==d&&l.includes(d)?[d,...l]:[...l];const p=ld({endpoint:n,endpointType:i,conversation:s,possibleValues:{models:u,secondaryModels:m}}),h={...t,...p,endpointType:i,endpoint:n},x=(null==p?void 0:p.assistant_id)??(null==t?void 0:t.assistant_id)??"",f=(null==s?void 0:s.assistant_id)??"";ji(n)&&!f&&x&&(h.assistant_id=x);const g=(null==p?void 0:p.agent_id)??"",v=(null==s?void 0:s.agent_id)??"";return wi(n)&&!v&&g&&(h.agent_id=g),h.tools=(null==s?void 0:s.tools)??o??h.tools,h},Up=({convoSetup:e,endpointsConfig:t})=>((e,t)=>{let{endpoint:n=""}=e||{};return n=n??"",n&&(null==t?void 0:t[n])?n:(n&&console.warn(`Illegal target endpoint ${n}`,t),null)})(e,t)||(e=>{try{const{lastConversationSetup:t}=kp(),{endpoint:n}=t??{endpoint:null},s=Object.values(e??{}).every(e=>!e);return s&&n||s&&n||n&&null!=(null==e?void 0:e[n])?n:null}catch(t){return console.error(t),null}})(t)||(e=>gp(e).find(t=>Object.hasOwn(e??{},t)))(t),Hp=(null==tl?void 0:tl.shape)?Object.keys(tl.shape):[];const Kp="",Gp="focus:outline-none focus:ring-0 focus:ring-opacity-0 focus:ring-offset-0",Wp="rounded-md border border-gray-200 focus:border-gray-400 focus:bg-gray-50 bg-transparent text-sm shadow-[0_0_10px_rgba(0,0,0,0.05)] outline-none focus-within:placeholder:text-text-primary focus:placeholder:text-text-primary placeholder:text-text-secondary focus:outline-none focus:ring-gray-400 focus:ring-opacity-20 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:focus:bg-gray-600 dark:focus:border-gray-600 dark:text-gray-50 dark:shadow-[0_0_15px_rgba(0,0,0,0.10)] dark:focus:outline-none",qp="p-0 shadow-none text-right pr-1 h-8 border-transparent hover:bg-gray-800/10 dark:hover:bg-white/10 dark:focus:bg-white/10 transition-colors",Qp=e=>{const t=document.createRange();t.selectNodeContents(e.target);const n=window.getSelection();n&&(n.removeAllRanges(),n.addRange(t))},Zp=e=>"string"==typeof e?e:m.isValidElement(e)?Zp(e.props.children):Array.isArray(e)?e.map(Zp).join(""):"",Jp=e=>{const t=e.reduce((e,t)=>e+t,0);if(Math.abs(t-100)<.01)return e.map(e=>Number(e.toFixed(2)));const n=100/t,s=e.map(e=>Number((e*n).toFixed(2))),a=s.reduce((t,n,s)=>s===e.length-1?t:t+n,0);return s[s.length-1]=Number((100-a).toFixed(2)),s},Yp=p({key:"artifactsState",default:null,effects:[({onSet:e,node:t})=>{e(async e=>{Dp.log("artifacts","Recoil Effect: Setting artifactsState",{key:t.key,newValue:e})})}]}),Xp=p({key:"currentArtifactId",default:null,effects:[({onSet:e,node:t})=>{e(async e=>{Dp.log("artifacts","Recoil Effect: Setting currentArtifactId",{key:t.key,newValue:e})})}]}),eh=p({key:"artifactsVisibility",default:!0,effects:[({onSet:e,node:t})=>{e(async e=>{Dp.log("artifacts","Recoil Effect: Setting artifactsVisibility",{key:t.key,newValue:e})})}]}),th=p({key:"visibleArtifacts",default:null,effects:[({onSet:e,node:t})=>{e(async e=>{Dp.log("artifacts","Recoil Effect: Setting `visibleArtifacts`",{key:t.key,newValue:e})})}]}),nh=Object.freeze(Object.defineProperty({__proto__:null,artifactsState:Yp,artifactsVisibility:eh,currentArtifactId:Xp,visibleArtifacts:th},Symbol.toStringTag,{value:"Module"})),sh=n.createContext({}),ah=({children:e})=>{const t=n.useRef(!1);return l.jsx(sh.Provider,{value:t,children:e})},rh=p({key:"latestMessageKeys",default:[]}),oh=p({key:"submissionKeys",default:[]}),ih=h({key:"latestMessageByIndex",default:null,effects:[({onSet:e,node:t})=>{e(async e=>{const n=Number(t.key.split(Zc.COMMON_DIVIDER)[1]);Dp.log("Recoil Effect: Setting latestMessage",{key:n,newValue:e})})}]}),lh=h({key:"submissionByIndex",default:null}),ch=x({key:"latestMessageKeysSelector",get:({get:e})=>e(ph).filter(t=>null!==e(ih(t))),set:({set:e},t)=>{Dp.log("setting latestMessageKeys",{newKeys:t}),e(rh,t)}}),dh=x({key:"submissionKeysSelector",get:({get:e})=>e(ph).filter(t=>null!==e(lh(t))),set:({set:e},t)=>{Dp.log("setting submissionKeysAtom",t),e(oh,t)}}),uh=h({key:"conversationByIndex",default:null,effects:[({onSet:e,node:t})=>{e(async(e,n)=>{const s=Number(t.key.split("__")[1]);if(Dp.log("conversation","Setting conversation:",{index:s,newValue:e,oldValue:n}),null!=(null==e?void 0:e.assistant_id)&&e.assistant_id&&localStorage.setItem(`${Jc.ASST_ID_PREFIX}${s}${e.endpoint}`,e.assistant_id),null!=(null==e?void 0:e.agent_id)&&e.agent_id&&localStorage.setItem(`${Jc.AGENT_ID_PREFIX}${s}`,e.agent_id),null!=(null==e?void 0:e.spec)&&e.spec&&localStorage.setItem(Jc.LAST_SPEC,e.spec),(null==e?void 0:e.tools)&&Array.isArray(e.tools)&&localStorage.setItem(Jc.LAST_TOOLS,JSON.stringify(e.tools.filter(e=>!!e))),!e)return;!function(e){if(!e)return;const{endpoint:t,model:n,agentOptions:s}=e;if(!t)return;const a=JSON.parse(localStorage.getItem(Jc.LAST_MODEL)??"{}");a[t]=n,t===vi.gptPlugins&&(a.secondaryModel=(null==s?void 0:s.model)??n??""),localStorage.setItem(Jc.LAST_MODEL,JSON.stringify(a))}(e),localStorage.setItem(`${Jc.LAST_CONVO_SETUP}_${s}`,JSON.stringify(e));const a=!0===e.disableParams;if(0===s&&!a&&""===e.createdAt&&JSON.stringify(e)!==JSON.stringify(n)&&(null==n?void 0:n.conversationId)===Zc.NEW_CONVO){const t=function(e){if(null==e)return new URLSearchParams;const t=new URLSearchParams;if(e&&"object"==typeof e&&!("endpoint"in e)&&!("model"in e))return Object.entries(e).forEach(([e,n])=>{null!=n&&Hp.includes(e)&&t.set(e,n)}),t;const n=e,s=n.endpoint;if(n.spec)return new URLSearchParams({spec:n.spec});if(wi(s)&&n.agent_id&&n.agent_id!==Zc.EPHEMERAL_AGENT_ID)return new URLSearchParams({agent_id:String(n.agent_id)});if(ji(s)&&n.assistant_id)return new URLSearchParams({assistant_id:String(n.assistant_id)});if(wi(s)&&!n.agent_id)return t;if(ji(s)&&!n.assistant_id)return t;s&&t.set("endpoint",s),n.model&&t.set("model",n.model);const a={};return Hp.forEach(e=>{"agent_id"===e&&n.agent_id===Zc.EPHEMERAL_AGENT_ID||"endpoint"!==e&&"model"!==e&&(a[e]=n[e])}),Object.entries(a).reduce((e,[t,n])=>(null!=n&&(Array.isArray(n)?e.set(t,"stop"===t?n.join(","):JSON.stringify(n)):e.set(t,String(n))),e),t)}(e),n=as(t),s=`${window.location.pathname}?${n.toString()}`;window.history.pushState({},"",s)}})}]}),mh=h({key:"filesByIndex",default:new Map}),ph=p({key:"conversationKeys",default:[]}),hh=x({key:"allConversationsSelector",get:({get:e})=>e(ph).map(t=>e(uh(t))).map(e=>null==e?void 0:e.conversationId)}),xh=h({key:"presetByIndex",default:null}),fh=h({key:"textByIndex",default:""}),gh=h({key:"showStopButtonByIndex",default:!1}),vh=h({key:"abortScrollByIndex",default:!1,effects:[({onSet:e,node:t})=>{e(async e=>{const n=Number(t.key.split(Zc.COMMON_DIVIDER)[1]);Dp.log("message_scrolling","Recoil Effect: Setting abortScrollByIndex",{key:n,newValue:e})})}]}),bh=h({key:"isSubmittingByIndex",default:!1,effects:[({onSet:e,node:t})=>{e(async e=>{const n=Number(t.key.split(Zc.COMMON_DIVIDER)[1]);Dp.log("message_stream","Recoil Effect: Setting isSubmittingByIndex",{key:n,newValue:e})})}]}),yh=h({key:"optionSettingsByIndex",default:{}}),_h=h({key:"showAgentSettingsByIndex",default:!1}),jh=h({key:"showPopoverByIndex",default:!1}),wh=h({key:"activePromptByIndex",default:void 0}),Nh=h({key:"showMentionPopoverByIndex",default:!1}),Ch=h({key:"showPlusPopoverByIndex",default:!1}),kh=h({key:"showPromptsPopoverByIndex",default:!1}),Sh=h({key:"globalAudioURLByIndex",default:null}),Th=h({key:"globalAudioisFetchingByIndex",default:!1}),Rh=h({key:"globalAudioisPlayingByIndex",default:!1}),Ih=h({key:"activeRunByIndex",default:null}),Eh=h({key:"audioRunByIndex",default:null}),Mh=h({key:"messagesSiblingIdx",default:0});const Ph=f({key:"conversationByKeySelector",get:e=>({get:t})=>t(uh(e))});const Lh=f({key:"updateConversationSelector",get:()=>()=>null,set:e=>({set:t,get:n},s)=>{if(s instanceof g)return;n(ph).forEach(n=>{t(uh(n),t=>t&&t.conversationId===e?{...t,...s}:t)})}}),Ah={conversationKeysAtom:ph,conversationByIndex:uh,filesByIndex:mh,presetByIndex:xh,submissionByIndex:lh,textByIndex:fh,showStopButtonByIndex:gh,abortScrollFamily:vh,isSubmittingFamily:bh,optionSettingsFamily:yh,showAgentSettingsFamily:_h,showPopoverFamily:jh,latestMessageFamily:ih,messagesSiblingIdxFamily:Mh,allConversationsSelector:hh,conversationByKeySelector:Ph,useClearConvoState:function(){return v(({reset:e,snapshot:t})=>async n=>{const s=await t.getPromise(ph);for(const a of s){if(!0===n&&0==a)continue;e(uh(a));await t.getPromise(uh(a))&&e(ih(a))}e(ph)},[])},useCreateConversationAtom:function(e){const t=n.useContext(sh),[s,a]=b(ph),r=y(uh(e)),o=_(uh(e));return n.useEffect(()=>{s.includes(e)||a([...s,e])},[e,s,a]),{hasSetConversation:t,conversation:o,setConversation:r}},showMentionPopoverFamily:Nh,globalAudioURLFamily:Sh,activeRunFamily:Ih,audioRunFamily:Eh,globalAudioPlayingFamily:Rh,globalAudioFetchingFamily:Th,showPlusPopoverFamily:Ch,activePromptByIndex:wh,useClearSubmissionState:function(){return v(({reset:e,set:t,snapshot:n})=>async s=>{const a=await n.getPromise(dh);Dp.log("submissionKeys",a);for(const t of a)!0===s&&0==t||(Dp.log("resetting submission",t),e(lh(t)));t(dh,[])},[])},useClearLatestMessages:function(e){return v(({reset:t,set:n,snapshot:s})=>async a=>{const r=await s.getPromise(ch);Dp.log("[clearAllLatestMessages] latestMessageKeys",r),null!=e&&e&&Dp.log(`[clearAllLatestMessages] context: ${e}`);for(const e of r)!0===a&&0==e||(Dp.log(`[clearAllLatestMessages] resetting latest message; key: ${e}`),t(ih(e)));n(ch,[])},[])},showPromptsPopoverFamily:kh,updateConversationSelector:Lh},Oh={[vi.azureOpenAI]:null,[vi.azureAssistants]:null,[vi.assistants]:null,[vi.agents]:null,[vi.openAI]:null,[vi.chatGPTBrowser]:null,[vi.gptPlugins]:null,[vi.google]:null,[vi.anthropic]:null,[vi.custom]:null},Dh=p({key:"endpointsConfig",default:Oh}),zh=p({key:"endpointsQueryEnabled",default:!0}),Fh=x({key:"plugins",get:({get:e})=>{var t;return(null==(t=(e(Dh)||{}).gptPlugins)?void 0:t.plugins)||{}}}),Vh=x({key:"endpointsFilter",get:({get:e})=>{const t=e(Dh)||{},n={};for(const s of Object.keys(t))n[s]=!!t[s];return n}}),$h={plugins:Fh,endpointsConfig:Dh,endpointsFilter:Vh,defaultConfig:Oh,endpointsQueryEnabled:zh},Bh={user:p({key:"user",default:void 0}),availableTools:p({key:"availableTools",default:{}})},Uh={text:p({key:"text",default:""})},Hh={toastState:p({key:"toastState",default:{open:!1,message:"",severity:Wo.SUCCESS,showIcon:!0}})},Kh={submission:p({key:"submission",default:null}),isSubmitting:p({key:"isSubmitting",default:!1})},Gh={search:p({key:"search",default:{enabled:null,query:"",debouncedQuery:"",isSearching:!1,isTyping:!1}})},Wh={defaultPreset:p({key:"defaultPreset",default:null}),presetModalVisible:p({key:"presetModalVisible",default:!1})};function qh(e,t){return p({key:e,default:t,effects_UNSTABLE:[({setSelf:n,onSet:s})=>{const a=localStorage.getItem(e);if(null!==a)try{n(JSON.parse(a))}catch(r){console.error(`Error parsing localStorage key "${e}", \`savedValue\`: defaultValue, error:`,r),localStorage.setItem(e,JSON.stringify(t)),n(t)}s(t=>{localStorage.setItem(e,JSON.stringify(t))})}]})}const Qh={...{promptsName:p({key:"promptsName",default:""}),promptsCategory:p({key:"promptsCategory",default:""}),promptsPageNumber:p({key:"promptsPageNumber",default:1}),promptsPageSize:p({key:"promptsPageSize",default:10})},...{autoSendPrompts:qh("autoSendPrompts",!0),alwaysMakeProd:qh("alwaysMakeProd",!0),promptsEditorMode:qh("promptsEditorMode",Vo.SIMPLE)}},Zh={lang:qh("lang",(()=>{const e=navigator.language||navigator.languages[0];return j.get("lang")||localStorage.getItem("lang")||e})())},Jh={...{abortScroll:p({key:"abortScroll",default:!1}),showFiles:p({key:"showFiles",default:!1}),optionSettings:p({key:"optionSettings",default:{}}),showPluginStoreDialog:p({key:"showPluginStoreDialog",default:!1}),showAgentSettings:p({key:"showAgentSettings",default:!1}),currentSettingsView:p({key:"currentSettingsView",default:Kl.default}),showPopover:p({key:"showPopover",default:!1})},...{autoScroll:qh("autoScroll",!1),hideSidePanel:qh("hideSidePanel",!1),fontSize:qh("fontSize","text-base"),enableUserMsgMarkdown:qh(Jc.ENABLE_USER_MSG_MARKDOWN,!0),enterToSend:qh("enterToSend",!0),maximizeChatSpace:qh("maximizeChatSpace",!1),chatDirection:qh("chatDirection","LTR"),showCode:qh(Jc.SHOW_ANALYSIS_CODE,!0),saveDrafts:qh("saveDrafts",!0),showScrollButton:qh("showScrollButton",!0),forkSetting:qh("forkSetting",""),splitAtTarget:qh("splitAtTarget",!1),rememberDefaultFork:qh(Jc.REMEMBER_FORK_OPTION,!1),showThinking:qh("showThinking",!1),saveBadgesState:qh("saveBadgesState",!1),modularChat:qh("modularChat",!0),LaTeXParsing:qh("LaTeXParsing",!0),codeArtifacts:qh("codeArtifacts",!1),includeShadcnui:qh("includeShadcnui",!1),customPromptMode:qh("customPromptMode",!1),centerFormOnLanding:qh("centerFormOnLanding",!0),showFooter:qh("showFooter",!0),atCommand:qh("atCommand",!0),plusCommand:qh("plusCommand",!0),slashCommand:qh("slashCommand",!0),conversationMode:qh("conversationMode",!1),advancedMode:qh("advancedMode",!1),speechToText:qh("speechToText",!0),engineSTT:qh("engineSTT","browser"),languageSTT:qh("languageSTT",""),autoTranscribeAudio:qh("autoTranscribeAudio",!1),decibelValue:qh("decibelValue",-45),autoSendText:qh("autoSendText",-1),textToSpeech:qh("textToSpeech",!0),engineTTS:qh("engineTTS","browser"),voice:qh("voice",void 0),cloudBrowserVoices:qh("cloudBrowserVoices",!1),languageTTS:qh("languageTTS",""),automaticPlayback:qh("automaticPlayback",!1),playbackRate:qh("playbackRate",null),cacheTTS:qh("cacheTTS",!0),UsernameDisplay:qh("UsernameDisplay",!0)}},Yh={hideBannerHint:qh("hideBannerHint",[]),messageAttachmentsMap:p({key:"messageAttachmentsMap",default:{}}),queriesEnabled:p({key:"queriesEnabled",default:!0}),isEditingBadges:p({key:"isEditingBadges",default:!1}),chatBadges:qh("chatBadges",[{id:"1"}])},Xh={isTemporary:qh("isTemporary",!1)},ex={modelsConfig:p({key:"modelsConfig",default:{}})},tx=h({key:"ephemeralAgentByConvoId",default:null,effects:[({onSet:e,node:t})=>{e(async e=>{var n;const s=null==(n=t.key.split("__")[1])?void 0:n.replaceAll('"',"");Dp.log("agents","Setting ephemeral agent:",{conversationId:s,newValue:e})})}]});const nx={...nh,...Ah,...$h,...Bh,...Uh,...Hh,...Kh,...Gh,...Qh,...Wh,...Zh,...Jh,...Yh,...Xh,...ex},sx=new Proxy(nx,{get(e,t){const n=e[t];return"string"==typeof t&&void 0===n&&(window&&window.__recoilMissingKeys&&window.__recoilMissingKeys.has(t)||(window.__recoilMissingKeys=window.__recoilMissingKeys||new Set,window.__recoilMissingKeys.add(t),console.error("[RECOIL STORE PROXY] Missing atom/selector:",t))),n}});function ax(e=0){const t=y(sx.audioRunFamily(e)),s=y(sx.activeRunFamily(e)),a=y(sx.globalAudioPlayingFamily(e)),r=y(sx.globalAudioFetchingFamily(e)),[o,i]=b(sx.globalAudioURLFamily(e));return{pauseGlobalAudio:n.useCallback(()=>{if(null!=o&&""!==o){const e=document.getElementById(Uo);e&&(console.log("Pausing global audio",o),e.pause(),a(!1)),URL.revokeObjectURL(o),r(!1),i(null),s(null),t(null)}},[t,s,o,i,a,r])}}const rx=e=>{const t=_(sx.queriesEnabled);return La([Pd.user],()=>ou.get("/api/user"),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})};function ox(){const e=sx.useClearConvoState(),t=sx.useClearSubmissionState(),n=sx.useClearLatestMessages();return v(({reset:s,snapshot:a})=>async r=>{await t(r),await e(r),await n(r);const o=await a.getPromise(sx.conversationKeysAtom);for(const e of o)!0===r&&0===e||(s(sx.filesByIndex(e)),s(sx.presetByIndex(e)),s(sx.textByIndex(e)),s(sx.showStopButtonByIndex(e)),s(sx.abortScrollFamily(e)),s(sx.isSubmittingFamily(e)),s(sx.optionSettingsFamily(e)),s(sx.showAgentSettingsFamily(e)),s(sx.showPopoverFamily(e)),s(sx.showMentionPopoverFamily(e)),s(sx.showPlusPopoverFamily(e)),s(sx.showPromptsPopoverFamily(e)),s(sx.activePromptByIndex(e)),s(sx.globalAudioURLFamily(e)),s(sx.globalAudioFetchingFamily(e)),s(sx.globalAudioPlayingFamily(e)),s(sx.activeRunFamily(e)),s(sx.audioRunFamily(e)),s(sx.messagesSiblingIdxFamily(e.toString())));!function(e){Object.keys(localStorage).forEach(t=>{!0===e&&t.endsWith("0")||(t.startsWith(Jc.LAST_MCP_)||t.startsWith(Jc.LAST_CODE_TOGGLE_)||t.startsWith(Jc.ASST_ID_PREFIX)||t.startsWith(Jc.AGENT_ID_PREFIX)||t.startsWith(Jc.LAST_CONVO_SETUP)||t===Jc.LAST_SPEC||t===Jc.LAST_TOOLS||t===Jc.LAST_MODEL||t===Jc.FILES_TO_DELETE)&&localStorage.removeItem(t)})}(r)},[])}const ix=e=>{const t=Aa(),n=ox(),s=w(sx.defaultPreset),a=y(sx.queriesEnabled);return Oa([Ld.logoutUser],{mutationFn:()=>ou.post("/api/auth/logout"),...e||{},onSuccess:(...r)=>{var o;a(!1),s(),n(),t.removeQueries(),null==(o=null==e?void 0:e.onSuccess)||o.call(e,...r)}})},lx=e=>{const t=Aa(),n=ox(),s=w(sx.defaultPreset),a=y(sx.queriesEnabled);return Oa([Ld.loginUser],{mutationFn:e=>(e=>ou.post("/api/auth/login",e))(e),...e||{},onMutate:a=>{var r;s(),n(),t.removeQueries(),null==(r=null==e?void 0:e.onMutate)||r.call(e,a)},onSuccess:(...t)=>{var n;a(!0),null==(n=null==e?void 0:e.onSuccess)||n.call(e,...t)}})},cx=e=>{const t=Aa(),n=ox(),s=w(sx.defaultPreset);return Oa([Ld.deleteUser],{mutationFn:()=>ou.delete("/api/user/delete"),...e||{},onSuccess:(...a)=>{var r;s(),n(),Sp(),t.removeQueries(),null==(r=null==e?void 0:e.onSuccess)||r.call(e,...a)}})},dx=()=>{const e=Aa();return Oa(()=>ou.get("/api/auth/2fa/enable"),{onSuccess:t=>{e.setQueryData([Pd.user,"2fa"],t)}})},ux=()=>{const e=Aa();return Oa(e=>function(e){return ou.post("/api/auth/2fa/verify",e)}(e),{onSuccess:t=>{e.setQueryData([Pd.user,"2fa"],t)}})},mx=()=>{const e=Aa();return Oa(e=>function(e){return ou.post("/api/auth/2fa/confirm",e)}(e),{onSuccess:t=>{e.setQueryData([Pd.user,"2fa"],t)}})},px=()=>{const e=Aa();return Oa(()=>ou.post("/api/auth/2fa/disable"),{onSuccess:t=>{e.setQueryData([Pd.user,"2fa"],null)}})},hx=()=>{const e=Aa();return Oa(()=>ou.post("/api/auth/2fa/backup/regenerate"),{onSuccess:t=>{e.setQueryData([Pd.user,"2fa","backup"],t)}})},xx=e=>{const t=Aa();return Oa(e=>function(e){return ou.post("/api/auth/2fa/verify-temp",e)}(e),{...e||{},onSuccess:(n,...s)=>{var a;t.setQueryData([Pd.user,"2fa"],n),null==(a=null==e?void 0:e.onSuccess)||a.call(e,n,...s)}})},fx=()=>{const e=Aa().getQueryData([Pd.endpoints]),t=!!(null==e?void 0:e[vi.agents]);return La([Pd.tools],()=>ou.get(Kd({path:"tools"})),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,enabled:t})},gx=(e=li,t)=>{const n=Aa().getQueryData([Pd.endpoints]),s=!!(null==n?void 0:n[vi.agents]);return La([Pd.agents,e],()=>(e=>ou.get(Kd({options:e})))(e),{staleTime:5e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t,enabled:void 0!==(null==t?void 0:t.enabled)?t.enabled&&s:s})},vx=(e,t)=>La([Pd.agent,e],()=>(({agent_id:e})=>ou.get(Kd({path:e})))({agent_id:e}),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t}),bx=e=>{const t=Aa();return Oa(e=>(({...e})=>ou.post(Kd({}),e))(e),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r,o;const i=t.getQueryData([Pd.agents,li]);if(!i)return null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a);const l=[n,...JSON.parse(JSON.stringify(i.data))];return t.setQueryData([Pd.agents,li],{...i,data:l}),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,a)}})},yx=e=>{const t=Aa();return Oa(({agent_id:e,data:t})=>(({agent_id:e,data:t})=>ou.patch(Kd({path:e}),t))({data:t,agent_id:e}),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;const r=t;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,r,n,s)},onSuccess:(n,s,a)=>{var r,o;const i=t.getQueryData([Pd.agents,li]);return i?(t.setQueryData([Pd.agents,li],{...i,data:i.data.map(e=>e.id===s.agent_id?n:e)}),t.setQueryData([Pd.agent,s.agent_id],n),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,a)):null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},_x=e=>{const t=Aa();return Oa(({agent_id:e})=>(({agent_id:e})=>ou.delete(Kd({path:e})))({agent_id:e}),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r,o;const i=t.getQueryData([Pd.agents,li]);if(!i)return null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a);const l=i.data.filter(e=>e.id!==s.agent_id);return t.setQueryData([Pd.agents,li],{...i,data:l}),t.removeQueries([Pd.agent,s.agent_id]),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,l)}})},jx=e=>{const t=Aa();return Oa(e=>(({agent_id:e})=>ou.post(Kd({path:`${e}/duplicate`})))(e),{onMutate:null==e?void 0:e.onMutate,onError:null==e?void 0:e.onError,onSuccess:({agent:n,actions:s},a,r)=>{var o;const i=t.getQueryData([Pd.agents,li]);if(i){const e=[n,...i.data];t.setQueryData([Pd.agents,li],{...i,data:e})}const l=t.getQueryData([Pd.actions])||[];return t.setQueryData([Pd.actions],l.concat(s)),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,{agent:n,actions:s},a,r)}})},wx=e=>Oa([Ld.agentAvatarUpload],{mutationFn:({postCreation:e,...t})=>{return n=t,ou.postMultiPart(`${Gd()}/agents/${n.agent_id}/avatar`,n.formData);var n},...e||{}}),Nx=e=>{const t=Aa();return Oa([Ld.updateAgentAction],{mutationFn:e=>(e=>{const{agent_id:t,...n}=e;return ou.post(Kd({path:`actions/${t}`}),n)})(e),onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r,o;const i=t.getQueryData([Pd.agents,li]);if(!i)return null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a);const l=n[0];return t.setQueryData([Pd.agents,li],{...i,data:i.data.map(e=>e.id===s.agent_id?l:e)}),t.setQueryData([Pd.actions],e=>e?s.action_id?e.map(e=>e.action_id===s.action_id?n[1]:e):[...e,n[1]]:[n[1]]),t.setQueryData([Pd.agent,s.agent_id],l),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,a)}})},Cx=e=>{const t=Aa();return Oa([Ld.deleteAgentAction],{mutationFn:e=>(async({agent_id:e,action_id:t})=>ou.delete(Kd({path:`actions/${e}/${t}`})))({...e}),onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r;let o="";return t.setQueryData([Pd.actions],e=>null==e?void 0:e.filter(e=>(o=e.metadata.domain,e.action_id!==s.action_id))),t.setQueryData([Pd.agents,li],e=>e?{...e,data:e.data.map(e=>{var t;return e.id===s.agent_id?{...e,tools:null==(t=e.tools)?void 0:t.filter(e=>!e.includes(o??""))}:e})}:e),t.setQueryData([Pd.agent,s.agent_id],e=>{var t;return e?{...e,tools:null==(t=e.tools)?void 0:t.filter(e=>!e.includes(o??""))}:e}),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},kx=e=>{const t=_(sx.queriesEnabled);return La([Pd.endpoints],()=>ou.get("/api/endpoints"),{staleTime:1/0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},Sx=e=>{const t=_(sx.queriesEnabled);return La([Pd.startupConfig],()=>ou.get("/api/config"),{staleTime:1/0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},Tx=e=>{const t=_(sx.queriesEnabled);return La([Pd.files],()=>ou.get("/api/files"),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},Rx=e=>La([Pd.fileConfig],()=>ou.get("/api/files/config"),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),Ix=(e,t)=>{const n=Aa();return La([Pd.fileDownload,t],async()=>{if(!e||!t)return void console.warn("No user ID provided for file download");const s=await(async(e,t)=>ou.getResponse(`/api/files/download/${e}/${t}`,{responseType:"blob",headers:{Accept:"application/octet-stream"}}))(e,t),a=s.data,r=window.URL.createObjectURL(a);try{const e=JSON.parse(s.headers["x-file-metadata"]);if(!e)return console.warn("No metadata found for file download",s.headers),r;Mm(n,e)}catch(o){console.error("Error parsing file metadata, skipped updating file query cache",o)}return r},{enabled:!1,retry:!1})},Ex=(e="")=>La([Pd.fileDownload,e],async()=>{if(!e)return void console.warn("No user ID provided for file download");const t=await(async e=>ou.getResponse(e,{responseType:"blob",headers:{Accept:"application/octet-stream"}}))(e),n=t.data;return window.URL.createObjectURL(n)},{enabled:!1,retry:!1}),Mx=(e,t)=>{const n=Aa(),{onSuccess:s,...a}=e||{};return Oa([Ld.fileUpload],{mutationFn:e=>{const n=e.get("width")??"",s=e.get("height")??"",a=e.get("version")??"",r=e.get("endpoint")??"";return ji(r)&&"2"===a?xu(e,t):""!==n&&""!==s?((e,t)=>{const n=t?{signal:t}:void 0;return ou.postMultiPart(Gd(),e,n)})(e,t):xu(e,t)},...a,onSuccess:(e,t,a)=>{n.setQueryData([Pd.files],t=>[e,...t??[]]);const r=t.get("endpoint"),o=t.get("message_file"),i=t.get("agent_id")??"",l=t.get("assistant_id")??"",c=t.get("tool_resource")??"";"true"!==o?(i&&c&&n.setQueryData([Pd.agent,i],t=>{var n,s;if(!t)return t;const a={},r=t.tool_resources??{},o=(null==(n=t.tool_resources)?void 0:n[c])??{file_ids:[]};return o.file_ids||(o.file_ids=[]),o.file_ids.push(e.file_id),a.tool_resources={...r,[c]:o},(null==(s=t.tools)?void 0:s.includes(c))||(a.tools=[...t.tools??[],c]),{...t,...a}}),l?(n.setQueryData([Pd.assistants,r,li],t=>t?{...t,data:t.data.map(t=>{var n;if(t.id!==l)return t;const s={};if(c||(s.file_ids=[...t.file_ids??[],e.file_id]),c===oi.code_interpreter){const a=t.tool_resources??{},r=(null==(n=t.tool_resources)?void 0:n[c])??{file_ids:[]};r.file_ids||(r.file_ids=[]),r.file_ids.push(e.file_id),s.tool_resources={...a,[c]:r}}return{...t,...s}})}:t),null==s||s(e,t,a)):null==s||s(e,t,a)):null==s||s(e,t,a)}})},Px=e=>{const t=Aa(),{onSuccess:n,...s}=e||{};return Oa([Ld.fileDelete],{mutationFn:e=>(async e=>ou.deleteWithOptions("/api/files",{data:e}))(e),...s,onSuccess:(e,s,a)=>{t.setQueryData([Pd.files],e=>{const{files:t}=s,n=t.reduce((e,t)=>(e.set(t.file_id,t),e),new Map);return(e??[]).filter(e=>!n.has(e.file_id))}),null==n||n(e,s,a),null!=s.agent_id&&s.agent_id&&t.refetchQueries([Pd.agent,s.agent_id])}})},Lx=e=>La([Pd.memories],()=>ou.get("/api/memories"),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),Ax=()=>{const e=Aa();return Oa(e=>(e=>ou.delete(Xd(e)))(e),{onSuccess:()=>{e.invalidateQueries([Pd.memories])}})},Ox=e=>{const t=Aa();return Oa(({key:e,value:t,originalKey:n})=>((e,t,n)=>ou.patch(Xd(n||e),{key:e,value:t}))(e,t,n),{...e,onSuccess:(...n)=>{var s;t.invalidateQueries([Pd.memories]),null==(s=null==e?void 0:e.onSuccess)||s.call(e,...n)}})},Dx=e=>{const t=Aa();return Oa([Ld.updateMemoryPreferences],e=>(e=>ou.patch("/api/memories/preferences",e))(e),{...e,onSuccess:(...n)=>{var s;t.invalidateQueries([Pd.user]),null==(s=null==e?void 0:e.onSuccess)||s.call(e,...n)}})},zx=e=>{const t=Aa();return Oa(({key:e,value:t})=>{return n={key:e,value:t},ou.post("/api/memories",n);var n},{...e,onSuccess:(n,s,a)=>{var r;t.setQueryData([Pd.memories],e=>{if(!e)return e;const t=[...e.memories,n.memory],s=t.reduce((e,t)=>e+(t.tokenCount||0),0),a=e.tokenLimit;let r=e.usagePercentage;return a&&a>0&&(r=Math.min(100,Math.round(s/a*100))),{...e,memories:t,totalTokens:s,usagePercentage:r}}),null==(r=null==e?void 0:e.onSuccess)||r.call(e,n,s,a)}})},Fx=(e,t)=>{const n=N(),s=Aa();return La([Pd.messages,e],async()=>{const t=await(a=e,a===Zc.NEW_CONVO||a===Zc.PENDING_CONVO?Promise.resolve([]):ou.get(Dd({conversationId:a})));var a;if(!n.pathname.includes("/c/new")&&1===(null==t?void 0:t.length)){const a=s.getQueryData([Pd.messages,e]);if(1===(null==a?void 0:a.length))return t;if(a&&(null==a?void 0:a.length)>1)return Dp.warn("messages",`Messages query for convo ${e} returned fewer than cache; path: "${n.pathname}"`,t,a),a}return t},{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t})},Vx=e=>{const t=Aa(),{onSuccess:n,...s}=e??{};return Oa({mutationFn:e=>(async({messageId:e,...t})=>ou.post(`/api/messages/artifact/${e}`,t))(e),onSuccess:(e,s,a)=>{let r=!0;const o=n=>{n&&t.setQueryData([Pd.messages,n],t=>{if(!t)return t;const n=[...t];let a;for(let e=n.length-1;e>=0;e--)if(n[e].messageId===s.messageId){a=e,r=!1;break}return null==a?t:(n[a]={...n[a],content:e.content,text:e.text},n)})};o(e.conversationId),r&&(console.warn("Edited Artifact Message not found in cache, trying `new` as `conversationId`"),o(Zc.NEW_CONVO)),null==n||n(e,s,a)},...s})},$x=e=>{const t=_(sx.queriesEnabled);return La([Pd.banner],()=>ou.get("/api/banner"),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:t})},Bx=e=>{const t=_(sx.queriesEnabled);return La([Pd.balance],()=>ou.get("/api/balance"),{refetchOnWindowFocus:!0,refetchOnReconnect:!0,refetchOnMount:!0,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},Ux=e=>{const t=_(sx.queriesEnabled);return La([Pd.searchEnabled],()=>ou.get("/api/search/enable"),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},Hx=(e,t)=>La([Pd.toolAuth,e.toolId],()=>(e=>ou.get(Kd({path:`tools/${e.toolId}/auth`})))(e),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t}),Kx=(e,t)=>{const{conversationId:n=""}=e;return La([Pd.toolCalls,n],()=>(e=>ou.get(Kd({path:"tools/calls",options:e})))(e),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,enabled:n.length>0&&n!==Zc.NEW_CONVO&&n!==Zc.PENDING_CONVO&&n!==Zc.SEARCH,...t})},Gx=(e,t)=>{const n=Aa();return Oa(t=>(({toolId:e,toolParams:t})=>ou.post(Kd({path:`tools/${e}/call`}),t))({toolId:e,toolParams:t}),{onMutate:e=>{var n;return null==(n=null==t?void 0:t.onMutate)?void 0:n.call(t,e)},onError:(e,n,s)=>{var a;return null==(a=null==t?void 0:t.onError)?void 0:a.call(t,e,n,s)},onSuccess:(e,s,a)=>{var r;return n.setQueryData([Pd.toolCalls,s.conversationId],t=>[...t??[],{user:"",toolId:ri.execute_code,partIndex:s.partIndex,messageId:s.messageId,blockIndex:s.blockIndex,conversationId:s.conversationId,result:e.result,attachments:e.attachments}]),null==(r=null==t?void 0:t.onSuccess)?void 0:r.call(t,e,s,a)}})},Wx=(e=!1)=>{const t=Aa(),s=n.useRef(!1),a=n.useRef(null),r=n.useRef(null);n.useEffect(()=>{if(!e)return;if(s.current)return;s.current=!0;const n=setTimeout(()=>{const e=async()=>{try{await t.fetchQuery([Pd.health],()=>ou.get("/health"),{retry:!1,cacheTime:0,staleTime:0})}catch(e){console.error("Health check failed:",e)}};e(),a.current=setInterval(e,Kc.TEN_MINUTES);const n=async()=>{const n=t.getQueryState([Pd.health]);if(!(null==n?void 0:n.dataUpdatedAt))return void(await e());const s=new Date(n.dataUpdatedAt),a=new Date(Date.now()-Kc.TEN_MINUTES);Dp.log(`Last health check: ${s.toISOString()}`),Dp.log(`Ten minutes ago: ${a.toISOString()}`),s<a&&await e()};r.current=n,window.addEventListener("focus",n)},500);return()=>{clearTimeout(n),a.current&&(clearInterval(a.current),a.current=null),r.current&&(window.removeEventListener("focus",r.current),r.current=null)}},[e,t])},qx=()=>{const e=Aa();return{updateTagsInConversation:(t,n)=>{const s=e.getQueryData([Pd.conversation,t]);if(!s)return;const a={...s,tags:n};e.setQueryData([Pd.conversation,t],a),e.setQueryData([Pd.allConversations],e=>e?{...e,pages:e.pages.map(e=>({...e,conversations:e.conversations.map(e=>e.conversationId===(s.conversationId??"")?{...e,tags:a.tags}:e)}))}:e)},replaceTagsInAllConversations:(t,n)=>{const s=e.getQueryData([Pd.allConversations]),a=[],r=JSON.parse(JSON.stringify(s));for(let e=0;e<r.pages.length;e++){const s=r.pages[e];s.conversations=s.conversations.map(e=>{var s;return e.conversationId&&"tags"in e&&Array.isArray(e.tags)&&(null==(s=e.tags)?void 0:s.includes(t))&&(e.tags=e.tags.map(e=>e===t?n:e)),e})}e.setQueryData([Pd.allConversations],r);for(let o=0;o<a.length;o++){const s=a[o],r=e.getQueryData([Pd.conversation,s]);if(r&&r.tags){const a={...r,tags:r.tags.map(e=>e===t?n:e)};e.setQueryData([Pd.conversation,s],a)}}}}},Qx=e=>La([Pd.presets],()=>ou.get("/api/presets"),{staleTime:1e4,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),Zx=(e,t)=>{const{isArchived:n,sortBy:s,sortDirection:a,tags:r,search:o}=e;return Da({queryKey:[n?Pd.archivedConversations:Pd.allConversations,{isArchived:n,sortBy:s,sortDirection:a,tags:r,search:o}],queryFn:({pageParam:e})=>wu({isArchived:n,sortBy:s,sortDirection:a,tags:r,search:o,cursor:null==e?void 0:e.toString()}),getNextPageParam:e=>(null==e?void 0:e.nextCursor)??void 0,keepPreviousData:!0,staleTime:3e5,cacheTime:18e5,...t})},Jx=(e,t)=>{const{sortBy:n,sortDirection:s,pageSize:a,conversationId:r,messageId:o,search:i}=e;return Da({queryKey:[Pd.messages,{sortBy:n,sortDirection:s,pageSize:a,conversationId:r,messageId:o,search:i}],queryFn:({pageParam:e})=>(e=>ou.get(Dd(e??{})))({sortBy:n,sortDirection:s,pageSize:a,conversationId:r,messageId:o,search:i,cursor:null==e?void 0:e.toString()}),getNextPageParam:e=>(null==e?void 0:e.nextCursor)??void 0,keepPreviousData:!0,staleTime:3e5,cacheTime:18e5,...t})},Yx=e=>La([Pd.conversationTags],()=>Eu(),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),Xx=(e,t)=>{var n,s;const a=Aa(),r=a.getQueryData([Pd.endpoints]),o=a.getQueryData([Pd.name,e]),i=!!!(null==(n=null==r?void 0:r[e])?void 0:n.userProvide)||!!(null==o?void 0:o.expiresAt),l=!!(null==r?void 0:r[e])&&i,c=(null==(s=null==r?void 0:r[e])?void 0:s.version)??Xl[e];return La([Pd.tools],()=>((e,t)=>{let n="";n=ji(e)?Hd({path:"tools",endpoint:e,version:t??Xl[e]}):Kd({path:"tools"});return ou.get(n)})(e,c),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,enabled:l,...t})},ef=(e,t=li,n)=>{var s,a;const r=Aa(),o=r.getQueryData([Pd.endpoints]),i=r.getQueryData([Pd.name,e]),l=!!!(null==(s=null==o?void 0:o[e])?void 0:s.userProvide)||!!(null==i?void 0:i.expiresAt),c=!!(null==o?void 0:o[e])&&l,d=(null==(a=null==o?void 0:o[e])?void 0:a.version)??Xl[e];return La([Pd.assistants,e,t],()=>((e,t)=>ou.get(Hd({version:t,options:e})))({...t,endpoint:e},d),{staleTime:5e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...n,enabled:void 0!==(null==n?void 0:n.enabled)?n.enabled&&c:c})},tf=(e,t)=>{var n;const s=Aa(),a=s.getQueryData([Pd.endpoints]),r=s.getQueryData([Pd.name,e]),o=!!!(null==(n=null==a?void 0:a[e])?void 0:n.userProvide)||!!(null==r?void 0:r.expiresAt),i=!!(null==a?void 0:a[e])&&o||e===vi.agents;return La([Pd.actions],()=>ou.get(Kd({path:"actions"})),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t,enabled:void 0!==(null==t?void 0:t.enabled)?t.enabled&&i:i})},nf=(e,t)=>{var n,s;const a=Aa(),r=a.getQueryData([Pd.endpoints]),o=a.getQueryData([Pd.name,e]),i=!!!(null==(n=null==r?void 0:r[e])?void 0:n.userProvide)||!!(null==o?void 0:o.expiresAt),l=!!(null==r?void 0:r[e])&&i,c=(null==(s=null==r?void 0:r[e])?void 0:s.version)??Xl[e];return La([Pd.assistantDocs,e],()=>function({endpoint:e,version:t}){return ji(e)?ou.get(Hd({path:"documents",version:t,options:{endpoint:e},endpoint:e})):Promise.resolve([])}({endpoint:e,version:c}),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t,enabled:void 0!==(null==t?void 0:t.enabled)?t.enabled&&l:l})},sf=e=>La([Pd.voices],()=>ou.get("/api/files/speech/tts/voices"),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...e}),af=(e,t)=>La([Pd.promptGroup,e],()=>function(e){return ou.get(Wd(e))}(e),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t,enabled:!0}),rf=(e,t)=>La([Pd.allPromptGroups],()=>ou.get("/api/prompts/all"),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t}),of=e=>La([Pd.categories],()=>ou.get("/api/categories"),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...e,enabled:void 0===(null==e?void 0:e.enabled)||e.enabled}),lf=e=>La([Pd.userTerms],()=>ou.get("/api/user/terms"),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),cf=e=>{const t=Aa();return Oa(e=>function(e){return ou.post(Bd(),{arg:e})}(e),{onSuccess:n=>{t.setQueryData([Pd.conversation,e],n),np(t,e,()=>n)}})},df=e=>{const t=Aa(),n=[Pd.allConversations],s=[Pd.archivedConversations],{onMutate:a,onError:r,onSettled:o,onSuccess:i,...l}=e||{};return Oa(e=>function(e){return ou.post(Bd(),{arg:e})}(e),{onMutate:a,onSuccess:(e,n,s)=>{const a=!0===n.isArchived;sp(t,n.conversationId);const r=t.getQueryCache().findAll([Pd.archivedConversations],{exact:!1});for(const o of r)t.setQueryData(o.queryKey,t=>t?a?{...t,pages:[{...t.pages[0],conversations:[e,...t.pages[0].conversations]},...t.pages.slice(1)]}:{...t,pages:t.pages.map(e=>({...e,conversations:e.conversations.filter(e=>e.conversationId!==n.conversationId)}))}:t);t.setQueryData([Pd.conversation,n.conversationId],a?null:e),null==i||i(e,n,s)},onError:r,onSettled:()=>{t.invalidateQueries({queryKey:n,refetchPage:(e,t)=>0===t}),t.invalidateQueries({queryKey:s,refetchPage:(e,t)=>0===t})},...l})},uf=e=>{const t=Aa(),{onSuccess:n}=e||{};return Oa(e=>{return t=e.shareId,ou.delete(Fd(t));var t},{onMutate:async e=>{await t.cancelQueries({queryKey:[Pd.sharedLinks],exact:!1});const n=new Map;return t.getQueryCache().findAll([Pd.sharedLinks]).forEach(s=>{const a=t.getQueryData(s.queryKey);n.set(s.queryKey,a),t.setQueryData(s.queryKey,t=>{if(!(null==t?void 0:t.pages))return t;const n=t.pages.map(t=>({...t,links:t.links.filter(t=>t.shareId!==e.shareId)})).filter(e=>e.links.length>0);return{...t,pages:n}})}),{previousQueries:n}},onError:(e,n,s)=>{(null==s?void 0:s.previousQueries)&&s.previousQueries.forEach((e,n)=>{t.setQueryData(n,e)})},onSettled:()=>{t.invalidateQueries({queryKey:[Pd.sharedLinks],exact:!1})},onSuccess:(e,s)=>{n&&n(e,s),t.refetchQueries({queryKey:[Pd.sharedLinks],exact:!0})}})},mf=({context:e,tag:t,options:n})=>{const s=Aa(),{onSuccess:a,...r}=n||{},{updateTagsInConversation:o,replaceTagsInAllConversations:i}=qx();return Oa(e=>null!=t?function(e,t){return ou.put(Yd(e),t)}(t,e):function(e){return ou.post(Yd(),e)}(e),{onSuccess:(...n)=>{((n,a)=>{if(s.setQueryData([Pd.conversationTags],s=>{if(!s)return[{count:1,position:0,tag:Zc.SAVED_TAG,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}];if(void 0===t||!t.length){const t=s.findIndex(e=>e.tag===n.tag);if(-1!==t){Dp.log("tag_mutation",`"Created" tag exists, updating from ${e}`,s,n);const a=[...s];return a[t]={...a[t],...n},a.sort((e,t)=>e.position-t.position)}return Dp.log("tag_mutation",`"Created" tag is new, adding from ${e}`,s,n),[...s,n].sort((e,t)=>e.position-t.position)}return Dp.log("tag_mutation",`Updating tag from ${e}`,s,n),((e,t,n,s)=>{if(0===e.length)return[n];const a=e.find(e=>e.tag===s);if(!a)return[e[0],n,...e.slice(1)].map((e,t)=>({...e,position:t}));const r=a.position,o=n.position,i=e.filter(e=>e.tag!==s);if(void 0===o||r===o)return e.map(e=>e.tag===s?n:e);const l=[...i.slice(0,o),n,...i.slice(o)];if(o>r)for(let c=r;c<o;c++)l[c].position=c;else for(let c=o+1;c<l.length;c++)l[c].position=c;return l})(s,0,n,t)}),!0===a.addToConversation&&null!=a.conversationId&&n.tag){const t=s.getQueryData([Pd.conversation,a.conversationId]);if(!t)return;Dp.log("tag_mutation",`\`updateTagsInConversation\` Update from ${e}`,t),o(a.conversationId,[...t.tags||[],n.tag])}null!=t&&i(t,n.tag)})(...n),null==a||a(...n)},...r})},pf=e=>{const t=Aa(),n=(()=>{const e=Aa();return t=>{const n=e.getQueryData([Pd.allConversations]),s=[],a=JSON.parse(JSON.stringify(n));for(let e=0;e<a.pages.length;e++){const n=a.pages[e];n.conversations=n.conversations.map(e=>(e.conversationId&&"tags"in e&&Array.isArray(e.tags)&&e.tags.includes(t)&&(s.push(e.conversationId),e.tags=e.tags.filter(e=>e!==t)),e))}e.setQueryData([Pd.allConversations],a);for(let r=0;r<s.length;r++){const n=s[r],a=e.getQueryData([Pd.conversation,n]);a&&"tags"in a&&Array.isArray(a.tags)&&(a.tags=a.tags.filter(e=>e!==t),e.setQueryData([Pd.conversation,n],a))}}})(),{onSuccess:s,...a}=e||{};return Oa(e=>function(e){return ou.delete(Yd(e))}(e),{onSuccess:(e,a,r)=>{t.setQueryData([Pd.conversationTags],e=>e?e.filter(e=>e.tag!==a):e),n(a),null==s||s(e,a,r)},...a})},hf=e=>{const t=Aa();return Oa(e=>_u(e),{onMutate:async()=>{await t.cancelQueries([Pd.allConversations]),await t.cancelQueries([Pd.archivedConversations])},onError:()=>{},onSuccess:(n,s,a)=>{var r;s.conversationId&&sp(t,s.conversationId);const o=t.getQueryCache().findAll([Pd.archivedConversations],{exact:!1});for(const e of o)t.setQueryData(e.queryKey,e=>e?{...e,pages:e.pages.map(e=>({...e,conversations:e.conversations.filter(e=>e.conversationId!==s.conversationId)})).filter(e=>e.conversations.length>0)}:e);t.removeQueries({queryKey:[Pd.conversation,s.conversationId],exact:!0}),t.invalidateQueries({queryKey:[Pd.allConversations],refetchPage:(e,t)=>0===t}),t.invalidateQueries({queryKey:[Pd.archivedConversations],refetchPage:(e,t)=>0===t}),null==(r=null==e?void 0:e.onSuccess)||r.call(e,n,s,a)}})},xf=e=>Oa([Ld.updatePreset],{mutationFn:e=>{return t=e,ou.post("/api/presets",t);var t},...e||{}}),ff=e=>Oa([Ld.deletePreset],{mutationFn:e=>{return t=e,ou.post("/api/presets/delete",t);var t},...e||{}}),gf=e=>Oa([Ld.speechToText],{mutationFn:e=>{return t=e,ou.postMultiPart("/api/files/speech/stt",t);var t},...e||{}}),vf=e=>Oa([Ld.textToSpeech],{mutationFn:e=>{return t=e,ou.postTTS("/api/files/speech/tts/manual",t);var t},...e||{}}),bf=e=>{const t=Aa();return Oa(e=>(({version:e,...t})=>ou.post(Hd({version:e}),t))(e),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r,o;const i=t.getQueryData([Pd.assistants,s.endpoint,li]);if(!i)return null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a);const l=[n,...JSON.parse(JSON.stringify(i.data))];return t.setQueryData([Pd.assistants,s.endpoint,li],{...i,data:l}),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,a)}})},yf=e=>{const t=Aa();return Oa(({assistant_id:e,data:n})=>{const{endpoint:s}=n,a=t.getQueryData([Pd.endpoints]),r=null==a?void 0:a[s];return(({assistant_id:e,data:t,version:n})=>ou.patch(Hd({path:e,version:n}),t))({data:n,version:(null==r?void 0:r.version)??Xl[s],assistant_id:e})},{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r,o;const i=t.getQueryData([Pd.assistants,s.data.endpoint,li]);return i?(t.setQueryData([Pd.assistantDocs,s.data.endpoint],e=>e?e.map(e=>e.assistant_id===s.assistant_id?{...e,conversation_starters:n.conversation_starters,append_current_datetime:s.data.append_current_datetime}:e):e),t.setQueryData([Pd.assistants,s.data.endpoint,li],{...i,data:i.data.map(e=>e.id===s.assistant_id?n:e)}),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,a)):null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},_f=e=>{const t=Aa();return Oa(({assistant_id:e,model:n,endpoint:s})=>{var a;const r=t.getQueryData([Pd.endpoints]);return(({assistant_id:e,model:t,endpoint:n,version:s})=>ou.delete(Hd({path:e,options:{model:t,endpoint:n},version:s})))({assistant_id:e,model:n,version:(null==(a=null==r?void 0:r[s])?void 0:a.version)??Xl[s],endpoint:s})},{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r,o;const i=t.getQueryData([Pd.assistants,s.endpoint,li]);if(!i)return null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a);const l=i.data.filter(e=>e.id!==s.assistant_id);return t.setQueryData([Pd.assistants,s.endpoint,li],{...i,data:l}),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,l)}})},jf=e=>Oa([Ld.assistantAvatarUpload],{mutationFn:({postCreation:e,...t})=>{return n=t,ou.postMultiPart(Hd({isAvatar:!0,path:`${n.assistant_id}/avatar`,options:{model:n.model,endpoint:n.endpoint},version:n.version}),n.formData);var n},...e||{}}),wf=e=>{const t=Aa();return Oa([Ld.updateAction],{mutationFn:e=>(e=>{const{assistant_id:t,version:n,...s}=e;return ou.post(Hd({path:`actions/${t}`,version:n}),s)})(e),onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r,o;const i=t.getQueryData([Pd.assistants,s.endpoint,li]);if(!i)return null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a);const l=n[1];return t.setQueryData([Pd.assistants,s.endpoint,li],{...i,data:i.data.map(e=>e.id===s.assistant_id?l:e)}),t.setQueryData([Pd.actions],e=>null==e?void 0:e.map(e=>e.action_id===s.action_id?n[2]:e).concat(null!=s.action_id&&s.action_id?[]:[n[2]])),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,s,a)}})},Nf=e=>{const t=Aa();return Oa([Ld.deleteAction],{mutationFn:e=>{var n;const{endpoint:s}=e,a=t.getQueryData([Pd.endpoints]),r=(null==(n=null==a?void 0:a[s])?void 0:n.version)??Xl[s];return(async({assistant_id:e,action_id:t,model:n,version:s,endpoint:a})=>ou.delete(Hd({path:`actions/${e}/${t}/${n}`,version:s,endpoint:a})))({...e,version:r})},onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r;let o="";return t.setQueryData([Pd.actions],e=>null==e?void 0:e.filter(e=>(o=e.metadata.domain,e.action_id!==s.action_id))),t.setQueryData([Pd.assistants,s.endpoint,li],e=>e?{...e,data:e.data.map(e=>e.id===s.assistant_id?{...e,tools:(e.tools??[]).filter(e=>{var t;return!(null==(t=e.function)?void 0:t.name.includes(o??""))})}:e)}:e),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})},Cf=e=>Oa({mutationFn:e=>{return t=e,ou.post("/api/user/verify",t);var t},...e||{}}),kf=e=>Oa({mutationFn:e=>{return t=e,ou.post("/api/user/verify/resend",t);var t},...e||{}}),Sf=e=>{const t=Aa();return Oa(()=>ou.post("/api/user/terms/accept"),{onSuccess:(n,s,a)=>{var r;t.setQueryData([Pd.userTerms],{termsAccepted:!0}),null==(r=null==e?void 0:e.onSuccess)||r.call(e,n,s,a)},onError:null==e?void 0:e.onError,onMutate:null==e?void 0:e.onMutate})},Tf=e=>{const{onMutate:t,onError:n,onSuccess:s}=e||{},a=Aa(),r=_(sx.promptsName),o=_(sx.promptsPageSize),i=_(sx.promptsCategory);return Oa({mutationFn:e=>function(e){return ou.patch(Qd(e.id),e.payload)}(e),onMutate:e=>{const n=a.getQueryData([Pd.promptGroup,e.id]),s=n?structuredClone(n):void 0,l=a.getQueryData([Pd.promptGroups,r,i,o]),c=l?structuredClone(l):void 0;let d=e.payload;if(d.removeProjectIds&&(null==s?void 0:s.projectIds)&&(d=structuredClone(d),d.projectIds=s.projectIds.filter(e=>{var t;return!(null==(t=d.removeProjectIds)?void 0:t.includes(e))}),delete d.removeProjectIds),l){const t=Mp(l,{_id:e.id,...d},t=>a.setQueryData([Pd.promptGroup,e.id],t));a.setQueryData([Pd.promptGroups,r,i,o],t)}return t&&t(e),{group:s,previousListData:c}},onError:(e,t,s)=>{(null==s?void 0:s.group)&&a.setQueryData([Pd.promptGroups,t.id],s.group),(null==s?void 0:s.previousListData)&&a.setQueryData([Pd.promptGroups,r,i,o],s.previousListData),n&&n(e,t,s)},onSuccess:(e,t,n)=>{Lp(a,{_id:t.id,...e}),s&&s(e,t,n)}})},Rf=e=>{const t=Aa(),{onSuccess:n,...s}=e||{},a=_(sx.promptsName),r=_(sx.promptsPageSize),o=_(sx.promptsCategory);return Oa({mutationFn:e=>function(e){return ou.post(qd(),e)}(e),...s,onSuccess:(e,s,i)=>{const{prompt:l,group:c}=e;t.setQueryData([Pd.prompts,s.prompt.groupId],e=>[l,...e??[]]),c&&(t.setQueryData([Pd.promptGroups,a,o,r],e=>e?Ip(e,c):e),((e,t)=>{!function(e,t,n){e.setQueryData(t,e=>e?[...e,n]:[n])}(e,[Pd.allPromptGroups],t)})(t,c)),n&&n(e,s,i)}})},If=e=>{const t=Aa(),{onSuccess:n,...s}={},a=_(sx.promptsName),r=_(sx.promptsPageSize),o=_(sx.promptsCategory);return Oa({mutationFn:e=>function(e){return ou.delete((({_id:e,groupId:t})=>`/api/prompts/${e}?groupId=${t}`)(e))}(e),...s,onSuccess:(e,s,i)=>{if(e.promptGroup){const n=e.promptGroup.id;t.setQueryData([Pd.promptGroups,a,o,r],e=>e?Ep(e,n):e),Ap(t,n)}else t.setQueryData([Pd.prompts,s.groupId],e=>{const n=e?e.filter(e=>e._id!==s._id):[];return t.setQueryData([Pd.promptGroup,s.groupId],e=>{if(!e)return e;e.productionId===s._id&&(e.productionId=n[0]._id,e.productionPrompt=n[0])}),n});n&&n(e,s,i)}})},Ef=e=>{const t=Aa(),{onSuccess:n,...s}=e||{},a=_(sx.promptsName),r=_(sx.promptsPageSize),o=_(sx.promptsCategory);return Oa({mutationFn:e=>{return t=e.id,ou.delete(Zd(t));var t},...s,onSuccess:(e,s,i)=>{t.setQueryData([Pd.promptGroups,a,o,r],e=>e?Ep(e,s.id):e),Ap(t,s.id),n&&n(e,s,i)}})},Mf=e=>{const t=Aa(),{onSuccess:n,onError:s,onMutate:a}={},r=_(sx.promptsName),o=_(sx.promptsPageSize),i=_(sx.promptsCategory);return Oa({mutationFn:e=>{return t=e.id,ou.patch(`/api/prompts/${t}/tags/production`);var t},onMutate:e=>{const n=JSON.parse(JSON.stringify(t.getQueryData([Pd.promptGroup,e.groupId]))),s=t.getQueryData([Pd.promptGroups,r,i,o]),l=JSON.parse(JSON.stringify(s));if(s){const n=Mp(s,{_id:e.groupId,productionId:e.id,productionPrompt:e.productionPrompt},n=>t.setQueryData([Pd.promptGroup,e.groupId],n));t.setQueryData([Pd.promptGroups,r,i,o],n)}return a&&a(e),{group:n,previousListData:l}},onError:(e,n,a)=>{(null==a?void 0:a.group)&&t.setQueryData([Pd.promptGroups,n.groupId],a.group),(null==a?void 0:a.previousListData)&&t.setQueryData([Pd.promptGroups,r,i,o],a.previousListData),s&&s(e,n,a)},onSuccess:(e,s,a)=>{Lp(t,{_id:s.groupId,productionId:s.id,productionPrompt:s.productionPrompt}),n&&n(e,s,a)}})},Pf=(e,t)=>La([Pd.roles,e],()=>function(e){return ou.get(Jd(e))}(e),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t});function Lf(e=100){const[t,s]=b(sx.toastState),a=n.useRef(null),r=n.useRef(null);n.useEffect(()=>()=>{null!==a.current&&clearTimeout(a.current),null!==r.current&&clearTimeout(r.current)},[]);return{toast:t,onOpenChange:e=>s({...t,open:e}),showToast:({message:t,severity:n=Wo.SUCCESS,showIcon:o=!0,duration:i=3e3,status:l})=>{null!==a.current&&clearTimeout(a.current),null!==r.current&&clearTimeout(r.current),a.current=window.setTimeout(()=>{s({open:!0,message:t,severity:l??n,showIcon:o}),r.current=window.setTimeout(()=>{s(e=>({...e,open:!1}))},i)},e)}}}const Af=n.createContext({showToast:()=>({})});function Of(){return n.useContext(Af)}function Df({children:e}){const{showToast:t}=Lf();return l.jsx(Af.Provider,{value:{showToast:t},children:e})}function zf(){const e=_(sx.lang),{t:t,i18n:s}=Tr();return n.useEffect(()=>{s.language!==e&&s.changeLanguage(e)},[e,s]),(e,n)=>t(e,n)}function Ff({setIsSpeaking:e,audioRef:t,messageId:s,isLast:a,index:r=0}){const o=zf(),{showToast:i}=Of(),l=_(sx.voice),c=_(sx.cacheTTS),d=_(sx.playbackRate),[u,m]=n.useState(!1),p=n.useRef(null),h=_(sx.globalAudioFetchingFamily(r)),x=_(sx.globalAudioPlayingFamily(r)),f=e=>{const t=document.createElement("a");t.href=e,t.download="audio.mp3",t.click(),m(!1)},{mutate:g,isLoading:v}=vf({onMutate:e=>{(e.get("input")??"").length>=4096&&i({message:o("com_nav_long_audio_warning"),status:"warning"})},onSuccess:async(e,n)=>{try{const s=n.get("input")??"",a=new Blob([e],{type:"audio/mpeg"});if(c&&s){const e=await caches.open("tts-responses"),t=new Request(s),n=new Response(a);e.put(t,n)}const r=URL.createObjectURL(a);u&&f(r),(e=>{const n=new Audio(e);t.current=n})(r)}catch(s){i({message:`Error processing audio: ${s.message}`,status:"error"})}},onError:e=>{i({message:o("com_nav_audio_process_error",{0:e.message}),status:"error"})}}),b=(e,t)=>{const n=((e,t)=>{const n=new FormData;return n.append("input",e),n.append("voice",t),n})(e,l??"");m(t),g(n)},y=async(t,n)=>{const s=await caches.match(t);if(!s)return b(t,n);const a=await s.blob(),r=URL.createObjectURL(a);n?f(r):(t=>{const n=new Audio(t),s=()=>{null!=d&&1!==d&&d>0&&(n.playbackRate=d)};s();const a=()=>n.play().then(()=>e(!0));a().catch(e=>{if(e.message&&e.message.includes("The play() request was interrupted by a call to pause()"))return console.log("Play request was interrupted by a call to pause()"),s(),a().catch(console.error);console.error(e),i({message:o("com_nav_audio_play_error",{0:e.message}),status:"error"})}),n.onended=()=>{console.log("Cached message audio ended"),URL.revokeObjectURL(t),e(!1)},p.current=n})(r)},j=n.useCallback(()=>{p.current&&(p.current.pause(),p.current.src&&URL.revokeObjectURL(p.current.src),p.current=null,e(!1))},[e]);n.useEffect(()=>j,[j]);const w=n.useMemo(()=>a&&h&&!x,[h,x,a]),{data:N=[]}=sf();return{generateSpeechExternal:(e,t)=>{c?y(e,t):b(e,t)},cancelSpeech:()=>{const n=e=>{e&&(e.pause(),e.src&&URL.revokeObjectURL(e.src),t.current=null)};n(document.getElementById(`audio-${s}`)),n(p.current),e(!1)},isLoading:w||v,audioRef:t,voices:N}}function Vf({setIsPlaying:e}){const t=n.useRef(null);return n.useEffect(()=>{const n=()=>{e(!1),console.log("message audio ended"),t.current&&URL.revokeObjectURL(t.current.src)},s=()=>{e(!0),console.log("message audio started")},a=()=>{e(!1),console.log("message audio paused")},r=t.current;return t.current&&(t.current.muted=!0,t.current.addEventListener("ended",n),t.current.addEventListener("play",s),t.current.addEventListener("pause",a)),()=>{r&&(r.removeEventListener("ended",n),r.removeEventListener("play",s),r.removeEventListener("pause",a),URL.revokeObjectURL(r.src))}},[e]),{audioRef:t}}const $f=e=>{const{messageId:t,content:s,isLast:a=!1,index:r=0}=e??{},o=n.useRef(!1),i=n.useRef(void 0),[l,c]=n.useState(!1),{audioRef:d}=Vf({setIsPlaying:c}),{pauseGlobalAudio:u}=ax(r),[m,p]=b(sx.voice),h=_(sx.globalAudioPlayingFamily(r)),x=l||a&&h,{cancelSpeech:f,generateSpeechExternal:g,isLoading:v,voices:y}=Ff({setIsSpeaking:c,audioRef:d,messageId:t,isLast:a,index:r});n.useEffect(()=>{const e=y[0];if(y.length){const t=y.find(e=>e===m);if(null!=t)return Dp.log("useTextToSpeech.ts - Effect:",{voices:y,voice:t}),void p(t.toString());Dp.log("useTextToSpeech.ts - Effect:",{voices:y,voice:e}),p(e.toString())}},[p,m,y]);return{handleMouseDown:()=>{o.current=!0,i.current=window.setTimeout(()=>{if(o.current){const e=s??"",t="string"==typeof e?e:md(e);g(t,!1)}},1e3)},handleMouseUp:()=>{o.current=!1,null!=i.current&&window.clearTimeout(i.current)},toggleSpeech:()=>{if(!0===x)f(),u();else{const e=s??"",t="string"==typeof e?e:md(e);g(t,!1)}},isSpeaking:x,isLoading:v,audioRef:d,voices:y}};const Bf=e=>{const{content:t,isLast:s=!1,index:a=0}=e??{},r=n.useRef(!1),o=n.useRef(void 0),[i,l]=n.useState(!1),{audioRef:c}=Vf({setIsPlaying:l}),{pauseGlobalAudio:d}=ax(a),[u,m]=b(sx.voice),p=_(sx.globalAudioPlayingFamily(a)),h=i||s&&p,{generateSpeechLocal:x,cancelSpeechLocal:f,voices:g}=function({setIsSpeaking:e}){const t=_(sx.voice),[s,a]=n.useState([]),r=_(sx.cloudBrowserVoices),[o,i]=n.useState(!0),l=n.useCallback(()=>{const e=window.speechSynthesis;if(e)try{const t=e.getVoices();if(!Array.isArray(t))return void console.error("getVoices() did not return an array");const n=t.filter(e=>r||!0===e.localService).map(e=>({value:e.name,label:e.name}));a(n)}catch(t){console.error("Error updating voices:",t),i(!1)}else i(!1)},[r]);return n.useEffect(()=>{const e=window.speechSynthesis;if(e){try{e.getVoices().length?l():e.onvoiceschanged=l}catch(t){console.error("Error in useEffect:",t),i(!1)}return()=>{e.onvoiceschanged&&(e.onvoiceschanged=null)}}i(!1)},[l]),{generateSpeechLocal:n=>{if(!o)return void console.warn("Speech synthesis is not supported");const a=window.speechSynthesis,r=s.find(e=>e.value===t);if(r)try{a.cancel();const t=new SpeechSynthesisUtterance(n);t.voice=a.getVoices().find(e=>e.name===r.value)||null,t.onend=()=>{e(!1)},t.onerror=t=>{console.error("Speech synthesis error:",t),e(!1)},e(!0),a.speak(t)}catch(i){console.error("Error generating speech:",i),e(!1)}else console.warn("Selected voice not found")},cancelSpeechLocal:()=>{if(o)try{window.speechSynthesis.cancel()}catch(t){console.error("Error cancelling speech:",t)}finally{e(!1)}},voices:s,isSpeechSynthesisSupported:o}}({setIsSpeaking:l});n.useEffect(()=>{const e=g[0];if(g.length&&"object"==typeof e){const t=g.find(e=>"object"==typeof e?e.value===u:e===u);if(null!=t){const e="object"==typeof t?t.value:t;return Dp.log("useTextToSpeech.ts - Effect:",{voices:g,voice:e}),void m(e)}Dp.log("useTextToSpeech.ts - Effect:",{voices:g,voice:e.value}),m(e.value)}},[m,u,g]);return{handleMouseDown:()=>{r.current=!0,o.current=window.setTimeout(()=>{if(r.current){const e=t??"",n="string"==typeof e?e:md(e);x(n)}},1e3)},handleMouseUp:()=>{r.current=!1,null!=o.current&&window.clearTimeout(o.current)},toggleSpeech:()=>{if(!0===h)f(),d();else{const e=t??"",n="string"==typeof e?e:md(e);x(n)}},isSpeaking:h,isLoading:!1,audioRef:c,voices:g}};const Uf=(e,t)=>Va([Pd.sharedMessages,e],()=>function(e){return ou.get(Fd(e))}(e),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t}),Hf=e=>{const t=za();return Fa(e=>function(e){const{conversationId:t,messageId:n,text:s}=e;if(!t)throw new Error("conversationId is required");return ou.put(Dd({conversationId:t,messageId:n}),{text:s})}(e),{onSuccess:()=>{t.invalidateQueries([Pd.messages,e])}})},Kf=e=>{const t=za();return Fa(e=>function(e){const{conversationId:t,messageId:n,index:s,text:a}=e;if(!t)throw new Error("conversationId is required");return ou.put(Dd({conversationId:t,messageId:n}),{text:a,index:s})}(e),{onSuccess:()=>{t.invalidateQueries([Pd.messages,e])}})},Gf=e=>Va([Pd.models],()=>(async()=>ou.get("/api/models"))(),{initialData:Vc,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:1/0,...e}),Wf=()=>{const e=za();return Fa(e=>function(e){return ou.post("/api/presets",e)}(e),{onSuccess:()=>{e.invalidateQueries([Pd.presets])}})},qf=e=>{const t=za();return Fa(e=>(e=>ou.post("/api/auth/register",e))(e),{...e,onSuccess:(...n)=>{t.invalidateQueries([Pd.user]),(null==e?void 0:e.onSuccess)&&e.onSuccess(...n)}})},Qf=(e,t)=>Va([Pd.name,e],()=>e?hu(e):Promise.resolve({expiresAt:""}),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t}),Zf=()=>Fa(e=>(e=>ou.post("/api/auth/requestPasswordReset",e))(e)),Jf=()=>Fa(e=>(e=>ou.post("/api/auth/resetPassword",e))(e)),Yf=e=>Va([Pd.availablePlugins],()=>ou.get("/api/plugins"),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),Xf=e=>{const t=za(),{onSuccess:n,...s}=e??{};return Fa(e=>(e=>ou.post("/api/user/plugins",e))(e),{...s,onSuccess:(...e)=>{t.invalidateQueries([Pd.user]),null==n||n(...e)}})},eg=e=>Va([Pd.customConfigSpeech],()=>ou.get("/api/files/speech/config/get"),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),tg=(e,t)=>{const n=za();return Fa(n=>function(e,t,n){return ou.put(((e,t)=>`/api/messages/${e}/${t}/feedback`)(e,t),n)}(e,t,n),{onSuccess:()=>{n.invalidateQueries([Pd.messages,t])}})},ng=new Set(["spec","iconURL"]),sg=()=>{const{data:e={}}=kx(),{data:t={}}=Gf();return({conversation:n,preset:s,cleanInput:a,cleanOutput:r})=>{const o=Up({convoSetup:s,endpointsConfig:e}),i=t[o??""]||[],l={...n};if(!0===a)for(const e in l)Hl.has(e)&&!ng.has(e)||null!=l[e]&&(l[e]=void 0);const c=Bp({conversation:l,endpoint:o,lastConversationSetup:s,models:i});if(!r)return c;for(const e in c)Hl.has(e)&&!ng.has(e)||null!=c[e]&&(c[e]=void 0);return c}},ag=n.createContext({}),rg=()=>n.useContext(ag),og=e=>e.data.map(({id:e,name:t,metadata:n,model:s})=>({id:e,name:t??"",metadata:n,model:s}));function ig(e=og){const{data:t=null}=ef(vi.assistants,void 0,{select:e}),{data:s=null}=ef(vi.azureAssistants,void 0,{select:e});return n.useMemo(()=>({[vi.assistants]:t,[vi.azureAssistants]:s}),[t,s])}const lg=n.createContext({}),cg=()=>n.useContext(lg);function dg(){return e=>localStorage.setItem(Jc.FILES_TO_DELETE,JSON.stringify(e))}function ug(){const{data:e={}}=kx();return n.useCallback(t=>{const{modelDisplayLabel:n}=(null==e?void 0:e[t.endpoint??""])??{};return(e=>{const{model:t,endpoint:n,endpointType:s,modelDisplayLabel:a,chatGptLabel:r,modelLabel:o}=e,i=n,l=t??"",c=a??"",d=r??"",u=o??"";if([vi.openAI,vi.bedrock,vi.gptPlugins,vi.azureOpenAI,vi.chatGPTBrowser].includes(i))return d||(u||(l&&dd(l)?dd(l):l&&(l.includes("mistral")||l.includes("codestral"))?"Mistral":l&&l.includes("deepseek")?"Deepseek":l&&l.includes("gpt-")?cd(l)||"GPT":Oc[i]??"ChatGPT"));if(i===vi.anthropic)return u||"Claude";if(i===vi.bedrock)return u||Oc[i];if(i===vi.google)return u||(!0===(null==l?void 0:l.toLowerCase().includes("gemma"))?"Gemma":"Gemini");if(i===vi.custom||s===vi.custom)return u||(d||(l&&dd(l)?dd(l):l&&(l.includes("mistral")||l.includes("codestral"))?"Mistral":l&&l.includes("deepseek")?"Deepseek":l&&l.includes("gpt-")?cd(l)||"GPT":c||"AI"));return""})({...t,modelDisplayLabel:n})},[e])}var mg,pg=Object.freeze,hg=Object.defineProperty;const xg=({codeArtifacts:e,includeShadcnui:t,customPromptMode:n})=>{if(e)return n?hd.CUSTOM:t?hd.SHADCNUI:hd.DEFAULT},fg={"application/vnd.mermaid":"App.tsx","application/vnd.react":"App.tsx","text/html":"index.html","application/vnd.code-html":"index.html",default:"index.html"},gg={"text/html":"static","application/vnd.react":"react-ts","application/vnd.mermaid":"react-ts","application/vnd.code-html":"static",default:"static"};function vg(e,t){return`${e}${((null==t?void 0:t.length)??0)>0?`-${t}`:""}`}const bg={three:"^0.167.1","lucide-react":"^0.394.0","react-router-dom":"^6.11.2","class-variance-authority":"^0.6.0",clsx:"^1.2.1","date-fns":"^3.3.1","tailwind-merge":"^1.9.1","tailwindcss-animate":"^1.0.5",recharts:"2.12.7","@radix-ui/react-accordion":"^1.1.2","@radix-ui/react-alert-dialog":"^1.0.2","@radix-ui/react-aspect-ratio":"^1.1.0","@radix-ui/react-avatar":"^1.1.0","@radix-ui/react-checkbox":"^1.0.3","@radix-ui/react-collapsible":"^1.0.3","@radix-ui/react-dialog":"^1.0.2","@radix-ui/react-dropdown-menu":"^2.1.1","@radix-ui/react-hover-card":"^1.0.5","@radix-ui/react-label":"^2.0.0","@radix-ui/react-menubar":"^1.1.1","@radix-ui/react-navigation-menu":"^1.2.0","@radix-ui/react-popover":"^1.0.7","@radix-ui/react-progress":"^1.1.0","@radix-ui/react-radio-group":"^1.1.3","@radix-ui/react-select":"^2.0.0","@radix-ui/react-separator":"^1.0.3","@radix-ui/react-slider":"^1.1.1","@radix-ui/react-switch":"^1.0.3","@radix-ui/react-tabs":"^1.0.3","@radix-ui/react-toast":"^1.1.5","@radix-ui/react-slot":"^1.1.0","@radix-ui/react-toggle":"^1.1.0","@radix-ui/react-toggle-group":"^1.1.0","embla-carousel-react":"^8.2.0","react-day-picker":"^9.0.8","dat.gui":"^0.7.9",vaul:"^0.9.1"},yg={"application/vnd.mermaid":Object.assign({mermaid:"^11.4.1","react-zoom-pan-pinch":"^3.6.1"},bg),"application/vnd.react":bg,"text/html":bg,"application/vnd.code-html":bg,default:bg};function _g(e){return yg[e]??bg}const jg={externalResources:["https://unpkg.com/@tailwindcss/ui/dist/tailwind-ui.min.css"]},wg={"/lib/utils.ts":xd.utils,"/components/ui/accordion.tsx":xd.accordian,"/components/ui/alert-dialog.tsx":xd.alertDialog,"/components/ui/alert.tsx":xd.alert,"/components/ui/avatar.tsx":xd.avatar,"/components/ui/badge.tsx":xd.badge,"/components/ui/breadcrumb.tsx":xd.breadcrumb,"/components/ui/button.tsx":xd.button,"/components/ui/calendar.tsx":xd.calendar,"/components/ui/card.tsx":xd.card,"/components/ui/carousel.tsx":xd.carousel,"/components/ui/checkbox.tsx":xd.checkbox,"/components/ui/collapsible.tsx":xd.collapsible,"/components/ui/dialog.tsx":xd.dialog,"/components/ui/drawer.tsx":xd.drawer,"/components/ui/dropdown-menu.tsx":xd.dropdownMenu,"/components/ui/input.tsx":xd.input,"/components/ui/label.tsx":xd.label,"/components/ui/menubar.tsx":xd.menuBar,"/components/ui/navigation-menu.tsx":xd.navigationMenu,"/components/ui/pagination.tsx":xd.pagination,"/components/ui/popover.tsx":xd.popover,"/components/ui/progress.tsx":xd.progress,"/components/ui/radio-group.tsx":xd.radioGroup,"/components/ui/select.tsx":xd.select,"/components/ui/separator.tsx":xd.separator,"/components/ui/skeleton.tsx":xd.skeleton,"/components/ui/slider.tsx":xd.slider,"/components/ui/switch.tsx":xd.switchComponent,"/components/ui/table.tsx":xd.table,"/components/ui/tabs.tsx":xd.tabs,"/components/ui/textarea.tsx":xd.textarea,"/components/ui/toast.tsx":xd.toast,"/components/ui/toaster.tsx":xd.toaster,"/components/ui/toggle-group.tsx":xd.toggleGroup,"/components/ui/toggle.tsx":xd.toggle,"/components/ui/tooltip.tsx":xd.tooltip,"/components/ui/use-toast.tsx":xd.useToast,"/public/index.html":C(mg||(Ng=['\n    <!DOCTYPE html>\n    <html lang="en">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>Document</title>\n        <script src="https://cdn.tailwindcss.com"><\/script>\n      </head>\n      <body>\n        <div id="root"></div>\n      </body>\n    </html>\n  '],mg=pg(hg(Ng,"raw",{value:pg(Ng.slice())}))))};var Ng;const Cg=e=>{const{data:t}=kx(),s=null==t?void 0:t[e??""],{azure:a}=s??{};let r=e;a?r=vi.azureOpenAI:r===vi.gptPlugins&&(r=vi.openAI);const o=(()=>{const e=za();return Fa(e=>pu(e),{onSuccess:(t,n)=>{e.invalidateQueries([Pd.name,n.name])}})})(),i=Qf(r),l=n.useCallback(()=>{if(i.data)return i.data.expiresAt||"never"},[i.data]),c=n.useCallback(()=>{const e=l();if(!e)return!0;return!(new Date(e)<new Date)},[l]),d=n.useCallback((e,t)=>{const n=t?new Date(t).toISOString():"";o.mutate({name:r,value:e,expiresAt:n})},[o,r]);return n.useMemo(()=>({getExpiry:l,checkExpiry:c,saveUserKey:d}),[l,c,d])};function kg({index:e=0,files:t,setFiles:n,getMessages:s,setMessages:a,isSubmitting:r,latestMessage:o,setSubmission:i,setLatestMessage:l,conversation:c}){const d=k(),u=ug(),{user:m}=Rg(),p=Aa(),h=dg(),x=v(({snapshot:e})=>t=>(Dp.log("agents",`[useGetEphemeralAgent] Getting loadable for ID: ${t}`),e.getLoadable(tx(t)).contents),[]),f=_(sx.isTemporary),g=_(sx.codeArtifacts),b=_(sx.includeShadcnui),j=_(sx.customPromptMode),{getExpiry:N}=Cg((null==c?void 0:c.endpoint)??""),C=y(sx.showStopButtonByIndex(e)),T=w(sx.latestMessageFamily(e+1)),R=({text:v,overrideConvoId:y,overrideUserMessageId:_,parentMessageId:w=null,conversationId:k=null,messageId:R=null},{editedText:I=null,editedMessageId:E=null,isResubmission:M=!1,isRegenerate:P=!1,isContinued:L=!1,isEdited:A=!1,overrideMessages:O,overrideFiles:D}={})=>{var z;if(C(!1),T(),r||""===v)return;const F=Nr.cloneDeep(c),V=null==F?void 0:F.endpoint;if(null===V)return void console.error("No endpoint available");if("search"==(k=k??(null==F?void 0:F.conversationId)??null))return void console.error("cannot send any message under search view!");if(L&&!o)return void console.error("cannot continue AI message without latestMessage!");const $=x(k??Zc.NEW_CONVO),B=A||L;let U=O??s()??[];(null==F?void 0:F.promptPrefix)&&(F.promptPrefix=pd({text:F.promptPrefix,user:m})),v=v.trim();const H=_??S();var K;w=w??(null==o?void 0:o.messageId)??Zc.NO_PARENT,K={index:e,conversation:F,latestMessage:o,conversationId:k,intermediateId:H,parentMessageId:w,currentMessages:U},Dp.log("=====================================\nAsk function called with:"),Dp.dir(K),Dp.log("====================================="),k==Zc.NEW_CONVO&&(w=Zc.NO_PARENT,U=[],k=null,d("/c/new",{state:{focusChat:!0}}));const G=P?R:null==o?void 0:o.parentMessageId,W=U.find(e=>e.messageId===G);let q=(null==W?void 0:W.thread_id)??(null==o?void 0:o.thread_id);null==q&&(q=null==(z=U.find(e=>e.thread_id))?void 0:z.thread_id);const Q=p.getQueryData([Pd.endpoints]),Z=fp(Q,V,"type"),J=(({endpoint:e,endpointType:t,conversation:n,possibleValues:s})=>{if(!e)throw new Error(`undefined endpoint: ${e}`);let a=ud[e];if(!a&&!t)throw new Error(`Unknown endpoint: ${e}`);if(!a&&t&&(a=ud[t]),!a)throw new Error(`Unknown endpointType: ${t}`);const r=a.parse(n),{models:o}=s??{};return o&&r&&(r.model=od(o)??r.model),r})({endpoint:V,endpointType:Z,conversation:F??{}}),{modelDisplayLabel:Y}=(null==Q?void 0:Q[V??""])??{},X=Object.assign({endpoint:V,endpointType:Z,overrideConvoId:y,overrideUserMessageId:_,artifacts:V!==vi.agents?xg({codeArtifacts:g,includeShadcnui:b,customPromptMode:j}):void 0},J);V!==vi.agents?(X.key=N(),X.thread_id=q,X.modelDisplayLabel=Y):X.key=new Date(Date.now()+36e5).toISOString();const ee=u({model:null==F?void 0:F.model,...X}),te={text:v,sender:"User",clientTimestamp:(new Date).toLocaleString("sv").replace(" ","T"),isCreatedByUser:!0,parentMessageId:w,conversationId:k,messageId:L&&null!=R&&R?R:H,thread_id:q,error:!1},ne=D??(null==W?void 0:W.files),se=(P||null!=D&&D.length)&&ne&&ne.length>0;n&&!0===se?(te.files=[...ne],n(new Map),h({})):n&&t&&t.size>0&&(te.files=Array.from(t.values()).map(e=>({file_id:e.file_id,filepath:e.filepath,type:e.type??"",height:e.height,width:e.width})),n(new Map),h({}));const ae=I??(null==o?void 0:o.text)??"",re=B?ae:"",oe=E??((null==o?void 0:o.messageId)?(null==o?void 0:o.messageId)+"_":null)??null,ie={sender:ee,text:re,endpoint:V??"",parentMessageId:P?R:H,messageId:oe??`${P?R:H}_`,thread_id:q,conversationId:k,unfinished:!1,isCreatedByUser:!1,iconURL:null==J?void 0:J.iconURL,model:null==J?void 0:J.model,error:!1};ji(V)?(ie.model=(null==F?void 0:F.assistant_id)??"",ie.text="",ie.content=[{type:td.TEXT,[td.TEXT]:{value:re}}]):V===vi.agents?(ie.model=(null==F?void 0:F.agent_id)??"",ie.text="",ie.content=[{type:td.TEXT,[td.TEXT]:{value:re}}],C(!0)):((e,t)=>t===vi.custom||e===vi.openAI||e===vi.azureOpenAI||void 0)(V,Z)?(ie.text="",ie.content=[{type:td.TEXT,[td.TEXT]:{value:re}}],C(!0)):C(!0),L&&(U=U.filter(e=>e.messageId!==oe)),Dp.log("message_state",ie);const le={conversation:{...F,conversationId:k},endpointOption:X,userMessage:{...te,generation:ae,responseMessageId:oe,overrideParentMessageId:P?R:null},messages:U,isEdited:B,isContinued:L,isRegenerate:P,isResubmission:M,initialResponse:ie,isTemporary:f,ephemeralAgent:$};a(P?[...le.messages,ie]:[...le.messages,te,ie]),0===e&&l&&l(ie),i(le),Dp.dir("message_stream",le,{depth:null})};return{ask:R,regenerate:({parentMessageId:e})=>{const t=s(),n=null==t?void 0:t.find(t=>t.messageId==e);n&&n.isCreatedByUser?R({...n},{isRegenerate:!0}):console.error("Failed to regenerate the message: parentMessage not found or not created by user.")}}}const Sg=n.createContext(void 0),Tg=({authConfig:e,children:t})=>{const[s,a]=b(sx.user),[r,o]=n.useState(void 0),[i,c]=n.useState(void 0),[d,u]=n.useState(!1),m=n.useRef(void 0),{data:p=null}=Pf(Id.USER,{enabled:!(!d||!(null==s?void 0:s.role))}),{data:h=null}=Pf(Id.ADMIN,{enabled:!(!d||(null==s?void 0:s.role)!==Id.ADMIN)}),x=k(),f=n.useMemo(()=>Nr.debounce(e=>{const{token:t,isAuthenticated:n,user:s,redirect:r}=e;a(s),o(t),Ad(t),u(n);const i=m.current||r;m.current=void 0,null!=i&&(i.startsWith("http://")||i.startsWith("https://")?window.location.href=i:x(i,{replace:!0}))},50),[x,a]),g=function({callback:e,delay:t=400}){const s=n.useRef(null);return n.useEffect(()=>()=>{null!==s.current&&clearTimeout(s.current)},[]),n=>{null!==s.current&&clearTimeout(s.current),null!=n&&n&&(console.log(n),s.current=setTimeout(()=>{e(n)},t))}}({callback:e=>c(e)}),v=lx({onSuccess:e=>{const{user:t,token:n,twoFAPending:s,tempToken:a}=e;s?x(`/login/2fa?tempToken=${a}`,{replace:!0}):(c(void 0),f({token:n,isAuthenticated:!0,user:t,redirect:"/c/new"}))},onError:e=>{g(e.message),x("/login",{replace:!0})}}),y=ix({onSuccess:e=>{f({token:void 0,isAuthenticated:!1,user:void 0,redirect:e.redirect??"/login"})},onError:e=>{g(e.message),f({token:void 0,isAuthenticated:!1,user:void 0,redirect:"/login"})}}),_=(()=>{const e=Aa();return Oa([Ld.refreshToken],{mutationFn:()=>ou.refreshToken(),onMutate:t=>{e.removeQueries()}})})(),j=n.useCallback(e=>{e&&(m.current=e),y.mutate(void 0)},[y]),w=rx({enabled:!!r}),N=e=>{v.mutate(e)},C=n.useCallback(()=>{!0!==(null==e?void 0:e.test)?_.mutate(void 0,{onSuccess:t=>{const{user:n,token:s=""}=t??{};if(s)f({token:s,isAuthenticated:!0,user:n});else{if(console.log("Token is not present. User is not authenticated."),!0===(null==e?void 0:e.test))return;x("/login")}},onError:t=>{console.log("refreshToken mutation error:",t),!0!==(null==e?void 0:e.test)&&x("/login")}}):console.log("Test mode. Skipping silent refresh.")},[]);n.useEffect(()=>{w.data?a(w.data):w.isError&&(g(w.error.message),x("/login",{replace:!0})),null!=i&&i&&d&&g(void 0),null!=r&&r&&d||C()},[r,d,w.data,w.isError,w.error,i,a,x,C,f]),n.useEffect(()=>{const e=e=>{console.log("tokenUpdated event received event");const t=e.detail;f({token:t,isAuthenticated:!0,user:s})};return window.addEventListener("tokenUpdated",e),()=>{window.removeEventListener("tokenUpdated",e)}},[f,s]);const S=n.useMemo(()=>({user:s,token:r,error:i,login:N,logout:j,setError:c,roles:{[Id.USER]:p,[Id.ADMIN]:h},isAuthenticated:d}),[s,i,d,r,p,h]);return l.jsx(Sg.Provider,{value:S,children:t})},Rg=()=>{const e=n.useContext(Sg);if(void 0===e)throw new Error("useAuthContext should be used inside AuthProvider");return e},Ig=[];function Eg(){const e=zf(),t=_(sx.chatBadges),s=n.useMemo(()=>new Set(t.map(e=>e.id)),[t]);return n.useMemo(()=>Ig.map(t=>({id:t.id,label:e(t.label),icon:t.icon,atom:t.atom,isAvailable:s.has(t.id)}))||[],[s,e])}const Mg=(e=0)=>{const t=k(),[s]=rs(),{data:a}=Sx(),r=sx.useClearConvoState(),o=_(sx.defaultPreset),{setConversation:i}=sx.useCreateConversationAtom(e),[l,c]=b(sx.filesByIndex(e)),d=_(sx.saveBadgesState),u=sx.useClearLatestMessages(`useNewConvo ${e}`),m=y(sx.submissionByIndex(e)),{data:p={}}=kx(),h=Gf(),x=ig(),{pauseGlobalAudio:f}=ax(e),g=_(sx.saveDrafts),j=v(({reset:e})=>()=>{Ig.forEach(({atom:t})=>e(t)),e(sx.chatBadges)},[]),{mutateAsync:w}=Px({onSuccess:()=>{console.log("Files deleted")},onError:e=>{console.log("Error deleting files:",e)}}),N=v(()=>async(n,a=null,l,c,d,f,g,v)=>{var b,y,_;const j=l??h.data,{endpoint:w=null}=n,N=(null===w||c)??!1,C=!o||a||o.endpoint!==w&&w||!N?a:o,k=v??(null!=(null==C?void 0:C.presetId)&&C.presetId&&C.presetId===(null==o?void 0:o.presetId));if(N){let t=Up({convoSetup:C??n,endpointsConfig:p});t||(t=Object.keys(p??{})[0]);const s=fp(p,t,"type");!n.endpointType&&s?n.endpointType=s:n.endpointType&&!s&&(n.endpointType=void 0);const a=ji(t),r=x[t]??[],o=n.assistant_id??"",i=null==(b=x[t])?void 0:b[o];if(o&&!i&&(n.assistant_id=void 0),!o&&a&&(n.assistant_id=localStorage.getItem(`${Jc.ASST_ID_PREFIX}${e}${t}`)??(null==(y=r[0])?void 0:y.id)),o&&a&&n.conversationId===Zc.NEW_CONVO){const e=r.find(e=>e.id===o);n.model=null==e?void 0:e.model,function({endpoint:e,model:t=""}){if(!t)return;const n=JSON.parse((localStorage.getItem(vp)??"{}")||"{}");n.endpoint===e&&(n.model=t,localStorage.setItem(vp,JSON.stringify(n)));const s=JSON.parse((localStorage.getItem(Jc.LAST_MODEL)??"{}")||"{}");s[e]=t,localStorage.setItem(Jc.LAST_MODEL,JSON.stringify(s))}({endpoint:t,model:n.model})}o&&!a&&(n.assistant_id=void 0);const l=(null==j?void 0:j[t])??[];n=Bp({conversation:n,lastConversationSetup:C,endpoint:t,models:l})}!0===k&&(n.disableParams=!0),f||r(!0);const S=null==(_=n.conversationId)?void 0:_.startsWith("_");if(S?(Dp.log("conversation","Cancelled conversation, setting to `new` in `useNewConvo`",n),i({...n,conversationId:Zc.NEW_CONVO})):(Dp.log("conversation","Setting conversation from `useNewConvo`",n),i(n)),m({}),d||u(),S)return;const T=null==s?void 0:s.toString(),R=()=>T?`?${T}`:"";if(n.conversationId===Zc.NEW_CONVO&&!l){const e=localStorage.getItem(Jc.APP_TITLE)??"";e&&(document.title=e);const n=`/c/${Zc.NEW_CONVO}${R()}`;return void t(n,{state:{focusChat:!0}})}const I=`/c/${n.conversationId}${R()}`;t(I,{replace:!0,state:g?{}:{focusChat:!0}})},[p,o,x,h.data]),C=n.useCallback(function({template:e={},preset:t,modelsData:n,disableFocus:s,buildDefault:r=!0,keepLatestMessage:o=!1,keepAddedConvos:i=!1,disableParams:u}={}){var m,p;f(),d||j();const h=e.conversationId??"",x=!0===(!0===Ni(e.endpoint??"",e.endpointType??"")||Ni((null==t?void 0:t.endpoint)??"",(null==t?void 0:t.endpointType)??""))&&h&&h===Zc.NEW_CONVO?{endpoint:e.endpoint}:e,v={conversationId:Zc.NEW_CONVO,title:"New Chat",endpoint:null,...x,createdAt:"",updatedAt:""};let b=t;const y=yp(a);if(b||!a||!0!==(null==(m=a.modelSpecs)?void 0:m.prioritize)&&!0===((null==(p=a.interface)?void 0:p.modelSelect)??!0)||!y||(b=_p(y)),"new"===v.conversationId&&!n){const e=Array.from(l.values()).filter(e=>null!=e.filepath&&""!==e.filepath&&e.source&&!e.embedded&&e.temp_file_id).map(e=>({file_id:e.file_id,embedded:!!e.embedded,filepath:e.filepath,source:e.source}));c(new Map),localStorage.setItem(Jc.FILES_TO_DELETE,JSON.stringify({})),!g&&e.length>0&&w({files:e})}N(v,b,n,r,o,i,s,u)},[l,c,g,w,j,a,d,f,N]);return{switchToConversation:N,newConversation:C}};function Pg(e=0,t){const s=sx.useClearSubmissionState(),[a,r]=b(sx.filesByIndex(e)),[o,i]=n.useState(!1),l=Aa(),{isAuthenticated:c}=Rg(),{newConversation:d}=Mg(e),{useCreateConversationAtom:u}=sx,{conversation:m,setConversation:p}=u(e),{conversationId:h}=m??{},x="new"===t?t:h??t??"",{data:f}=Fx(h??"",{enabled:c}),g=w(sx.latestMessageFamily(e)),[v,_]=b(sx.isSubmittingFamily(e)),[j,N]=b(sx.latestMessageFamily(e)),C=y(sx.messagesSiblingIdxFamily((null==j?void 0:j.parentMessageId)??null)),k=n.useCallback(e=>{l.setQueryData([Pd.messages,x],e),"new"===x&&h&&"new"!==h&&l.setQueryData([Pd.messages,h],e)},[x,l,h]),S=n.useCallback(()=>l.getQueryData([Pd.messages,x]),[x,l]),T=y(sx.submissionByIndex(e)),{ask:R,regenerate:I}=kg({index:e,files:a,setFiles:r,getMessages:S,setMessages:k,isSubmitting:v,conversation:m,latestMessage:j,setSubmission:T,setLatestMessage:N}),E=()=>s(),[M,P]=b(sx.showPopoverFamily(e)),[L,A]=b(sx.abortScrollFamily(e)),[O,D]=b(sx.presetByIndex(e)),[z,F]=b(sx.optionSettingsFamily(e)),[V,$]=b(sx.showAgentSettingsFamily(e));return{newConversation:d,conversation:m,setConversation:p,isSubmitting:v,setIsSubmitting:_,getMessages:S,setMessages:k,setSiblingIdx:C,latestMessage:j,setLatestMessage:N,resetLatestMessage:g,ask:R,index:e,regenerate:I,stopGenerating:E,handleStopGenerating:e=>{e.preventDefault(),E()},handleRegenerate:e=>{e.preventDefault();const t=(null==j?void 0:j.parentMessageId)??"";t?I({parentMessageId:t}):console.error("Failed to regenerate the message: parentMessageId not found.")},handleContinue:e=>{e.preventDefault(),(()=>{if(!j)return void console.error("Failed to regenerate the message: latestMessage not found.");const e=S(),t=null==e?void 0:e.find(e=>e.messageId==j.parentMessageId);t&&t.isCreatedByUser?R({...t},{isContinued:!0,isRegenerate:!0,isEdited:!0}):console.error("Failed to regenerate the message: parentMessage not found, or not created by user.")})(),C(0)},showPopover:M,setShowPopover:P,abortScroll:L,setAbortScroll:A,preset:O,setPreset:D,optionSettings:z,setOptionSettings:F,showAgentSettings:V,setShowAgentSettings:$,files:a,setFiles:r,filesLoading:o,setFilesLoading:i}}function Lg({rootIndex:e=0,currentIndex:t,paramId:s}){const a=Aa(),r=sx.useClearSubmissionState(),[o,i]=b(sx.filesByIndex(e)),l=_(sx.latestMessageFamily(e)),c=y(sx.latestMessageFamily(t)),{useCreateConversationAtom:d}=sx,{conversation:u,setConversation:m}=d(t),[p,h]=b(sx.isSubmittingFamily(t)),x=y(sx.messagesSiblingIdxFamily((null==l?void 0:l.parentMessageId)??null)),f="new"===s?s:(null==u?void 0:u.conversationId)??s??"",g=n.useCallback(e=>{a.setQueryData([Pd.messages,f,t],e);const n=e[e.length-1];n&&c({...n,depth:-1})},[f,a,t,c]),v=n.useCallback(()=>a.getQueryData([Pd.messages,f,t]),[f,a,t]),j=y(sx.submissionByIndex(t)),{ask:w,regenerate:N}=kg({index:t,files:o,setFiles:i,getMessages:v,setMessages:g,isSubmitting:p,conversation:u,setSubmission:j,latestMessage:l}),C=()=>r();return{ask:w,regenerate:N,getMessages:v,setMessages:g,conversation:u,isSubmitting:p,setSiblingIdx:x,latestMessage:l,stopGenerating:C,handleContinue:e=>{e.preventDefault(),(()=>{if(!l)return void console.error("Failed to regenerate the message: latestMessage not found.");const e=v(),t=null==e?void 0:e.find(e=>e.messageId==l.parentMessageId);t&&t.isCreatedByUser?w({...t},{isContinued:!0,isRegenerate:!0,isEdited:!0}):console.error("Failed to regenerate the message: parentMessage not found, or not created by user.")})(),x(0)},setConversation:m,setIsSubmitting:h,handleRegenerate:e=>{e.preventDefault();const t=null==l?void 0:l.parentMessageId;t?N({parentMessageId:t}):console.error("Failed to regenerate the message: parentMessageId not found.")},handleStopGenerating:e=>{e.preventDefault(),C()}}}function Ag({rootIndex:e}){const t=n.useMemo(()=>e+1,[e]),{ask:s,regenerate:a,setMessages:r,getMessages:o,conversation:i,isSubmitting:l,setConversation:c,setIsSubmitting:d}=Lg({rootIndex:e,currentIndex:t}),{generateConversation:u}=(({index:e=0,rootIndex:t,setConversation:s})=>{const a=Gf(),r=ig(),{data:o={}}=kx(),i=n.useRef(),l=_(sx.conversationByKeySelector(t));return n.useEffect(()=>{null!=(null==l?void 0:l.conversationId)&&s&&s(e=>{if(!e)return e;const t={...e,conversationId:l.conversationId};return Dp.log("conversation","Setting conversation from `useNewConvo`",t),t})},[null==l?void 0:l.conversationId,s]),{generateConversation:n.useCallback(({template:t={},preset:n,modelsData:c}={})=>{var d,u;let m={conversationId:"new",title:"New Chat",endpoint:null,...t,createdAt:"",updatedAt:""};(null==l?void 0:l.conversationId)&&(m.conversationId=l.conversationId);const p=c??a.data,h=Up({convoSetup:n??m,endpointsConfig:o}),x=fp(o,h,"type");!m.endpointType&&x?m.endpointType=x:m.endpointType&&!x&&(m.endpointType=void 0);const f=ji(h),g=r[h??""]??[];if(m.assistant_id&&!(null==(d=r[h??""])?void 0:d[m.assistant_id])&&(m.assistant_id=void 0),!m.assistant_id&&f&&(m.assistant_id=localStorage.getItem(`${Jc.ASST_ID_PREFIX}${e}${h}`)??(null==(u=g[0])?void 0:u.id)),null!=m.assistant_id&&f&&"new"===m.conversationId){const e=g.find(e=>e.id===m.assistant_id);m.model=null==e?void 0:e.model}null==m.assistant_id||f||(m.assistant_id=void 0);const v=(null==p?void 0:p[h??""])??[];return m=Bp({conversation:m,lastConversationSetup:n,endpoint:h??"",models:v}),null!=(null==n?void 0:n.title)&&""!==n.title&&(m.title=n.title),s&&s(m),clearTimeout(i.current),i.current=setTimeout(()=>{const e=document.getElementById(Bo);e&&e.focus()},150),m},[r,o,e,a.data,l,s])}})({index:t,rootIndex:e,setConversation:c});return{ask:s,regenerate:a,getMessages:o,setMessages:r,conversation:i,isSubmitting:l,setConversation:c,setIsSubmitting:d,generateConversation:u,addedIndex:t}}const Og={name:"Plugin store",pluginKey:"pluginStore",isButton:!0,description:"",icon:"",authConfig:[],authenticated:!1};function Dg({startupConfig:e,user:t}){var s;const a=y(sx.availableTools),[r,o]=b(sx.defaultPreset),{data:i}=Yf({enabled:!!(null==t?void 0:t.plugins),select:Yo});!function(e){const{data:t}=eg({enabled:e}),s=n.useRef({conversationMode:y(sx.conversationMode),advancedMode:y(sx.advancedMode),speechToText:y(sx.speechToText),textToSpeech:y(sx.textToSpeech),cacheTTS:y(sx.cacheTTS),engineSTT:y(sx.engineSTT),languageSTT:y(sx.languageSTT),autoTranscribeAudio:y(sx.autoTranscribeAudio),decibelValue:y(sx.decibelValue),autoSendText:y(sx.autoSendText),engineTTS:y(sx.engineTTS),voice:y(sx.voice),cloudBrowserVoices:y(sx.cloudBrowserVoices),languageTTS:y(sx.languageTTS),automaticPlayback:y(sx.automaticPlayback),playbackRate:y(sx.playbackRate)}).current;n.useEffect(()=>{e&&t&&"not_found"!==t.message&&(Dp.log("Initializing speech settings from config:",t),Object.entries(t).forEach(([e,t])=>{if("sttExternal"===e||"ttsExternal"===e)return;if(null!==localStorage.getItem(e))return;const n=s[e];n&&(Dp.log(`Setting default speech setting: ${e} = ${t}`),n(t))}))},[e,t,s])}(!!t),n.useEffect(()=>{const t=(null==e?void 0:e.appTitle)??"";t&&(document.title=t,localStorage.setItem(Jc.APP_TITLE,t))},[e]),n.useEffect(()=>{var t;if(r&&null!=r.spec)return;const n=null==(t=null==e?void 0:e.modelSpecs)?void 0:t.list;if(!n||!n.length)return;const s=n.find(e=>e.default);s&&o({...s.preset,iconURL:s.iconURL,spec:s.name})},[r,o,null==(s=null==e?void 0:e.modelSpecs)?void 0:s.list]),n.useEffect(()=>{if(!t)return;if(!i)return;const e=t.plugins??[];if(0===e.length)return void a({pluginStore:Og});const n=[...e].map(e=>i.map[e]).filter(e=>void 0!==e),s=localStorage.getItem(Jc.LAST_TOOLS)??"";if(!s)return a({pluginStore:Og,...Jo(n)});const r=Xo(JSON.parse(s)??[],i.map).filter(e=>n.some(t=>t.pluginKey===e.pluginKey)).filter(e=>!!e);localStorage.setItem(Jc.LAST_TOOLS,JSON.stringify(r)),a({pluginStore:Og,...Jo(n)})},[i,t,a]),n.useEffect(()=>{if(null!=(null==e?void 0:e.analyticsGtmId)&&void 0===window.google_tag_manager){const t={gtmId:e.analyticsGtmId};T.initialize(t)}},[null==e?void 0:e.analyticsGtmId])}n.createContext({}),n.createContext({});const zg=n.createContext(void 0);function Fg(){const e=n.useContext(zg);if(void 0===e)throw new Error("useAgentPanelContext must be used within an AgentPanelProvider");return e}function Vg({children:e}){const t=zf(),[s,a]=n.useState(void 0),[r,o]=n.useState(void 0),[i,c]=n.useState(void 0),[d,u]=n.useState(Ko.builder),[m,p]=n.useState(void 0),{data:h}=tf(vi.agents,{enabled:!!m}),{data:x}=Xx(vi.agents,{enabled:!!m}),f=(null==x?void 0:x.map(e=>({tool_id:e.pluginKey,metadata:e,agent_id:m||""})))||[],g=(null==f?void 0:f.reduce((e,n)=>{var s;if(n.tool_id.includes(Zc.mcp_delimiter)){const[a,r]=n.tool_id.split(Zc.mcp_delimiter),o=`${r.toLowerCase()}`;e[o]||(e[o]={tool_id:o,metadata:{name:`${r}`,pluginKey:o,description:`${t("com_ui_tool_collection_prefix")} ${r}`,icon:n.metadata.icon||""},agent_id:m||"",tools:[]}),null==(s=e[o].tools)||s.push({tool_id:n.tool_id,metadata:n.metadata,agent_id:m||""})}else e[n.tool_id]={tool_id:n.tool_id,metadata:n.metadata,agent_id:m||""};return e},{}))||{},v={action:i,setAction:c,mcp:s,setMcp:a,mcps:r,setMcps:o,activePanel:d,setActivePanel:u,setCurrentAgentId:p,agent_id:m,groupedTools:g,actions:h,tools:f};return l.jsx(zg.Provider,{value:v,children:e})}const $g=n.createContext({}),Bg=n.createContext({}),Ug=()=>n.useContext(Bg),Hg=n.createContext({}),Kg=()=>n.useContext(Hg),Gg=n.createContext(void 0);function Wg({children:e}){const[t,s]=n.useState(!1),[a,r]=n.useState();return l.jsx(Gg.Provider,{value:{isMutating:t,setIsMutating:s,currentCode:a,setCurrentCode:r},children:e})}function qg(){const e=n.useContext(Gg);if(void 0===e)throw new Error("useEditorContext must be used within an EditorProvider");return e}const{CustomFormProvider:Qg,useCustomFormContext:Zg}=function(){const e=n.createContext(void 0);return{CustomFormProvider:({register:t,control:s,setValue:a,getValues:r,handleSubmit:o,reset:i,children:c})=>{const d=n.useMemo(()=>({register:t,control:s,getValues:r,setValue:a,handleSubmit:o,reset:i}),[t,s,a,r,o,i]);return l.jsx(e.Provider,{value:d,children:c})},useCustomFormContext:()=>{const t=n.useContext(e);if(!t)throw new Error("useCustomFormContext must be used within a CustomFormProvider");return t}}}(),Jg=n.createContext({bookmarks:[]}),Yg=()=>n.useContext(Jg),Xg=n.createContext({}),ev=()=>n.useContext(Xg),tv=n.createContext({}),nv=n.createContext({}),sv=()=>n.useContext(nv),av={announceAssertive:()=>console.warn("Announcement failed, LiveAnnouncer context is missing"),announcePolite:()=>console.warn("Announcement failed, LiveAnnouncer context is missing")},rv=m.createContext(av),ov=n.createContext({});function iv({children:e}){const t=n.useRef(0),s=n.useCallback(e=>{if(e)return t.current;const n=t.current;return t.current+=1,n},[]),a=n.useCallback(()=>{t.current=0},[]);return l.jsx(ov.Provider,{value:{getNextIndex:s,resetCounter:a},children:e})}const lv=n.createContext({});function cv({children:e}){const t=n.useRef(0),s=n.useCallback(e=>{if(e)return t.current;const n=t.current;return t.current+=1,n},[]),a=n.useCallback(()=>{t.current=0},[]);return l.jsx(lv.Provider,{value:{getNextIndex:s,resetCounter:a},children:e})}const dv=n.createContext({});function uv({children:e,conversationId:t}){const s=function({conversationId:e}){const{data:t=null}=Kx({conversationId:e},{select:e=>function(e=[]){return e.reduce((e,t)=>{const n=`${t.messageId}_${t.partIndex??0}_${t.blockIndex??0}_${t.toolId}`,s=e[n]??[];return s.push(t),e[n]=s,e},{})}(e)}),s=n.useMemo(()=>null!==t?t:void 0,[t]);return Dp.log("tools","tool calls map:",s),s}({conversationId:t});return l.jsx(dv.Provider,{value:s,children:e})}const mv=n.createContext({}),pv=()=>n.useContext(mv),hv=n.createContext(void 0);function xv(){const e=n.useContext(hv);if(void 0===e)throw new Error("useBadgeRowContext must be used within a BadgeRowProvider");return e}function fv({children:e,conversationId:t}){const{data:s}=Sx(),a=function({conversationId:e}){const t=e??Zc.NEW_CONVO,s=n.useRef(null),[a,r]=b(tx(t)),{data:o,isFetched:i}=Xx(vi.agents,{select:e=>{const t=new Map;return e.forEach(e=>{if(e.pluginKey.includes(Zc.mcp_delimiter)&&!1!==e.chatMenu){const n=e.pluginKey.split(Zc.mcp_delimiter),s=n[n.length-1];t.has(s)||t.set(s,{name:s,pluginKey:e.pluginKey,authConfig:e.authConfig,authenticated:e.authenticated})}}),Array.from(t.values())}}),l=n.useMemo(()=>(null==a?void 0:a.mcp)??[],[null==a?void 0:a.mcp]),c=n.useCallback(e=>{e&&Array.isArray(e)&&r(t=>({...t,mcp:e}))},[r]),[d,u]=fb(`${Jc.LAST_MCP_}${t}`,l,c,gb),[m,p]=fb(`${Jc.PIN_MCP_}${t}`,!0);n.useEffect(()=>{s.current!==t&&i&&(s.current=t,((null==o?void 0:o.length)??0)>0?u(d.filter(e=>null==o?void 0:o.some(t=>t.name===e))):u([]))},[i,u,o,t,d]);const h=n.useMemo(()=>(o??[]).map(e=>e.name),[o]);return{isPinned:m,mcpValues:d,setIsPinned:p,setMCPValues:u,mcpServerNames:h,ephemeralAgent:a,mcpToolDetails:o,setEphemeralAgent:r}}({conversationId:t}),r=_b({}),{setIsDialogOpen:o}=r,i=bb({conversationId:t,setIsDialogOpen:o,toolKey:ri.execute_code,localStorageKey:Jc.LAST_CODE_TOGGLE_,authConfig:{toolId:ri.execute_code,queryOptions:{retry:1}}}),c=wb({}),{setIsDialogOpen:d}=c,u={mcpSelect:a,webSearch:bb({conversationId:t,toolKey:ri.web_search,localStorageKey:Jc.LAST_WEB_SEARCH_TOGGLE_,setIsDialogOpen:d,authConfig:{toolId:ri.web_search,queryOptions:{retry:1}}}),fileSearch:bb({conversationId:t,toolKey:ri.file_search,localStorageKey:Jc.LAST_FILE_SEARCH_TOGGLE_,isAuthenticated:!0}),startupConfig:s,conversationId:t,codeApiKeyForm:r,codeInterpreter:i,searchApiKeyForm:c};return l.jsx(hv.Provider,{value:u,children:e})}function gv(){const e=zf(),t=n.useRef(!1),s=Aa(),{showToast:a}=Of(),{user:r,isAuthenticated:o}=Rg(),i=_(sx.modularChat),l=_(sx.availableTools),c=y(sx.presetModalVisible),[d,u]=b(sx.defaultPreset),m=Qx({enabled:!!r&&o}),{preset:p,conversation:h,index:x,setPreset:f}=rg(),{data:g}=Gf(),{newConversation:v}=Mg(x);n.useEffect(()=>{if(null==g?void 0:g.initial)return;const{data:e}=m;if(d||!e||t.current)return;if(e&&e.length>0&&r&&e[0].user!==r.id)return void m.refetch();const n=e.find(e=>e.defaultPreset);n?(u(n),(null==h?void 0:h.conversationId)&&"new"!==h.conversationId||v({preset:n,modelsData:g,disableParams:!0}),t.current=!0):t.current=!0},[m.data,r,g]);const j=n.useCallback(e=>{s.setQueryData([Pd.presets],e)},[s]),w=ff({onMutate:e=>{if(!e)return void j([]);const t=m.data??[];t&&j(t.filter(t=>t.presetId!==e.presetId))},onSuccess:()=>{s.invalidateQueries([Pd.presets])},onError:t=>{s.invalidateQueries([Pd.presets]),console.error("Error deleting the preset:",t),a({message:e("com_endpoint_preset_delete_error"),severity:Wo.ERROR})}}),N=Wf(),C=xf({onSuccess:(t,n)=>{const r=t.title?`"${t.title}"`:e("com_endpoint_preset_title");let o=`${r} ${e("com_ui_saved")}`;t.defaultPreset&&t.presetId!==(null==d?void 0:d.presetId)?(o=`${r} ${e("com_endpoint_preset_default")}`,u(t),v({preset:t,disableParams:!0})):!1===n.defaultPreset&&(u(null),o=`${r} ${e("com_endpoint_preset_default_removed")}`),a({message:o}),s.invalidateQueries([Pd.presets])},onError:t=>{console.error("Error updating the preset:",t),a({message:e("com_endpoint_preset_save_error"),severity:Wo.ERROR})}}),k=sg();return{presetsQuery:m,onSetDefaultPreset:(e,t=!1)=>{C.mutate({...e,defaultPreset:!t})},onFileSelected:t=>{(t=>{N.mutate({...t},{onSuccess:()=>{a({message:e("com_endpoint_preset_import")}),s.invalidateQueries([Pd.presets])},onError:t=>{console.error("Error uploading the preset:",t),a({message:e("com_endpoint_preset_import_error"),severity:Wo.ERROR})}})})({...$p({preset:t}),presetId:null})},onSelectPreset:t=>{if(!t)return;const n=rp(t,l),r=n.title?`"${n.title}"`:e("com_endpoint_preset_title");a({message:`${r} ${e("com_endpoint_preset_selected_title")}`,showIcon:!1,duration:750});const o=s.getQueryData([Pd.endpoints]),{shouldSwitch:c,isNewModular:d,newEndpointType:u,isCurrentModular:m,isExistingConversation:p}=bp({newEndpoint:n.endpoint??"",modularChat:i,conversation:h,endpointsConfig:o});n.spec=null,n.iconURL=n.iconURL??null,n.modelLabel=n.modelLabel??null;const x=m&&d&&c,f=!0===n.defaultPreset;if(p&&x){const e=k({conversation:{...h??{},spec:null,iconURL:null,modelLabel:null,endpointType:u},preset:{...n,endpointType:u},cleanInput:!0});return void v({template:e,preset:e,keepLatestMessage:!0,keepAddedConvos:!0,disableParams:f})}v({preset:n,keepAddedConvos:x,disableParams:f})},onChangePreset:e=>{f(e),c(!0)},clearAllPresets:()=>w.mutate(void 0),onDeletePreset:t=>{confirm(e("com_endpoint_preset_delete_confirm"))&&w.mutate(t)},submitPreset:()=>{p&&C.mutate($p({preset:p}))},exportPreset:()=>{if(!p)return;const e=R(p.title||"preset");I({data:$p({preset:p}),fileName:e,exportType:I.types.json})}}}function vv({setOption:e,setter:t,optionKey:s,initialValue:a,delay:r=450}){const[o,i]=n.useState(a),l=n.useMemo(()=>Cr(e&&s?e(s):t||(()=>{}),r),[e,s,t,r]);return[n.useCallback((e,t)=>{let n="object"!=typeof e?e:e.target.value;!0===t&&void 0!==n&&""!==n&&(n=Number(n)),i(n),l(n)},[l]),o,i]}const bv=(e=0)=>{const t=k(),n=Aa(),s=sx.useClearConvoState(),a=y(sx.submissionByIndex(e)),r=sx.useClearLatestMessages(`useNavigateToConvo ${e}`),{hasSetConversation:o,setConversation:i}=sx.useCreateConversationAtom(e);return{navigateToConvo:(e,l)=>{if(!e)return void Dp.warn("conversation","Conversation not provided to `navigateToConvo`");const{resetLatestMessage:c=!0,currentConvoId:d}=l||{};Dp.log("conversation","Navigating to conversation",e),o.current=!0,a(null),c&&r();let u={...e};const m=n.getQueryData([Pd.endpoints]);if(!u.endpoint||!(null==m?void 0:m[u.endpoint])){const t=n.getQueryData([Pd.models]),s=Up({convoSetup:e,endpointsConfig:m}),a=fp(m,s,"type");!e.endpointType&&a&&(e.endpointType=a);const r=(null==t?void 0:t[s??""])??[];u=Bp({models:r,conversation:e,endpoint:s,lastConversationSetup:e})}s(!0),n.setQueryData([Pd.messages,d],[]),u.conversationId!==Zc.NEW_CONVO&&u.conversationId?(n.invalidateQueries([Pd.conversation,u.conversationId]),(async e=>{const s=null==e?void 0:e.conversationId;if(s)try{const e=await n.fetchQuery([Pd.conversation,s],()=>Nu(s));Dp.log("conversation","Fetched fresh conversation data",e),i(e),t(`/c/${s??Zc.NEW_CONVO}`,{state:{focusChat:!0}})}catch(a){console.error("Error fetching conversation data on navigation",a),e&&(i(e),t(`/c/${s}`,{state:{focusChat:!0}}))}})(u)):(i(u),t(`/c/${u.conversationId??Zc.NEW_CONVO}`,{state:{focusChat:!0}}))}}},yv=(e=!1)=>{const t=y(sx.showPluginStoreDialog),n=_(sx.availableTools),{conversation:s,setConversation:a}=rg(),r=(e=>{const t=y(sx.showPluginStoreDialog),n=_(sx.availableTools),{preset:s,setPreset:a}=rg();if(!e)return!1;function r(e){return!!(null==s?void 0:s.tools)&&!!s.tools.find(t=>"string"==typeof t?t===e:t.pluginKey===e)}return{setOption:e=>t=>{const n={};n[e]=t,a(e=>$p({preset:{...e,...n}}))},setExample:(e,t,n=null)=>{var r;const o={},i=(null==(r=null==s?void 0:s.examples)?void 0:r.slice())||[],l={...i[e]};l[t]={content:n},i[e]=l,o.examples=i,a(e=>$p({preset:{...e,...o}}))},addExample:()=>{var e;const t={},n=(null==(e=null==s?void 0:s.examples)?void 0:e.slice())||[];n.push({input:{content:""},output:{content:""}}),t.examples=n,a(e=>$p({preset:{...e,...t}}))},setOptions:e=>{const t={...e};a(e=>$p({preset:{...e,...t}}))},removeExample:()=>{var e;const t={},n=(null==(e=null==s?void 0:s.examples)?void 0:e.slice())||[];if(n.length<=1)return t.examples=[{input:{content:""},output:{content:""}}],void a(e=>$p({preset:{...e,...t}}));n.pop(),t.examples=n,a(e=>$p({preset:{...e,...t}}))},getConversation:()=>s,checkPluginSelection:r,setAgentOption:t=>n=>{const s=JSON.parse(JSON.stringify(e)),{agentOptions:r}=s;r[t]=n,a(e=>$p({preset:{...e,agentOptions:r}}))},setTools:(e,o)=>{var i;if("pluginStore"===e)return void t(!0);const l={},c=(null==(i=null==s?void 0:s.tools)?void 0:i.map(e=>"string"==typeof e?n[e]:e).filter(e=>!!e))||[],d=r(e),u=n[e];l.tools=d||o?c.filter(t=>t.pluginKey!==e):[...c,u],a(e=>$p({preset:{...e,...l}}))}}})(e);if(r&&"boolean"!=typeof r)return r;function o(e){return!!(null==s?void 0:s.tools)&&!!s.tools.find(t=>"string"==typeof t?t===e:t.pluginKey===e)}return{setTools:(e,r)=>{var i;if("pluginStore"===e)return void t(!0);const l={},c=(null==(i=null==s?void 0:s.tools)?void 0:i.map(e=>"string"==typeof e?n[e]:e).filter(e=>!!e))||[],d=o(e),u=n[e];l.tools=d||r?c.filter(t=>t.pluginKey!==e):[...c,u],a(e=>el.parse({...e,...l}))},setOption:e=>t=>{const n={};if(n[e]=t,"presetOverride"===e){const e=(null==s?void 0:s.presetOverride)||{};n.presetOverride={...e,...t}}a(e=>el.parse({...e,...n}))},setExample:(e,t,n=null)=>{var r;const o={},i=(null==(r=null==s?void 0:s.examples)?void 0:r.slice())||[],l={...i[e]};l[t]={content:n},i[e]=l,o.examples=i,a(e=>el.parse({...e,...o}))},addExample:()=>{var e;const t={},n=(null==(e=null==s?void 0:s.examples)?void 0:e.slice())||[];n.push({input:{content:""},output:{content:""}}),t.examples=n,a(e=>el.parse({...e,...t}))},removeExample:()=>{var e;const t={},n=(null==(e=null==s?void 0:s.examples)?void 0:e.slice())||[];if(n.length<=1)return t.examples=[{input:{content:""},output:{content:""}}],void a(e=>el.parse({...e,...t}));n.pop(),t.examples=n,a(e=>el.parse({...e,...t}))},setAgentOption:e=>t=>{const n=JSON.stringify(s),r=JSON.parse(n),{agentOptions:o}=r;o[e]=t,a(e=>el.parse({...e,agentOptions:o}))},checkPluginSelection:o}};function _v({preset:e,settingKey:t,defaultValue:s,conversation:a,inputValue:r,setInputValue:o,preventDelayedUpdate:i=!1}){const l=n.useRef(null),c=n.useRef(null);n.useEffect(()=>{if(i)return;const e=setTimeout(()=>{(null==a?void 0:a[t])!==r&&o(null==a?void 0:a[t])},562.5);return()=>clearTimeout(e)},[o,i,a,r,t]),n.useEffect(()=>{const e=(null==a?void 0:a.conversationId)??"";e&&l.current!==e&&(l.current=e,o(s))},[o,null==a?void 0:a.conversationId,s]),n.useEffect(()=>{const t=(null==e?void 0:e.presetId)??"";t&&c.current!==t&&(c.current=t,o(s))},[o,null==e?void 0:e.presetId,s])}const jv={theme:Hm(),setTheme:()=>{}},wv=e=>"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"===e,Nv=n.createContext(jv),Cv=({initialTheme:e,children:t})=>{const[s,a]=n.useState(Hm),r=y(sx.fontSize),o=e=>{const t=window.document.documentElement,n=wv(e);t.classList.remove(n?"light":"dark"),t.classList.add(n?"dark":"light"),localStorage.setItem("color-theme",e)};return n.useEffect(()=>{const e=window.matchMedia("(prefers-color-scheme: dark)"),t=()=>{o(e.matches?"dark":"light")};return e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}},[]),n.useEffect(()=>{const e=localStorage.getItem("fontSize");if(null==e)return r("text-base"),Um("text-base"),void localStorage.setItem("fontSize",JSON.stringify("text-base"));try{Um(JSON.parse(e))}catch(t){console.log(t)}},[]),e&&o(e),n.useEffect(()=>{o(s)},[s]),l.jsx(Nv.Provider,{value:{theme:s,setTheme:a},children:t})},kv=n.createContext({}),Sv=()=>{const{ref:e}=n.useContext(kv),{theme:t}=n.useContext(Nv);return{screenshotTargetRef:e,captureScreenshot:async()=>{if(e instanceof Function)throw new Error("Ref callback is not supported.");if(null==e?void 0:e.current)return(async e=>{if(!e)throw new Error("You should provide correct html node.");let n="dark"===t;"system"===t&&(n=window.matchMedia("(prefers-color-scheme: dark)").matches);const s=n?"#171717":"white",a=await E(e,{backgroundColor:s,imagePlaceholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII="}),r=document.createElement("canvas"),o=r.getContext("2d"),i=a.width,l=a.height;return r.width=i,r.height=l,o.fillStyle=s,o.fillRect(0,0,i,l),o.drawImage(a,0,0),r.toDataURL("image/png",1)})(e.current);throw new Error("Ref is not attached to any element.")}}},Tv=({children:e})=>{const t=n.useRef(null);return l.jsx(kv.Provider,{value:{ref:t},children:e})};function Rv({conversation:e,filename:t,type:s,includeOptions:a,exportBranches:r,recursive:o}){const i=Aa(),{captureScreenshot:l}=Sv(),c=function(){const e=v(({snapshot:e})=>async t=>await e.getPromise(sx.messagesSiblingIdxFamily(t)),[]),t=async({messageId:n,message:s,messages:a,branches:r=!1,recursive:o=!1})=>{let i=[];if(null!=(null==a?void 0:a.length)&&a.length>0)if(r)for(const e of a)i.push(await t({messageId:null==e?void 0:e.messageId,message:e,messages:(null==e?void 0:e.children)||[],branches:r,recursive:o}));else{let s=a[0];if(a.length>1){const t=await e(n);s=a[a.length-t-1]}i=[await t({messageId:null==s?void 0:s.messageId,message:s,messages:(null==s?void 0:s.children)||[],branches:r,recursive:o})]}if(o&&s)return{...s,children:i};{let e=[];if(s){const t={...s};delete t.children,e=[t]}for(const t of i)e=e.concat(t);return e}};return t}(),{conversationId:d}=M(),u=n.useCallback(()=>{const t="new"===d?d:(null==e?void 0:e.conversationId)??d??"",n=zp({messages:i.getQueryData([Pd.messages,t])??[]});return 0===(null==n?void 0:n.length)?null:n??null},[d,null==e?void 0:e.conversationId,i]),m=(e,t="text")=>{if(!e)return"";const n=(e,n)=>"text"===t?`>> ${e}:\n${n}`:`**${e}**\n${n}`;return e.content?e.content.map(t=>p(e.sender||"",t)).map(e=>n(e[0],e[1])).join("\n\n\n"):n(e.sender||"",e.text)},p=(e,t)=>{if(!t)return[];if(t.type===td.ERROR)return[e,t[td.TEXT].value];if(t.type===td.TEXT){const n=t[td.TEXT];return[e,"string"==typeof n?n:n.value]}if(t.type===td.TOOL_CALL){const e=t[td.TOOL_CALL].type;if(e===sd.CODE_INTERPRETER){const e=t[td.TOOL_CALL][sd.CODE_INTERPRETER];return["Code Interpreter",JSON.stringify(e)]}if(e===sd.RETRIEVAL){const e=t[td.TOOL_CALL];return["Retrieval",JSON.stringify(e)]}if(e===sd.FUNCTION&&Uc.has(t[td.TOOL_CALL].function.name)){const e=t[td.TOOL_CALL];return["Tool",JSON.stringify(e)]}if(e===sd.FUNCTION){const e=t[td.TOOL_CALL];return Mi(e),["Tool",JSON.stringify(e)]}}if(t.type===td.IMAGE_FILE){const e=t[td.IMAGE_FILE];return["Image",JSON.stringify(e)]}return[e,JSON.stringify(t)]};return{exportConversation:()=>{"json"===s?(async()=>{const n={conversationId:null==e?void 0:e.conversationId,endpoint:null==e?void 0:e.endpoint,title:null==e?void 0:e.title,exportAt:(new Date).toTimeString(),branches:r,recursive:o};!0===a&&(n.options=$p({preset:e}));const s=await c({messageId:null==e?void 0:e.conversationId,message:null,messages:u(),branches:Boolean(r),recursive:Boolean(o)});!0!==o||Array.isArray(s)?n.messages=s:n.messagesTree=s.children,I({data:n,fileName:t,extension:"json",exportType:I.types.json})})():"text"==s?(async()=>{let n=`Conversation\n########################\nconversationId: ${null==e?void 0:e.conversationId}\nendpoint: ${null==e?void 0:e.endpoint}\ntitle: ${null==e?void 0:e.title}\nexportAt: ${(new Date).toTimeString()}\n`;if(!0===a){n+="\nOptions\n########################\n";const t=$p({preset:e});for(const e of Object.keys(t))n+=`${e}: ${t[e]}\n`}const s=await c({messageId:null==e?void 0:e.conversationId,message:null,messages:u(),branches:!1,recursive:!1});if(n+="\nHistory\n########################\n",Array.isArray(s))for(const e of s)n+=`${m(e)}\n`,e.error&&(n+="(This is an error message)\n"),!0===e.unfinished&&(n+="(This is an unfinished message)\n"),n+="\n\n";else n+=`${m(s)}\n`,s.error&&(n+="(This is an error message)\n"),!0===s.unfinished&&(n+="(This is an unfinished message)\n");I({data:n,fileName:t,extension:"txt",exportType:I.types.txt})})():"markdown"==s?(async()=>{let n=`# Conversation\n- conversationId: ${null==e?void 0:e.conversationId}\n- endpoint: ${null==e?void 0:e.endpoint}\n- title: ${null==e?void 0:e.title}\n- exportAt: ${(new Date).toTimeString()}\n`;if(!0===a){n+="\n## Options\n";const t=$p({preset:e});for(const e of Object.keys(t))n+=`- ${e}: ${t[e]}\n`}const s=await c({messageId:null==e?void 0:e.conversationId,message:null,messages:u(),branches:!1,recursive:!1});if(n+="\n## History\n",Array.isArray(s))for(const e of s)n+=`${m(e,"md")}\n`,e.error&&(n+="*(This is an error message)*\n"),!0===e.unfinished&&(n+="*(This is an unfinished message)*\n"),n+="\n\n";else n+=`${m(s,"md")}\n`,s.error&&(n+="*(This is an error message)*\n"),!0===s.unfinished&&(n+="*(This is an unfinished message)*\n");I({data:n,fileName:t,extension:"md",exportType:I.types.txt})})():"csv"==s?(async()=>{const n=[],s=await c({messageId:null==e?void 0:e.conversationId,message:null,messages:u(),branches:Boolean(r),recursive:!1});if(Array.isArray(s))for(const e of s)n.push(e);else n.push(s);I({data:n,fileName:t,extension:"csv",exportType:I.types.csv,beforeTableEncode:e=>{var t,n,s,a,r,o,i,l;return[{fieldName:"sender",fieldValues:(null==(t=null==e?void 0:e.find(e=>"sender"==e.fieldName))?void 0:t.fieldValues)??[]},{fieldName:"text",fieldValues:(null==(n=null==e?void 0:e.find(e=>"text"==e.fieldName))?void 0:n.fieldValues)??[]},{fieldName:"isCreatedByUser",fieldValues:(null==(s=null==e?void 0:e.find(e=>"isCreatedByUser"==e.fieldName))?void 0:s.fieldValues)??[]},{fieldName:"error",fieldValues:(null==(a=null==e?void 0:e.find(e=>"error"==e.fieldName))?void 0:a.fieldValues)??[]},{fieldName:"unfinished",fieldValues:(null==(r=null==e?void 0:e.find(e=>"unfinished"==e.fieldName))?void 0:r.fieldValues)??[]},{fieldName:"messageId",fieldValues:(null==(o=null==e?void 0:e.find(e=>"messageId"==e.fieldName))?void 0:o.fieldValues)??[]},{fieldName:"parentMessageId",fieldValues:(null==(i=null==e?void 0:e.find(e=>"parentMessageId"==e.fieldName))?void 0:i.fieldValues)??[]},{fieldName:"createdAt",fieldValues:(null==(l=null==e?void 0:e.find(e=>"createdAt"==e.fieldName))?void 0:l.fieldValues)??[]}]}})})():"screenshot"==s&&(async()=>{let e;try{e=await l()}catch(n){return console.error("Failed to capture screenshot"),console.error(n)}P(e,`${t}.png`,"image/png")})()}}}function Iv({nextCursor:e,isFetchingNext:t,setShowLoading:s,fetchNextPage:a}){const r=n.useRef(null),o=n.useRef(null),i=n.useCallback(kr(()=>a?a():Promise.resolve(),750,{leading:!0}),[a]),l=n.useCallback(()=>{if(o.current){const{scrollTop:n,clientHeight:a,scrollHeight:r}=o.current;n+a>=.97*r&&null!=e&&!t?(s(!0),i()):s(!1)}},[e,t,i,s]);n.useEffect(()=>{const e=o.current;return e&&e.addEventListener("scroll",l),()=>{e&&e.removeEventListener("scroll",l)}},[l]);const c=n.useCallback(()=>{const e=o.current;e&&(r.current=e.scrollTop)},[]);return{containerRef:o,moveToTop:c}}function Ev(e,t){const s=k(),a=N();return n.useCallback(n=>{t&&t(n),0!==n.button||n.ctrlKey||n.metaKey||(n.preventDefault(),s(e,{state:{prevLocation:a}}))},[s,e,t,a])}const Mv=({mutateAsync:e,agent_id:t,assistant_id:s,tool_resource:a})=>{const[r,o]=n.useState([]),i=dg(),l=n.useCallback(({filesToDelete:t,agent_id:n,assistant_id:s,tool_resource:a})=>{const r=ol({agent_id:n,assistant_id:s,tool_resource:a});console.log("Deleting files:",t,r),e({files:t,...r}),o([])},[e]),c=n.useCallback(Cr(l,1e3),[]);n.useEffect(()=>()=>c.cancel(),[c]);return{deleteFile:n.useCallback(({file:e,setFiles:n})=>{const{file_id:r,temp_file_id:l="",filepath:d="",source:u=Ml.local,embedded:m,attached:p=!1}=e;if((e.progress??1)<1)return;const h={file_id:r,embedded:m,filepath:d,source:u};n&&n(e=>{const t=new Map(e);t.delete(r),t.delete(l);const n=Object.fromEntries(t);return i(n),t}),p||o(e=>{const n=[...e,h];return c({filesToDelete:n,agent_id:t,assistant_id:s,tool_resource:a}),n})},[c,i,t,s,a]),deleteFiles:n.useCallback(({files:e,setFiles:n})=>{const a=[];for(const t of e){const{file_id:e,embedded:n,temp_file_id:s,filepath:r="",source:o=Ml.local}=t;a.push({source:o,file_id:e,filepath:r,temp_file_id:s,embedded:n??!1})}n&&n(e=>{const t=new Map(e);a.forEach(e=>{t.delete(e.file_id),e.temp_file_id&&t.delete(e.temp_file_id)});const n=Object.fromEntries(t);return i(n),t}),o(e=>{const n=[...e,...a];return c({filesToDelete:n,agent_id:t,assistant_id:s}),n})},[c,i,t,s])}},Pv={maxWidth:1900,maxHeight:1900,quality:.92,format:"jpeg"};function Lv(){try{if("undefined"==typeof HTMLCanvasElement)return!1;if("undefined"==typeof FileReader)return!1;if("undefined"==typeof Image)return!1;const e=document.createElement("canvas"),t=e.getContext("2d");return!!(t&&t.drawImage&&e.toBlob)}catch{return!1}}function Av(e,t={}){return new Promise((n,s)=>{if(!Lv())return void s(new Error("Browser does not support client-side image resizing"));if(!e.type.startsWith("image/"))return void s(new Error("File is not an image"));const a={...Pv,...t},r=new FileReader;r.onload=t=>{var r;const o=new Image;o.onload=()=>{try{const t={width:o.width,height:o.height},r=function(e,t,n,s){const{width:a,height:r}={width:e,height:t};if(a<=n&&r<=s)return{width:a,height:r};const o=n/a,i=s/r,l=Math.min(o,i);return{width:Math.round(a*l),height:Math.round(r*l)}}(o.width,o.height,a.maxWidth,a.maxHeight);if(r.width===t.width&&r.height===t.height)return void n({file:e,originalSize:e.size,newSize:e.size,originalDimensions:t,newDimensions:r,compressionRatio:1});const i=document.createElement("canvas"),l=i.getContext("2d");i.width=r.width,i.height=r.height,l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.drawImage(o,0,0,r.width,r.height),i.toBlob(o=>{if(!o)return void s(new Error("Failed to create blob from canvas"));const i="jpeg"===a.format?".jpg":`.${a.format}`,l=e.name.replace(/\.[^/.]+$/,""),c=new File([o],`${l}${i}`,{type:`image/${a.format}`,lastModified:Date.now()});n({file:c,originalSize:e.size,newSize:c.size,originalDimensions:t,newDimensions:r,compressionRatio:c.size/e.size})},`image/${a.format}`,a.quality)}catch(t){s(t)}},o.onerror=()=>s(new Error("Failed to load image")),o.src=null==(r=t.target)?void 0:r.result},r.onerror=()=>s(new Error("Failed to read file")),r.readAsDataURL(e)})}const Ov=async(e,t=.9,n)=>{const s=await(async e=>{try{return await Eo(e)}catch(t){return console.warn("Error checking if file is HEIC:",t),"image/heic"===e.type||"image/heif"===e.type}})(e);return s?(console.log("HEIC file detected, converting to JPEG..."),(async(e,t=.9,n)=>{try{null==n||n(.3);const s=await Mo({blob:e,type:"image/jpeg",quality:t});null==n||n(.8);const a=new File([s],e.name.replace(/\.(heic|heif)$/i,".jpg"),{type:"image/jpeg",lastModified:e.lastModified});return null==n||n(1),a}catch(s){throw console.error("Error converting HEIC to JPEG:",s),new Error("Failed to convert HEIC image to JPEG")}})(e,t,n)):e},Dv=()=>{const e=zf(),{showToast:t}=Of(),[s,a]=n.useState({});return{startUploadTimer:(n,r,o)=>{const i=(e=>5e3+2e3*Math.floor(e/1e6))(o);s[n]&&clearTimeout(s[n]);const l=setTimeout(()=>{const n=e("com_ui_upload_delay",{0:r});t({message:n,status:"warning",duration:1e4})},i);a(e=>({...e,[n]:l}))},clearUploadTimer:e=>{s[e]&&(clearTimeout(s[e]),a(t=>{const{[e]:n,...s}=t;return s}))}}};function zv(e){const t=dg();return{addFile:t=>{e(e=>{const n=new Map(e);return n.set(t.file_id,t),n})},replaceFile:t=>{e(e=>{const n=new Map(e);return n.set(t.file_id,t),n})},updateFileById:(n,s,a=!1)=>{e(e=>{if(!e.has(n))return console.warn(`File with id ${n} not found.`),e;const r=new Map(e),o=r.get(n);if(!o)return console.warn(`File with id ${n} not found.`),e;r.set(n,{...o,...s});if((s.filepath??"")&&1!==s.progress&&!a){const e=Object.fromEntries(r);t(e)}return r})},deleteFileById:n=>{e(e=>{const s=new Map(e);s.has(n)?s.delete(n):console.warn(`File with id ${n} not found.`);const a=Object.fromEntries(s);return t(a),s})}}}const Fv=e=>{var t,s,a;const r=zf(),o=Aa(),{showToast:i}=Of(),[l,c]=n.useState([]),d=n.useRef(null),{startUploadTimer:u,clearUploadTimer:m}=Dv(),{files:p,setFiles:h,setFilesLoading:x,conversation:f}=rg(),g=e=>c(t=>[...t,e]),{addFile:v,replaceFile:b,updateFileById:y,deleteFileById:_}=zv((null==e?void 0:e.fileSetter)??h),{resizeImageIfNeeded:j}=(()=>{const{data:e=null}=Rx({select:e=>El(e)}),t=(null==e?void 0:e.clientImageResize)??{enabled:!1,maxWidth:1900,maxHeight:1900,quality:.92},s=(null==t?void 0:t.enabled)??!1,a=n.useCallback(async(e,n)=>{if(!s)return{file:e,resized:!1};if(!Lv())return console.warn("Client-side image resizing not supported in this browser"),{file:e,resized:!1};if(!function(e,t=536870912){return!(e.size<.1*t||!e.type.startsWith("image/")||"image/gif"===e.type)}(e))return{file:e,resized:!1};try{const s={maxWidth:null==t?void 0:t.maxWidth,maxHeight:null==t?void 0:t.maxHeight,quality:null==t?void 0:t.quality,...n},a=await Av(e,s);return{file:a.file,resized:!0,result:a}}catch(a){return console.warn("Client-side image resizing failed:",a),{file:e,resized:!1}}},[s,t]);return{isEnabled:s,isSupported:Lv(),config:t,resizeImageIfNeeded:a}})(),w=(null==(t=null==e?void 0:e.additionalMetadata)?void 0:t.agent_id)??"",N=(null==(s=null==e?void 0:e.additionalMetadata)?void 0:s.assistant_id)??"",{data:C=null}=Rx({select:e=>El(e)}),k=n.useMemo(()=>(null==e?void 0:e.overrideEndpoint)??(null==f?void 0:f.endpointType)??(null==f?void 0:f.endpoint)??"default",[null==e?void 0:e.overrideEndpoint,null==f?void 0:f.endpointType,null==f?void 0:f.endpoint]),T=n.useCallback(()=>{if(l.length>1){const e=Array.from(new Set(l)).map((e,t)=>`${t>0?" ":""}${r(e)||e}\n`).join("");i({message:e,status:"error",duration:5e3})}else if(1===l.length){const e=r(l[0])||l[0];i({message:e,status:"error",duration:5e3})}c([])},[l,i,r]),R=Cr(T,250);n.useEffect(()=>(l.length>0&&R(),()=>R.cancel()),[l,R]);const I=Mx({onSuccess:e=>{m(e.temp_file_id),console.log("upload success",e),w?o.refetchQueries([Pd.agent,w]):(y(e.temp_file_id,{progress:.9,filepath:e.filepath},!!N),setTimeout(()=>{y(e.temp_file_id,{progress:1,file_id:e.file_id,temp_file_id:e.temp_file_id,filepath:e.filepath,type:e.type,height:e.height,width:e.width,filename:e.filename,source:e.source,embedded:e.embedded},!!N)},300))},onError:(e,t)=>{var n,s;const a=e;console.log("upload error",a);const r=t.get("file_id");m(r),_(r);const o="ERR_CANCELED"===(null==a?void 0:a.code)?"com_error_files_upload_canceled":(null==(s=null==(n=null==a?void 0:a.response)?void 0:n.data)?void 0:s.message)??"com_error_files_upload";g(o)}},null==(a=d.current)?void 0:a.signal),E=async t=>{var n,s;const a=(null==(n=t.file)?void 0:n.name)??"File";u(t.file_id,a,t.size);const r=new FormData;r.append("endpoint",k),r.append("file",t.file,encodeURIComponent(a)),r.append("file_id",t.file_id);const i=t.width??0,l=t.height??0;i&&r.append("width",i.toString()),l&&r.append("height",l.toString());const c=(null==e?void 0:e.additionalMetadata)??{};if(null==e?void 0:e.additionalMetadata)for(const[e,o=""]of Object.entries(c))o&&r.append(e,o);if(wi(k)){w||r.append("message_file","true");const e=t.tool_resource;null!=e&&r.append("tool_resource",e),null!=(null==f?void 0:f.agent_id)&&null==r.get("agent_id")&&r.append("agent_id",f.agent_id)}if(!ji(k))return void I.mutate(r);const d=(null==f?void 0:f.model)??"",m=(null==f?void 0:f.assistant_id)??"";N||r.append("message_file","true");const p=o.getQueryData([Pd.endpoints]),h=(null==(s=null==p?void 0:p[k])?void 0:s.version)??Xl[k];!N&&m&&(r.append("version",h),r.append("model",d),r.append("assistant_id",m));(r.get("version")??"")||r.append("version",h);(r.get("model")??"")||r.append("model",d),I.mutate(r)},M=(e,t)=>{const n=new Image;n.onload=async()=>{e.width=n.width,e.height=n.height,e={...e,progress:.6},b(e),await E(e),URL.revokeObjectURL(t)},n.src=t},P=async(t,n)=>{var s;d.current=new AbortController;const a=Array.from(t);let o;try{o=(({files:e,fileList:t,setError:n,endpointFileConfig:s})=>{const{fileLimit:a,fileSizeLimit:r,totalSizeLimit:o,supportedMimeTypes:i}=s,l=Array.from(e.values()),c=t.reduce((e,t)=>e+t.size,0);if(0===c)return n("com_error_files_empty"),!1;const d=l.reduce((e,t)=>e+t.size,0);if(a&&t.length+e.size>a)return n(`You can only upload up to ${a} files at a time.`),!1;for(let m=0;m<t.length;m++){let e=t[m],s=e.type;const a=e.name.split(".").pop()??"",o=yl[a];if(!o||s&&s===o||(s=o),!s)return n("Unable to determine file type for: "+e.name),!1;if(e.type!==s){const n=new File([e],e.name,{type:s});e=n,t[m]=n}if(!Lm(e.type,i))return console.log(e),n("Currently, unsupported file type: "+e.type),!1;if(r&&e.size>=r)return n(`File size exceeds ${r/jl} MB.`),!1}if(o&&d+c>o)return n(`The total size of the files cannot exceed ${o/jl} MB.`),!1;const u=[...l.map(e=>{var t,n;return`${(null==(t=e.file)?void 0:t.name)??e.filename}-${e.size}-${(null==(n=e.type)?void 0:n.split("/")[0])??"file"}`}),...t.map(e=>`${null==e?void 0:e.name}-${null==e?void 0:e.size}-${(null==e?void 0:e.type.split("/")[0])??"file"}`)];return new Set(u).size===u.length||(n("com_error_files_dupe"),!1)})({files:p,fileList:a,setError:g,endpointFileConfig:(null==C?void 0:C.endpoints[k])??(null==C?void 0:C.endpoints.default)??kl.endpoints[k]??kl.endpoints.default})}catch(l){return console.error("file validation error",l),void g("com_error_files_validation")}if(o)for(const d of a){const t=S();try{const a=URL.createObjectURL(d),o={file_id:t,file:d,type:d.type,preview:a,progress:.1,size:d.size};null!=n&&""!==n&&(o.tool_resource=n),v(o);("image/heic"===d.type||"image/heif"===d.type||d.name.toLowerCase().match(/\.(heic|heif)$/))&&i({message:r("com_info_heic_converting"),status:"info",duration:3e3});const l=await Ov(d,.9,e=>{const t=.1+.4*e;b({...o,progress:t})});let u=l;if(l.type.startsWith("image/"))try{const e=await j(l);if(u=e.file,e.resized&&e.result){const{originalSize:t,newSize:n,compressionRatio:s}=e.result,a=(t/1048576).toFixed(1),r=(n/1048576).toFixed(1),o=Math.round(100*(1-s));i({message:`Image resized: ${a}MB  ${r}MB (${o}% smaller)`,status:"success",duration:3e3})}}catch(c){console.warn("Image resize failed, using original:",c)}if(u!==d){URL.revokeObjectURL(a);const e=URL.createObjectURL(u),t={...o,file:u,type:u.type,preview:e,progress:.5,size:u.size};b(t);if("image"===u.type.split("/")[0]){M(t,e);continue}await E(t)}else{const t="image"===d.type.split("/")[0],n=o.tool_resource??(null==(s=null==e?void 0:e.additionalMetadata)?void 0:s.tool_resource);if(wi(k)&&!t&&null==n){g("com_error_files_unsupported_capability");continue}const r={...o,progress:.2};if(b(r),t){M(r,a);continue}await E(r)}}catch(l){_(t),console.log("file handling error",l),l instanceof Error&&l.message.includes("HEIC")?g("com_error_heic_conversion"):g("com_error_files_process")}}else x(!1)};return{handleFileChange:(e,t)=>{e.stopPropagation(),e.target.files&&(x(!0),P(e.target.files,t),e.target.value="")},handleFiles:P,abortUpload:()=>{d.current&&(Dp.log("files","Aborting upload"),d.current.abort("User aborted upload"),d.current=null)},setFiles:h,files:p}};function Vv(e,t=[],s=300){const a=n.useRef(),r=n.useRef();r.current=n.useCallback(e,t);const o=n.useCallback(Cr(()=>{var e;return a.current=null==(e=r.current)?void 0:e.call(r)},s),[]);n.useEffect(o,t),n.useEffect(()=>()=>a.current instanceof Function?a.current():void 0,[])}const $v=Cr(e=>{localStorage.removeItem(`${Jc.TEXT_DRAFT}${e??""}`)},2500),Bv=e=>{try{const t=(new TextEncoder).encode(e);return btoa(String.fromCharCode(...t))}catch(t){return""}},Uv=({isSubmitting:e,conversationId:t,textAreaRef:s,setFiles:a,files:r})=>{const{setValue:o}=Zg(),i=_(sx.saveDrafts),l=e?Zc.PENDING_CONVO:t,[c,d]=n.useState(null),u=n.useMemo(()=>Array.from(r.keys()),[r]),{data:m}=Tx(),p=n.useCallback(e=>{const t=JSON.parse((localStorage.getItem(`${Jc.FILES_DRAFT}${e}`)??"")||"[]");0!==t.length?t.forEach(e=>{const t=null==m?void 0:m.find(t=>t.file_id===e),n=null==m?void 0:m.find(t=>t.temp_file_id===e),{fileToRecover:s,fileIdToRecover:r}=t?{fileToRecover:t,fileIdToRecover:e}:{fileToRecover:n,fileIdToRecover:((null==n?void 0:n.temp_file_id)??"")||e};s&&a(e=>{const t=new Map(e);return t.set(r,{...s,progress:1,attached:!0,size:s.bytes}),t})}):a(new Map)},[m,a]),h=n.useCallback(e=>{const t=(localStorage.getItem(`${Jc.TEXT_DRAFT}${e}`)??"")||"";o("text",(e=>{try{const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return(new TextDecoder).decode(n)}catch(t){return""}})(t))},[o]),x=n.useCallback(e=>{(null==s?void 0:s.current)&&(""===s.current.value||1===s.current.value.length?$v(e):localStorage.setItem(`${Jc.TEXT_DRAFT}${e}`,Bv(s.current.value)))},[s]);n.useEffect(()=>{if(!i||null==l||""===l)return;const e=Cr(e=>{e&&e.length>1?localStorage.setItem(`${Jc.TEXT_DRAFT}${l}`,Bv(e)):localStorage.removeItem(`${Jc.TEXT_DRAFT}${l}`)},750),t=t=>{const n=t.target;e(n.value)},n=null==s?void 0:s.current;return n&&n.addEventListener("input",t),()=>{n&&n.removeEventListener("input",t),e.cancel()}},[l,i,s]);const f=n.useRef(null);n.useEffect(()=>{var e;if(i&&null!=l&&""!==l&&l!==c){a(new Map);try{if(f.current===Zc.PENDING_CONVO&&l!==Zc.PENDING_CONVO&&l.length>3){const t=localStorage.getItem(`${Jc.TEXT_DRAFT}${Zc.PENDING_CONVO}`);localStorage.removeItem(`${Jc.TEXT_DRAFT}${Zc.PENDING_CONVO}`),t?localStorage.setItem(`${Jc.TEXT_DRAFT}${l}`,t):(null==(e=null==s?void 0:s.current)?void 0:e.value)&&localStorage.setItem(`${Jc.TEXT_DRAFT}${l}`,Bv(s.current.value));const n=localStorage.getItem(`${Jc.FILES_DRAFT}${Zc.PENDING_CONVO}`);if(n){localStorage.setItem(`${Jc.FILES_DRAFT}${l}`,n),localStorage.removeItem(`${Jc.FILES_DRAFT}${Zc.PENDING_CONVO}`);JSON.parse(n||"[]").length>0&&p(l)}}else null!=c&&c&&x(c);h(l),p(l)}catch(t){console.error(t)}f.current=l,d(l)}},[c,l,p,s,h,i,x,a]),n.useEffect(()=>{i&&null!=l&&""!==l&&c===l&&(0===u.length?localStorage.removeItem(`${Jc.FILES_DRAFT}${l}`):localStorage.setItem(`${Jc.FILES_DRAFT}${l}`,JSON.stringify(u)))},[r,l,i,c,u])};function Hv({textAreaRef:e,submitButtonRef:t,setIsScrollable:s,disabled:a=!1}){const r=zf(),o=ug(),i=n.useRef(!1),l=cg(),{handleFiles:c}=Fv(),d=sv(),u=(()=>{const e=Aa(),t=n.useRef(Date.now());return n.useCallback(()=>{const n=Date.now();n-t.current>Kc.FIVE_MINUTES&&(Dp.log("Checking health on interaction. Time elapsed:",n-t.current),e.invalidateQueries([Pd.health]),t.current=n)},[e])})(),m=_(sx.enterToSend),{index:p,conversation:h,isSubmitting:x,filesLoading:f,latestMessage:g,setFilesLoading:v}=rg(),[y,j]=b(sx.activePromptByIndex(p)),{endpoint:w=""}=h||{},{entity:N,isAgent:C,isAssistant:k}=Cp({endpoint:w,agentsMap:l,assistantMap:d,agent_id:null==h?void 0:h.agent_id,assistant_id:null==h?void 0:h.assistant_id}),S=(null==N?void 0:N.name)??"",T=(((null==g?void 0:g.unfinished)??!1)&&!x||((null==g?void 0:g.error)??!1))&&!k;n.useEffect(()=>{const t=y??"";t&&e.current&&(lp(e.current,t),cp(e.current),j(void 0))},[y,j,e]),n.useEffect(()=>{var t,n;if((null==(t=e.current)?void 0:t.value)??"")return;const s=()=>{var e;if(a)return r("com_endpoint_config_placeholder");const t=(null==h?void 0:h.endpoint)??"",n=(null==h?void 0:h.agent_id)??"",s=(null==h?void 0:h.assistant_id)??"";if(!(!C||n&&(null==l?void 0:l[n])))return r("com_endpoint_agent_placeholder");if(k&&(!s||!(null==(e=null==d?void 0:d[t])?void 0:e[s])))return r("com_endpoint_assistant_placeholder");if(T)return r("com_endpoint_message_not_appendable");const i=k||C?(({name:e="",localize:t,isAgent:n})=>e&&e.length>0?e:t(!0===n?"com_ui_agent":"com_ui_assistant"))({name:S,isAgent:C,localize:r}):o(h);return`${r("com_endpoint_message_new",{0:i||r("com_endpoint_ai")})}`},i=s();if((null==(n=e.current)?void 0:n.getAttribute("placeholder"))===i)return;const c=Cr(()=>{var t,n;const a=s();(null==(t=e.current)?void 0:t.getAttribute("placeholder"))!==a&&(null==(n=e.current)||n.setAttribute("placeholder",a),cp(e.current))},80);return c(),()=>c.cancel()},[C,r,a,o,l,S,e,k,d,h,g,T]);const R=n.useCallback(n=>{var a;if(e.current&&up(e.current)){const t=up(e.current);t&&s(t)}if("Enter"===n.key&&x)return;u();const r="Enter"===n.key&&!n.shiftKey,o="Enter"===n.key&&(n.ctrlKey||n.metaKey),l=i.current||"Process"===n.key||229===n.keyCode;if(r&&f&&n.preventDefault(),r&&n.preventDefault(),"Enter"===n.key&&!m&&!o&&e.current&&!l)return n.preventDefault(),lp(e.current,"\n"),void cp(e.current);if((r||o)&&!l){const e=document.getElementById(Uo);e&&(console.log("Unmuting global audio"),e.muted=!1),null==(a=t.current)||a.click()}},[x,u,f,m,s,e,t]),I=n.useCallback(t=>{if(!e.current)return;const n=t.clipboardData;if(n&&n.files.length>0){v(!0);const e=[];for(const t of n.files){const n=new File([t],`clipboard_${+new Date}_${t.name}`,{type:t.type});e.push(n)}c(e)}},[c,v,e]);return{textAreaRef:e,handlePaste:I,handleKeyDown:R,isNotAppendable:T,handleCompositionEnd:()=>{i.current=!1},handleCompositionStart:()=>{i.current=!0}}}function Kv({value:e,options:t}){const[s,a]=n.useState(!1),[r,o]=n.useState(""),i=n.useMemo(()=>{if(!r)return t;const n=L(t,r,{keys:["label","value"]}),s=t.find(t=>t.value===e);return s&&!n.includes(s)&&n.push(s),n},[r,e,t]);return{open:s,setOpen:a,searchValue:r,setSearchValue:o,matches:i}}const Gv=(e,t)=>t?`${t}${Zc.COMMON_DIVIDER}${e}`:t;function Wv(){const{user:e}=Rg(),t=Zg(),{ask:s,index:a,getMessages:r,setMessages:o,latestMessage:i}=rg(),{addedIndex:l,ask:c,conversation:d}=Kg(),u=_(sx.autoSendPrompts),m=_(sx.allConversationsSelector),p=y(sx.activePromptByIndex(a)),h=n.useCallback(e=>{if(!e)return console.warn("No data provided to submitMessage");const n=r();!(null==n?void 0:n.some(e=>e.messageId===(null==i?void 0:i.messageId)))&&i&&o([...n||[],i]);const a=l&&m[l]&&d,u=a&&m.every(e=>e===Zc.NEW_CONVO)&&!(null==n?void 0:n.length)?S():void 0,p=a?S():void 0,h=l-1,x=(new Date).toISOString();s({text:e.text,overrideConvoId:Gv(h,u),overrideUserMessageId:Gv(h,p),clientTimestamp:x}),a&&c({text:e.text,overrideConvoId:Gv(l,u),overrideUserMessageId:Gv(l,p),clientTimestamp:x},{overrideMessages:n}),t.reset()},[s,t,l,d,o,r,m,c,i]),x=n.useCallback(n=>{const s=pd({text:n,user:e});if(u)return void h({text:s});const a=t.getValues("text").trim().length>1?`\n${s}`:s;p(a)},[u,h,p,t,e]);return{submitMessage:h,submitPrompt:x}}const qv=e=>{const t={};return Object.entries(e).forEach(([e,n])=>{try{const s=tl.shape[e];if(s){const a=(e=>"true"===e||"false"!==e&&(isNaN(Number(e))?e:Number(e)))(n),r=s.parse(a);t[e]=r}}catch(s){console.warn(`Invalid value for setting ${e}:`,s)}}),null!=t.assistant_id&&t.assistant_id&&!ji(t.endpoint)&&(t.endpoint=vi.assistants),null!=t.agent_id&&t.agent_id&&!wi(t.endpoint)&&(t.endpoint=vi.agents),t};function Qv({textAreaRef:e}){const t=n.useRef(0),s=n.useRef(!1),a=n.useRef(!1),r=n.useRef(!1),o=n.useRef(!1),i=n.useRef(null),l=n.useRef(null),c=n.useRef(null),d=Zg(),[u,m]=rs(),p=sg(),h=_(sx.modularChat),x=_(sx.availableTools),{submitMessage:f}=Wv(),g=Aa(),{conversation:v,newConversation:b}=rg(),y=n.useCallback(e=>{var t;if(!e)return;let n=rp(e,x);if(null!=n.spec&&""!==n.spec){const e=g.getQueryData([Pd.startupConfig]),s=((null==(t=null==e?void 0:e.modelSpecs)?void 0:t.list)??[]).find(e=>e.name===n.spec);if(!s)return;const{preset:a}=s;a.iconURL=jp(s),a.spec=s.name,n=a}let s=n.endpoint??"";const a=g.getQueryData([Pd.endpoints]);if(s&&a&&!a[s]){const e=s.toLowerCase();for(const[t,r]of Object.entries(a))if(r&&r.type===vi.custom&&t.toLowerCase()===e){s=t,n.endpoint=t,n.endpointType=vi.custom;break}}const{template:r,shouldSwitch:o,isNewModular:i,newEndpointType:l,isCurrentModular:c,isExistingConversation:d}=bp({newEndpoint:s,modularChat:h,conversation:v,endpointsConfig:a});let u={};null==n.spec&&(r.spec=null,r.iconURL=null,r.modelLabel=null,u={spec:null,iconURL:null,modelLabel:null},n={...n,...u});if(d&&(c&&i&&o)){r.endpointType=l;const e=p({conversation:{...v??{},endpointType:r.endpointType,...u},preset:r,cleanOutput:null!=n.spec&&""!==n.spec});return Dp.log("conversation","Switching conversation from query params",e),void b({template:e,preset:n,keepLatestMessage:!0,keepAddedConvos:!0})}b({preset:n,keepAddedConvos:!0})},[g,h,v,x,b,p]),j=n.useCallback(()=>{if(!l.current||!v)return!1;for(const[e,t]of Object.entries(l.current))if(!["presetOverride","iconURL","spec","modelLabel"].includes(e)&&v[e]!==t)return!1;return!0},[v]),w=n.useCallback(()=>{!o.current&&a.current&&i.current&&(o.current=!0,a.current=!1,d.setValue("text",i.current,{shouldValidate:!0}),d.handleSubmit(e=>{var t;if(null==(t=e.text)?void 0:t.trim()){f(e);const t=window.location.pathname;window.history.replaceState({},"",t),console.log("Message submitted with conversation state:",v)}})())},[d,f,v]);n.useEffect(()=>{const n=setInterval(()=>{if(s.current||t.current>=50)return clearInterval(n),void(t.current>=50&&console.warn("Max attempts reached, failed to process parameters"));if(t.current+=1,!e.current)return;if(!g.getQueryData([Pd.startupConfig]))return;const{decodedPrompt:r,validSettings:p,shouldAutoSubmit:h}=(()=>{var e;const t={};u.forEach((e,n)=>{t[n]=e});const n=t.prompt||t.q||"",s="true"===(null==(e=t.submit)?void 0:e.toLowerCase());return delete t.prompt,delete t.q,delete t.submit,{decodedPrompt:n,validSettings:qv(t),shouldAutoSubmit:s}})();h||(o.current=!0);Object.keys(p).length>0&&(l.current=p),r&&(i.current=r),h&&r?Object.keys(p).length>0?(a.current=!0,c.current=setTimeout(()=>{!o.current&&a.current&&(console.warn("Settings application timeout reached, proceeding with submission anyway"),w())},3e3)):(d.setValue("text",r,{shouldValidate:!0}),e.current.focus(),e.current.setSelectionRange(r.length,r.length),d.handleSubmit(e=>{var t;(null==(t=e.text)?void 0:t.trim())&&f(e)})()):r?(d.setValue("text",r,{shouldValidate:!0}),e.current.focus(),e.current.setSelectionRange(r.length,r.length)):o.current=!0,Object.keys(p).length>0&&y(p),(()=>{const e=u.toString(),t=new URLSearchParams(e);if(t.delete("prompt"),t.delete("q"),t.delete("submit"),m(t,{replace:!0}),s.current=!0,console.log("Parameters processed successfully",e),clearInterval(n),!a.current){const e=window.location.pathname;window.history.replaceState({},"",e)}})()},100);return()=>{clearInterval(n),c.current&&clearTimeout(c.current)}},[u,d,e,y,b,f,m,g,w]),n.useEffect(()=>{if(!s.current||o.current||r.current||!l.current||!v)return;j()&&(r.current=!0,a.current&&(c.current&&(clearTimeout(c.current),c.current=null),console.log("Settings fully applied, processing submission"),w()))},[v,w,j])}const Zv=({permissionType:e,permission:t})=>{const s=n.useContext(Sg),a=null==s?void 0:s.user,r=null==s?void 0:s.roles,o=(null==s?void 0:s.isAuthenticated)||!1,i=n.useCallback(({user:e,permissionType:t,permission:n})=>{var a,i,l;return!!s&&(!!(o&&null!=(null==e?void 0:e.role)&&r&&r[e.role])&&!0===(null==(l=null==(i=null==(a=r[e.role])?void 0:a.permissions)?void 0:i[t])?void 0:l[n]))},[s,o,r]);return n.useMemo(()=>i({user:a,permissionType:e,permission:t}),[a,e,t,i])},Jv={Escape:!0,Backspace:!0,Enter:!0},Yv=(e,t)=>{var n,s;const a=null==(n=e.current)?void 0:n.value;if("string"!=typeof a||0===a.length||a[0]!==t)return!1;const r=null==(s=e.current)?void 0:s.selectionStart;return"number"==typeof r&&1===r};const Xv=()=>{const e=_(sx.engineSTT),t=_(sx.engineTTS),s=e,a=t;return n.useMemo(()=>({speechToTextEndpoint:s,textToSpeechEndpoint:a}),[s,a])},eb=(e,t)=>{const{showToast:s}=Of(),{speechToTextEndpoint:a}=Xv(),r="external"===a,o=n.useRef(null),i=n.useRef(null),l=n.useRef(null),c=n.useRef(null),[d,u]=n.useState(!1),[m,p]=n.useState(!1),[h,x]=n.useState([]),[f,g]=n.useState(!1),[v,y]=n.useState(()=>S()),[_]=b(sx.decibelValue),[j]=b(sx.autoSendText),[w]=b(sx.speechToText),[N]=b(sx.autoTranscribeAudio),{mutate:C,isLoading:k}=gf({onSuccess:n=>{const s=n.text;e(s),g(!1),j>-1&&w&&s.length>0&&setTimeout(()=>{t(s)},1e3*j)},onError:()=>{s({message:"An error occurred while processing the audio, maybe the audio was too short",status:"error"}),g(!1)}});function S(){const e=["audio/webm","audio/webm;codecs=opus","audio/mp4","audio/ogg;codecs=opus","audio/ogg","audio/wav"];for(const t of e)if("undefined"!=typeof MediaRecorder&&MediaRecorder.isTypeSupported(t))return t;if("undefined"!=typeof navigator){const e=navigator.userAgent.toLowerCase();if(-1!==e.indexOf("safari")&&-1===e.indexOf("chrome"))return"audio/mp4";if(-1!==e.indexOf("firefox"))return"audio/ogg"}return"audio/webm"}const T=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});u(!0),o.current=e??null}catch(e){u(!1)}},R=()=>{if(h.length>0){const t=new Blob(h,{type:v}),n=(e=v).includes("mp4")?"m4a":e.includes("ogg")?"ogg":e.includes("wav")?"wav":"webm";x([]);const s=new FormData;s.append("audio",t,`audio.${n}`),g(!0),c.current&&(c.current.removeEventListener("dataavailable",e=>{h.push(e.data)}),c.current.removeEventListener("stop",R),c.current=null),C(s)}else s({message:"The audio was too short",status:"warning"});var e},I=async()=>{if(f)s({message:"A request is already being made. Please wait.",status:"warning"});else if(o.current||await T(),o.current)try{x([]);const e=S();y(e),c.current=new MediaRecorder(o.current,{mimeType:v}),c.current.addEventListener("dataavailable",e=>{h.push(e.data)}),c.current.addEventListener("stop",R),c.current.start(100),!l.current&&N&&w&&((e,t)=>{const n=new AudioContext,s=n.createMediaStreamSource(e),a=n.createAnalyser();a.minDecibels=_,s.connect(a);const r=a.frequencyBinCount,o=new Uint8Array(r);let l=Date.now();const c=()=>{a.getByteFrequencyData(o),o.some(e=>e>0)&&(l=Date.now()),Date.now()-l>3e3?t():i.current=window.requestAnimationFrame(c)};i.current=window.requestAnimationFrame(c)})(o.current,E),p(!0)}catch(e){s({message:`Error starting recording: ${e}`,status:"error"})}else s({message:"Microphone permission not granted",status:"error"})},E=()=>{var e;c.current&&("recording"===c.current.state?(c.current.stop(),null==(e=o.current)||e.getTracks().forEach(e=>e.stop()),o.current=null,null!==i.current&&(window.cancelAnimationFrame(i.current),i.current=null),p(!1)):s({message:"MediaRecorder is not recording",status:"error"}))},M=async e=>{if(e.shiftKey&&e.altKey&&"KeyL"===e.code&&r){if(!window.MediaRecorder)return void s({message:"MediaRecorder is not supported in this browser",status:"error"});!1===d&&await T(),m?E():I(),e.preventDefault()}};return n.useEffect(()=>(window.addEventListener("keydown",M),()=>{window.removeEventListener("keydown",M)}),[m]),{isListening:m,externalStopRecording:()=>{m?E():s({message:"Not currently recording. Please start recording first.",status:"warning"})},externalStartRecording:()=>{m?s({message:"Already listening. Please stop recording first.",status:"warning"}):I()},isLoading:k}},tb=(e,t)=>{const{speechToTextEndpoint:s}=Xv(),a="external"===s,{isListening:r,isLoading:o,startRecording:i,stopRecording:l}=((e,t)=>{const{showToast:s}=Of(),{speechToTextEndpoint:a}=Xv(),r="browser"===a,o=n.useRef(null),i=n.useRef(null),l=n.useRef(),[c]=b(sx.autoSendText),[d]=b(sx.languageSTT),[u]=b(sx.autoTranscribeAudio),{listening:m,finalTranscript:p,resetTranscript:h,interimTranscript:x,isMicrophoneAvailable:f,browserSupportsSpeechRecognition:g}=A.useSpeechRecognition(),v=n.useMemo(()=>m,[m]);n.useEffect(()=>{null!=x&&""!==x&&i.current!==x&&(e(x),i.current=x)},[e,x]),n.useEffect(()=>{if(null!=p&&""!==p&&o.current!==p)return e(p),o.current=p,c>-1&&p.length>0&&(l.current=setTimeout(()=>{t(p),h()},1e3*c)),()=>{l.current&&clearTimeout(l.current)}},[e,t,h,p,c]);const y=()=>{g?f?!0===v?O.stopListening():O.startListening({language:d,continuous:u}):s({message:"Microphone is not available",status:"error"}):s({message:"Browser does not support SpeechRecognition",status:"error"})};return n.useEffect(()=>{const e=e=>{e.shiftKey&&e.altKey&&"KeyL"===e.code&&!r&&y()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),{isListening:v,isLoading:!1,startRecording:y,stopRecording:y}})(e,t),{isListening:c,isLoading:d,externalStartRecording:u,externalStopRecording:m}=eb(e,t);return{isLoading:a?d:o,isListening:a?c:r,stopRecording:a?m:l,startRecording:a?u:i}},nb={},sb=e=>n.useMemo(()=>{const{username:t,name:n}=e??{},s=n||t;if(!s)return"";if((null==e?void 0:e.avatar)&&""!==(null==e?void 0:e.avatar))return e.avatar;if(nb[s])return nb[s];const a=uo(mo,{seed:s,fontFamily:["Verdana"],fontSize:36});let r="";try{r=a.toDataUri(),r&&(nb[s]=r)}catch(o){console.error("Failed to generate avatar:",o)}return r},[e]);function ab(e=.01,t=.007,s){const a=n.useCallback(e=>{const n=e?e/1048576:0;return e?n<=1?.1:Math.max(.05/Math.sqrt(n),.002):t},[t]),r=n.useMemo(()=>a(s),[s,a]),[o,i]=n.useState(e),l=n.useCallback(e=>r,[r,s]);return n.useEffect(()=>{let t,n;if(!(e>=1&&o>=1))return e>=1&&o<1?(i(.99),t=setTimeout(()=>{i(1)},200)):n=setInterval(()=>{i(e=>{if(e>=1)return clearInterval(n),1;const t=l(e);return Math.min(e+t,.95)})},200),()=>{clearInterval(n),clearTimeout(t)}},[o,e,r,s,l]),o}function rb({messageId:e,attachments:t}){const s=_(sx.messageAttachmentsMap),a=n.useMemo(()=>t??s[e??""]??[],[t,s,e]),r=function(e){return n.useMemo(()=>{const t={};return null==e||e.forEach(e=>{if(e.type===ri.web_search&&e[ri.web_search]){const n=e[ri.web_search];n&&"number"==typeof n.turn&&(t[n.turn.toString()]=n)}}),t},[e])}(a);return{attachments:a,searchResults:r}}const ob=/(\\ue203.*?\\ue204)/g,ib=/(\\ue200.*?\\ue201)/g,lb=/\\ue202turn(\d+)(search|image|news|video|ref)(\d+)/g,cb=/\\ue200|\\ue201|\\ue202|\\ue203|\\ue204|\\ue206/g,db=/\s*\\ue202turn\d+(search|news|image|video|ref)\d+/g,ub={search:"organic",ref:"references",news:"topStories",image:"images",video:"videos"};function mb({text:e,content:t,searchResults:s}){const a=n.useRef(null);n.useEffect(()=>()=>{a.current&&clearTimeout(a.current)},[]);return n.useCallback(n=>{a.current&&clearTimeout(a.current),n(!0);let r=e??"";if(t&&(r=t.reduce((e,n,s)=>{if(n.type===td.TEXT){return e+("string"==typeof n.text?n.text:n.text.value)+(s===t.length-1?"":"\n")}return e},"")),!s||0===Object.keys(s).length){const e=r.replace(db,"").replace(cb,"");return D(e,{format:"text/plain"}),void(a.current=setTimeout(()=>{n(!1)},3e3))}const o=function(e,t){var n,s;const a=new Map,r=new Map;let o=1,i=e;i=i.replace(ob,e=>`**${e.replace(/\\ue203|\\ue204/g,"")}**`);const l=[];let c;const d=new RegExp(lb.source,"g");for(;null!==(c=d.exec(i));)l.push({turn:c[1],type:c[2],index:c[3],position:c.index,fullMatch:c[0],isComposite:!1});let u;const m=new RegExp(ib.source,"g");for(;null!==(u=m.exec(i));){const e=u[0],t=u.index;let n;const s=new RegExp(lb.source,"g");for(;null!==(n=s.exec(e));)l.push({turn:n[1],type:n[2],index:n[3],position:t+n.index,fullMatch:e,isComposite:!0})}l.sort((e,t)=>e.position-t.position);const p=new Set,h=[],x=new Map;for(const f of l){const{turn:e,type:i,index:l,fullMatch:c,isComposite:d}=f,u=t[e];if(!u)continue;const m=ub[i.toLowerCase()]||i.toLowerCase(),g=parseInt(l,10);if(!u[m]||!u[m][g])continue;const v=u[m][g],b=v.link||"";if(!b)continue;let y=r.get(b);y||(y=`${e}-${m}-${g}`,r.set(b,y));const _={link:b,title:v.title||v.name||"",attribution:v.attribution||v.source||"",type:m,typeIndex:g,citationKey:y};if(d&&p.has(c))continue;let j="",w=a.get(y);if(w||(w={referenceNumber:o++,link:_.link,title:_.title,source:_},a.set(y,w)),w){if(d){if(!p.has(c)){const e=[];let i;const l=new RegExp(lb.source,"g");for(;null!==(i=l.exec(c));){const l=i[1],c=i[2],d=i[3],u=ub[c.toLowerCase()]||c.toLowerCase(),m=null==(s=null==(n=t[l])?void 0:n[u])?void 0:s[parseInt(d,10)];if(m&&m.link){const t=m.link;let n=r.get(t);n||(n=`${l}-${u}-${d}`,r.set(t,n));let s=a.get(n);s||(s={referenceNumber:o++,link:m.link,title:m.title||m.name||"",source:{link:m.link,title:m.title||m.name||"",attribution:m.attribution||m.source||"",type:u,typeIndex:parseInt(d,10),citationKey:n}},a.set(n,s)),s&&e.push(s.referenceNumber)}}const d=[...new Set(e)].sort((e,t)=>e-t);j=d.length>0?d.map(e=>`[${e}]`).join(""):"",p.add(c),x.set(c,d),h.push([c,j])}continue}j=`[${w.referenceNumber}]`,h.push([c,j])}}h.sort((e,t)=>t[0].length-e[0].length);for(const[f,g]of h)i=i.replace(f,g);return i=i.replace(/\n\s*\[\d+\](\[\d+\])*\s*$/g,""),i=i.replace(db,""),i=i.replace(cb,""),{formattedText:i,citations:a}}(r,s);let i=o.formattedText;if(o.citations.size>0){i+="\n\nCitations:\n";const e=Array.from(o.citations.entries()).sort((e,t)=>e[1].referenceNumber-t[1].referenceNumber);for(const[t,n]of e)i+=`[${n.referenceNumber}] ${n.link}\n`}D(i,{format:"text/plain"}),a.current=setTimeout(()=>{n(!1)},3e3)},[e,t,s])}function pb(e){const t=zf(),{user:s}=Rg(),a=_(sx.UsernameDisplay),{message:r,currentEditId:o,setCurrentEditId:i,isMultiMessage:l,searchResults:c}=e,{ask:d,index:u,regenerate:m,latestMessage:p,handleContinue:h,setLatestMessage:x,conversation:f,isSubmitting:g}=rg(),{conversation:v,isSubmitting:b}=Kg(),y=n.useMemo(()=>!0===l?v:f,[l,v,f]),j=cg(),w=sv(),{text:N,content:C,messageId:k=null,isCreatedByUser:S}=r??{},T=n.useMemo(()=>k===o,[k,o]),[R,I]=n.useState(()=>{var e,t;if(null==r?void 0:r.feedback){const n=xi(null==(t=null==(e=r.feedback)?void 0:e.tag)?void 0:t.key);return{rating:r.feedback.rating,tag:n,text:r.feedback.text}}}),E=n.useCallback(e=>i&&i(!0===e?-1:k),[k,i]),M=n.useMemo(()=>{if(!ji(null==y?void 0:y.endpoint))return;const e=(null==y?void 0:y.endpoint)??"",t=(null==r?void 0:r.model)??"";return(null==w?void 0:w[e])?w[e][t]:void 0},[null==y?void 0:y.endpoint,null==r?void 0:r.model,w]),P=n.useMemo(()=>{if(!wi(null==y?void 0:y.endpoint))return;if(!j)return;const e=(null==r?void 0:r.model)??"";if(e)return j[e];const t=(null==y?void 0:y.agent_id)??"";return t?j[t]:void 0},[j,null==y?void 0:y.agent_id,null==y?void 0:y.endpoint,null==r?void 0:r.model]),L=n.useMemo(()=>!0===l?b:g,[l,b,g]),A=n.useCallback(()=>{L&&!0===S||!r||m(r)},[L,S,r,m]),O=mb({text:N,content:C,searchResults:c}),D=n.useMemo(()=>!0===(null==r?void 0:r.isCreatedByUser)?a?((null==s?void 0:s.name)??"")||(null==s?void 0:s.username):t("com_user_message"):P?P.name??"Assistant":M?M.name??"Assistant":null==r?void 0:r.sender,[r,P,M,a,s,t]),z=tg((null==y?void 0:y.conversationId)||"",(null==r?void 0:r.messageId)||""),F=n.useCallback(({feedback:e})=>{const t={feedback:e?hi(e):void 0};z.mutate(t,{onSuccess:e=>{var t;if(e.feedback){const n=xi((null==(t=e.feedback)?void 0:t.tag)??void 0);I({rating:e.feedback.rating,tag:n,text:e.feedback.text})}else I(void 0)},onError:e=>{console.error("Failed to update feedback:",e)}})},[z]);return{ask:d,edit:T,index:u,agent:P,assistant:M,enterEdit:E,conversation:y,messageLabel:D,isSubmitting:L,latestMessage:p,handleContinue:h,copyToClipboard:O,setLatestMessage:x,regenerateMessage:A,handleFeedback:F,feedback:R}}function hb({message:e}){const t=n.useRef(""),[s,a]=n.useState(null),r=n.useMemo(()=>{var t;return 0===((null==(t=null==e?void 0:e.children)?void 0:t.length)??0)},[e]),{index:o,conversation:i,latestMessage:l,setAbortScroll:c,setLatestMessage:d,isSubmitting:u}=rg(),{isSubmitting:m}=Kg(),p=_(sx.latestMessageFamily(o+1)),h=n.useMemo(()=>u||m,[u,m]);n.useEffect(()=>{const n=null==i?void 0:i.conversationId;if(n===Zc.NEW_CONVO)return;if(!e)return;if(!r)return;const s=pp(e,n),a={textKey:s,"latestText.current":t.current,messageId:e.messageId,convoId:n};s!==t.current||null!=n&&t.current&&n!==t.current.split(Zc.COMMON_DIVIDER)[2]?(Dp.log("latest_message","[useMessageProcess] Setting latest message; logInfo:",a),t.current=s,d({...e})):Dp.log("latest_message","No change in latest message; logInfo",a)},[r,e,d,null==i?void 0:i.conversationId]);const x=n.useCallback(e=>{kr(()=>{Dp.log("message_scrolling",`useMessageProcess: setting abort scroll to ${h}, handleScroll event`,e),c(!!h)},500)()},[h,c]),f=n.useMemo(()=>{var e;return r&&p&&0===((null==(e=p.children)?void 0:e.length)??0)||!!s},[r,p,s]);return n.useEffect(()=>{if(r&&p&&p.conversationId===(null==e?void 0:e.conversationId)){const t=Object.assign({},p,{parentMessageId:e.parentMessageId,depth:e.depth});a(t)}},[r,p,e,a,l]),{showSibling:f,handleScroll:x,conversation:i,siblingMessage:s,setSiblingMessage:a,isSubmittingFamily:h,latestMultiMessage:p}}function xb(e){const t=_(sx.autoScroll),s=n.useRef(null),a=n.useRef(null),[r,o]=n.useState(!1),{conversation:i,setAbortScroll:l,isSubmitting:c,abortScroll:d}=rg(),{conversationId:u}=i??{},m=n.useRef(),p=n.useCallback(e=>{clearTimeout(m.current),m.current=setTimeout(()=>{o(e)},150)},[]);n.useEffect(()=>{if(!a.current||!s.current)return;const e=new IntersectionObserver(([e])=>{p(!e.isIntersecting)},{root:s.current,threshold:.85});return e.observe(a.current),()=>{e.disconnect(),clearTimeout(m.current)}},[a,s,p]);const h=n.useCallback(()=>{if(a.current&&s.current){const e=new IntersectionObserver(([e])=>{p(!e.isIntersecting)},{root:s.current,threshold:.85});return e.observe(a.current),()=>e.disconnect()}},[p]),x=()=>p(!1),{scrollToRef:f,handleSmoothToRef:g}=function({targetRef:e,callback:t,smoothCallback:s}){const a=(t,n)=>{var s;null==(s=e.current)||s.scrollIntoView({behavior:t}),n()},r=n.useCallback(kr(()=>a("instant",t),145,{leading:!0}),[e]),o=n.useCallback(kr(()=>a("smooth",s),750,{leading:!0}),[e]);return{scrollToRef:r,handleSmoothToRef:e=>{e.preventDefault(),o()}}}({targetRef:a,callback:x,smoothCallback:()=>{x(),l(!1)}});return n.useEffect(()=>{if(e&&0!==e.length&&a.current&&s.current)return c&&f&&!0!==d&&f(),()=>{!0===d&&f&&f.cancel()}},[c,e,f,d]),n.useEffect(()=>{a.current&&s.current&&f&&t&&u!==Zc.NEW_CONVO&&f()},[t,u,f]),{conversation:i,scrollableRef:s,messagesEndRef:a,scrollToBottom:f,showScrollButton:r,handleSmoothToRef:g,debouncedHandleScroll:h}}function fb(e,t,s,a){const[r,o]=n.useState(t);n.useEffect(()=>{const n=localStorage.getItem(e);n||a?!n&&a&&a(t)&&localStorage.setItem(e,JSON.stringify(t)):localStorage.setItem(e,JSON.stringify(t));const r=n&&"undefined"!==n?JSON.parse(n):t;function i(t){if(t.key!==e)return;const n=localStorage.getItem(e);o(JSON.parse(n??""))}return o(r),s&&s(r),window.addEventListener("storage",i),()=>{window.removeEventListener("storage",i)}},[e,s]);return[r,t=>{try{o(t);const n=()=>{localStorage.setItem(e,JSON.stringify(t)),null==window||window.dispatchEvent(new StorageEvent("storage",{key:e}))};a?a(t,localStorage.getItem(e))&&n():n(),null==s||s(t)}catch(n){console.error(n)}}]}const gb=(e,t)=>{if(t)try{if(((null==t?void 0:t.trim())??"").length>2)return!0}catch(n){console.error(n)}return Array.isArray(e)&&e.length>0};const vb=(e,t)=>{if(t)try{if("true"===((null==t?void 0:t.trim())??"")&&!1===e)return!0}catch(n){console.error(n)}return null!=e&&""!==e&&!1!==e};function bb({conversationId:e,toolKey:t,localStorageKey:s,isAuthenticated:a,setIsDialogOpen:r,authConfig:o}){var i;const l=e??Zc.NEW_CONVO,[c,d]=b(tx(l)),u=Hx({toolId:(null==o?void 0:o.toolId)||""},{enabled:!!(null==o?void 0:o.toolId),...null==o?void 0:o.queryOptions}),m=n.useMemo(()=>{var e;return a??(!!o&&((null==(e=null==u?void 0:u.data)?void 0:e.authenticated)??!1))},[a,o,null==(i=u.data)?void 0:i.authenticated]),p=n.useMemo(()=>(null==c?void 0:c[t])??!1,[c,t]),h=n.useRef(p),[x,f]=fb(`${s}${l}`,p,void 0,vb),[g,v]=fb(`${s}pinned`,!1),y=n.useCallback(({e:e,isChecked:n})=>{var s;if(void 0!==m&&!m&&r)return r(!0),void(null==(s=null==e?void 0:e.preventDefault)||s.call(e));f(n),d(e=>({...e,[t]:n}))},[f,r,m,d,t]),_=n.useMemo(()=>Cr(y,50,{leading:!0}),[y]);return n.useEffect(()=>{h.current!==p&&f(p),h.current=p},[p,f]),{toggleState:x,handleChange:y,isToolEnabled:p,setToggleState:f,ephemeralAgent:c,debouncedChange:_,setEphemeralAgent:d,authData:null==u?void 0:u.data,isPinned:g,setIsPinned:v}}const yb=e=>{const t=Aa(),s=null==e?void 0:e.isEntityTool,a=Xf({onMutate:e=>{t.setQueryData([Pd.toolAuth,ri.execute_code],()=>({authenticated:"install"===e.action,message:fi.USER_PROVIDED}))},onSuccess:()=>{t.invalidateQueries([Pd.toolAuth,ri.execute_code])},onError:()=>{t.invalidateQueries([Pd.toolAuth,ri.execute_code])}}),r=n.useCallback(e=>{a.mutate({pluginKey:ri.execute_code,action:"install",auth:{CHAT_CODE_API_KEY:e},isEntityTool:s})},[a,s]);return{removeTool:n.useCallback(()=>{a.mutate({pluginKey:ri.execute_code,action:"uninstall",auth:{CHAT_CODE_API_KEY:null},isEntityTool:s})},[a,s]),installTool:r}};function _b({onSubmit:e,onRevoke:t}){const s=Rr(),a=n.useRef(null),r=n.useRef(null),[o,i]=n.useState(!1),{installTool:l,removeTool:c}=yb({isEntityTool:!0}),{reset:d}=s,u=n.useCallback(t=>{d(),l(t.apiKey),i(!1),null==e||e()},[e,d,l]),m=n.useCallback(()=>{d(),c(),i(!1),null==t||t()},[d,t,c]);return{methods:s,isDialogOpen:o,setIsDialogOpen:i,handleRevokeApiKey:m,onSubmit:u,badgeTriggerRef:r,menuTriggerRef:a}}const jb=e=>{const t=Aa(),s=null==e?void 0:e.isEntityTool,a=Xf({onMutate:e=>{t.setQueryData([Pd.toolAuth,ri.web_search],()=>({authenticated:"install"===e.action,authTypes:"install"===e.action?[["providers",fi.USER_PROVIDED],["scrapers",fi.USER_PROVIDED],["rerankers",fi.USER_PROVIDED]]:[]}))},onSuccess:()=>{t.invalidateQueries([Pd.toolAuth,ri.web_search])},onError:()=>{t.invalidateQueries([Pd.toolAuth,ri.web_search])}}),r=n.useCallback(e=>{const t=Object.entries({serperApiKey:e.serperApiKey,firecrawlApiKey:e.firecrawlApiKey,firecrawlApiUrl:e.firecrawlApiUrl,jinaApiKey:e.jinaApiKey,cohereApiKey:e.cohereApiKey}).reduce((e,[t,n])=>(n&&(e[t]=n),e),{});a.mutate({pluginKey:ri.web_search,action:"install",auth:t,isEntityTool:s})},[a,s]);return{removeTool:n.useCallback(()=>{a.mutate({pluginKey:ri.web_search,action:"uninstall",auth:{},isEntityTool:s})},[a,s]),installTool:r}};function wb({onSubmit:e,onRevoke:t}){const s=Rr(),a=n.useRef(null),r=n.useRef(null),[o,i]=n.useState(!1),{installTool:l,removeTool:c}=jb({isEntityTool:!0}),{reset:d}=s,u=n.useCallback(t=>{d(),l(t),i(!1),null==e||e()},[e,d,l]),m=n.useCallback(()=>{d(),c(),i(!1),null==t||t()},[d,t,c]);return{methods:s,isDialogOpen:o,setIsDialogOpen:i,handleRevokeApiKey:m,onSubmit:u,badgeTriggerRef:r,menuTriggerRef:a}}const Nb={misc:G,roleplay:K,write:H,idea:U,shop:B,finance:$,code:V,travel:F,teach_or_explain:z},Cb={code:"text-red-500",misc:"text-blue-300",shop:"text-purple-400",idea:"text-yellow-500/90 dark:text-yellow-300 ",write:"text-purple-400",travel:"text-yellow-500/90 dark:text-yellow-300 ",finance:"text-orange-400",roleplay:"text-orange-400",teach_or_explain:"text-blue-300"};function kb({category:e,className:t=""}){const n=Nb[e],s=Cb[e]+" "+t;return n?l.jsx(n,{className:Op(s,t),"aria-hidden":"true"}):null}const Sb=[{label:"com_ui_loading",value:""}],Tb={label:"com_ui_empty_category",value:""},Rb=(e="")=>{const t=zf(),{data:n=Sb}=of({select:n=>n.map(n=>({label:t(n.label),value:n.value,icon:n.value?l.jsx(kb,{category:n.value,className:e}):null}))});return{categories:n,emptyCategory:Tb}};function Ib(){const e=Aa(),t=_(sx.promptsCategory),[s,a]=b(sx.promptsName),[r,o]=b(sx.promptsPageSize),[i,l]=b(sx.promptsPageNumber),c=n.useRef(1);n.useEffect(()=>{i>1&&i>c.current&&(c.current=i)},[i]);const d=((e,t)=>{const{name:n,pageSize:s,category:a,...r}=e||{};return Da([Pd.promptGroups,n,a,s],({pageParam:e="1"})=>Su({...r,name:n,category:a||"",pageNumber:null==e?void 0:e.toString(),pageSize:(s||10).toString()}),{getNextPageParam:e=>{const t=Number(e.pageNumber);return t<Number(e.pages)?t+1:void 0},refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t})})({name:s,pageSize:r,category:t,pageNumber:i+""});n.useEffect(()=>{c.current=1,l(1),e.resetQueries([Pd.promptGroups,s,t,r])},[r,s,t,l]);const u=n.useMemo(()=>{var e,t;return(null==(t=null==(e=d.data)?void 0:e.pages[i-1+""])?void 0:t.promptGroups)||[]},[d.data,i]),m=d.isFetchingNextPage,p=!!d.hasNextPage||c.current>i,h=!!d.hasPreviousPage||i>1,x=n.useCallback(Cr(e=>{a(e)},850),[a]);return{name:s,setName:x,nextPage:()=>{l(e=>e+1),d.hasNextPage&&d.fetchNextPage()},prevPage:()=>{l(e=>e-1),d.hasPreviousPage&&d.fetchPreviousPage()},isFetching:m,pageSize:r,setPageSize:o,hasNextPage:p,groupsQuery:d,promptGroups:u,hasPreviousPage:h}}function Eb(e){const t=y(sx.messageAttachmentsMap);return({data:n})=>{const{messageId:s}=n;if(e&&(null==n?void 0:n.filepath)&&!n.filepath.startsWith("/api/files")&&e.setQueryData([Pd.files],e=>[n,...e||[]]),e&&n.type===ri.memory&&n[ri.memory]){const t=n[ri.memory];e.setQueryData([Pd.memories],e=>e&&function({memoryArtifact:e,currentData:t}){const{type:n,key:s,value:a,tokenCount:r=0}=e;if("update"===n&&!a)return;const o=t.memories,i=o.findIndex(e=>e.key===s);if("delete"===n){if(-1===i)return;const e=o[i],n=[...o];n.splice(i,1);const s=t.totalTokens-(e.tokenCount||0),a=t.tokenLimit?Math.min(100,Math.round(s/t.tokenLimit*100)):null;return{...t,memories:n,totalTokens:s,usagePercentage:a}}if("update"===n){const e=(new Date).toISOString();let n,l=t.totalTokens;i>=0?(l=l-(o[i].tokenCount||0)+r,n=[...o],n[i]={key:s,value:a,tokenCount:r,updated_at:e}):(l+=r,n=[...o,{key:s,value:a,tokenCount:r,updated_at:e}]);const c=t.tokenLimit?Math.min(100,Math.round(l/t.tokenLimit*100)):null;return{...t,memories:n,totalTokens:l,usagePercentage:c}}}({memoryArtifact:t,currentData:e})||e)}t(e=>{const t=e[s]||[];return{...e,[s]:[...t,n]}})}}const Mb=({errorMetadata:e,getMessages:t,submission:n,error:s})=>{const a=t(),r=null==a?void 0:a[a.length-1];let o;const i=n.initialResponse.text.length>45?n.initialResponse.text:"",l=((null==e?void 0:e.text)||i||(null==s?void 0:s.message))??"Error cancelling request",c=(null==r?void 0:r.content)??[];let d=!1;if(c.length>0){const e=c[c.length-1],t=null==e?void 0:e[e.type??""];d=e.type!==td.TEXT||e.type===td.TEXT&&"string"==typeof t||""!==(null==t?void 0:t.value)}if((null==r?void 0:r.conversationId)&&(null==r?void 0:r.messageId)&&c&&d){const t=[...c];return t.push({type:td.ERROR,error:l}),o={...r,...e,error:void 0,text:"",content:t},n.userMessage.messageId&&n.userMessage.messageId!==o.parentMessageId&&(o.parentMessageId=n.userMessage.messageId),o}return e||(o={...n,...n.initialResponse,text:l,unfinished:!!i.length,error:!0},Qi.parse(o))},Pb=({parentId:e,queryClient:t,currentTitle:n,conversationId:s})=>{if(e!==Zc.NO_PARENT&&(null==n?void 0:n.toLowerCase().includes("new chat"))){const e=t.getQueryData([Pd.conversation,s]);if(null==e?void 0:e.title)return e.title;const n=ep(t.getQueryData([Pd.allConversations]),s??"");return(null==n?void 0:n.title)??(null==e?void 0:e.title)??null}return n};function Lb({genTitle:e,setMessages:t,getMessages:s,setCompleted:a,isAddedRequest:r=!1,setConversation:o,setIsSubmitting:i,newConversation:l,setShowStopButton:c,resetLatestMessage:d}){const u=Aa(),{announcePolite:p}=m.useContext(rv),h=v(({snapshot:e,set:t})=>async(n,s=Zc.NEW_CONVO)=>{const a=s||Zc.NEW_CONVO;if(Dp.log("agents",`Attempting to apply template from "${a}" to "${n}"`),n!==a)try{const s=await e.getPromise(tx(a));s?(Dp.log("agents",`Applying agent template to "${n}":`,s),t(tx(n),s)):(Dp.warn("agents",`Agent template from "${a}" is null or unset. Setting agent for "${n}" to null.`),t(tx(n),null))}catch(r){Dp.error("agents",`Error applying agent template from "${a}" to "${n}":`,r),t(tx(n),null)}else Dp.warn("agents",`Attempted to apply template to itself ("${a}"). Skipping.`)},[]),x=y(sx.abortScroll),f=k(),g=N(),b=n.useRef(Date.now()),{conversationId:_}=M(),{token:j}=Rg(),w=function({setMessages:e,getMessages:t}){const s=Aa(),a=n.useMemo(()=>new Map,[]);return n.useCallback(({data:n,submission:r})=>{const{type:o,messageId:i,thread_id:l,conversationId:c,index:d}=n,u=t(),m=(null==u?void 0:u.filter(e=>e.messageId!==i).map(e=>({...e,thread_id:l})))??[],p=m[m.length-1],{initialResponse:h}=r;let x=a.get(i);x||(x={...h,parentMessageId:(null==p?void 0:p.messageId)??"",conversationId:c,messageId:i,thread_id:l},a.set(i,x));const f=n[td.TEXT],g=null!=f&&"string"==typeof f?{value:f}:n[o];o===td.IMAGE_FILE&&Mm(s,g),x.content=[...x.content??[]],x.content[d]={type:o,[o]:g},o!==td.TEXT&&h.content&&(x.content[x.content.length-1].type===td.TOOL_CALL&&1===x.content[x.content.length-1][td.TOOL_CALL].progress||x.content[x.content.length-1].type===td.IMAGE_FILE)&&x.content.push(h.content[0]),e([...m,x])},[s,t,a,e])}({setMessages:t,getMessages:s}),C=function({setMessages:e,getMessages:t,setIsSubmitting:s,announcePolite:a,lastAnnouncementTimeRef:r}){const o=n.useRef(new Map),i=n.useRef(new Map),l=n.useRef(new Map),c=(e,t,n,s=!1)=>{const a=n.type??"";if(!a)return console.warn("No content type found in content part"),e;const r=[...e.content||[]];if(r[t]||(r[t]={type:n.type}),a.startsWith(td.TEXT)&&td.TEXT in n&&"string"==typeof n.text){const e=r[t],s={type:td.TEXT,text:(e.text||"")+n.text};null!=n.tool_call_ids&&(s.tool_call_ids=n.tool_call_ids),r[t]=s}else if(a.startsWith(td.AGENT_UPDATE)&&td.AGENT_UPDATE in n&&n.agent_update){const e={type:td.AGENT_UPDATE,agent_update:n.agent_update};r[t]=e}else if(a.startsWith(td.THINK)&&td.THINK in n&&"string"==typeof n.think){const e=r[t],s={type:td.THINK,think:(e.think||"")+n.think};r[t]=s}else if(a===td.IMAGE_URL&&"image_url"in n){const e=r[t];r[t]={...e}}else if(a===td.TOOL_CALL&&"tool_call"in n){const e=r[t],a=null==e?void 0:e.tool_call,o=n.tool_call.args,i=s||"object"==typeof(null==a?void 0:a.args)||"object"==typeof o?n.tool_call.args:((null==a?void 0:a.args)??"")+(o??""),l={id:id([n.tool_call.id,null==a?void 0:a.id])??"",name:id([n.tool_call.name,null==a?void 0:a.name])??"",args:i,type:sd.TOOL_CALL,auth:n.tool_call.auth,expires_at:n.tool_call.expires_at};s&&(l.progress=1,l.output=n.tool_call.output),r[t]={type:td.TOOL_CALL,tool_call:l}}return{...e,content:r}};return n.useCallback(({event:n,data:d},u)=>{const m=t()||[],{userMessage:p}=u;s(!0);const h=Date.now();if(h-r.current>7e3&&(a({message:"composing",isStatus:!0}),r.current=h),"on_run_step"===n){const t=d,n=t.runId??"";if(!n)return void console.warn("No message id found in run step event");l.current.set(t.id,t);let s=i.current.get(n);if(s||(s={...m[m.length-1],parentMessageId:p.messageId,conversationId:p.conversationId,messageId:n,content:[]},i.current.set(n,s),e([...m.slice(0,-1),s])),t.stepDetails.type===nd.TOOL_CALLS){let a={...s};t.stepDetails.tool_calls.forEach(e=>{const n=e.id??"";"id"in e&&n&&o.current.set(t.id,n);const s={type:td.TOOL_CALL,tool_call:{name:e.name??"",args:e.args,id:n}};a=c(a,t.index,s)}),i.current.set(n,a);const r=m.map(e=>e.messageId===t.runId?a:e);e(r)}}else if("on_agent_update"===n){const{agent_update:n}=d,s=n.runId||"";if(!s)return void console.warn("No message id found in agent update event");const a=i.current.get(s);if(a){const r=c(a,n.index,d);i.current.set(s,r);const o=t()||[];e([...o.slice(0,-1),r])}}else if("on_message_delta"===n){const n=d,s=l.current.get(n.id),a=(null==s?void 0:s.runId)??"";if(!s||!a)return void console.warn("No run step or runId found for message delta event");const r=i.current.get(a);if(r&&n.delta.content){const o=Array.isArray(n.delta.content)?n.delta.content[0]:n.delta.content,l=c(r,s.index,o);i.current.set(a,l);const d=t()||[];e([...d.slice(0,-1),l])}}else if("on_reasoning_delta"===n){const n=d,s=l.current.get(n.id),a=(null==s?void 0:s.runId)??"";if(!s||!a)return void console.warn("No run step or runId found for reasoning delta event");const r=i.current.get(a);if(r&&null!=n.delta.content){const o=Array.isArray(n.delta.content)?n.delta.content[0]:n.delta.content,l=c(r,s.index,o);i.current.set(a,l);const d=t()||[];e([...d.slice(0,-1),l])}}else if("on_run_step_delta"===n){const t=d,n=l.current.get(t.id),s=(null==n?void 0:n.runId)??"";if(!n||!s)return void console.warn("No run step or runId found for run step delta event");const a=i.current.get(s);if(a&&t.delta.type===nd.TOOL_CALLS&&t.delta.tool_calls){let r={...a};t.delta.tool_calls.forEach(e=>{const s=o.current.get(t.id)??"",a={type:td.TOOL_CALL,tool_call:{name:e.name??"",args:e.args??"",id:s}};null!=t.delta.auth&&(a.tool_call.auth=t.delta.auth,a.tool_call.expires_at=t.delta.expires_at),r=c(r,n.index,a)}),i.current.set(s,r);const l=m.map(e=>e.messageId===n.runId?r:e);e(l)}}else if("on_run_step_completed"===n){const{result:t}=d,{id:n}=t,s=l.current.get(n),a=(null==s?void 0:s.runId)??"";if(!s||!a)return void console.warn("No run step or runId found for completed tool call event");const r=i.current.get(a);if(r){let n={...r};const o={type:td.TOOL_CALL,tool_call:t.tool_call};n=c(n,s.index,o,!0),i.current.set(a,n);const l=m.map(e=>e.messageId===s.runId?n:e);e(l)}}return()=>{o.current.clear(),i.current.clear(),l.current.clear()}},[t,s,r,a,e])}({setMessages:t,getMessages:s,announcePolite:p,setIsSubmitting:i,lastAnnouncementTimeRef:b}),T=Eb(u),R=n.useCallback((e,n)=>{const{messages:s,userMessage:a,plugin:r,plugins:o,initialResponse:l,isRegenerate:c=!1}=n,d=e??"";i(!0);const u=Date.now();u-b.current>7e3&&(p({message:"composing",isStatus:!0}),b.current=u),t(c?[...s,{...l,text:d,plugin:r??null,plugins:o??[]}]:[...s,a,{...l,text:d,plugin:r??null,plugins:o??[]}])},[t,p,i]),I=n.useCallback((n,s)=>{const{requestMessage:a,responseMessage:l,conversation:c}=n,{messages:d,isRegenerate:m=!1}=s,p=c??s.conversation;if(m){const e=[...d,l].filter(e=>e);t(e)}else{const e=[...d,a,l].filter(e=>e);t(e)}const h=c.conversationId!==s.conversation.conversationId;h&&sp(u,s.conversation.conversationId),e&&h&&a.parentMessageId===Zc.NO_PARENT&&setTimeout(()=>{e.mutate({conversationId:p.conversationId})},2500),o&&!r&&o(e=>({...e,...p})),i(!1)},[t,o,e,r,u,i]),E=n.useCallback((e,n)=>{const{conversationId:s,thread_id:a,responseMessage:i,requestMessage:l}=e,{initialResponse:m,messages:h,userMessage:x}=n,f=h.filter(e=>e.messageId!==x.messageId);t([...f,l,{...m,...i}]),p({message:"start",isStatus:!0});let g={};o&&!r?(o(e=>{const t=l.parentMessageId,n=Pb({parentId:t,queryClient:u,conversationId:s,currentTitle:null==e?void 0:e.title});return g=el.parse({...e,conversationId:s,thread_id:a,title:n,messages:[l.messageId,i.messageId]}),g}),l.parentMessageId===Zc.NO_PARENT?tp(u,g):np(u,g.conversationId,e=>g)):o&&o(e=>(g=el.parse({...e,conversationId:s,thread_id:a,messages:[l.messageId,i.messageId]}),g)),c(!0),d&&d()},[u,t,r,p,o,c,d]),P=n.useCallback((e,n)=>{const{messages:s,userMessage:a,isRegenerate:i=!1,isTemporary:l=!1}=n,c={...n.initialResponse,parentMessageId:a.messageId,messageId:a.messageId+"_"};t(i?[...s,c]:[...s,a,c]);const{conversationId:m,parentMessageId:f}=a;b.current=Date.now(),p({message:"start",isStatus:!0});let g={};m&&h(m,n.conversation.conversationId),o&&!r?(o(e=>{const t=i?a.overrideParentMessageId:f,n=Pb({parentId:t,queryClient:u,conversationId:m,currentTitle:null==e?void 0:e.title});return g=el.parse({...e,conversationId:m,title:n}),g}),l||(f===Zc.NO_PARENT?tp(u,g):np(u,g.conversationId,e=>g))):o&&o(e=>(g=el.parse({...e,conversationId:m}),g)),d&&d(),(e=>{const t=document.getElementById("messages-end");t&&(t.scrollIntoView({behavior:"instant"}),e&&e())})(()=>x(!1))},[t,u,x,r,p,o,d,h]),L=n.useCallback((n,l)=>{const{requestMessage:d,responseMessage:m,conversation:h,runMessages:x}=n,{messages:v,conversation:b,isRegenerate:y=!1,isTemporary:_=!1}=l;c(!1),a(e=>new Set(e.add(l.initialResponse.messageId)));const j=s();if(!j||0===j.length)return void i(!1);var w;p({message:"end",isStatus:!0}),p({message:(w=m,w?w.text?w.text:w.content&&w.content.length>0?w.content.filter(e=>e.type===td.TEXT).map(e=>("string"==typeof e.text?e.text:e.text.value)||"").filter(e=>e.length>0).join("\n"):"":"")});let N=[];x?N=[...x]:y&&m?N=[...v,m]:null!=d&&null!=m&&(N=[...v,d,m]),N.length>0?(t(N),u.setQueryData([Pd.messages,h.conversationId],N)):!ji(b.endpoint)||b.conversationId&&b.conversationId!==Zc.NEW_CONVO||u.setQueryData([Pd.messages,h.conversationId],[...j]);const C=h.conversationId!==b.conversationId;C&&sp(u,b.conversationId),e&&C&&!_&&d&&d.parentMessageId===Zc.NO_PARENT&&setTimeout(()=>{e.mutate({conversationId:h.conversationId})},2500),o&&!0!==r&&(o(e=>{const t={...e,...h};null!=(null==e?void 0:e.model)&&e.model!==b.model&&(t.model=e.model);return u.getQueryData([Pd.conversation,h.conversationId])||u.setQueryData([Pd.conversation,h.conversationId],t),t}),"/c/new"===g.pathname&&f(`/c/${h.conversationId}`,{replace:!0})),i(!1)},[c,a,s,p,e,o,r,i,t,u,g.pathname,f]),A=n.useCallback(({data:e,submission:n})=>{var r;const{messages:o,userMessage:c,initialResponse:d}=n;a(e=>new Set(e.add(d.messageId)));const m=c.conversationId??(null==(r=n.conversation)?void 0:r.conversationId)??"",p=(e,n)=>{const s=[...o,c,n];t(s),u.setQueryData([Pd.messages,e],s)},h=e=>{const t=e.responseMessage??e,n={...d,...t,error:!0,parentMessageId:c.messageId};return void 0!==n.messageId&&""!==n.messageId||(n.messageId=S()),Qi.parse(n)};if(!e){const e=m||`_${S()}`,t=h({text:"Error connecting to server, try refreshing the page.",...n,conversationId:e});return p(e,Mb({errorMetadata:t,getMessages:s,submission:n})),l&&l({template:{conversationId:e},preset:Xi.parse(n.conversation)}),void i(!1)}const x=e.conversationId??"";if(!m&&!x){const t=`_${S()}`;return p(t,h(e)),l&&l({template:{conversationId:t},preset:Xi.parse(n.conversation)}),void i(!1)}if(!x){return p(m,h(e)),void i(!1)}p(x,Qi.parse({...e,error:!0,parentMessageId:c.messageId})),x&&_===Zc.NEW_CONVO&&l&&l({template:{conversationId:x},preset:Xi.parse(n.conversation)}),i(!1)},[a,t,_,l,i,s,u]),O=n.useCallback(async(e="",n,a)=>{var r;const o=`${e}:${(null==(r=null==a?void 0:a[a.length-1])?void 0:r.messageId)??""}`,{endpoint:c,endpointType:d}=n.conversation??{},u=d??c;if(!ji(u)&&null!=(null==a?void 0:a[a.length-1])&&null!=a[a.length-2]){let t=a[a.length-2];const s=a[a.length-1];if(t.messageId!==s.parentMessageId)for(let e=a.length-3;e>=0;e--)if(a[e].messageId===s.parentMessageId){t=a[e];break}return void L({conversation:{conversationId:e},requestMessage:t,responseMessage:s},n)}if(!ji(u)){const t=e||`_${S()}`;return Dp.log("conversation","Aborted conversation with minimal messages, ID: "+t),l&&l({template:{conversationId:t},preset:Xi.parse(n.conversation)}),void i(!1)}try{const e=await fetch(`${$c[u??""]}/abort`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`},body:JSON.stringify({abortKey:o,endpoint:u})}),t=e.headers.get("content-type");if(null!=t&&t.includes("application/json")){const t=await e.json();if(404===e.status)return void i(!1);!0===t.final?L(t,n):I(t,n)}else{if(204!==e.status&&200!==e.status)throw new Error("Unexpected response from server; Status: "+e.status+" "+e.statusText);i(!1)}}catch(m){const a=Mb({getMessages:s,submission:n,error:m});t([...n.messages,n.userMessage,a]),l&&l({template:{conversationId:e||a.conversationId||S()},preset:Xi.parse(n.conversation)}),i(!1)}},[L,l,i,j,I,s,t]);return{stepHandler:C,syncHandler:E,finalHandler:L,errorHandler:A,messageHandler:R,contentHandler:w,createdHandler:P,attachmentHandler:T,abortConversation:O}}function Ab(e,t,s=!1,a=0){var r;const o=(()=>{const e=Aa();return Oa(e=>Cu(e),{onSuccess:(t,n)=>{e.setQueryData([Pd.conversation,n.conversationId],e=>e?{...e,title:t.title}:e),np(e,n.conversationId,e=>({...e,title:t.title})),document.title=t.title}})})(),i=y(sx.activeRunFamily(a)),{token:l,isAuthenticated:c}=Rg(),[d,u]=n.useState(new Set),m=y(sx.abortScrollFamily(a)),p=y(sx.showStopButtonByIndex(a)),{setMessages:h,getMessages:x,setConversation:f,setIsSubmitting:g,newConversation:v,resetLatestMessage:b}=t,{stepHandler:_,syncHandler:j,finalHandler:w,errorHandler:N,messageHandler:C,contentHandler:k,createdHandler:T,attachmentHandler:R,abortConversation:I}=Lb({genTitle:o,setMessages:h,getMessages:x,setCompleted:u,isAddedRequest:s,setConversation:f,setIsSubmitting:g,newConversation:v,setShowStopButton:p,resetLatestMessage:b}),{data:E}=Sx(),M=Bx({enabled:!!c&&(null==(r=null==E?void 0:E.balance)?void 0:r.enabled)});n.useEffect(()=>{if(null==e||0===Object.keys(e).length)return;let{userMessage:t}=e;const n=function(e){const{conversation:t,userMessage:n,endpointOption:s,isEdited:a,isContinued:r,isTemporary:o,ephemeralAgent:i}=e,{conversationId:l}=el.parse(t),{endpoint:c}=s,d=c;let u=`${$c[vi.agents]}/${d}`;return a&&ji(d)&&(u+="/modify"),{server:u,payload:{...n,...s,endpoint:d,ephemeralAgent:ji(d)?void 0:i,isContinued:!(!a||!r),conversationId:l,isTemporary:o}}}(e);let{payload:s}=n;s=ol(s);const a=new W(n.server,{payload:JSON.stringify(s),headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}});return a.addEventListener("attachment",t=>{try{const n=JSON.parse(t.data);R({data:n,submission:e})}catch(n){console.error(n)}}),a.addEventListener("message",n=>{var s,a;const r=JSON.parse(n.data);if(null!=r.final){(o=null==(s=e.conversation)?void 0:s.conversationId)?(localStorage.removeItem(`${Jc.TEXT_DRAFT}${o}`),localStorage.removeItem(`${Jc.FILES_DRAFT}${o}`)):(localStorage.removeItem(`${Jc.TEXT_DRAFT}${Zc.NEW_CONVO}`),localStorage.removeItem(`${Jc.FILES_DRAFT}${Zc.NEW_CONVO}`));const{plugins:t}=r;return w(r,{...e,plugins:t}),(null==(a=null==E?void 0:E.balance)?void 0:a.enabled)&&M.refetch(),void console.log("final",r)}if(null!=r.created){const n=S();i(n),t={...t,...r.message,overrideParentMessageId:t.overrideParentMessageId},T(r,{...e,userMessage:t})}else if(null!=r.event)_(r,{...e,userMessage:t});else if(null!=r.sync){const n=S();i(n),j(r,{...e,userMessage:t})}else if(null!=r.type){const{text:t,index:n}=r;k({data:r,submission:e})}else{const n=r.text??r.response,{plugin:s,plugins:a}=r,o={...e.initialResponse,parentMessageId:r.parentMessageId,messageId:r.messageId};null!=r.message&&C(n,{...e,plugin:s,plugins:a,userMessage:t,initialResponse:o})}var o}),a.addEventListener("open",()=>{m(!1),console.log("connection is opened")}),a.addEventListener("cancel",async()=>{var n,s,a;const r=null==(n=null==e?void 0:e.initialResponse)?void 0:n.messageId;if(d.has(r))return g(!1),void u(e=>(e.delete(r),new Set(e)));u(e=>new Set(e.add(r)));const o=x(),i=null==(s=null==o?void 0:o[o.length-1])?void 0:s.conversationId;return await I(i??t.conversationId??(null==(a=e.conversation)?void 0:a.conversationId)??"",e,o)}),a.addEventListener("error",async n=>{var s;if(401===n.responseCode)try{const e=await ou.refreshToken(),t=(null==e?void 0:e.token)??"";if(!t)throw new Error("Token refresh failed.");return a.headers={"Content-Type":"application/json",Authorization:`Bearer ${t}`},ou.dispatchTokenUpdatedEvent(t),void a.stream()}catch(o){console.log(o)}let r;console.log("error in server stream."),(null==(s=null==E?void 0:E.balance)?void 0:s.enabled)&&M.refetch();try{r=JSON.parse(n.data)}catch(o){console.error(o),console.log(n),g(!1)}N({data:r,submission:{...e,userMessage:t}})}),g(!0),a.stream(),()=>{const e=a.readyState<=1;if(a.close(),e){const e=new Event("cancel");a.dispatchEvent(e)}}},[e])}const Ob=m.createContext(void 0),Db=({value:e,children:t})=>{const[s,a]=n.useState(!1);return l.jsx(Ob.Provider,{value:e??{error:s,setError:a},children:t})},zb=()=>{const e=m.useContext(Ob);if(void 0===e)throw new Error("useApiErrorBoundary must be used inside ApiErrorBoundaryProvider");return e};function Fb({className:e=""}){return l.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",xmlns:"http://www.w3.org/2000/svg",className:Op("lucide lucide-blocks",e),children:[l.jsx("rect",{width:"7",height:"7",x:"14",y:"3",rx:"1"}),l.jsx("path",{d:"M10 21V8a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-5a1 1 0 0 0-1-1H3"})]})}function Vb({className:e="",...t}){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"none",className:Op("h-4 w-4",e),width:"16",height:"16",strokeWidth:"2",...t,children:l.jsxs("g",{fill:"currentColor",children:[l.jsx("path",{d:"M13.164.98a.7.7 0 0 0-1.328 0l-.478 1.435a.7.7 0 0 1-.443.443l-1.436.478a.7.7 0 0 0 0 1.328l1.436.479a.7.7 0 0 1 .443.442l.478 1.436a.7.7 0 0 0 1.328 0l.478-1.436a.7.7 0 0 1 .443-.443l1.436-.478a.7.7 0 0 0 0-1.328l-1.436-.478a.7.7 0 0 1-.443-.443L13.164.979Z"}),l.jsx("path",{d:"M13.237 10.534c-.228-.245-.513-.46-.847-.46a.823.823 0 0 0-.828.849c.04 1.04.128 2.067.263 3.08a.619.619 0 0 1-.528.695c-.872.121-1.748.208-2.626.262a.8.8 0 0 1-.845-.805c0-.325.21-.602.45-.82.235-.215.375-.488.375-.787 0-.683-.738-1.237-1.65-1.237-.911 0-1.65.554-1.65 1.237 0 .294.137.563.364.775.245.229.461.513.461.848a.823.823 0 0 1-.85.829 33.809 33.809 0 0 1-3.266-.278.619.619 0 0 1-.532-.532 34.099 34.099 0 0 1-.278-3.267.823.823 0 0 1 .83-.85c.333 0 .619.216.846.461.212.228.482.364.776.364.683 0 1.237-.738 1.237-1.65 0-.91-.554-1.65-1.237-1.65-.299 0-.572.142-.786.376-.219.24-.496.45-.821.45a.8.8 0 0 1-.805-.845c.054-.885.142-1.76.262-2.626a.619.619 0 0 1 .695-.528c1.022.136 2.05.224 3.08.263a.822.822 0 0 0 .85-.828c0-.334-.217-.62-.462-.847-.227-.212-.363-.482-.363-.776C5.352 1.554 6.09 1 7.002 1c.91 0 1.649.554 1.649 1.237 0 .173-.012.327-.029.473C8.258 3 8 3.41 8 4c0 1.5 1.667 1.833 2.5 2 .167.833.5 2.5 2 2.5.732 0 1.186-.397 1.479-.9l.034-.001c.683 0 1.237.738 1.237 1.65 0 .911-.554 1.65-1.237 1.65-.294 0-.564-.137-.776-.364Z"})]})})}function $b({size:e=25,className:t=""}){const n=e,s=e;return l.jsx("svg",{width:s,height:n,viewBox:"0 0 41 41",fill:"none",xmlns:"http://www.w3.org/2000/svg",strokeWidth:"1.5",className:Op(t,""),children:l.jsx("path",{d:"M37.5324 16.8707C37.9808 15.5241 38.1363 14.0974 37.9886 12.6859C37.8409 11.2744 37.3934 9.91076 36.676 8.68622C35.6126 6.83404 33.9882 5.3676 32.0373 4.4985C30.0864 3.62941 27.9098 3.40259 25.8215 3.85078C24.8796 2.7893 23.7219 1.94125 22.4257 1.36341C21.1295 0.785575 19.7249 0.491269 18.3058 0.500197C16.1708 0.495044 14.0893 1.16803 12.3614 2.42214C10.6335 3.67624 9.34853 5.44666 8.6917 7.47815C7.30085 7.76286 5.98686 8.3414 4.8377 9.17505C3.68854 10.0087 2.73073 11.0782 2.02839 12.312C0.956464 14.1591 0.498905 16.2988 0.721698 18.4228C0.944492 20.5467 1.83612 22.5449 3.268 24.1293C2.81966 25.4759 2.66413 26.9026 2.81182 28.3141C2.95951 29.7256 3.40701 31.0892 4.12437 32.3138C5.18791 34.1659 6.8123 35.6322 8.76321 36.5013C10.7141 37.3704 12.8907 37.5973 14.9789 37.1492C15.9208 38.2107 17.0786 39.0587 18.3747 39.6366C19.6709 40.2144 21.0755 40.5087 22.4946 40.4998C24.6307 40.5054 26.7133 39.8321 28.4418 38.5772C30.1704 37.3223 31.4556 35.5506 32.1119 33.5179C33.5027 33.2332 34.8167 32.6547 35.9659 31.821C37.115 30.9874 38.0728 29.9178 38.7752 28.684C39.8458 26.8371 40.3023 24.6979 40.0789 22.5748C39.8556 20.4517 38.9639 18.4544 37.5324 16.8707ZM22.4978 37.8849C20.7443 37.8874 19.0459 37.2733 17.6994 36.1501C17.7601 36.117 17.8666 36.0586 17.936 36.0161L25.9004 31.4156C26.1003 31.3019 26.2663 31.137 26.3813 30.9378C26.4964 30.7386 26.5563 30.5124 26.5549 30.2825V19.0542L29.9213 20.998C29.9389 21.0068 29.9541 21.0198 29.9656 21.0359C29.977 21.052 29.9842 21.0707 29.9867 21.0902V30.3889C29.9842 32.375 29.1946 34.2791 27.7909 35.6841C26.3872 37.0892 24.4838 37.8806 22.4978 37.8849ZM6.39227 31.0064C5.51397 29.4888 5.19742 27.7107 5.49804 25.9832C5.55718 26.0187 5.66048 26.0818 5.73461 26.1244L13.699 30.7248C13.8975 30.8408 14.1233 30.902 14.3532 30.902C14.583 30.902 14.8088 30.8408 15.0073 30.7248L24.731 25.1103V28.9979C24.7321 29.0177 24.7283 29.0376 24.7199 29.0556C24.7115 29.0736 24.6988 29.0893 24.6829 29.1012L16.6317 33.7497C14.9096 34.7416 12.8643 35.0097 10.9447 34.4954C9.02506 33.9811 7.38785 32.7263 6.39227 31.0064ZM4.29707 13.6194C5.17156 12.0998 6.55279 10.9364 8.19885 10.3327C8.19885 10.4013 8.19491 10.5228 8.19491 10.6071V19.808C8.19351 20.0378 8.25334 20.2638 8.36823 20.4629C8.48312 20.6619 8.64893 20.8267 8.84863 20.9404L18.5723 26.5542L15.206 28.4979C15.1894 28.5089 15.1703 28.5155 15.1505 28.5173C15.1307 28.5191 15.1107 28.516 15.0924 28.5082L7.04046 23.8557C5.32135 22.8601 4.06716 21.2235 3.55289 19.3046C3.03862 17.3858 3.30624 15.3413 4.29707 13.6194ZM31.955 20.0556L22.2312 14.4411L25.5976 12.4981C25.6142 12.4872 25.6333 12.4805 25.6531 12.4787C25.6729 12.4769 25.6928 12.4801 25.7111 12.4879L33.7631 17.1364C34.9967 17.849 36.0017 18.8982 36.6606 20.1613C37.3194 21.4244 37.6047 22.849 37.4832 24.2684C37.3617 25.6878 36.8382 27.0432 35.9743 28.1759C35.1103 29.3086 33.9415 30.1717 32.6047 30.6641C32.6047 30.5947 32.6047 30.4733 32.6047 30.3889V21.188C32.6066 20.9586 32.5474 20.7328 32.4332 20.5338C32.319 20.3348 32.154 20.1698 31.955 20.0556ZM35.3055 15.0128C35.2464 14.9765 35.1431 14.9142 35.069 14.8717L27.1045 10.2712C26.906 10.1554 26.6803 10.0943 26.4504 10.0943C26.2206 10.0943 25.9948 10.1554 25.7963 10.2712L16.0726 15.8858V11.9982C16.0715 11.9783 16.0753 11.9585 16.0837 11.9405C16.0921 11.9225 16.1048 11.9068 16.1207 11.8949L24.1719 7.25025C25.4053 6.53903 26.8158 6.19376 28.2383 6.25482C29.6608 6.31589 31.0364 6.78077 32.2044 7.59508C33.3723 8.40939 34.2842 9.53945 34.8334 10.8531C35.3826 12.1667 35.5464 13.6095 35.3055 15.0128ZM14.2424 21.9419L10.8752 19.9981C10.8576 19.9893 10.8423 19.9763 10.8309 19.9602C10.8195 19.9441 10.8122 19.9254 10.8098 19.9058V10.6071C10.8107 9.18295 11.2173 7.78848 11.9819 6.58696C12.7466 5.38544 13.8377 4.42659 15.1275 3.82264C16.4173 3.21869 17.8524 2.99464 19.2649 3.1767C20.6775 3.35876 22.0089 3.93941 23.1034 4.85067C23.0427 4.88379 22.937 4.94215 22.8668 4.98473L14.9024 9.58517C14.7025 9.69878 14.5366 9.86356 14.4215 10.0626C14.3065 10.2616 14.2466 10.4877 14.2479 10.7175L14.2424 21.9419ZM16.071 17.9991L20.4018 15.4978L24.7325 17.9975V22.9985L20.4018 25.4983L16.071 22.9985V17.9991Z",fill:"currentColor"})})}const Bb=m.forwardRef((e,t)=>{const{className:n="icon-md",size:s="1.2em"}=e;return l.jsx("svg",{ref:t,fill:"none",strokeWidth:"2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",height:s,width:s,className:Op(n),children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13.2929 4.29291C15.0641 2.52167 17.9359 2.52167 19.7071 4.2929C21.4783 6.06414 21.4783 8.93588 19.7071 10.7071L18.7073 11.7069L11.1603 19.2539C10.7182 19.696 10.1489 19.989 9.53219 20.0918L4.1644 20.9864C3.84584 21.0395 3.52125 20.9355 3.29289 20.7071C3.06453 20.4788 2.96051 20.1542 3.0136 19.8356L3.90824 14.4678C4.01103 13.8511 4.30396 13.2818 4.7461 12.8397L13.2929 4.29291ZM13 7.41422L6.16031 14.2539C6.01293 14.4013 5.91529 14.591 5.88102 14.7966L5.21655 18.7835L9.20339 18.119C9.40898 18.0847 9.59872 17.9871 9.7461 17.8397L16.5858 11L13 7.41422ZM18 9.5858L14.4142 6.00001L14.7071 5.70712C15.6973 4.71693 17.3027 4.71693 18.2929 5.70712C19.2831 6.69731 19.2831 8.30272 18.2929 9.29291L18 9.5858Z",fill:"currentColor"})})});function Ub({className:e="icon-sm"}){return l.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.00633 5.5C6.02321 5.53319 6.07042 5.60366 6.19525 5.70906C6.42458 5.9027 6.81573 6.12215 7.38659 6.32603C8.5196 6.73067 10.1506 7 12 7C13.8494 7 15.4804 6.73067 16.6134 6.32603C17.1843 6.12215 17.5754 5.9027 17.8048 5.70906C17.9296 5.60366 17.9768 5.53319 17.9937 5.5C17.9768 5.46681 17.9296 5.39634 17.8048 5.29094C17.5754 5.0973 17.1843 4.87785 16.6134 4.67397C15.4804 4.26933 13.8494 4 12 4C10.1506 4 8.5196 4.26933 7.38659 4.67397C6.81573 4.87785 6.42458 5.0973 6.19525 5.29094C6.07042 5.39634 6.02321 5.46681 6.00633 5.5ZM18 7.91726C17.7726 8.02403 17.5333 8.12123 17.2861 8.20951C15.8856 8.70968 14.0166 9 12 9C9.98341 9 8.1144 8.70968 6.71392 8.20951C6.46674 8.12123 6.22738 8.02403 6 7.91726V11.9866C6.00813 12.0073 6.03931 12.0661 6.14259 12.1624C6.31976 12.3277 6.63181 12.5252 7.10609 12.7189C8.04837 13.1039 9.43027 13.3932 11.051 13.476C11.6026 13.5042 12.0269 13.9741 11.9987 14.5257C11.9705 15.0773 11.5005 15.5016 10.949 15.4734C9.17744 15.3829 7.55934 15.0646 6.34969 14.5704C6.23097 14.5219 6.11419 14.4709 6 14.4173V18.4866C6.00813 18.5073 6.03931 18.5661 6.14259 18.6624C6.31976 18.8277 6.63181 19.0252 7.10609 19.2189C8.04837 19.6039 9.43027 19.8932 11.051 19.976C11.6026 20.0042 12.0269 20.4741 11.9987 21.0257C11.9705 21.5773 11.5005 22.0016 10.949 21.9734C9.17744 21.8829 7.55934 21.5646 6.34969 21.0704C5.74801 20.8246 5.19611 20.5146 4.77833 20.1249C4.35948 19.7341 4 19.1866 4 18.5V5.5C4 4.74631 4.43048 4.16346 4.90494 3.76283C5.38405 3.35829 6.01803 3.03902 6.71392 2.79049C8.1144 2.29032 9.98341 2 12 2C14.0166 2 15.8856 2.29032 17.2861 2.79049C17.982 3.03902 18.616 3.35829 19.0951 3.76283C19.5695 4.16346 20 4.74631 20 5.5V10C20 10.5523 19.5523 11 19 11C18.4477 11 18 10.5523 18 10V7.91726ZM17.5 13C18.0523 13 18.5 13.4477 18.5 14V14.6707C18.851 14.7948 19.172 14.9823 19.4492 15.2195L20.0308 14.8837C20.5091 14.6075 21.1207 14.7714 21.3968 15.2497C21.673 15.728 21.5091 16.3396 21.0308 16.6157L20.4499 16.9511C20.4828 17.1291 20.5 17.3125 20.5 17.5C20.5 17.6873 20.4828 17.8707 20.45 18.0485L21.0308 18.3838C21.5091 18.6599 21.6729 19.2715 21.3968 19.7498C21.1206 20.2281 20.5091 20.392 20.0308 20.1158L19.4495 19.7803C19.1722 20.0176 18.8511 20.2052 18.5 20.3293V21C18.5 21.5523 18.0523 22 17.5 22C16.9477 22 16.5 21.5523 16.5 21V20.3293C16.1489 20.2052 15.8277 20.0176 15.5504 19.7802L14.969 20.1159C14.4907 20.392 13.8791 20.2282 13.603 19.7499C13.3269 19.2716 13.4907 18.66 13.969 18.3839L14.55 18.0484C14.5172 17.8706 14.5 17.6873 14.5 17.5C14.5 17.3127 14.5172 17.1294 14.55 16.9515L13.9691 16.6161C13.4908 16.34 13.3269 15.7284 13.6031 15.2501C13.8792 14.7718 14.4908 14.608 14.9691 14.8841L15.5504 15.2197C15.8278 14.9824 16.1489 14.7948 16.5 14.6707V14C16.5 13.4477 16.9477 13 17.5 13ZM16.624 17.0174C16.6274 17.0117 16.6308 17.0059 16.6342 17.0001C16.6374 16.9946 16.6405 16.989 16.6436 16.9834C16.8187 16.6937 17.1367 16.5 17.5 16.5C17.8645 16.5 18.1835 16.6951 18.3583 16.9865C18.3607 16.9909 18.3632 16.9953 18.3658 16.9997C18.3685 17.0044 18.3713 17.0091 18.3741 17.0138C18.4543 17.1577 18.5 17.3235 18.5 17.5C18.5 17.6737 18.4557 17.8371 18.3778 17.9794C18.3737 17.9861 18.3697 17.9929 18.3657 17.9998C18.3619 18.0064 18.3581 18.0131 18.3545 18.0198C18.1789 18.3077 17.8619 18.5 17.5 18.5C17.1362 18.5 16.8178 18.3058 16.6428 18.0154C16.64 18.0102 16.6371 18.005 16.6341 17.9999C16.631 17.9945 16.6278 17.9891 16.6246 17.9838C16.5452 17.8404 16.5 17.6755 16.5 17.5C16.5 17.325 16.545 17.1605 16.624 17.0174Z",fill:"currentColor"})})}function Hb({className:e}){return l.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.85719 3H15.1428C16.2266 2.99999 17.1007 2.99998 17.8086 3.05782C18.5375 3.11737 19.1777 3.24318 19.77 3.54497C20.7108 4.02433 21.4757 4.78924 21.955 5.73005C22.2568 6.32234 22.3826 6.96253 22.4422 7.69138C22.5 8.39925 22.5 9.27339 22.5 10.3572V13.6428C22.5 14.7266 22.5 15.6008 22.4422 16.3086C22.3826 17.0375 22.2568 17.6777 21.955 18.27C21.4757 19.2108 20.7108 19.9757 19.77 20.455C19.1777 20.7568 18.5375 20.8826 17.8086 20.9422C17.1008 21 16.2266 21 15.1428 21H8.85717C7.77339 21 6.89925 21 6.19138 20.9422C5.46253 20.8826 4.82234 20.7568 4.23005 20.455C3.28924 19.9757 2.52433 19.2108 2.04497 18.27C1.74318 17.6777 1.61737 17.0375 1.55782 16.3086C1.49998 15.6007 1.49999 14.7266 1.5 13.6428V10.3572C1.49999 9.27341 1.49998 8.39926 1.55782 7.69138C1.61737 6.96253 1.74318 6.32234 2.04497 5.73005C2.52433 4.78924 3.28924 4.02433 4.23005 3.54497C4.82234 3.24318 5.46253 3.11737 6.19138 3.05782C6.89926 2.99998 7.77341 2.99999 8.85719 3ZM6.35424 5.05118C5.74907 5.10062 5.40138 5.19279 5.13803 5.32698C4.57354 5.6146 4.1146 6.07354 3.82698 6.63803C3.69279 6.90138 3.60062 7.24907 3.55118 7.85424C3.50078 8.47108 3.5 9.26339 3.5 10.4V13.6C3.5 14.7366 3.50078 15.5289 3.55118 16.1458C3.60062 16.7509 3.69279 17.0986 3.82698 17.362C4.1146 17.9265 4.57354 18.3854 5.13803 18.673C5.40138 18.8072 5.74907 18.8994 6.35424 18.9488C6.97108 18.9992 7.76339 19 8.9 19H9.5V5H8.9C7.76339 5 6.97108 5.00078 6.35424 5.05118ZM11.5 5V19H15.1C16.2366 19 17.0289 18.9992 17.6458 18.9488C18.2509 18.8994 18.5986 18.8072 18.862 18.673C19.4265 18.3854 19.8854 17.9265 20.173 17.362C20.3072 17.0986 20.3994 16.7509 20.4488 16.1458C20.4992 15.5289 20.5 14.7366 20.5 13.6V10.4C20.5 9.26339 20.4992 8.47108 20.4488 7.85424C20.3994 7.24907 20.3072 6.90138 20.173 6.63803C19.8854 6.07354 19.4265 5.6146 18.862 5.32698C18.5986 5.19279 18.2509 5.10062 17.6458 5.05118C17.0289 5.00078 16.2366 5 15.1 5H11.5ZM5 8.5C5 7.94772 5.44772 7.5 6 7.5H7C7.55229 7.5 8 7.94772 8 8.5C8 9.05229 7.55229 9.5 7 9.5H6C5.44772 9.5 5 9.05229 5 8.5ZM5 12C5 11.4477 5.44772 11 6 11H7C7.55229 11 8 11.4477 8 12C8 12.5523 7.55229 13 7 13H6C5.44772 13 5 12.5523 5 12Z",fill:"currentColor"})})}function Kb({className:e}){return l.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 8C3 7.44772 3.44772 7 4 7H20C20.5523 7 21 7.44772 21 8C21 8.55228 20.5523 9 20 9H4C3.44772 9 3 8.55228 3 8ZM3 16C3 15.4477 3.44772 15 4 15H14C14.5523 15 15 15.4477 15 16C15 16.5523 14.5523 17 14 17H4C3.44772 17 3 16.5523 3 16Z",fill:"currentColor"})})}function Gb({className:e="m-auto",size:t=20,color:n="currentColor",bgOpacity:s=.1,speed:a=.75}){const r={"--spinner-speed":`${a}s`};return l.jsxs("svg",{className:Op(e,"spinner"),width:t,height:t,viewBox:"0 0 40 40",xmlns:"http://www.w3.org/2000/svg",style:r,children:[l.jsx("defs",{children:l.jsx("style",{type:"text/css",children:"\n          .spinner {\n            transform-origin: center;\n            overflow: visible;\n            animation: spinner-rotate var(--spinner-speed) linear infinite;\n          }\n          @keyframes spinner-rotate {\n            to { transform: rotate(360deg); }\n          }\n        "})}),l.jsx("circle",{cx:"20",cy:"20",r:"14.5",pathLength:"100",strokeWidth:"5",fill:"none",stroke:n,strokeOpacity:s}),l.jsx("circle",{cx:"20",cy:"20",r:"14.5",pathLength:"100",strokeWidth:"5",fill:"none",stroke:n,strokeDasharray:"25 75",strokeLinecap:"round"})]})}function Wb({className:e="icon-md-heavy",size:t="1em"}){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:Op(e),children:l.jsx("path",{fill:"currentColor",fillRule:"evenodd",d:"M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z",clipRule:"evenodd"})})}function qb({className:e=""}){return l.jsx("svg",{fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:Op("h-4 w-4",e),height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.0633 5.67375C18.5196 5.98487 18.6374 6.607 18.3262 7.06331L10.8262 18.0633C10.6585 18.3093 10.3898 18.4678 10.0934 18.4956C9.79688 18.5234 9.50345 18.4176 9.29289 18.2071L4.79289 13.7071C4.40237 13.3166 4.40237 12.6834 4.79289 12.2929C5.18342 11.9023 5.81658 11.9023 6.20711 12.2929L9.85368 15.9394L16.6738 5.93664C16.9849 5.48033 17.607 5.36263 18.0633 5.67375Z",fill:"currentColor"})})}function Qb({className:e=""}){return l.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:Op(e,"h-4 w-4"),height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[l.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),l.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}function Zb({size:e=25,className:t=""}){return l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:Op("lucide lucide-bot",t),children:[l.jsx("path",{d:"M12 8V4H8"}),l.jsx("rect",{width:"16",height:"12",x:"4",y:"8",rx:"2"}),l.jsx("path",{d:"M2 14h2"}),l.jsx("path",{d:"M20 14h2"}),l.jsx("path",{d:"M15 13v2"}),l.jsx("path",{d:"M9 13v2"})]})}function Jb({className:e=""}){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor","aria-hidden":"true",className:Op("h-6 w-6",e),children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z"})})}function Yb({className:e=""}){return l.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9 7C9 4.23858 11.2386 2 14 2C16.7614 2 19 4.23858 19 7V15C19 18.866 15.866 22 12 22C8.13401 22 5 18.866 5 15V9C5 8.44772 5.44772 8 6 8C6.55228 8 7 8.44772 7 9V15C7 17.7614 9.23858 20 12 20C14.7614 20 17 17.7614 17 15V7C17 5.34315 15.6569 4 14 4C12.3431 4 11 5.34315 11 7V15C11 15.5523 11.4477 16 12 16C12.5523 16 13 15.5523 13 15V9C13 8.44772 13.4477 8 14 8C14.5523 8 15 8.44772 15 9V15C15 16.6569 13.6569 18 12 18C10.3431 18 9 16.6569 9 15V7Z",fill:"currentColor"})})}function Xb({className:e}){return l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:Op(e??"","lucide lucide-messages-square"),children:[l.jsx("path",{d:"M14 9a2 2 0 0 1-2 2H6l-4 4V4c0-1.1.9-2 2-2h8a2 2 0 0 1 2 2v5Z"}),l.jsx("path",{d:"M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1"})]})}function ey({className:e="",size:t="1em"}){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:Op("icon-md-heavy",e),children:l.jsx("path",{fill:"currentColor",d:"M3.07 10.876C3.623 6.436 7.41 3 12 3a9.15 9.15 0 0 1 6.012 2.254V4a1 1 0 1 1 2 0v4a1 1 0 0 1-1 1H15a1 1 0 1 1 0-2h1.957A7.15 7.15 0 0 0 12 5a7 7 0 0 0-6.946 6.124 1 1 0 1 1-1.984-.248m16.992 1.132a1 1 0 0 1 .868 1.116C20.377 17.564 16.59 21 12 21a9.15 9.15 0 0 1-6-2.244V20a1 1 0 1 1-2 0v-4a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2H7.043A7.15 7.15 0 0 0 12 19a7 7 0 0 0 6.946-6.124 1 1 0 0 1 1.116-.868"})})}function ty({className:e=""}){return l.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:Op("h-3 w-3 -rotate-180",e),height:"19",width:"19",xmlns:"http://www.w3.org/2000/svg",children:[l.jsx("polygon",{points:"11 19 2 12 11 5 11 19"}),l.jsx("polygon",{points:"22 19 13 12 22 5 22 19"})]})}function ny(){return l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",id:"google",className:"h-5 w-5",children:[l.jsx("path",{fill:"#666666",d:"M113.47 309.408 95.648 375.94l-65.139 1.378C11.042 341.211 0 299.9 0 256c0-42.451 10.324-82.483 28.624-117.732h.014L86.63 148.9l25.404 57.644c-5.317 15.501-8.215 32.141-8.215 49.456.002 18.792 3.406 36.797 9.651 53.408z"}),l.jsx("path",{fill:"#999999",d:"M507.527 208.176C510.467 223.662 512 239.655 512 256c0 18.328-1.927 36.206-5.598 53.451-12.462 58.683-45.025 109.925-90.134 146.187l-.014-.014-73.044-3.727-10.338-64.535c29.932-17.554 53.324-45.025 65.646-77.911h-136.89V208.176h245.899z"}),l.jsx("path",{fill:"#333333",d:"m416.253 455.624.014.014C372.396 490.901 316.666 512 256 512c-97.491 0-182.252-54.491-225.491-134.681l82.961-67.91c21.619 57.698 77.278 98.771 142.53 98.771 28.047 0 54.323-7.582 76.87-20.818l83.383 68.262z"}),l.jsx("path",{fill:"#1a1a1a",d:"m419.404 58.936-82.933 67.896C313.136 112.246 285.552 103.82 256 103.82c-66.729 0-123.429 42.957-143.965 102.724l-83.397-68.276h-.014C71.23 56.123 157.06 0 256 0c62.115 0 119.068 22.126 163.404 58.936z"})]})}function sy(){return l.jsxs("svg",{viewBox:"0 0 40 40",width:"25",height:"25",children:[l.jsxs("linearGradient",{id:"a",x1:-277.375,x2:-277.375,y1:406.602,y2:407.573,gradientTransform:"matrix(40 0 0 -39.7778 11115.001 16212.334)",gradientUnits:"userSpaceOnUse",children:[l.jsx("stop",{offset:0,stopColor:"#0062e0"}),l.jsx("stop",{offset:1,stopColor:"#19afff"})]}),l.jsx("path",{fill:"url(#a)",d:"M16.7 39.8C7.2 38.1 0 29.9 0 20 0 9 9 0 20 0s20 9 20 20c0 9.9-7.2 18.1-16.7 19.8l-1.1-.9h-4.4l-1.1.9z"}),l.jsx("path",{fill:"#fff",d:"m27.8 25.6.9-5.6h-5.3v-3.9c0-1.6.6-2.8 3-2.8H29V8.2c-1.4-.2-3-.4-4.4-.4-4.6 0-7.8 2.8-7.8 7.8V20h-5v5.6h5v14.1c1.1.2 2.2.3 3.3.3 1.1 0 2.2-.1 3.3-.3V25.6h4.4z"})]})}function ay(){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",id:"openid",className:"h-5 w-5",children:l.jsx("path",{fill:"currentColor",d:"M271.5 432l-68 32C88.5 453.7 0 392.5 0 318.2c0-71.5 82.5-131 191.7-144.3v43c-71.5 12.5-124 53-124 101.3 0 51 58.5 93.3 135.7 103v-340l68-33.2v384zM448 291l-131.3-28.5 36.8-20.7c-19.5-11.5-43.5-20-70-24.8v-43c46.2 5.5 87.7 19.5 120.3 39.3l35-19.8L448 291z"})})}function ry(){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",fill:"none",children:l.jsx("path",{fill:"currentColor",d:"M12 0a12 12 0 0 0-3.84 23.399c.608.112.832-.256.832-.576v-2.015c-3.395.736-4.115-1.632-4.115-1.632a3.241 3.241 0 0 0-1.359-1.792c-1.104-.736.064-.736.064-.736a2.566 2.566 0 0 1 1.824 1.216a2.638 2.638 0 0 0 3.616 1.024a2.607 2.607 0 0 1 .768-1.6c-2.688-.32-5.504-1.344-5.504-5.984a4.677 4.677 0 0 1 1.216-3.168a4.383 4.383 0 0 1 .128-3.136s1.024-.32 3.36 1.216a11.66 11.66 0 0 1 6.112 0c2.336-1.536 3.36-1.216 3.36-1.216a4.354 4.354 0 0 1 .128 3.136a4.628 4.628 0 0 1 1.216 3.168c0 4.672-2.848 5.664-5.536 5.952a2.881 2.881 0 0 1 .832 2.24v3.36c0 .32.224.672.832.576A12 12 0 0 0 12 0z"})})}function oy(){return l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",id:"discord",className:"h-6 w-6",children:[l.jsx("circle",{cx:"512",cy:"512",r:"512",fill:"#333333"}),l.jsx("path",{fill:"#fff",d:"M689.43 349a422.21 422.21 0 0 0-104.22-32.32 1.58 1.58 0 0 0-1.68.79 294.11 294.11 0 0 0-13 26.66 389.78 389.78 0 0 0-117.05 0 269.75 269.75 0 0 0-13.18-26.66 1.64 1.64 0 0 0-1.68-.79A421 421 0 0 0 334.44 349a1.49 1.49 0 0 0-.69.59c-66.37 99.17-84.55 195.9-75.63 291.41a1.76 1.76 0 0 0 .67 1.2 424.58 424.58 0 0 0 127.85 64.63 1.66 1.66 0 0 0 1.8-.59 303.45 303.45 0 0 0 26.15-42.54 1.62 1.62 0 0 0-.89-2.25 279.6 279.6 0 0 1-39.94-19 1.64 1.64 0 0 1-.16-2.72c2.68-2 5.37-4.1 7.93-6.22a1.58 1.58 0 0 1 1.65-.22c83.79 38.26 174.51 38.26 257.31 0a1.58 1.58 0 0 1 1.68.2c2.56 2.11 5.25 4.23 8 6.24a1.64 1.64 0 0 1-.14 2.72 262.37 262.37 0 0 1-40 19 1.63 1.63 0 0 0-.87 2.28 340.72 340.72 0 0 0 26.13 42.52 1.62 1.62 0 0 0 1.8.61 423.17 423.17 0 0 0 128-64.63 1.64 1.64 0 0 0 .67-1.18c10.68-110.44-17.88-206.38-75.7-291.42a1.3 1.3 0 0 0-.63-.63zM427.09 582.85c-25.23 0-46-23.16-46-51.6s20.38-51.6 46-51.6c25.83 0 46.42 23.36 46 51.6.02 28.44-20.37 51.6-46 51.6zm170.13 0c-25.23 0-46-23.16-46-51.6s20.38-51.6 46-51.6c25.83 0 46.42 23.36 46 51.6.01 28.44-20.17 51.6-46 51.6z"})]})}function iy(){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",viewBox:"0 0 814 1000",id:"apple",className:"h-6 w-6",children:l.jsx("path",{d:"M788.1 340.9c-5.8 4.5-108.2 62.2-108.2 190.5 0 148.4 130.3 200.9 134.2 202.2-.6 3.2-20.7 71.9-68.7 141.9-42.8 61.6-87.5 123.1-155.5 123.1s-85.5-39.5-164-39.5c-76.5 0-103.7 40.8-165.9 40.8s-105.6-57-155.5-127C46.7 790.7 0 663 0 541.8c0-194.4 126.4-297.5 250.8-297.5 66.1 0 121.2 43.4 162.7 43.4 39.5 0 101.1-46 176.3-46 28.5 0 130.9 2.6 198.3 99.2zm-234-181.5c31.1-36.9 53.1-88.1 53.1-139.3 0-7.1-.6-14.3-1.9-20.1-50.6 1.9-110.8 33.7-147.1 75.8-28.5 32.4-55.1 83.6-55.1 135.5 0 7.8 1.3 15.6 1.9 18.1 3.2.6 8.4 1.3 13.6 1.3 45.4 0 102.5-30.4 135.5-71.3z",fill:"currentColor"})})}function ly(){return l.jsx("svg",{width:"800px",height:"800px",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",fill:"none",className:"h-5 w-5",children:l.jsxs("g",{fill:"#000000",children:[l.jsx("path",{d:"M7.754 2l.463.41c.343.304.687.607 1.026.915C11.44 5.32 13.3 7.565 14.7 10.149c.072.132.137.268.202.403l.098.203-.108.057-.081-.115-.21-.299-.147-.214c-1.019-1.479-2.04-2.96-3.442-4.145a6.563 6.563 0 00-1.393-.904c-1.014-.485-1.916-.291-2.69.505-.736.757-1.118 1.697-1.463 2.653-.045.123-.092.245-.139.367l-.082.215-.172-.055c.1-.348.192-.698.284-1.049.21-.795.42-1.59.712-2.356.31-.816.702-1.603 1.093-2.39.169-.341.338-.682.5-1.025h.092z"}),l.jsx("path",{d:"M8.448 11.822c-1.626.77-5.56 1.564-7.426 1.36C.717 11.576 3.71 4.05 5.18 2.91l-.095.218a4.638 4.638 0 01-.138.303l-.066.129c-.76 1.462-1.519 2.926-1.908 4.53a7.482 7.482 0 00-.228 1.689c-.01 1.34.824 2.252 2.217 2.309.67.027 1.347-.043 2.023-.114.294-.03.587-.061.88-.084.108-.008.214-.021.352-.039l.231-.028z"}),l.jsx("path",{d:"M3.825 14.781c-.445.034-.89.068-1.333.108 4.097.39 8.03-.277 11.91-1.644-1.265-2.23-2.97-3.991-4.952-5.522.026.098.084.169.141.239l.048.06c.17.226.348.448.527.67.409.509.818 1.018 1.126 1.578.778 1.42.356 2.648-1.168 3.296-1.002.427-2.097.718-3.18.892-1.03.164-2.075.243-3.119.323z"})]})})}function cy({size:e=25,className:t=""}){return l.jsxs("svg",{viewBox:"0 0 24 16",overflow:"visible",width:e,height:e,className:Op("fill-current text-black",t),children:[l.jsx("g",{style:{transform:"translateX(13px) rotateZ(0deg)",transformOrigin:"4.775px 7.73501px"},children:l.jsx("path",{shapeRendering:"geometricPrecision",fillOpacity:"1",d:" M0,0 C0,0 6.1677093505859375,15.470022201538086 6.1677093505859375,15.470022201538086 C6.1677093505859375,15.470022201538086 9.550004005432129,15.470022201538086 9.550004005432129,15.470022201538086 C9.550004005432129,15.470022201538086 3.382294178009033,0 3.382294178009033,0 C3.382294178009033,0 0,0 0,0 C0,0 0,0 0,0z"})}),l.jsx("g",{style:{transform:"none",transformOrigin:"7.935px 7.73501px"},opacity:"1",children:l.jsx("path",{shapeRendering:"geometricPrecision",fillOpacity:"1",d:" M5.824605464935303,9.348296165466309 C5.824605464935303,9.348296165466309 7.93500280380249,3.911694288253784 7.93500280380249,3.911694288253784 C7.93500280380249,3.911694288253784 10.045400619506836,9.348296165466309 10.045400619506836,9.348296165466309 C10.045400619506836,9.348296165466309 5.824605464935303,9.348296165466309 5.824605464935303,9.348296165466309 C5.824605464935303,9.348296165466309 5.824605464935303,9.348296165466309 5.824605464935303,9.348296165466309z M6.166755199432373,0 C6.166755199432373,0 0,15.470022201538086 0,15.470022201538086 C0,15.470022201538086 3.4480772018432617,15.470022201538086 3.4480772018432617,15.470022201538086 C3.4480772018432617,15.470022201538086 4.709278583526611,12.22130012512207 4.709278583526611,12.22130012512207 C4.709278583526611,12.22130012512207 11.16093635559082,12.22130012512207 11.16093635559082,12.22130012512207 C11.16093635559082,12.22130012512207 12.421928405761719,15.470022201538086 12.421928405761719,15.470022201538086 C12.421928405761719,15.470022201538086 15.87000560760498,15.470022201538086 15.87000560760498,15.470022201538086 C15.87000560760498,15.470022201538086 9.703250885009766,0 9.703250885009766,0 C9.703250885009766,0 6.166755199432373,0 6.166755199432373,0 C6.166755199432373,0 6.166755199432373,0 6.166755199432373,0z"})})]})}function dy({size:e=24,className:t=""}){return l.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",className:Op("text-white dark:text-black",t),children:l.jsx("path",{d:"M7 11L12 6L17 11M12 18V7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}const uy=({className:e=""})=>l.jsxs("svg",{className:e,width:"17",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[l.jsx("path",{d:"M11.6439 3C10.9352 3 10.2794 3.37508 9.92002 3.98596L9.49644 4.70605C8.96184 5.61487 7.98938 6.17632 6.93501 6.18489L6.09967 6.19168C5.39096 6.19744 4.73823 6.57783 4.38386 7.19161L4.02776 7.80841C3.67339 8.42219 3.67032 9.17767 4.01969 9.7943L4.43151 10.5212C4.95127 11.4386 4.95127 12.5615 4.43151 13.4788L4.01969 14.2057C3.67032 14.8224 3.67339 15.5778 4.02776 16.1916L4.38386 16.8084C4.73823 17.4222 5.39096 17.8026 6.09966 17.8083L6.93502 17.8151C7.98939 17.8237 8.96185 18.3851 9.49645 19.294L9.92002 20.014C10.2794 20.6249 10.9352 21 11.6439 21H12.3561C13.0648 21 13.7206 20.6249 14.08 20.014L14.5035 19.294C15.0381 18.3851 16.0106 17.8237 17.065 17.8151L17.9004 17.8083C18.6091 17.8026 19.2618 17.4222 19.6162 16.8084L19.9723 16.1916C20.3267 15.5778 20.3298 14.8224 19.9804 14.2057L19.5686 13.4788C19.0488 12.5615 19.0488 11.4386 19.5686 10.5212L19.9804 9.7943C20.3298 9.17767 20.3267 8.42219 19.9723 7.80841L19.6162 7.19161C19.2618 6.57783 18.6091 6.19744 17.9004 6.19168L17.065 6.18489C16.0106 6.17632 15.0382 5.61487 14.5036 4.70605L14.08 3.98596C13.7206 3.37508 13.0648 3 12.3561 3H11.6439Z",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round"}),l.jsx("circle",{cx:"12",cy:"12",r:"2.5",stroke:"currentColor",strokeWidth:"2"})]});function my({unpin:e=!1}){return e?l.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-sm",children:[l.jsx("path",{d:"M15 15V17.5585C15 18.4193 14.4491 19.1836 13.6325 19.4558L13.1726 19.6091C12.454 19.8487 11.6616 19.6616 11.126 19.126L4.87403 12.874C4.33837 12.3384 4.15132 11.546 4.39088 10.8274L4.54415 10.3675C4.81638 9.55086 5.58066 9 6.44152 9H9M12 6.2L13.6277 3.92116C14.3461 2.91549 15.7955 2.79552 16.6694 3.66942L20.3306 7.33058C21.2045 8.20448 21.0845 9.65392 20.0788 10.3723L18 11.8571",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),l.jsx("path",{d:"M8 16L3 21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),l.jsx("path",{d:"M4 4L20 20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}):l.jsx("svg",{className:"icon-sm",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.4845 2.8798C16.1773 1.57258 14.0107 1.74534 12.9272 3.24318L9.79772 7.56923C9.60945 7.82948 9.30775 7.9836 8.98654 7.9836H6.44673C3.74061 7.9836 2.27414 11.6759 4.16948 13.5713L6.59116 15.993L2.29324 20.2909C1.90225 20.6819 1.90225 21.3158 2.29324 21.7068C2.68422 22.0977 3.31812 22.0977 3.70911 21.7068L8.00703 17.4088L10.4287 19.8305C12.3241 21.7259 16.0164 20.2594 16.0164 17.5533V15.0135C16.0164 14.6923 16.1705 14.3906 16.4308 14.2023L20.7568 11.0728C22.2547 9.98926 22.4274 7.8227 21.1202 6.51549L17.4845 2.8798ZM11.8446 18.4147C12.4994 19.0694 14.0141 18.4928 14.0141 17.5533V15.0135C14.0141 14.0499 14.4764 13.1447 15.2572 12.58L19.5832 9.45047C20.0825 9.08928 20.1401 8.3671 19.7043 7.93136L16.0686 4.29567C15.6329 3.85993 14.9107 3.91751 14.5495 4.4168L11.4201 8.74285C10.8553 9.52359 9.95016 9.98594 8.98654 9.98594H6.44673C5.5072 9.98594 4.93059 11.5006 5.58535 12.1554L11.8446 18.4147Z",fill:"currentColor"})})}function py({className:e=""}){return l.jsx("svg",{fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:Op("icon-md h-4 w-4",e),height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.5555 4C10.099 4 9.70052 4.30906 9.58693 4.75114L9.29382 5.8919H14.715L14.4219 4.75114C14.3083 4.30906 13.9098 4 13.4533 4H10.5555ZM16.7799 5.8919L16.3589 4.25342C16.0182 2.92719 14.8226 2 13.4533 2H10.5555C9.18616 2 7.99062 2.92719 7.64985 4.25342L7.22886 5.8919H4C3.44772 5.8919 3 6.33961 3 6.8919C3 7.44418 3.44772 7.8919 4 7.8919H4.10069L5.31544 19.3172C5.47763 20.8427 6.76455 22 8.29863 22H15.7014C17.2354 22 18.5224 20.8427 18.6846 19.3172L19.8993 7.8919H20C20.5523 7.8919 21 7.44418 21 6.8919C21 6.33961 20.5523 5.8919 20 5.8919H16.7799ZM17.888 7.8919H6.11196L7.30423 19.1057C7.3583 19.6142 7.78727 20 8.29863 20H15.7014C16.2127 20 16.6417 19.6142 16.6958 19.1057L17.888 7.8919ZM10 10C10.5523 10 11 10.4477 11 11V16C11 16.5523 10.5523 17 10 17C9.44772 17 9 16.5523 9 16V11C9 10.4477 9.44772 10 10 10ZM14 10C14.5523 10 15 10.4477 15 11V16C15 16.5523 14.5523 17 14 17C13.4477 17 13 16.5523 13 16V11C13 10.4477 13.4477 10 14 10Z",fill:"currentColor"})})}function hy({size:e,className:t="icon-md"}){return l.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.4646 19C15.2219 20.6961 13.7632 22 12 22C10.2368 22 8.77806 20.6961 8.53544 19H6C4.34315 19 3 17.6569 3 16V13.5C3 12.9477 3.44772 12.5 4 12.5H4.5C5.32843 12.5 6 11.8284 6 11C6 10.1716 5.32843 9.5 4.5 9.5H4C3.44772 9.5 3 9.05229 3 8.5L3 6C3 4.34315 4.34315 3 6 3L18 3C19.6569 3 21 4.34315 21 6L21 16C21 17.6569 19.6569 19 18 19H15.4646ZM12 20C12.8284 20 13.5 19.3284 13.5 18.5V18C13.5 17.4477 13.9477 17 14.5 17H18C18.5523 17 19 16.5523 19 16L19 6C19 5.44772 18.5523 5 18 5L6 5C5.44772 5 5 5.44772 5 6V7.53544C6.69615 7.77806 8 9.23676 8 11C8 12.7632 6.69615 14.2219 5 14.4646L5 16C5 16.5523 5.44771 17 6 17H9.5C10.0523 17 10.5 17.4477 10.5 18V18.5C10.5 19.3284 11.1716 20 12 20Z",fill:"currentColor"})})}function xy({size:e=25,className:t="h-4 w-4"}){const n=e,s=e;return l.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:Op(t,""),width:s,height:n,xmlns:"http://www.w3.org/2000/svg",children:[l.jsx("path",{d:"m8.0458 0.81981a1.1197 1.1197 0 0 0-1.0608 0.76184l-6.7912 20.123a1.1178 1.1178 0 0 0 1.0592 1.4751h5.4647a1.1197 1.1197 0 0 0 1.0608-0.7615l1.3528-4.0084-2.3684-2.2107a0.51536 0.51536 0 0 1 0.35193-0.8923h3.0639l1.8213-5.3966-2.8111-8.3294a1.1181 1.1181 0 0 0-1.0595-0.76049h-0.0836z"}),l.jsx("path",{d:"m7.1147 15.307a0.51536 0.51536 0 0 0-0.35193 0.8923l7.1552 6.6782a1.1248 1.1248 0 0 0 0.76724 0.30238h0.2417a1.1181 1.1181 0 0 0 1.0534-1.4755l-2.1591-6.3974z"}),l.jsx("path",{d:"m17.015 1.5807a1.1178 1.1178 0 0 0-1.0593-0.76049h-7.8258a1.1181 1.1181 0 0 1 1.0593 0.76049l6.7916 20.123a1.1181 1.1181 0 0 1-1.0593 1.4757h7.8261a1.1181 1.1181 0 0 0 1.059-1.4757z"})]})}function fy({className:e="h-4 w-4"}){return l.jsx("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"1",viewBox:"0 0 40 40",strokeLinecap:"round",strokeLinejoin:"round",className:e,height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{d:"M37.5324 16.8707C37.9808 15.5241 38.1363 14.0974 37.9886 12.6859C37.8409 11.2744 37.3934 9.91076 36.676 8.68622C35.6126 6.83404 33.9882 5.3676 32.0373 4.4985C30.0864 3.62941 27.9098 3.40259 25.8215 3.85078C24.8796 2.7893 23.7219 1.94125 22.4257 1.36341C21.1295 0.785575 19.7249 0.491269 18.3058 0.500197C16.1708 0.495044 14.0893 1.16803 12.3614 2.42214C10.6335 3.67624 9.34853 5.44666 8.6917 7.47815C7.30085 7.76286 5.98686 8.3414 4.8377 9.17505C3.68854 10.0087 2.73073 11.0782 2.02839 12.312C0.956464 14.1591 0.498905 16.2988 0.721698 18.4228C0.944492 20.5467 1.83612 22.5449 3.268 24.1293C2.81966 25.4759 2.66413 26.9026 2.81182 28.3141C2.95951 29.7256 3.40701 31.0892 4.12437 32.3138C5.18791 34.1659 6.8123 35.6322 8.76321 36.5013C10.7141 37.3704 12.8907 37.5973 14.9789 37.1492C15.9208 38.2107 17.0786 39.0587 18.3747 39.6366C19.6709 40.2144 21.0755 40.5087 22.4946 40.4998C24.6307 40.5054 26.7133 39.8321 28.4418 38.5772C30.1704 37.3223 31.4556 35.5506 32.1119 33.5179C33.5027 33.2332 34.8167 32.6547 35.9659 31.821C37.115 30.9874 38.0728 29.9178 38.7752 28.684C39.8458 26.8371 40.3023 24.6979 40.0789 22.5748C39.8556 20.4517 38.9639 18.4544 37.5324 16.8707ZM22.4978 37.8849C20.7443 37.8874 19.0459 37.2733 17.6994 36.1501C17.7601 36.117 17.8666 36.0586 17.936 36.0161L25.9004 31.4156C26.1003 31.3019 26.2663 31.137 26.3813 30.9378C26.4964 30.7386 26.5563 30.5124 26.5549 30.2825V19.0542L29.9213 20.998C29.9389 21.0068 29.9541 21.0198 29.9656 21.0359C29.977 21.052 29.9842 21.0707 29.9867 21.0902V30.3889C29.9842 32.375 29.1946 34.2791 27.7909 35.6841C26.3872 37.0892 24.4838 37.8806 22.4978 37.8849ZM6.39227 31.0064C5.51397 29.4888 5.19742 27.7107 5.49804 25.9832C5.55718 26.0187 5.66048 26.0818 5.73461 26.1244L13.699 30.7248C13.8975 30.8408 14.1233 30.902 14.3532 30.902C14.583 30.902 14.8088 30.8408 15.0073 30.7248L24.731 25.1103V28.9979C24.7321 29.0177 24.7283 29.0376 24.7199 29.0556C24.7115 29.0736 24.6988 29.0893 24.6829 29.1012L16.6317 33.7497C14.9096 34.7416 12.8643 35.0097 10.9447 34.4954C9.02506 33.9811 7.38785 32.7263 6.39227 31.0064ZM4.29707 13.6194C5.17156 12.0998 6.55279 10.9364 8.19885 10.3327C8.19885 10.4013 8.19491 10.5228 8.19491 10.6071V19.808C8.19351 20.0378 8.25334 20.2638 8.36823 20.4629C8.48312 20.6619 8.64893 20.8267 8.84863 20.9404L18.5723 26.5542L15.206 28.4979C15.1894 28.5089 15.1703 28.5155 15.1505 28.5173C15.1307 28.5191 15.1107 28.516 15.0924 28.5082L7.04046 23.8557C5.32135 22.8601 4.06716 21.2235 3.55289 19.3046C3.03862 17.3858 3.30624 15.3413 4.29707 13.6194ZM31.955 20.0556L22.2312 14.4411L25.5976 12.4981C25.6142 12.4872 25.6333 12.4805 25.6531 12.4787C25.6729 12.4769 25.6928 12.4801 25.7111 12.4879L33.7631 17.1364C34.9967 17.849 36.0017 18.8982 36.6606 20.1613C37.3194 21.4244 37.6047 22.849 37.4832 24.2684C37.3617 25.6878 36.8382 27.0432 35.9743 28.1759C35.1103 29.3086 33.9415 30.1717 32.6047 30.6641C32.6047 30.5947 32.6047 30.4733 32.6047 30.3889V21.188C32.6066 20.9586 32.5474 20.7328 32.4332 20.5338C32.319 20.3348 32.154 20.1698 31.955 20.0556ZM35.3055 15.0128C35.2464 14.9765 35.1431 14.9142 35.069 14.8717L27.1045 10.2712C26.906 10.1554 26.6803 10.0943 26.4504 10.0943C26.2206 10.0943 25.9948 10.1554 25.7963 10.2712L16.0726 15.8858V11.9982C16.0715 11.9783 16.0753 11.9585 16.0837 11.9405C16.0921 11.9225 16.1048 11.9068 16.1207 11.8949L24.1719 7.25025C25.4053 6.53903 26.8158 6.19376 28.2383 6.25482C29.6608 6.31589 31.0364 6.78077 32.2044 7.59508C33.3723 8.40939 34.2842 9.53945 34.8334 10.8531C35.3826 12.1667 35.5464 13.6095 35.3055 15.0128ZM14.2424 21.9419L10.8752 19.9981C10.8576 19.9893 10.8423 19.9763 10.8309 19.9602C10.8195 19.9441 10.8122 19.9254 10.8098 19.9058V10.6071C10.8107 9.18295 11.2173 7.78848 11.9819 6.58696C12.7466 5.38544 13.8377 4.42659 15.1275 3.82264C16.4173 3.21869 17.8524 2.99464 19.2649 3.1767C20.6775 3.35876 22.0089 3.93941 23.1034 4.85067C23.0427 4.88379 22.937 4.94215 22.8668 4.98473L14.9024 9.58517C14.7025 9.69878 14.5366 9.86356 14.4215 10.0626C14.3065 10.2616 14.2466 10.4877 14.2479 10.7175L14.2424 21.9419ZM16.071 17.9991L20.4018 15.4978L24.7325 17.9975V22.9985L20.4018 25.4983L16.071 22.9985V17.9991Z"})})}function gy({size:e=25,className:t=""}){return l.jsxs("svg",{width:e,height:e,className:t,viewBox:"0 0 19 17",fill:"none",preserveAspectRatio:"xMidYMid meet",focusable:"false",children:[l.jsx("path",{d:"M9.62674 16.2202H9.7049C10.4225 16.2202 11.0016 15.6412 11.0016 14.9236V4.04224H8.33008V14.92C8.33008 15.6376 8.90914 16.2202 9.62674 16.2202Z",fill:"#808080"}),l.jsx("path",{d:"M14.6819 8.02813C13.3249 6.66752 11.2964 6.39398 9.66577 7.2004L15.0585 12.5931C15.2823 12.8169 15.6624 12.7281 15.7583 12.4297C16.2308 10.927 15.8756 9.21822 14.6819 8.02813Z",fill:"#666666"}),l.jsx("path",{d:"M4.64953 8.02813C6.00659 6.66752 8.03507 6.39398 9.66567 7.2004L4.27297 12.5931C4.04916 12.8169 3.66904 12.7281 3.57312 12.4297C3.10064 10.927 3.45589 9.21822 4.64953 8.02813Z",fill:"#999999"}),l.jsx("path",{d:"M14.284 3.84326C12.1383 3.84326 10.3159 5.25005 9.66577 7.20038H18.1918C18.5399 7.20038 18.7744 6.83092 18.6145 6.5183C17.8081 4.93033 16.1704 3.84326 14.284 3.84326Z",fill:"#4d4d4d"}),l.jsx("path",{d:"M10.5574 1.55901C9.04053 3.07593 8.74567 5.36019 9.66577 7.20039L15.6944 1.17179C15.943 0.923113 15.8436 0.496814 15.5132 0.390239C13.8151 -0.1604 11.8896 0.226822 10.5574 1.55901Z",fill:"#b3b3b3"}),l.jsx("path",{d:"M8.77408 1.55901C10.291 3.07593 10.5859 5.36019 9.66576 7.20039L3.63716 1.17179C3.38848 0.923113 3.48795 0.496814 3.81833 0.390239C5.51643 -0.1604 7.44189 0.226822 8.77408 1.55901Z",fill:"#333333"}),l.jsx("path",{d:"M5.04752 3.84326C7.19323 3.84326 9.01566 5.25005 9.66577 7.20038H1.13976C0.791616 7.20038 0.55715 6.83092 0.717013 6.5183C1.52343 4.93033 3.16114 3.84326 5.04752 3.84326Z",fill:"#1a1a1a"})]})}function vy({size:e=25,className:t=""}){return l.jsx("svg",{width:e,height:e,className:Op("dark:fill-white",t),viewBox:"0 0 18 18",preserveAspectRatio:"xMidYMid meet",focusable:"false",children:l.jsx("path",{d:"M2 4.006C2 2.898 2.897 2 4.006 2h9.988C15.102 2 16 2.897 16 4.006v9.988A2.005 2.005 0 0 1 13.994 16H4.006A2.005 2.005 0 0 1 2 13.994V4.006zM13.992 9l.003-.003L10.997 6 9.75 7.247 11.503 9 9.75 10.753 10.997 12l2.997-2.997L13.992 9zm-9.99 0L4 8.997 6.997 6l1.247 1.247L6.492 9l1.753 1.753L6.997 12 4 9.003 4.003 9z",fillRule:"evenodd"})})}function by({size:e=25,className:t=""}){return l.jsxs("svg",{width:e,height:e,className:t,viewBox:"0 0 18 18",preserveAspectRatio:"xMidYMid meet",focusable:"false",children:[l.jsx("path",{fill:"url(#_4rif_paint0_radial_897_42)",d:"M9 18c0-1.245-.24-2.415-.72-3.51a8.934 8.934 0 00-1.912-2.857A8.934 8.934 0 003.51 9.72 8.646 8.646 0 000 9a8.886 8.886 0 003.51-.697 9.247 9.247 0 002.857-1.936A8.934 8.934 0 008.28 3.51C8.76 2.415 9 1.245 9 0c0 1.245.232 2.415.697 3.51a9.247 9.247 0 001.936 2.857 9.247 9.247 0 002.857 1.936A8.886 8.886 0 0018 9c-1.245 0-2.415.24-3.51.72a8.934 8.934 0 00-2.857 1.912 9.247 9.247 0 00-1.935 2.858A8.886 8.886 0 009 18z"}),l.jsx("defs",{children:l.jsxs("radialGradient",{id:"_4rif_paint0_radial_897_42",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"rotate(135 9 3.728) scale(25.4558 12.7279)",children:[l.jsx("stop",{offset:".325",stopColor:"#FFDDB7"}),l.jsx("stop",{offset:".706",stopColor:"#076EFF"})]})})]})}function yy({className:e=""}){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",width:"800px",height:"800px",viewBox:"0 0 512 512",className:Op("h-4 w-4",e),children:l.jsx("path",{d:"M473.16,221.48l-2.26-9.59H262.46v88.22H387c-12.93,61.4-72.93,93.72-121.94,93.72-35.66,0-73.25-15-98.13-39.11a140.08,140.08,0,0,1-41.8-98.88c0-37.16,16.7-74.33,41-98.78s61-38.13,97.49-38.13c41.79,0,71.74,22.19,82.94,32.31l62.69-62.36C390.86,72.72,340.34,32,261.6,32h0c-60.75,0-119,23.27-161.58,65.71C58,139.5,36.25,199.93,36.25,256S56.83,369.48,97.55,411.6C141.06,456.52,202.68,480,266.13,480c57.73,0,112.45-22.62,151.45-63.66,38.34-40.4,58.17-96.3,58.17-154.9C475.75,236.77,473.27,222.12,473.16,221.48Z"})})}function _y({className:e}){return l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:Op(e),strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}),l.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),l.jsx("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]})}function jy({className:e="",size:t="1em"}){return l.jsx("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",height:t,width:t,className:Op(e),children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11 4.9099C11 4.47485 10.4828 4.24734 10.1621 4.54132L6.67572 7.7372C6.49129 7.90626 6.25019 8.00005 6 8.00005H4C3.44772 8.00005 3 8.44776 3 9.00005V15C3 15.5523 3.44772 16 4 16H6C6.25019 16 6.49129 16.0938 6.67572 16.2629L10.1621 19.4588C10.4828 19.7527 11 19.5252 11 19.0902V4.9099ZM8.81069 3.06701C10.4142 1.59714 13 2.73463 13 4.9099V19.0902C13 21.2655 10.4142 22.403 8.81069 20.9331L5.61102 18H4C2.34315 18 1 16.6569 1 15V9.00005C1 7.34319 2.34315 6.00005 4 6.00005H5.61102L8.81069 3.06701ZM20.3166 6.35665C20.8019 6.09313 21.409 6.27296 21.6725 6.75833C22.5191 8.3176 22.9996 10.1042 22.9996 12.0001C22.9996 13.8507 22.5418 15.5974 21.7323 17.1302C21.4744 17.6185 20.8695 17.8054 20.3811 17.5475C19.8927 17.2896 19.7059 16.6846 19.9638 16.1962C20.6249 14.9444 20.9996 13.5175 20.9996 12.0001C20.9996 10.4458 20.6064 8.98627 19.9149 7.71262C19.6514 7.22726 19.8312 6.62017 20.3166 6.35665ZM15.7994 7.90049C16.241 7.5688 16.8679 7.65789 17.1995 8.09947C18.0156 9.18593 18.4996 10.5379 18.4996 12.0001C18.4996 13.3127 18.1094 14.5372 17.4385 15.5604C17.1357 16.0222 16.5158 16.1511 16.0539 15.8483C15.5921 15.5455 15.4632 14.9255 15.766 14.4637C16.2298 13.7564 16.4996 12.9113 16.4996 12.0001C16.4996 10.9859 16.1653 10.0526 15.6004 9.30063C15.2687 8.85905 15.3578 8.23218 15.7994 7.90049Z",fill:"currentColor"})})}function wy({className:e="",size:t="1em"}){return l.jsx("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",height:t,width:t,className:Op(e),children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM9.5 8.5C8.94772 8.5 8.5 8.94772 8.5 9.5V14.5C8.5 15.0523 8.94772 15.5 9.5 15.5H14.5C15.0523 15.5 15.5 15.0523 15.5 14.5V9.5C15.5 8.94772 15.0523 8.5 14.5 8.5H9.5Z",fill:"currentColor"})})}function Ny(){return l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),l.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}function Cy({className:e=""}){return l.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:Op("text-black dark:text-white",e),"aria-hidden":!0,children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.7929 2.79289C18.0118 1.57394 19.9882 1.57394 21.2071 2.79289C22.4261 4.01184 22.4261 5.98815 21.2071 7.20711L12.7071 15.7071C12.5196 15.8946 12.2652 16 12 16H9C8.44772 16 8 15.5523 8 15V12C8 11.7348 8.10536 11.4804 8.29289 11.2929L16.7929 2.79289ZM19.7929 4.20711C19.355 3.7692 18.645 3.7692 18.2071 4.2071L10 12.4142V14H11.5858L19.7929 5.79289C20.2308 5.35499 20.2308 4.64501 19.7929 4.20711ZM6 5C5.44772 5 5 5.44771 5 6V18C5 18.5523 5.44772 19 6 19H18C18.5523 19 19 18.5523 19 18V14C19 13.4477 19.4477 13 20 13C20.5523 13 21 13.4477 21 14V18C21 19.6569 19.6569 21 18 21H6C4.34315 21 3 19.6569 3 18V6C3 4.34314 4.34315 3 6 3H10C10.5523 3 11 3.44771 11 4C11 4.55228 10.5523 5 10 5H6Z",fill:"currentColor"})})}function ky({className:e=""}){return l.jsxs("svg",{version:"1.1",viewBox:"0 0 233.33 290",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",className:Op("h-9 w-9",e),children:[l.jsx("defs",{children:l.jsxs("linearGradient",{id:"linearGradient1842",x1:"163.92",x2:"173.66",y1:"22.212",y2:"-6.5784",gradientTransform:"translate(.10391 .050143)",gradientUnits:"userSpaceOnUse",children:[l.jsx("stop",{stopColor:"#640a62",offset:"0"}),l.jsx("stop",{stopColor:"#852283",offset:".49917"}),l.jsx("stop",{stopColor:"#640a62",offset:"1"})]})}),l.jsxs("g",{children:[l.jsx("path",{transform:"matrix(.43416 .90084 -.89966 .4366 0 0)",d:"m259.29-126.03a232.2 237.56 0 0 1-17.412 231.34l-193.32-131.59z",fill:"url(#linearGradient1842)"}),l.jsx("path",{transform:"matrix(.6967 .051926 -.051926 .6967 35.578 23.196)",d:"m50.818 31.415c-1.4654 2.4749-10.838 2.4195-12.997 4.3204-2.1584 1.9009-3.288 11.206-5.9282 12.347-2.6402 1.1409-10.191-4.4132-13.054-4.1441-2.8636 0.26917-9.2466 7.133-12.053 6.5041-2.8066-0.62889-5.6503-9.5602-8.1252-11.026-2.4749-1.4654-11.673 0.33572-13.574-1.8227s1.0482-11.056-0.0927-13.696c-1.1409-2.6402-9.6412-6.5898-9.9104-9.4533-0.26917-2.8636 7.3463-8.328 7.9752-11.135 0.62889-2.8066-3.9265-10.998-2.4612-13.473 1.4654-2.4749 10.838-2.4195 12.997-4.3204 2.1584-1.9009 3.288-11.206 5.9282-12.347 2.6402-1.1409 10.191 4.4132 13.054 4.1441 2.8636-0.26917 9.2466-7.133 12.053-6.5041 2.8066 0.62889 5.6503 9.5602 8.1252 11.026s11.673-0.33572 13.574 1.8227c1.9009 2.1584-1.0482 11.056 0.0927 13.696 1.1409 2.6402 9.6412 6.5898 9.9104 9.4533 0.26917 2.8635-7.3463 8.328-7.9752 11.135-0.62889 2.8066 3.9265 10.998 2.4612 13.473z",fill:"#ff9d78",stroke:"#f29472",strokeWidth:"4.7877"}),l.jsx("circle",{cx:"170.36",cy:"215.76",r:"12.903",fill:"#cfffff"}),l.jsx("path",{d:"m220.77 174.77c-88.526 101.03-191.21 85.731-209.5 82.142-2.2101-2e-5 -2.6686 0.42426-3.437 2.0021l-1.7042 7.5028c0.056197 2.3603 0.37544 2.6428 1.9121 3.5409 18.396 3.3746 130.27 19.488 223.46-86.881 0.64011-1.5095 0.46653-3.1324-0.59137-4.7337l-5.1558-3.6482c-1.586-0.8743-3.9524-0.94332-4.9837 0.0751z",color:"#000000",fill:"#ff9d78",stroke:"#f29472",strokeLinejoin:"round",strokeWidth:"2.8913"}),l.jsxs("g",{fill:"#cfffff",children:[l.jsx("circle",{cx:"72.684",cy:"99.47",r:"12.903"}),l.jsx("circle",{cx:"99.144",cy:"172.32",r:"12.903"}),l.jsx("circle",{cx:"59.617",cy:"214.78",r:"12.903"}),l.jsx("circle",{cx:"135.4",cy:"118.42",r:"12.903"}),l.jsx("path",{transform:"rotate(38.66)",d:"m254.21-1.9608a12.903 12.903 0 0 1-6.4852 11.194 12.903 12.903 0 0 1-12.937-0.0582 12.903 12.903 0 0 1-6.3843-11.252l12.903 0.1161z"}),l.jsx("path",{d:"m29.476 158.16a12.903 12.903 0 0 0-3.6562 0.5293l-3.3691 23.189a12.903 12.903 0 0 0 7.0254 2.0879 12.903 12.903 0 0 0 12.904-12.904 12.903 12.903 0 0 0-12.904-12.902z"})]})]})]})}function Sy({className:e="",size:t="1em"}){const n=t,s=t;return l.jsxs("svg",{width:s,height:n,viewBox:"0 0 24 24",stroke:"currentColor",fill:"none",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:Op("text-token-secondary h-2/3 w-2/3",e),xmlns:"http://www.w3.org/2000/svg",children:[l.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),l.jsx("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),l.jsx("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]})}function Ty({className:e="",size:t=24}){return l.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:Op("icon-md shrink-0",e),children:[l.jsx("path",{d:"M19.3975 1.35498C19.3746 1.15293 19.2037 1.00021 19.0004 1C18.7971 0.999793 18.6259 1.15217 18.6026 1.35417C18.4798 2.41894 18.1627 3.15692 17.6598 3.65983C17.1569 4.16274 16.4189 4.47983 15.3542 4.60264C15.1522 4.62593 14.9998 4.79707 15 5.00041C15.0002 5.20375 15.1529 5.37457 15.355 5.39746C16.4019 5.51605 17.1562 5.83304 17.6716 6.33906C18.1845 6.84269 18.5078 7.57998 18.6016 8.63539C18.6199 8.84195 18.7931 9.00023 19.0005 9C19.2078 8.99977 19.3806 8.84109 19.3985 8.6345C19.4883 7.59673 19.8114 6.84328 20.3273 6.32735C20.8433 5.81142 21.5967 5.48834 22.6345 5.39851C22.8411 5.38063 22.9998 5.20782 23 5.00045C23.0002 4.79308 22.842 4.61992 22.6354 4.60157C21.58 4.50782 20.8427 4.18447 20.3391 3.67157C19.833 3.15623 19.516 2.40192 19.3975 1.35498Z",fill:"currentColor"}),l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11 3C11.4833 3 11.8974 3.34562 11.9839 3.82111C12.4637 6.46043 13.279 8.23983 14.5196 9.48039C15.7602 10.721 17.5396 11.5363 20.1789 12.0161C20.6544 12.1026 21 12.5167 21 13C21 13.4833 20.6544 13.8974 20.1789 13.9839C17.5396 14.4637 15.7602 15.279 14.5196 16.5196C13.279 17.7602 12.4637 19.5396 11.9839 22.1789C11.8974 22.6544 11.4833 23 11 23C10.5167 23 10.1026 22.6544 10.0161 22.1789C9.53625 19.5396 8.72096 17.7602 7.48039 16.5196C6.23983 15.279 4.46043 14.4637 1.82111 13.9839C1.34562 13.8974 1 13.4833 1 13C1 12.5167 1.34562 12.1026 1.82111 12.0161C4.46043 11.5363 6.23983 10.721 7.48039 9.48039C8.72096 8.23983 9.53625 6.46043 10.0161 3.82111C10.1026 3.34562 10.5167 3 11 3ZM5.66618 13C6.9247 13.5226 7.99788 14.2087 8.89461 15.1054C9.79134 16.0021 10.4774 17.0753 11 18.3338C11.5226 17.0753 12.2087 16.0021 13.1054 15.1054C14.0021 14.2087 15.0753 13.5226 16.3338 13C15.0753 12.4774 14.0021 11.7913 13.1054 10.8946C12.2087 9.99788 11.5226 8.9247 11 7.66618C10.4774 8.9247 9.79134 9.99788 8.89461 10.8946C7.99788 11.7913 6.9247 12.4774 5.66618 13Z",fill:"currentColor"})]})}function Ry({size:e="1em",className:t}){return l.jsx("svg",{viewBox:"64 64 896 896",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,width:e,height:e,fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"})})}function Iy({className:e="icon-md-heavy",size:t="1em"}){return l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:Op(e),children:[l.jsx("circle",{cx:"12",cy:"12",r:"10"}),l.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),l.jsx("path",{d:"M12 17h.01"})]})}function Ey({size:e=25,className:t=""}){return l.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",className:Op("fill-current text-black",t),children:l.jsx("g",{fill:"currentColor",children:l.jsx("path",{d:"M12,18.1397014 L9.574,18.9487014 L8.628,18.3177014 L9.658,17.9737014 L9.342,17.0257014 L7.574,17.6147014 L7,17.2327014 L7,14.4997014 C7,14.3107014 6.893,14.1377014 6.724,14.0527014 L5,13.1907014 L5,10.8087014 L6.5,10.0587014 L8,10.8087014 L8,12.4997014 C8,12.6897014 8.107,12.8627014 8.276,12.9477014 L10.276,13.9477014 L10.724,13.0527014 L9,12.1907014 L9,10.8087014 L10.724,9.94770136 C10.893,9.86270136 11,9.68970136 11,9.49970136 L11,7.99970136 L10,7.99970136 L10,9.19070136 L8.5,9.94070136 L7,9.19070136 L7,6.76770136 L8,6.10070136 L8,7.99970136 L9,7.99970136 L9,5.43470136 L9.574,5.05170136 L12,5.86070136 L12,18.1397014 Z M17.5,16.9997014 C17.775,16.9997014 18,17.2237014 18,17.4997014 C18,17.7757014 17.775,17.9997014 17.5,17.9997014 C17.225,17.9997014 17,17.7757014 17,17.4997014 C17,17.2237014 17.225,16.9997014 17.5,16.9997014 L17.5,16.9997014 Z M16.5,5.99970136 C16.775,5.99970136 17,6.22370136 17,6.49970136 C17,6.77570136 16.775,6.99970136 16.5,6.99970136 C16.225,6.99970136 16,6.77570136 16,6.49970136 C16,6.22370136 16.225,5.99970136 16.5,5.99970136 L16.5,5.99970136 Z M18.5,11.9997014 C18.775,11.9997014 19,12.2237014 19,12.4997014 C19,12.7757014 18.775,12.9997014 18.5,12.9997014 C18.225,12.9997014 18,12.7757014 18,12.4997014 C18,12.2237014 18.225,11.9997014 18.5,11.9997014 L18.5,11.9997014 Z M17.092,12.9997014 C17.299,13.5807014 17.849,13.9997014 18.5,13.9997014 C19.327,13.9997014 20,13.3277014 20,12.4997014 C20,11.6727014 19.327,10.9997014 18.5,10.9997014 C17.849,10.9997014 17.299,11.4197014 17.092,11.9997014 L13,11.9997014 L13,9.99970136 L16.5,9.99970136 C16.776,9.99970136 17,9.77670136 17,9.49970136 L17,7.90770136 C17.581,7.70070136 18,7.15070136 18,6.49970136 C18,5.67270136 17.327,4.99970136 16.5,4.99970136 C15.673,4.99970136 15,5.67270136 15,6.49970136 C15,7.15070136 15.419,7.70070136 16,7.90770136 L16,8.99970136 L13,8.99970136 L13,5.49970136 C13,5.28470136 12.862,5.09370136 12.658,5.02570136 L9.658,4.02570136 C9.511,3.97670136 9.351,3.99870136 9.223,4.08370136 L6.223,6.08370136 C6.084,6.17670136 6,6.33270136 6,6.49970136 L6,9.19070136 L4.276,10.0527014 C4.107,10.1377014 4,10.3107014 4,10.4997014 L4,13.4997014 C4,13.6897014 4.107,13.8627014 4.276,13.9477014 L6,14.8087014 L6,17.4997014 C6,17.6667014 6.084,17.8237014 6.223,17.9157014 L9.223,19.9157014 C9.306,19.9717014 9.402,19.9997014 9.5,19.9997014 C9.553,19.9997014 9.606,19.9917014 9.658,19.9737014 L12.658,18.9737014 C12.862,18.9067014 13,18.7157014 13,18.4997014 L13,15.9997014 L15.293,15.9997014 L16.146,16.8537014 L16.159,16.8407014 C16.061,17.0407014 16,17.2627014 16,17.4997014 C16,18.3267014 16.673,18.9997014 17.5,18.9997014 C18.327,18.9997014 19,18.3267014 19,17.4997014 C19,16.6727014 18.327,15.9997014 17.5,15.9997014 C17.262,15.9997014 17.04,16.0607014 16.841,16.1597014 L16.854,16.1467014 L15.854,15.1467014 C15.76,15.0527014 15.633,14.9997014 15.5,14.9997014 L13,14.9997014 L13,12.9997014 L17.092,12.9997014 Z"})})})}function My({className:e="",size:t="1em",bold:n=!1}){return n?l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",className:e,children:[l.jsx("path",{d:"M12.592 2.50386C12.8047 2.13014 13.2317 1.935 13.652 2.01942C15.5627 2.40314 16.7246 4.36079 16.1516 6.23085L15.303 9L17.0142 9C19.6409 9 21.5485 11.5079 20.8574 14.0525L19.4994 19.0525C19.0267 20.7927 17.4526 22 15.6562 22H9.96721C8.869 21.9979 7.97939 21.1033 7.97939 20V9H8.31734C8.67472 9 9.0047 8.80771 9.18201 8.49613L12.592 2.50386Z",fill:"currentColor"}),l.jsx("path",{d:"M5.98763 9C4.33761 9 3 10.3431 3 12V19C3 20.6569 4.33761 22 5.98763 22H6.52055C6.18162 21.4116 5.98763 20.7286 5.98763 20V9Z",fill:"currentColor"})]}):l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",className:e,children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.1318 2.50389C12.3321 2.15338 12.7235 1.95768 13.124 2.00775L13.5778 2.06447C16.0449 2.37286 17.636 4.83353 16.9048 7.20993L16.354 8.99999H17.0722C19.7097 8.99999 21.6253 11.5079 20.9313 14.0525L19.5677 19.0525C19.0931 20.7927 17.5124 22 15.7086 22H6C4.34315 22 3 20.6568 3 19V12C3 10.3431 4.34315 8.99999 6 8.99999H8C8.25952 8.99999 8.49914 8.86094 8.6279 8.63561L12.1318 2.50389ZM10 20H15.7086C16.6105 20 17.4008 19.3964 17.6381 18.5262L19.0018 13.5262C19.3488 12.2539 18.391 11 17.0722 11H15C14.6827 11 14.3841 10.8494 14.1956 10.5941C14.0071 10.3388 13.9509 10.0092 14.0442 9.70591L14.9932 6.62175C15.3384 5.49984 14.6484 4.34036 13.5319 4.08468L10.3644 9.62789C10.0522 10.1742 9.56691 10.5859 9 10.8098V19C9 19.5523 9.44772 20 10 20ZM7 11V19C7 19.3506 7.06015 19.6872 7.17071 20H6C5.44772 20 5 19.5523 5 19V12C5 11.4477 5.44772 11 6 11H7Z",fill:"currentColor"})})}function Py({className:e="",size:t="1em",bold:n=!1}){return n?l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",className:e,children:[l.jsx("path",{d:"M11.4079 21.4961C11.1953 21.8698 10.7683 22.0649 10.348 21.9805C8.4373 21.5968 7.27541 19.6391 7.84844 17.7691L8.69697 14.9999L6.98577 14.9999C4.35915 14.9999 2.45151 12.492 3.14262 9.94747L4.50063 4.94747C4.97329 3.20722 6.54741 1.99994 8.34378 1.99994H14.0328C15.131 2.00207 16.0206 2.89668 16.0206 3.99994V14.9999H15.6827C15.3253 14.9999 14.9953 15.1922 14.818 15.5038L11.4079 21.4961Z",fill:"currentColor"}),l.jsx("path",{d:"M18.0124 14.9999C19.6624 14.9999 21 13.6568 21 11.9999V4.99994C21 3.34308 19.6624 1.99994 18.0124 1.99994H17.4794C17.8184 2.58829 18.0124 3.27136 18.0124 3.99994V14.9999Z",fill:"currentColor"})]}):l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:t,width:t,fill:"none",viewBox:"0 0 24 24",className:e,children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.8727 21.4961C11.6725 21.8466 11.2811 22.0423 10.8805 21.9922L10.4267 21.9355C7.95958 21.6271 6.36855 19.1665 7.09975 16.7901L7.65054 15H6.93226C4.29476 15 2.37923 12.4921 3.0732 9.94753L4.43684 4.94753C4.91145 3.20728 6.49209 2 8.29589 2H18.0045C19.6614 2 21.0045 3.34315 21.0045 5V12C21.0045 13.6569 19.6614 15 18.0045 15H16.0045C15.745 15 15.5054 15.1391 15.3766 15.3644L11.8727 21.4961ZM14.0045 4H8.29589C7.39399 4 6.60367 4.60364 6.36637 5.47376L5.00273 10.4738C4.65574 11.746 5.61351 13 6.93226 13H9.00451C9.32185 13 9.62036 13.1506 9.8089 13.4059C9.99743 13.6612 10.0536 13.9908 9.96028 14.2941L9.01131 17.3782C8.6661 18.5002 9.35608 19.6596 10.4726 19.9153L13.6401 14.3721C13.9523 13.8258 14.4376 13.4141 15.0045 13.1902V5C15.0045 4.44772 14.5568 4 14.0045 4ZM17.0045 13V5C17.0045 4.64937 16.9444 4.31278 16.8338 4H18.0045C18.5568 4 19.0045 4.44772 19.0045 5V12C19.0045 12.5523 18.5568 13 18.0045 13H17.0045Z",fill:"currentColor"})})}function Ly({className:e=""}){return l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24","aria-hidden":"true",focusable:"false",fill:"currentColor",className:e,children:l.jsx("path",{d:"m3.005 8.858 8.783 12.544h3.904L6.908 8.858zM6.905 15.825 3 21.402h3.907l1.951-2.788zM16.585 2l-6.75 9.64 1.953 2.79L20.492 2zM17.292 7.965v13.437h3.2V3.395z"})})}function Ay({className:e}){return l.jsxs("svg",{width:"195",height:"195",viewBox:"0 2 195 195",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,children:[l.jsx("path",{d:"M25 97.8528L92.8823 29.9706C102.255 20.598 117.451 20.598 126.823 29.9706V29.9706C136.196 39.3431 136.196 54.5391 126.823 63.9117L75.5581 115.177",stroke:"currentColor",strokeWidth:"12",strokeLinecap:"round"}),l.jsx("path",{d:"M76.2653 114.47L126.823 63.9117C136.196 54.5391 151.392 54.5391 160.765 63.9117L161.118 64.2652C170.491 73.6378 170.491 88.8338 161.118 98.2063L99.7248 159.6C96.6006 162.724 96.6006 167.789 99.7248 170.913L112.331 183.52",stroke:"currentColor",strokeWidth:"12",strokeLinecap:"round"}),l.jsx("path",{d:"M109.853 46.9411L59.6482 97.1457C50.2757 106.518 50.2757 121.714 59.6482 131.087V131.087C69.0208 140.459 84.2168 140.459 93.5894 131.087L143.794 80.8822",stroke:"currentColor",strokeWidth:"12",strokeLinecap:"round"})]})}function Oy({className:e}){return l.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:e,"aria-label":"",children:l.jsx("path",{d:"M7.45996 14.375C7.45996 13.3616 6.63844 12.54 5.625 12.54C4.61156 12.54 3.79004 13.3616 3.79004 14.375C3.79004 15.3884 4.61156 16.21 5.625 16.21C6.63844 16.21 7.45996 15.3884 7.45996 14.375ZM16.21 14.375C16.21 13.3616 15.3884 12.54 14.375 12.54C13.3616 12.54 12.54 13.3616 12.54 14.375C12.54 15.3884 13.3616 16.21 14.375 16.21C15.3884 16.21 16.21 15.3884 16.21 14.375ZM7.45996 5.625C7.45996 4.61156 6.63844 3.79004 5.625 3.79004C4.61156 3.79004 3.79004 4.61156 3.79004 5.625C3.79004 6.63844 4.61156 7.45996 5.625 7.45996C6.63844 7.45996 7.45996 6.63844 7.45996 5.625ZM16.21 5.625C16.21 4.61156 15.3884 3.79004 14.375 3.79004C13.3616 3.79004 12.54 4.61156 12.54 5.625C12.54 6.63844 13.3616 7.45996 14.375 7.45996C15.3884 7.45996 16.21 6.63844 16.21 5.625ZM17.54 14.375C17.54 16.123 16.123 17.54 14.375 17.54C12.627 17.54 11.21 16.123 11.21 14.375C11.21 12.627 12.627 11.21 14.375 11.21C16.123 11.21 17.54 12.627 17.54 14.375ZM8.79004 5.625C8.79004 7.37298 7.37298 8.79004 5.625 8.79004C3.87702 8.79004 2.45996 7.37298 2.45996 5.625C2.45996 3.87702 3.87702 2.45996 5.625 2.45996C7.37298 2.45996 8.79004 3.87702 8.79004 5.625ZM17.54 5.625C17.54 7.37298 16.123 8.79004 14.375 8.79004C13.7416 8.79004 13.153 8.60173 12.6582 8.28125L8.28125 12.6582C8.60173 13.153 8.79004 13.7416 8.79004 14.375C8.79004 16.123 7.37298 17.54 5.625 17.54C3.87702 17.54 2.45996 16.123 2.45996 14.375C2.45996 12.627 3.87702 11.21 5.625 11.21C6.25794 11.21 6.84623 11.3977 7.34082 11.7178L11.7178 7.34082C11.3977 6.84623 11.21 6.25794 11.21 5.625C11.21 3.87702 12.627 2.45996 14.375 2.45996C16.123 2.45996 17.54 3.87702 17.54 5.625Z"})})}const Dy={[Lc.anyscale]:"/assets/anyscale.png",[Lc.apipie]:"/assets/apipie.png",[Lc.cohere]:"/assets/cohere.png",[Lc.deepseek]:"/assets/deepseek.svg",[Lc.fireworks]:"/assets/fireworks.png",[Lc.google]:"/assets/google.svg",[Lc.groq]:"/assets/groq.png",[Lc.huggingface]:"/assets/huggingface.svg",[Lc.mistral]:"/assets/mistral.png",[Lc.mlx]:"/assets/mlx.png",[Lc.ollama]:"/assets/ollama.png",[Lc.openai]:"/assets/openai.svg",[Lc.openrouter]:"/assets/openrouter.png",[Lc.perplexity]:"/assets/perplexity.png",[Lc.qwen]:"/assets/qwen.svg",[Lc.shuttleai]:"/assets/shuttleai.png",[Lc["together.ai"]]:"/assets/together.png",[Lc.unify]:"/assets/unify.webp"},zy={[Lc.cohere]:{[Ho.landing]:"p-2"},[Lc.xai]:{[Ho.landing]:"p-2"}},Fy=({currentEndpoint:e,context:t="",className:n})=>{var s;if(e===Lc.openrouter)return n;return Op((null==(s=zy[e])?void 0:s[t])??"",t===Ho.landing?"":n)};const Vy=n.memo(function({className:e="",endpoint:t,iconURL:s="",context:a}){const{theme:r}=n.useContext(Nv),o=t??"";if(!o)return l.jsx(Zb,{className:e});const i=o.toLowerCase();if(i===Lc.xai)return l.jsx(Ly,{className:Fy({currentEndpoint:i,context:a,className:e})});if(s){let t=s;return"/assets/hanzo-logo.svg"===s&&(t=wv(r)?"/assets/hanzo-logo-dark.svg":"/assets/hanzo-logo-light.svg"),l.jsx("img",{className:e,src:t,alt:`${o} Icon`})}const c=Dy[i]??"";return c?l.jsx("img",{className:Fy({currentEndpoint:i,context:a,className:e}),src:c,alt:`${i} Icon`}):l.jsx(Zb,{className:e})}),$y=({className:e="",assistantName:t="",avatar:n="",context:s,size:a})=>t&&n?l.jsx("img",{src:n,className:"bg-token-surface-secondary dark:bg-token-surface-tertiary h-full w-full rounded-full object-cover",alt:t,width:"80",height:"80"}):t?l.jsx(Sy,{className:Op("text-token-secondary",e),size:a}):l.jsx(Ty,{className:Op("landing"===s?"icon-2xl":"",e)}),By={[vi.azureOpenAI]:xy,[vi.openAI]:$b,[vi.gptPlugins]:hy,[vi.anthropic]:cy,[vi.chatGPTBrowser]:Jb,[vi.google]:yy,[vi.custom]:Zb,[vi.assistants]:$y,[vi.azureAssistants]:$y,[vi.agents]:({className:e="",avatar:t="",agentName:n,size:s})=>null!=n&&n&&t?l.jsx("img",{src:t,className:"bg-token-surface-secondary dark:bg-token-surface-tertiary h-full w-full rounded-full object-cover",alt:n,width:"80",height:"80"}):l.jsx(q,{className:Op(""===n?"icon-2xl":"",e),size:s}),[vi.bedrock]:({className:e=""})=>l.jsx(Ey,{className:Op(e,"h-full w-full")}),unknown:Vy};function Uy(e){const[t,s]=n.useState(!1);return n.useEffect(()=>{const n=window.matchMedia(e);n.matches!==t&&s(n.matches);const a=()=>s(n.matches);return n.addEventListener("change",a),()=>n.removeEventListener("change",a)},[t,e]),t}const Hy={enabled:!1,name:"Hanzo AI",models:{default:"Hanzo Zen-1",pro:"Hanzo Zen-1 Pro"},hideModelSwitcher:!1,hideSidePanelParameters:!1,hideEndpointMenu:!1,hideApiKeyInput:!1,hideAdvancedSettings:!1,appTitle:"Hanzo Chat",defaultModel:"Hanzo Zen-1",availableModels:[]};function Ky(e,t){const[s,a]=n.useState(t);n.useEffect(()=>{const n=localStorage.getItem(e);function s(t){if(t.key!==e)return;const n=localStorage.getItem(e);a(JSON.parse(n??""))}return n||localStorage.setItem(e,JSON.stringify(t)),a(n?JSON.parse(n):t),window.addEventListener("storage",s),()=>{window.removeEventListener("storage",s)}},[]);return[s,t=>{try{a(t),localStorage.setItem(e,JSON.stringify(t)),"undefined"!=typeof window&&window.dispatchEvent(new StorageEvent("storage",{key:e}))}catch(n){console.error(n)}}]}function Gy(e,t,s,a){n.useEffect(()=>{const n=n=>{const a=n.target;a&&"id"in a&&s.includes(a.id)||(null==a?void 0:a.parentNode)&&"id"in a.parentNode&&s.includes(a.parentNode.id)||e.current&&!e.current.contains(a)&&t()};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[e,t])}function Wy(){const{toast:e,onOpenChange:t}=Lf(),n={[Wo.INFO]:"border-gray-500 bg-gray-500",[Wo.SUCCESS]:"border-gray-400 bg-white text-black dark:border-gray-600 dark:bg-gray-800 dark:text-white",[Wo.WARNING]:"border-orange-500 bg-orange-500",[Wo.ERROR]:"border-red-500 bg-red-500"};return l.jsx(cs,{open:e.open,onOpenChange:t,className:"toast-root",style:{height:"74px",marginBottom:"0px"},children:l.jsx("div",{className:"w-full p-1 text-center md:w-auto md:text-justify",children:l.jsxs("div",{className:`alert-root pointer-events-auto inline-flex flex-row gap-2 rounded-md border px-3 py-2 ${e.severity===Wo.SUCCESS?"":"text-white"} ${n[e.severity]}`,children:[e.showIcon&&l.jsx("div",{className:"mt-1 flex-shrink-0 flex-grow-0",children:l.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"icon-sm",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[l.jsx("polygon",{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2"}),l.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),l.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]})}),l.jsx(ds,{className:"flex-1 justify-center gap-2",children:l.jsx("div",{className:"whitespace-pre-wrap text-left",children:e.message})})]})})})}const qy=({statusMessage:e,logMessage:t})=>l.jsxs("div",{className:"sr-only",children:[l.jsx("div",{"aria-live":"polite","aria-atomic":"true",children:e}),l.jsx("div",{"aria-live":"polite","aria-atomic":"true",children:t})]}),Qy=({children:e})=>{const[t,s]=n.useState(""),[a,r]=n.useState(""),o=n.useRef(null),i=zf(),c=n.useMemo(()=>({start:i("com_a11y_start"),end:i("com_a11y_end"),composing:i("com_a11y_ai_composing")}),[i]),d=n.useCallback(e=>{o.current&&clearTimeout(o.current),s(e),o.current=setTimeout(()=>{s("")},1e3)},[]),u=n.useCallback(e=>{r(e)},[]),m=n.useCallback(({message:e,isStatus:t=!1})=>{const n=(c[e]??e).replace(/[*`_]/g,"");t?d(n):u(n)},[c,d,u]),p={announcePolite:m,announceAssertive:m};return n.useEffect(()=>()=>{o.current&&clearTimeout(o.current)},[]),l.jsxs(rv.Provider,{value:p,children:[e,l.jsx(qy,{statusMessage:t,logMessage:a})]})},Zy=({children:e})=>l.jsx("div",{role:"alert","aria-live":"assertive",className:"relative mt-6 rounded-xl border border-red-500/20 bg-red-50/50 px-6 py-4 text-red-700 shadow-sm transition-all dark:bg-red-950/30 dark:text-red-100",children:e}),Jy=({id:e,enabled:t,serverDomain:n,oauthPath:s,Icon:a,label:r})=>t?l.jsx("div",{className:"mt-2 flex gap-x-2",children:l.jsxs("a",{"aria-label":`${r}`,className:"flex w-full items-center space-x-3 rounded-2xl border border-border-light bg-surface-primary px-5 py-3 text-text-primary transition-colors duration-200 hover:bg-surface-tertiary",href:`${n}/oauth/${s}`,"data-testid":e,children:[l.jsx(a,{}),l.jsx("p",{children:r})]})}):null;const Yy=n.forwardRef(function(e,t){const s=n.useRef(null);return n.useEffect(()=>{const e=s.current;if(!e)return;const t=()=>{const t="true"===e.getAttribute("aria-selected");e.setAttribute("data-state",t?"active":"inactive")};t();const n=new MutationObserver(t);return n.observe(e,{attributes:!0,attributeFilter:["aria-selected"]}),()=>n.disconnect()},[]),l.jsx(Q,{ref:e=>{s.current=e,"function"==typeof t?t(e):t&&(t.current=e)},...e,className:`animated-tab aria-selected:text-token-text-primary flex select-none items-center justify-center gap-2 whitespace-nowrap border-none text-sm font-medium outline-none transition-colors aria-disabled:opacity-50 ${e.className||""}`})}),Xy=n.forwardRef(function(e,t){const s=Z(),a=function(e){const t=n.useRef();return n.useEffect(()=>{t.current=e},[e]),t.current}(J(s,"selectedId")),r=e.tabId&&a===e.tabId;return l.jsx(Y,{ref:t,...e,"data-was-open":r||void 0,className:`animated-tab-panel max-w-full ${e.className||""}`})});function e_({tabs:e,className:t="",tabListClassName:s="",tabClassName:a="",tabPanelClassName:r="",containerClassName:o="",tabListProps:i={},defaultSelectedId:c}){const d=e.map((e,t)=>e.id||`tab-${t}`),u=c||d[0],m=n.useRef(null);return n.useEffect(()=>{const e=m.current;if(!e)return;const t=()=>{const t=e.querySelector('[data-state="active"]');t&&(e.style.setProperty("--tab-left",`${t.offsetLeft}px`),e.style.setProperty("--tab-width",`${t.offsetWidth}px`))};t();const n=new MutationObserver(t);return n.observe(e,{attributes:!0,subtree:!0,attributeFilter:["data-state"]}),()=>n.disconnect()},[e]),l.jsx("div",{className:`w-full ${t}`,children:l.jsxs(X,{defaultSelectedId:u,children:[l.jsx(ee,{ref:m,"aria-label":"Tabs",className:`animated-tab-list flex py-1 ${s}`,...i,children:e.map((e,t)=>l.jsx(Yy,{id:d[t],disabled:e.disabled,className:a,"data-state":d[t]===u?"active":"inactive",children:e.label},d[t]))}),l.jsx("div",{className:Op("animated-panels relative flex w-full flex-col items-center overflow-hidden p-0",o),children:e.map((e,t)=>l.jsx(Xy,{id:`panel-${d[t]}`,tabId:d[t],className:r,children:e.content},`panel-${d[t]}`))})]})})}const t_=({className:e="",children:t,...n})=>l.jsx(gs,{className:Op(e),...n,children:l.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center sm:items-center",children:t})});t_.displayName=gs.displayName;const n_=n.forwardRef(({className:e="",...t},n)=>l.jsx(us,{className:Op("fixed inset-0 z-50 bg-gray-500/90 transition-opacity animate-in fade-in dark:bg-gray-800/90",e),...t,ref:n}));n_.displayName=us.displayName;n.forwardRef(({className:e="",...t},n)=>l.jsxs(t_,{children:[l.jsx(n_,{}),l.jsx(ms,{ref:n,className:Op("fixed z-50 grid w-full max-w-lg scale-100 gap-4 bg-white p-6 opacity-100 animate-in fade-in-90 slide-in-from-bottom-10 sm:rounded-lg sm:zoom-in-90 sm:slide-in-from-bottom-0 md:w-full","dark:bg-gray-900",e),...t})]})).displayName=ms.displayName;n.forwardRef(({className:e="",...t},n)=>l.jsx(ps,{ref:n,className:Op("text-lg font-semibold text-gray-900","dark:text-gray-50",e),...t})).displayName=ps.displayName;n.forwardRef(({className:e="",...t},n)=>l.jsx(hs,{ref:n,className:Op("text-sm text-gray-500","dark:text-gray-400",e),...t})).displayName=hs.displayName;n.forwardRef(({className:e="",...t},n)=>l.jsx(xs,{ref:n,className:Op("inline-flex h-10 items-center justify-center rounded-md bg-gray-900 px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-gray-100 dark:text-gray-900 dark:hover:bg-gray-100 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900",e),...t})).displayName=xs.displayName;n.forwardRef(({className:e="",...t},n)=>l.jsx(fs,{ref:n,className:Op("mt-2 inline-flex h-10 items-center justify-center rounded-md border border-gray-200 bg-transparent px-4 py-2 text-sm font-semibold text-gray-900 transition-colors hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-700 dark:text-gray-100 dark:hover:bg-gray-800 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900 sm:mt-0",e),...t})).displayName=fs.displayName;const s_=n.forwardRef(({...e},t)=>l.jsx("nav",{ref:t,"aria-label":"breadcrumb",...e}));s_.displayName="Breadcrumb";const a_=n.forwardRef(({className:e,...t},n)=>l.jsx("ol",{ref:n,className:Op("text-muted-foreground flex flex-wrap items-center gap-1.5 break-words text-sm sm:gap-2.5",e),...t}));a_.displayName="BreadcrumbList";const r_=n.forwardRef(({className:e,...t},n)=>l.jsx("li",{ref:n,className:Op("inline-flex items-center gap-1.5",e),...t}));r_.displayName="BreadcrumbItem";const o_=n.forwardRef(({asChild:e,className:t,...n},s)=>{const a=e?vs:"a";return l.jsx(a,{ref:s,className:Op("hover:text-foreground transition-colors",t),...n})});o_.displayName="BreadcrumbLink";n.forwardRef(({className:e,...t},n)=>l.jsx("span",{ref:n,role:"link","aria-disabled":"true","aria-current":"page",className:Op("text-foreground font-normal",e),...t})).displayName="BreadcrumbPage";const i_=({children:e,className:t,...n})=>l.jsx("li",{role:"presentation","aria-hidden":"true",className:Op("[&>svg]:size-3.5",t),...n,children:e??l.jsx(te,{})});i_.displayName="BreadcrumbSeparator";const l_=ne("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-surface-destructive text-destructive-foreground hover:bg-surface-destructive-hover",outline:"text-text-primary border border-border-light bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-surface-hover hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",submit:"bg-surface-submit text-black hover:bg-surface-submit-hover border border-border-light"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-lg px-3",lg:"h-11 rounded-lg px-8",icon:"size-10"}},defaultVariants:{variant:"default",size:"default"}}),c_=n.forwardRef(({className:e,variant:t,size:n,asChild:s=!1,...a},r)=>{const o=s?vs:"button";return l.jsx(o,{className:Op(l_({variant:t,size:n,className:e})),ref:r,...a})});c_.displayName="Button";const d_=n.forwardRef(({className:e="",...t},n)=>l.jsx(bs,{ref:n,className:Op("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:l.jsx(ys,{className:Op("flex items-center justify-center"),children:l.jsx(se,{className:"h-4 w-4"})})}));d_.displayName=bs.displayName;const u_=Es,m_=Ms,p_=Ps;n.forwardRef(({className:e="",inset:t,children:n,...s},a)=>l.jsxs(_s,{ref:a,className:Op("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm font-medium outline-none focus:bg-gray-100 data-[state=open]:bg-gray-100 dark:focus:bg-gray-900 dark:data-[state=open]:bg-gray-900",t?"pl-8":"",e),...s,children:[n,l.jsx(te,{className:"ml-auto h-4 w-4"})]})).displayName=_s.displayName;n.forwardRef(({className:e="",...t},n)=>l.jsx(js,{ref:n,className:Op("z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-100 bg-white p-1 text-gray-700 shadow-md animate-in slide-in-from-left-1 dark:border-gray-800 dark:bg-gray-800 dark:text-gray-400",e),...t})).displayName=js.displayName;const h_=n.forwardRef(({className:e="",sideOffset:t=4,...n},s)=>l.jsx(ws,{children:l.jsx(Ns,{ref:s,sideOffset:t,className:Op("z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-100 bg-white p-1 text-gray-700 shadow-md animate-in data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-800 dark:text-gray-400",e),...n})}));h_.displayName=Ns.displayName;const x_=n.forwardRef(({className:e="",inset:t,...n},s)=>l.jsx(Cs,{ref:s,className:Op("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm font-medium outline-none focus:bg-gray-100 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-900",t?"pl-8":"",e),...n}));x_.displayName=Cs.displayName;const f_=n.forwardRef(({className:e="",children:t,checked:n,...s},a)=>l.jsxs(ks,{ref:a,className:Op("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm font-medium outline-none focus:bg-gray-100 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-900",e),checked:n,...s,children:[l.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:l.jsx(Ss,{children:l.jsx(se,{className:"h-4 w-4"})})}),t]}));f_.displayName=ks.displayName;n.forwardRef(({className:e="",children:t,...n},s)=>l.jsxs(Ts,{ref:s,className:Op(e,"relative flex cursor-pointer select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm font-medium outline-none focus:bg-gray-100 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800"),...n,children:[l.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:l.jsx(Ss,{children:l.jsx(ae,{className:"h-2 w-2 fill-current"})})}),t]})).displayName=Ts.displayName;n.forwardRef(({className:e="",inset:t,...n},s)=>l.jsx(Rs,{ref:s,className:Op("px-2 py-1.5 text-sm font-semibold text-gray-900 dark:text-gray-300",t?"pl-8":"",e),...n})).displayName=Rs.displayName;const g_=n.forwardRef(({className:e="",...t},n)=>l.jsx(Is,{ref:n,className:Op("-mx-1 my-1 h-px bg-border-medium",e),...t}));g_.displayName=Is.displayName;const v_=Vs,b_=$s,y_=({className:e="",children:t,...n})=>l.jsx(Ls,{className:Op(e),...n,children:l.jsx("div",{className:"fixed inset-0 z-[999] flex items-start justify-center sm:items-center",children:t})});y_.displayName=Ls.displayName;const __=n.forwardRef(({className:e,...t},n)=>l.jsx(As,{className:Op("fixed inset-0 z-[999] bg-gray-600/65 transition-all duration-100 data-[state=closed]:animate-out data-[state=closed]:fade-out data-[state=open]:fade-in dark:bg-black/80",e??""),...t,ref:n}));__.displayName=As.displayName;const j_=n.forwardRef(({className:e,children:t=!0,showCloseButton:n=!0,disableScroll:s=!1,...a},r)=>{const o=Uy("(max-width: 768px)");return l.jsxs(y_,{children:[l.jsx(__,{}),l.jsxs(Os,{ref:r,className:Op("fixed z-[999] grid w-full gap-4 rounded-b-lg bg-white pb-6 animate-in data-[state=open]:fade-in-90 data-[state=open]:slide-in-from-bottom-10 sm:rounded-lg","dark:bg-gray-700",o?"fixed left-1/2 top-1/2 z-[999] m-auto grid w-11/12 -translate-x-1/2 -translate-y-1/2 gap-4 rounded-xl bg-white pb-6":"",s?"overflow-hidden":"",e??""),...a,children:[t,n&&l.jsxs(Ds,{className:"absolute right-6 top-[1.6rem] rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-gray-100 dark:focus:ring-white dark:focus:ring-offset-gray-700 dark:data-[state=open]:bg-gray-800",children:[l.jsx(re,{className:"h-5 w-5 text-black dark:text-white"}),l.jsx("span",{className:"sr-only",children:"Close"})]})]})]})});j_.displayName=Os.displayName;const w_=({className:e,...t})=>l.jsx("div",{className:Op("flex flex-col space-y-2 border-b border-black/10 p-6 pb-4 text-left dark:border-white/10",e??""),...t});w_.displayName="DialogHeader";const N_=({className:e,...t})=>l.jsx("div",{className:Op("flex flex-row justify-between space-x-2 px-6 py-4",e??""),...t});N_.displayName="DialogFooter";const C_=n.forwardRef(({className:e,...t},n)=>l.jsx(zs,{ref:n,className:Op("text-lg font-semibold text-gray-900","dark:text-gray-50",e??""),...t}));C_.displayName=zs.displayName;const k_=n.forwardRef(({className:e,...t},n)=>l.jsx(Fs,{ref:n,className:Op("text-sm text-gray-500","dark:text-gray-400",e??""),...t}));k_.displayName=Fs.displayName;const S_=n.forwardRef(({className:e,...t},n)=>l.jsx(Ds,{ref:n,className:Op("mt-2 inline-flex h-10 items-center justify-center rounded-lg border border-gray-200 bg-transparent px-4 py-2 text-sm font-semibold text-gray-900 transition-colors hover:bg-gray-100 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-700 dark:text-gray-100 dark:hover:bg-gray-800 sm:mt-0",e??"","focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900"),...t}));S_.displayName=zs.displayName;n.forwardRef(({className:e,...t},n)=>l.jsx(c_,{ref:n,variant:"outline",className:Op("mt-2 inline-flex h-10 items-center justify-center rounded-lg border border-gray-200 bg-transparent px-4 py-2 text-sm font-semibold text-gray-900 transition-colors hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-700 dark:text-gray-100 dark:hover:bg-gray-800 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900 sm:mt-0",e??"","focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900"),...t})).displayName=zs.displayName;const T_=Us,R_=Hs,I_=Ks,E_=n.forwardRef(({className:e="",align:t="center",sideOffset:n=6,disabled:s=!1,...a},r)=>s?null:l.jsx(Bs,{ref:r,align:t,sideOffset:n,className:Op("z-50 w-64 origin-[--radix-hover-card-content-transform-origin] rounded-xl border border-border-light bg-surface-secondary p-4 text-text-primary shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a}));E_.displayName=Bs.displayName;const M_=n.forwardRef(({className:e,...t},n)=>l.jsx("input",{className:Op("flex h-10 w-full rounded-lg border border-input bg-transparent px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",e??""),ref:n,...t}));M_.displayName="Input";const P_=n.forwardRef(({className:e,...t},n)=>l.jsx(oe,{className:Op("flex max-h-5 w-full rounded-md border border-gray-300 bg-transparent px-3 py-2 text-sm placeholder:text-gray-400 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-700 dark:text-gray-50",e??""),ref:n,...t}));P_.displayName="Input";const L_=n.forwardRef(({className:e="",...t},n)=>l.jsx(Gs,{ref:n,className:Op("block w-full break-all text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-200",e),...t}));L_.displayName=Gs.displayName;const A_=n.forwardRef(({children:e,triggerRef:t,triggerRefs:n,onOpenChange:s,...a},r)=>l.jsx(Vs,{...a,onOpenChange:e=>{!e&&(null==t?void 0:t.current)&&setTimeout(()=>{var e;null==(e=t.current)||e.focus()},0),(null==n?void 0:n.length)&&n.forEach(e=>{(null==e?void 0:e.current)&&setTimeout(()=>{var t;null==(t=e.current)||t.focus()},0)}),null==s||s(e)},children:e})),O_=$s,D_=Ls,z_=Ds,F_=n.forwardRef(({className:e,...t},n)=>l.jsx(As,{ref:n,className:Op("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));F_.displayName=As.displayName;const V_=n.forwardRef(({className:e,overlayClassName:t,showCloseButton:n=!0,children:s,...a},r)=>l.jsxs(D_,{children:[l.jsx(F_,{className:t}),l.jsxs(Os,{ref:r,className:Op("max-w-11/12 fixed left-[50%] top-[50%] z-50 grid w-full translate-x-[-50%] translate-y-[-50%] gap-4 rounded-2xl bg-background p-6 text-text-primary shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",e),...a,children:[s,n&&l.jsxs(Ds,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-ring-primary ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[l.jsx(re,{className:"h-4 w-4"}),l.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));V_.displayName=Os.displayName;const $_=({className:e,...t})=>l.jsx("div",{className:Op("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});$_.displayName="DialogHeader";const B_=({className:e,...t})=>l.jsx("div",{className:Op("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});B_.displayName="DialogFooter";const U_=n.forwardRef(({className:e,...t},n)=>l.jsx(zs,{ref:n,className:Op("text-lg font-semibold leading-none tracking-tight",e),...t}));U_.displayName=zs.displayName;const H_=n.forwardRef(({className:e,...t},n)=>l.jsx(Fs,{ref:n,className:Op("text-sm text-muted-foreground",e),...t}));H_.displayName=Fs.displayName;const K_=n.forwardRef(({className:e,onDoubleClick:t,...n},s)=>l.jsxs(Ws,{ref:s,className:Op("relative flex w-full cursor-pointer touch-none select-none items-center",e),onDoubleClick:t,...n,children:[l.jsx(qs,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:l.jsx(Qs,{className:"absolute h-full bg-primary"})}),l.jsx(Zs,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));K_.displayName=Ws.displayName;const G_=n.forwardRef(({className:e="",orientation:t="horizontal",decorative:n=!0,...s},a)=>l.jsx(Js,{ref:a,decorative:n,orientation:t,className:Op("shrink-0 bg-border-light","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",e),...s}));G_.displayName=Js.displayName;const W_=({label:e,labelClassName:t,placeholder:n="Select an option",options:s,className:a,value:r,onChange:o,onBlur:i})=>{const c=e=>null!=e&&"object"==typeof e&&"value"in e,[d,u]=m.useState(!1),[p,h]=m.useState(r),[x,f]=m.useState(!1);m.useEffect(()=>{h(r)},[r]);const g=e=>{h(e),o(e)};return l.jsxs(ie,{value:p,setValue:g,children:[null!=e&&l.jsx(le,{className:Op("mb-2 block text-sm font-medium text-text-primary",t??""),children:e}),l.jsx("div",{className:Op("relative",x?"rounded-md ring-2 ring-ring-primary":""),children:l.jsx(ce,{placeholder:n,className:Op("h-10 w-full rounded-md border border-border-light bg-surface-primary px-3 py-2 text-sm","placeholder-text-secondary hover:bg-surface-hover","focus:outline-none",a),onChange:e=>g(e.target.value),onBlur:()=>{f(!1),i()},onFocusVisible:()=>{f(!0),u(!0)},onMouseDown:()=>{f(!1)}})}),l.jsx(de,{gutter:4,sameWidth:!0,open:d,onClose:()=>u(!1),className:Op("z-50 max-h-60 w-full overflow-auto rounded-md bg-surface-primary p-1 shadow-lg","animate-in fade-in-0 zoom-in-95"),children:s.map((e,t)=>l.jsxs(ue,{className:Op("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none","cursor-pointer hover:bg-surface-tertiary hover:text-text-primary","data-[active-item]:bg-surface-tertiary data-[active-item]:text-text-primary"),value:c(e)?`${e.value??""}`:e,children:[c(e)&&null!=e.icon&&l.jsx("span",{className:"mr-2 flex-shrink-0",children:e.icon}),c(e)?e.label:e]},t))})]})};function q_({className:e,...t}){return l.jsx("div",{className:Op("animate-pulse rounded-md bg-surface-tertiary opacity-50 dark:opacity-25",e),...t})}const Q_=n.forwardRef(({className:e,...t},n)=>l.jsx(Ys,{className:Op("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-unchecked",e),...t,ref:n,children:l.jsx(Xs,{className:Op("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Q_.displayName=Ys.displayName;const Z_=n.forwardRef(({className:e,...t},n)=>l.jsx("div",{className:"relative w-full overflow-auto",children:l.jsx("table",{ref:n,className:Op("w-full caption-bottom text-sm",e),...t})}));Z_.displayName="Table";const J_=n.forwardRef(({className:e,...t},n)=>l.jsx("thead",{ref:n,className:Op("[&_tr]:border-b",e),...t}));J_.displayName="TableHeader";const Y_=n.forwardRef(({className:e,...t},n)=>l.jsx("tbody",{ref:n,className:Op("[&_tr:last-child]:border-0",e),...t}));Y_.displayName="TableBody";n.forwardRef(({className:e,...t},n)=>l.jsx("tfoot",{ref:n,className:Op("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";const X_=n.forwardRef(({className:e,...t},n)=>l.jsx("tr",{ref:n,className:Op("border-b border-border-light transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));X_.displayName="TableRow";const ej=n.forwardRef(({className:e,...t},n)=>l.jsx("th",{ref:n,className:Op("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));ej.displayName="TableHead";const tj=n.forwardRef(({className:e,...t},n)=>l.jsx("td",{ref:n,className:Op("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));tj.displayName="TableCell";n.forwardRef(({className:e,...t},n)=>l.jsx("caption",{ref:n,className:Op("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption";n.forwardRef(({className:e="",...t},n)=>l.jsx(ea,{ref:n,className:Op("inline-flex items-center justify-center rounded-md bg-surface-primary",e),...t})).displayName=ea.displayName;n.forwardRef(({className:e="",...t},n)=>l.jsx(ta,{className:Op("inline-flex min-w-[100px] items-center justify-center rounded-[0.185rem] px-3 py-1.5 text-sm font-medium text-gray-700 transition-all disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-800 data-[state=active]:shadow-sm dark:data-[state=active]:bg-gray-700 dark:data-[state=active]:text-gray-200",e),...t,ref:n})).displayName=ta.displayName;n.forwardRef(({className:e="",...t},n)=>l.jsx(na,{className:Op("mt-2 rounded-md p-6",e),...t,ref:n})).displayName=na.displayName;const nj=n.forwardRef(({CancelButton:e,LabelNode:t,label:n,onRemove:s,className:a="",labelClassName:r="",...o},i)=>l.jsxs("div",{ref:i,...o,className:Op("flex max-h-8 items-center overflow-y-hidden rounded-3xl border-2 border-gray-400 bg-white text-xs text-black dark:border-gray-600 dark:bg-gray-800 dark:text-white",a),children:[l.jsxs("div",{className:Op("ml-1 whitespace-pre-wrap px-2 py-1",r),children:[t?l.jsxs(l.Fragment,{children:[t," "]}):null,n]}),e||s&&l.jsx("button",{onClick:e=>{e.stopPropagation(),s(e)},className:"rounded-full bg-gray-300 dark:bg-gray-600","aria-label":`Remove ${n}`,children:l.jsx(re,{className:"m-[1.5px] p-1"})})]}));nj.displayName="Tag";const sj=n.memo(nj);n.forwardRef(({className:e="",...t},n)=>l.jsx("textarea",{className:Op("flex h-20 w-full resize-none rounded-md border border-gray-300 bg-transparent px-3 py-2 text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-700 dark:text-gray-50 dark:focus:ring-gray-400 dark:focus:ring-offset-gray-900",e),ref:n,...t})).displayName="Textarea";const aj=n.forwardRef((e,t)=>{const[,s]=n.useState(!1),a=_(sx.chatDirection).toLowerCase();return n.useLayoutEffect(()=>s(!0),[]),l.jsx(me,{dir:a,...e,ref:t})}),rj=n.forwardRef(function({description:e,side:t="top",className:s,role:a,...r},o){const i=pe({placement:t}),c=J(i,e=>e.mounted),d=J(i,e=>e.placement),{x:u,y:m}=n.useMemo(()=>{switch(d.split("-")[0]){case"top":return{x:0,y:-8};case"bottom":return{x:0,y:8};case"left":return{x:-8,y:0};case"right":return{x:8,y:0};default:return{x:0,y:0}}},[d]);return l.jsxs(he,{store:i,hideTimeout:0,children:[l.jsx(xe,{...r,ref:o,role:a,onKeyDown:e=>{"button"===a&&"Enter"===e.key&&(e.preventDefault(),e.target.click())},className:Op("cursor-pointer",s)}),l.jsx(Or,{children:!0===c&&l.jsxs(fe,{gutter:4,alwaysVisible:!0,className:"tooltip",render:l.jsx(Dr.div,{initial:{opacity:0,x:u,y:m},animate:{opacity:1,x:0,y:0},exit:{opacity:0,x:u,y:m}}),children:[l.jsx(ge,{}),e]})})]})});n.forwardRef(({className:e,...t},n)=>l.jsx("ul",{ref:n,className:Op("flex flex-row items-center gap-1",e),...t})).displayName="PaginationContent";n.forwardRef(({className:e,...t},n)=>l.jsx("li",{ref:n,className:Op("",e),...t})).displayName="PaginationItem";const oj=n.forwardRef(({className:e,value:t,...n},s)=>l.jsx(sa,{ref:s,className:Op("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",e),...n,children:l.jsx(aa,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));oj.displayName=sa.displayName;const ij=n.forwardRef(({className:e,containerClassName:t,...n},s)=>l.jsx(ve,{ref:s,containerClassName:Op("flex items-center gap-2 has-[:disabled]:opacity-50",t),className:Op("disabled:cursor-not-allowed",e),...n}));ij.displayName="InputOTP";const lj=n.forwardRef(({className:e,...t},n)=>l.jsx("div",{ref:n,className:Op("flex items-center",e),...t}));lj.displayName="InputOTPGroup";const cj=n.forwardRef(({index:e,className:t,...s},a)=>{const r=n.useContext(be),{char:o,hasFakeCaret:i,isActive:c}=r.slots[e];return l.jsxs("div",{ref:a,className:Op("text-md relative flex h-11 w-11 items-center justify-center border-y border-r border-input shadow-sm transition-all first:rounded-l-xl first:border-l last:rounded-r-xl",c&&"z-10 ring-1 ring-ring",t),...s,children:[o,i&&l.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:l.jsx("div",{className:"animate-caret-blink h-4 w-px bg-foreground duration-1000"})})]})});cj.displayName="InputOTPSlot";const dj=n.forwardRef(({...e},t)=>l.jsx("div",{ref:t,role:"separator",...e,children:l.jsx(ye,{})}));function uj({icon:e,label:t,id:n,isActive:s=!1,isEditing:a=!1,isDragging:r=!1,isAvailable:o=!0,isInChat:i=!1,onBadgeAction:c,onToggle:d,className:u,...m}){const p=a&&o,h="1"===n&&i;return l.jsxs(Dr.button,{onClick:e=>{if(h)return e.preventDefault(),void e.stopPropagation();!a&&d&&(e.preventDefault(),e.stopPropagation(),d())},className:Op("group relative inline-flex items-center gap-1.5 rounded-full px-4 py-1.5","border border-border-medium text-sm font-medium transition-shadow md:w-full","size-9 p-2 md:p-3",s?"bg-surface-active shadow-md":"bg-surface-chat shadow-sm hover:bg-surface-hover hover:shadow-md","active:scale-95 active:shadow-inner",p&&"cursor-move",h&&"cursor-not-allowed opacity-50 hover:shadow-sm",u),animate:{scale:r?1.1:1,boxShadow:r?"0 10px 25px rgba(0,0,0,0.1)":void 0},whileTap:{scale:r?1.1:h?1:.97},transition:{type:"tween",duration:.1,ease:"easeOut"},...m,children:[e&&l.jsx(e,{className:Op("relative h-5 w-5 md:h-4 md:w-4",!t&&"mx-auto")}),l.jsx("span",{className:"relative hidden md:inline",children:t}),a&&!r&&l.jsx(Dr.button,{className:"absolute -right-1 -top-1 flex h-6 w-6 items-center justify-center rounded-full bg-surface-secondary-alt text-text-primary shadow-sm md:h-5 md:w-5",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},whileTap:{scale:.9},onMouseDown:e=>e.stopPropagation(),onClick:e=>{e.stopPropagation(),null==c||c()},children:o?l.jsx(re,{className:"h-3 w-3"}):l.jsx(_e,{className:"h-3 w-3"})})]})}dj.displayName="InputOTPSeparator";n.forwardRef(({className:e="",children:t,...n},s)=>l.jsxs(zr,{ref:s,className:Op("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-gray-200 border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 [&>span]:line-clamp-1","rounded-lg hover:bg-gray-100/50 dark:hover:bg-gray-700",e),...n,children:[t,l.jsx(Fr,{asChild:!0,children:l.jsx(ra,{className:"h-4 w-4 opacity-50"})})]})).displayName=zr.displayName;const mj=n.forwardRef(({className:e="",...t},n)=>l.jsx(Vr,{ref:n,className:Op("flex cursor-default items-center justify-center py-1 dark:text-white",e),...t,children:l.jsx(oa,{})}));mj.displayName=Vr.displayName;const pj=n.forwardRef(({className:e="",...t},n)=>l.jsx($r,{ref:n,className:Op("flex cursor-default items-center justify-center py-1 dark:text-white",e),...t,children:l.jsx(ia,{})}));pj.displayName=$r.displayName;n.forwardRef(({className:e="",children:t,position:n="popper",...s},a)=>l.jsx(Br,{children:l.jsxs(Ur,{ref:a,className:Op("bg-popover text-popover-foreground relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-600","popper"===n?"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1":"",e),position:n,...s,children:[l.jsx(mj,{}),l.jsx(Hr,{className:Op("p-1","popper"===n?"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]":""),children:t}),l.jsx(pj,{})]})})).displayName=Ur.displayName;n.forwardRef(({className:e="",...t},n)=>l.jsx(Kr,{ref:n,className:Op("px-2 py-1.5 text-sm font-semibold",e),...t})).displayName=Kr.displayName;n.forwardRef(({className:e="",children:t,...n},s)=>l.jsxs(Gr,{ref:s,className:Op("relative flex w-full cursor-pointer select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50","rounded-lg hover:bg-gray-100/50 dark:hover:bg-gray-700",e),...n,children:[l.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:l.jsx(Wr,{children:l.jsx(la,{className:"h-4 w-4"})})}),l.jsx(qr,{children:t})]})).displayName=Gr.displayName;n.forwardRef(({className:e="",...t},n)=>l.jsx(Qr,{ref:n,className:Op("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=Qr.displayName;const hj=e=>"object"==typeof e&&"divider"in e,xj=e=>"object"==typeof e&&"value"in e&&"label"in e,fj=({value:e,label:t="",onChange:n,options:s,className:a="",sizeClasses:r,testId:o="dropdown-menu",icon:i,iconOnly:c=!1,renderValue:d,ariaLabel:u,portal:m=!0})=>{const p=je({value:e,setValue:e=>{n(e)}}),h=e=>{if(null!=e&&""!==e)return s.filter(e=>!hj(e)).map(e=>"string"==typeof e?{value:e,label:e}:e).find(t=>xj(t)&&t.value===e)};return l.jsxs("div",{className:Op("relative",a),children:[l.jsxs(we,{store:p,className:Op("focus:ring-offset-ring-offset relative inline-flex items-center justify-between rounded-xl border border-input bg-background px-3 py-2 text-sm text-text-primary transition-all duration-200 ease-in-out hover:bg-accent hover:text-accent-foreground focus:ring-ring-primary",c?"h-full w-10":"w-fit gap-2",a),"data-testid":o,"aria-label":u,children:[l.jsxs("div",{className:"flex w-full items-center gap-2",children:[i,!c&&l.jsxs("span",{className:"block truncate",children:[t,(()=>{const t=h(e);return t&&d?d(t):(e=>{if(null==e||""===e)return"";const t=h(e);return t?t.label:e})(e)})()]})]}),!c&&l.jsx(Ne,{})]}),l.jsx(Ce,{portal:m,store:p,className:Op("popover-ui",r,a,"max-h-[80vh] overflow-y-auto"),children:s.map((t,n)=>{if(hj(t))return l.jsx("div",{className:"my-1 border-t border-border-heavy"},`divider-${n}`);const s="string"==typeof t?{value:t,label:t}:t;return xj(s)?l.jsx(ke,{value:String(s.value),className:"select-item","data-theme":s.value,children:l.jsxs("div",{className:"flex w-full items-center gap-2",children:[null!=s.icon&&l.jsx("span",{children:s.icon}),l.jsx("span",{className:"block truncate",children:s.label}),e===s.value&&l.jsx("span",{className:"ml-auto pl-2",children:l.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-md block group-hover:hidden",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})})]})},`option-${n}`):null})})]})},gj=e=>{if("undefined"!=typeof Intl&&Intl.Segmenter){const t=new Intl.Segmenter("en",{granularity:"grapheme"}).segment(e);return Array.from(t).map(e=>e.segment)}return[...e]},vj=({text:e="",className:t="",delay:s=100,animationFrom:a={opacity:0,transform:"translate3d(0,40px,0)"},animationTo:r={opacity:1,transform:"translate3d(0,0,0)"},easing:o=e=>e,threshold:i=.1,rootMargin:c="-100px",textAlign:d="center",onLetterAnimationComplete:u,onLineCountChange:m})=>{const p=e.split(" ").map(gj),h=p.flat(),[x,f]=n.useState(!1),g=n.useRef(null),v=n.useRef(0),b=Zr(h.length,h.map((e,t)=>({from:a,to:x?async e=>{await e(r),v.current+=1,v.current===h.length&&u&&u()}:a,delay:t*s,config:{easing:o}})));return n.useEffect(()=>{const e=new IntersectionObserver(([t])=>{t.isIntersecting&&(f(!0),g.current&&e.unobserve(g.current))},{threshold:i,rootMargin:c});return g.current&&e.observe(g.current),()=>e.disconnect()},[i,c]),n.useEffect(()=>{if(g.current&&x){const e=g.current;setTimeout(()=>{const t=parseInt(getComputedStyle(e).lineHeight)||1.2*parseInt(getComputedStyle(e).fontSize),n=e.offsetHeight,s=Math.round(n/t);m&&m(s)},100)}},[x,e,m]),l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"sr-only",children:e}),l.jsx("p",{ref:g,className:`split-parent inline overflow-hidden ${t}`,style:{textAlign:d,whiteSpace:"normal",wordWrap:"break-word"},"aria-hidden":"true",children:p.map((e,t)=>l.jsxs("span",{style:{display:"inline-block",whiteSpace:"nowrap"},children:[e.map((e,n)=>{const s=p.slice(0,t).reduce((e,t)=>e+t.length,0)+n;return l.jsx(Jr.span,{style:b[s],className:"inline-block transform transition-opacity will-change-transform",children:e},s)}),t<p.length-1&&l.jsx("span",{style:{display:"inline-block",width:"0.3em"},children:""})]},t))})]})};function bj({field:e,label:t,labelClass:n,inputClass:s,containerClass:a,labelAdjacent:r,placeholder:o="",type:i="string"}){return l.jsxs("div",{className:Op("flex w-full flex-col items-center gap-2",a),children:[l.jsxs("div",{className:"flex w-full items-center justify-start gap-2",children:[l.jsx(L_,{htmlFor:`${e.name}-input`,className:Op("text-left text-sm font-semibold text-text-primary",n),children:t}),r]}),l.jsx(M_,{id:`${e.name}-input`,value:e.value??"",onChange:t=>{const n=t.target.value;"number"===i?""===n?e.onChange(n):isNaN(Number(n))||e.onChange(Number(n)):e.onChange(n)},placeholder:o,className:Op("flex h-10 max-h-10 w-full resize-none border-none bg-surface-secondary px-3 py-2",s)})]})}class yj{constructor(e,n,s,a,r,o,i,l){t(this,"width"),t(this,"height"),t(this,"ctx"),t(this,"x"),t(this,"y"),t(this,"color"),t(this,"speed"),t(this,"size"),t(this,"sizeStep"),t(this,"minSize"),t(this,"maxSizeInteger"),t(this,"maxSize"),t(this,"delay"),t(this,"counter"),t(this,"counterStep"),t(this,"isIdle"),t(this,"isReverse"),t(this,"isShimmer"),t(this,"activationThreshold"),this.width=e.width,this.height=e.height,this.ctx=n,this.x=s,this.y=a,this.color=r,this.speed=this.random(.1,.9)*o,this.size=0,this.sizeStep=.4*Math.random(),this.minSize=.5,this.maxSizeInteger=2,this.maxSize=this.random(this.minSize,this.maxSizeInteger),this.delay=i,this.counter=0,this.counterStep=4*Math.random()+.01*(this.width+this.height),this.isIdle=!1,this.isReverse=!1,this.isShimmer=!1,this.activationThreshold=l}random(e,t){return Math.random()*(t-e)+e}draw(){const e=.5*this.maxSizeInteger-.5*this.size;this.ctx.fillStyle=this.color,this.ctx.fillRect(this.x+e,this.y+e,this.size,this.size)}appear(){this.isIdle=!1,this.counter<=this.delay?this.counter+=this.counterStep:(this.size>=this.maxSize&&(this.isShimmer=!0),this.isShimmer?this.shimmer():this.size+=this.sizeStep,this.draw())}appearWithProgress(e){if(e-this.activationThreshold<=0)this.isIdle=!0;else{if(this.counter<=this.delay)return this.counter+=this.counterStep,void(this.isIdle=!1);this.size>=this.maxSize&&(this.isShimmer=!0),this.isShimmer?this.shimmer():this.size+=this.sizeStep,this.isIdle=!1,this.draw()}}disappear(){this.isShimmer=!1,this.counter=0,this.size<=0?this.isIdle=!0:(this.size-=.1,this.draw())}shimmer(){this.size>=this.maxSize?this.isReverse=!0:this.size<=this.minSize&&(this.isReverse=!1),this.size+=this.isReverse?-this.speed:this.speed}}const _j=(e,t)=>{const n=parseInt(String(e),10);return n<=0||t?0:n>=100?.1:.001*n},jj=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),wj={default:{gap:5,speed:35,colors:"#f8fafc,#f1f5f9,#cbd5e1",noFocus:!1},blue:{gap:10,speed:25,colors:"#e0f2fe,#7dd3fc,#0ea5e9",noFocus:!1},yellow:{gap:3,speed:20,colors:"#fef08a,#fde047,#eab308",noFocus:!1},pink:{gap:6,speed:80,colors:"#fecdd3,#fda4af,#e11d48",noFocus:!0}};function Nj({variant:e="default",gap:t,speed:s,colors:a,noFocus:r,className:o="",progress:i,randomness:c=.3,width:d,height:u}){const m=n.useRef(null),p=n.useRef(null),h=n.useRef([]),x=n.useRef(),f=n.useRef(performance.now()),g=n.useRef(i),v=n.useRef(window.matchMedia("(prefers-reduced-motion: reduce)").matches).current,b=wj[e],y=t??b.gap,_=s??b.speed,j=a??b.colors,w=r??b.noFocus,N=n.useCallback(()=>{if(!p.current)return;if(void 0===g.current)return void(p.current.style.opacity="1");const e=g.current>=.9?1-(g.current-.9)/.1:1;p.current.style.opacity=String(jj(e))},[]),C=n.useCallback(e=>{var t;x.current=requestAnimationFrame(()=>C(e));const n=performance.now(),s=n-f.current;if(s<1e3/60)return;f.current=n-s%(1e3/60);const a=null==(t=p.current)?void 0:t.getContext("2d");if(!a||!p.current)return;a.clearRect(0,0,p.current.width,p.current.height);let r=!0;for(const o of h.current)"appearWithProgress"===e?void 0!==g.current?o.appearWithProgress(g.current):o.isIdle=!0:o[e](),o.isIdle||(r=!1);N(),r&&cancelAnimationFrame(x.current)},[N]),k=n.useCallback(e=>{cancelAnimationFrame(x.current),x.current=requestAnimationFrame(()=>C(e))},[C]),S=n.useCallback(()=>{if(!m.current||!p.current)return;const{width:e,height:t}=m.current.getBoundingClientRect(),n=p.current.getContext("2d");p.current.width=Math.floor(e),p.current.height=Math.floor(t);const s=j.split(","),a=[],r=e/2,o=t/2,i=Math.hypot(r,o);for(let l=0;l<e;l+=y)for(let e=0;e<t;e+=y){const t=s[Math.floor(Math.random()*s.length)],d=Math.hypot(l-r,e-o)/i,u=jj(d*(1-c)+Math.random()*c),m=v?0:d*i;n&&a.push(new yj(p.current,n,l,e,t,_j(_,v),m,u))}h.current=a,void 0!==g.current&&k("appearWithProgress")},[y,j,_,c,v,k]);n.useEffect(()=>{g.current=i,void 0!==i&&k("appearWithProgress")},[i,k]),n.useEffect(()=>{void 0===i&&cancelAnimationFrame(x.current)},[i]),n.useEffect(()=>{S();const e=new ResizeObserver(S);return m.current&&e.observe(m.current),()=>{e.disconnect(),cancelAnimationFrame(x.current)}},[S]);return l.jsx("div",{ref:m,style:{width:d||"100%",height:u||"100%"},children:l.jsx("div",{className:Op("relative isolate grid select-none place-items-center overflow-hidden rounded-lg border border-border-light shadow-md transition-colors duration-200 ease-in-out",o),style:{width:"100%",height:"100%",transitionTimingFunction:"cubic-bezier(0.5, 1, 0.89, 1)"},onMouseEnter:()=>void 0===g.current&&k("appear"),onMouseLeave:()=>void 0===g.current&&k("disappear"),onFocus:w?void 0:e=>{w||e.currentTarget.contains(e.relatedTarget)||void 0!==g.current||k("appear")},onBlur:w?void 0:e=>{w||e.currentTarget.contains(e.relatedTarget)||void 0!==g.current||k("disappear")},tabIndex:w?-1:0,children:l.jsx("canvas",{ref:p,className:"pointer-events-none absolute inset-0 block",width:d&&"auto"!==d?parseInt(String(d)):void 0,height:u&&"auto"!==u?parseInt(String(u)):void 0})})})}const Cj=n.forwardRef(({children:e,handleFileChange:t},n)=>l.jsxs(l.Fragment,{children:[e,l.jsx("input",{ref:n,multiple:!0,type:"file",style:{display:"none"},onChange:t})]}));Cj.displayName="FileUpload";const kj=({trigger:e,isOpen:t,setIsOpen:n,focusLoop:s,mountByState:a,...r})=>{const o=Se({open:t,setOpen:n,focusLoop:s});return a?l.jsxs(Te,{store:o,children:[e,t&&l.jsx(Sj,{...r})]}):l.jsxs(Te,{store:o,children:[e,l.jsx(Sj,{...r})]})},Sj=({items:e,menuId:t,keyPrefix:n,className:s,iconClassName:a,itemClassName:r,modal:o,portal:i,sameWidth:c,gutter:d=8,finalFocus:u,unmountOnHide:m,preserveTabOrder:p})=>{const h=Re();return l.jsx(Ie,{id:t,modal:o,gutter:d,portal:i,sameWidth:c,finalFocus:u,unmountOnHide:m,preserveTabOrder:p,className:Op("popover-ui z-50",s),children:e.filter(e=>!1!==e.show).map((e,t)=>!0===e.separate?l.jsx(Ee,{className:"my-1 h-px bg-white/10"},t):l.jsxs(Me,{id:e.id,className:Op("group flex w-full cursor-pointer items-center gap-2 rounded-lg px-3 py-3.5 text-sm text-text-primary outline-none transition-colors duration-200 hover:bg-surface-hover focus:bg-surface-hover md:px-2.5 md:py-2",r),disabled:e.disabled,render:e.render,ref:e.ref,hideOnClick:e.hideOnClick,onClick:t=>{t.preventDefault(),e.onClick&&e.onClick(t),!1!==e.hideOnClick&&(null==h||h.hide())},children:[null!=e.icon&&l.jsx("span",{className:Op("mr-2 size-4",a),"aria-hidden":"true",children:e.icon}),e.label,null!=e.kbd&&l.jsxs("kbd",{className:"ml-auto hidden font-sans text-xs text-black/50 group-hover:inline group-focus:inline dark:text-white/50",children:["",e.kbd]})]},`${n??""}${t}-${e.id??""}`))})},Tj=({delay:e,children:t})=>(e=>{const[t,s]=n.useState(!0),a=n.useRef(null);return n.useEffect(()=>{if(t){const t=new Promise(t=>{const n=setTimeout(()=>{s(!1),t()},e);return()=>{clearTimeout(n)}});a.current=t}return()=>{a.current=null}},[e,t]),e=>{if(t&&a.current)throw a.current;return e()}})(e)(()=>t),Rj=({theme:e,onChange:t})=>{const s={system:l.jsx(Ae,{}),dark:l.jsx(Le,{color:"white"}),light:l.jsx(Pe,{})},a="dark"===e?"light":"dark",r=`Switch to ${a} theme`;return n.useEffect(()=>{const e=e=>{e.ctrlKey&&e.shiftKey&&"t"===e.key.toLowerCase()&&(e.preventDefault(),t(a))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a,t]),l.jsx("button",{className:"flex items-center gap-2 rounded-lg p-2 transition-colors hover:bg-surface-hover focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2","aria-label":r,"aria-keyshortcuts":"Ctrl+Shift+T",onClick:e=>{e.preventDefault(),t(a)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t(a))},children:s[e]})},Ij=({returnThemeOnly:e})=>{const{theme:t,setTheme:s}=n.useContext(Nv),[a,r]=n.useState(""),o=n.useCallback(e=>{const t=Date.now();"number"==typeof window.lastThemeChange&&t-window.lastThemeChange<500||(window.lastThemeChange=t,s(e),r("dark"===e?"Dark theme enabled":"Light theme enabled"))},[s]);return n.useEffect(()=>{if("system"===t){const e=window.matchMedia("(prefers-color-scheme: dark)").matches;s(e?"dark":"light")}},[t,s]),n.useEffect(()=>{if(a){const e=setTimeout(()=>r(""),1e3);return()=>clearTimeout(e)}},[a]),!0===e?l.jsx(Rj,{theme:t,onChange:o}):l.jsxs("div",{className:"flex flex-col items-center justify-center bg-white pt-6 dark:bg-gray-900 sm:pt-0",children:[l.jsx("div",{className:"absolute bottom-0 left-0 m-4",children:l.jsx(Rj,{theme:t,onChange:o})}),a&&l.jsx("div",{"aria-live":"polite",className:"sr-only",children:a})]})};function Ej({value:e,onChange:t,placeholder:s,className:a=""}){const r=zf(),o=n.useRef(null),i=n.useCallback(e=>t(e.target.value),[t]);return l.jsxs("div",{className:Op("focus:to-surface-primary/50 group sticky left-0 top-0 z-10 flex h-12 items-center gap-2 bg-gradient-to-b from-surface-tertiary-alt from-65% to-transparent px-3 py-2 text-text-primary transition-colors duration-300 focus:bg-gradient-to-b focus:from-surface-primary",a),children:[l.jsx(Oe,{className:"h-4 w-4 text-text-secondary-alt transition-colors duration-300","aria-hidden":"true"}),l.jsx("input",{ref:o,type:"text",value:e??"",onChange:i,placeholder:s??r("com_ui_select_search_model"),"aria-label":"Search Model",className:"flex-1 rounded-md border-none bg-transparent px-2.5 py-2 text-sm placeholder-text-secondary focus:outline-none focus:ring-1 focus:ring-ring-primary"}),l.jsx("button",{className:Op("relative flex h-5 w-5 items-center justify-end rounded-md text-text-secondary-alt",(null==e?void 0:e.length)?"cursor-pointer opacity-100":"hidden"),"aria-label":"Clear search",onClick:()=>{t(""),setTimeout(()=>{var e;null==(e=o.current)||e.focus()},0)},tabIndex:0,children:l.jsx(re,{"aria-hidden":"true",className:Op("text-text-secondary-alt",(null==e?void 0:e.length)?"cursor-pointer opacity-100":"opacity-0")})})]})}function Mj(e){return"string"==typeof e?e.startsWith("---")&&e.endsWith("---")?"":e.toUpperCase():""}function Pj({availableOptions:e=[],placeholder:t,getTextKeyOverride:s,className:a,disabled:r=!1}){const[o,i]=n.useState(null),c=e.length>10&&!r,d=s||Mj,u=n.useMemo(()=>{const t=o??"";if(!c||!t||!e.length)return e;const n=t.toUpperCase();return e.filter(e=>d(e).includes(n))},[e,d,o,c]),m=n.useCallback(e=>i(e),[]);return[u,c?l.jsx(Ej,{value:o,className:a,onChange:m,placeholder:t}):null]}function Lj({title:e,value:t,disabled:s,setValue:a,availableValues:r,showAbove:o=!1,showLabel:i=!0,emptyTitle:c=!1,iconSide:d="right",optionIconSide:u="left",placeholder:p,containerClassName:h,optionsListClass:x,optionsClass:f,currentValueClass:g,subContainerClassName:v,className:b,renderOption:y,searchClassName:_,searchPlaceholder:j,showOptionIcon:w=!1}){const N=zf(),C={className:"top-full mt-3"};o&&(C.className="bottom-full mb-3");let k=e;c?k="":k||(k=N("com_ui_model"));const S=r??[],[T,R]=Pj({availableOptions:S,placeholder:j,getTextKeyOverride:e=>function(e){return"string"==typeof e?e:"label"in e?e.label??"":"value"in e?(e.value??"")+"":""}(e).toUpperCase(),className:_,disabled:s}),I=null!=R?T:S,E=w&&null!=t&&null!=t.icon,M=n.useRef(null);return l.jsx("div",{className:Op("flex items-center justify-center gap-2",h??""),children:l.jsx("div",{className:Op("relative w-full",v??""),children:l.jsx(po,{value:t,onChange:a,disabled:s,children:({open:e})=>l.jsxs(l.Fragment,{children:[l.jsxs(ho,{ref:M,"data-testid":"select-dropdown-button",onKeyDown:t=>{"Enter"===t.key&&(t.preventDefault(),!e&&M.current&&M.current.click())},className:Op("relative flex w-full cursor-default flex-col rounded-md border border-black/10 bg-white py-2 pl-3 pr-10 text-left focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:bg-white dark:border-gray-600 dark:bg-gray-700 sm:text-sm",b??""),children:[i&&l.jsx(xo,{className:"block text-xs text-gray-700 dark:text-gray-500",id:"headlessui-listbox-label-:r1:","data-headlessui-state":"",children:k}),l.jsx("span",{className:"inline-flex w-full truncate",children:l.jsxs("span",{className:Op("flex h-6 items-center gap-1 truncate text-sm text-gray-800 dark:text-white",i?"":"text-xs",g??""),children:[!i&&!c&&l.jsxs("span",{className:"text-xs text-gray-700 dark:text-gray-500",children:[k,":"]}),E&&"right"!==u&&l.jsx("span",{className:"icon-md flex items-center",children:t.icon}),E&&l.jsx("span",{className:"icon-md absolute right-0 mr-8 flex items-center",children:t.icon}),t?"string"!=typeof t?t.label??"":t:l.jsx("span",{className:"text-text-secondary",children:p})]})}),l.jsx("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:l.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4 text-gray-400",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",style:o?{transform:"scaleY(-1)"}:{},children:l.jsx("polyline",{points:"6 9 12 15 18 9"})})})]}),l.jsx(fo,{show:e,as:m.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",...C,children:l.jsxs(go,{className:Op("absolute z-10 mt-2 max-h-60 w-full overflow-auto rounded border bg-white text-xs ring-black/10 dark:border-gray-600 dark:bg-gray-700 dark:ring-white/20 md:w-[100%]",x??""),children:[y&&l.jsx(vo,{value:null,className:Op("group relative flex h-[42px] cursor-pointer select-none items-center overflow-hidden pl-3 pr-9 text-gray-800 hover:bg-gray-20 dark:text-white dark:hover:bg-gray-700",f??""),children:y()},"listbox-render-option"),R,I.map((e,n)=>{if(!e)return null;const s="string"==typeof e?e:e.label??e.value??"",a="string"==typeof e?e:e.value??"",r="string"==typeof e?null:e.icon??null;let o=t;return"string"!=typeof o&&(o=(null==o?void 0:o.value)??""),l.jsx(vo,{value:e,className:({active:e})=>Op("group relative flex h-[42px] cursor-pointer select-none items-center overflow-hidden pl-3 pr-9 text-gray-800 hover:bg-gray-20 dark:text-white dark:hover:bg-gray-600",e?"bg-surface-active text-text-primary":"",f??""),children:l.jsxs("span",{className:"flex items-center gap-1.5 truncate",children:[l.jsxs("span",{className:Op("flex h-6 items-center gap-1 text-gray-800 dark:text-gray-200",e===t?"font-semibold":"","left"===d?"ml-4":""),children:[null!=r&&l.jsx("span",{className:Op("mr-1","right"===u?"absolute right-0 pr-2":""),children:r}),s]}),a===o&&l.jsx("span",{className:Op("absolute inset-y-0 flex items-center text-gray-800 dark:text-gray-200","left"===d?"left-0 pl-2":"right-0 pr-3"),children:l.jsx(qb,{})})]})},n)})]})})]})})})})}const Aj=({title:e,description:t,selected:n,icon:s,className:a="",textClassName:r="",children:o,onClick:i,...c})=>l.jsx("div",{id:n?"selected-endpoint":void 0,role:"option","aria-selected":n,"aria-label":e,"data-testid":"chat-menu-item",className:Op("group m-1.5 flex cursor-pointer gap-2 rounded px-5 py-2.5 !pr-3 text-sm !opacity-100 hover:bg-black/5 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 dark:hover:bg-gray-600 md:min-w-[240px]",a||""),tabIndex:0,onClick:i,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),i&&i())},...c,children:l.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[l.jsx("div",{children:l.jsxs("div",{className:Op("flex items-center gap-1 "),children:[null!=s?s:null,l.jsxs("div",{className:Op("truncate",r),children:[e,l.jsx("div",{className:"text-token-text-tertiary",children:t})]})]})}),l.jsxs("div",{className:"flex items-center gap-2",children:[o,n&&l.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-md block ",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]})]})});m.memo(({label:e="Value",ariaLabel:t="Value",min:s=0,max:a=100,step:r=1,stepClick:o=1,initialValue:i=0,showButtons:c=!0,onChange:d,disabled:u=!1})=>{const m=zf(),[p,h]=n.useState(i),[x,f]=n.useState(!1),g=n.useRef(null),v=`model-parameter-${t.toLowerCase().replace(/\s+/g,"-")}`,b=e&&e.startsWith("com_")?m(e):e,y=(e=>{const t=(""+e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0})(r),_=n.useCallback(e=>{const t=Math.min(Math.max(e,s),a),n=Object.is(t,-0)?0:t;h(n),null==d||d(n)},[s,a,d]),j=n.useCallback(e=>{_(parseFloat(e.target.value))},[_]),w=n.useCallback(()=>{_(p+o)},[p,o,_]),N=n.useCallback(()=>{_(p-o)},[p,o,_]),C=n.useCallback(e=>{"ArrowRight"===e.key||"ArrowUp"===e.key?(e.preventDefault(),w()):"ArrowLeft"!==e.key&&"ArrowDown"!==e.key||(e.preventDefault(),N())},[w,N]);return n.useEffect(()=>{const e=g.current;if(e){const t=(p-s)/(a-s)*100;e.style.backgroundSize=`${t}% 100%`}},[p,s,a]),l.jsxs("div",{className:"w-full",children:[l.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[l.jsx("label",{htmlFor:v,className:"text-sm font-medium "+(u?"text-gray-400 dark:text-gray-400":""),children:b}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("output",{htmlFor:v,className:"select-none text-sm font-medium "+(u?"text-gray-400 dark:text-gray-400":""),"aria-live":"polite",children:p.toFixed(y).replace("-0.00","0.00")}),c&&l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("button",{type:"button",onClick:N,className:"rounded-md p-1 transition-colors "+(u?"cursor-not-allowed text-gray-400 dark:text-gray-400":"hover:bg-gray-200 dark:hover:bg-gray-700"),"aria-label":`Decrease ${e}`,disabled:u,children:l.jsx(ye,{size:16})}),l.jsx("button",{type:"button",onClick:w,className:"rounded-md p-1 transition-colors "+(u?"cursor-not-allowed text-gray-400 dark:text-gray-400":"hover:bg-gray-200 dark:hover:bg-gray-700"),"aria-label":`Increase ${e}`,disabled:u,children:l.jsx(_e,{size:16})})]})]})]}),l.jsxs("div",{className:"relative w-full",children:[l.jsx("input",{ref:g,type:"range",id:v,min:s,max:a,step:r,value:p,onChange:j,onKeyDown:C,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),className:"slider-thumb h-2 w-full appearance-none rounded-lg bg-gradient-to-r from-gray-500 to-gray-500 bg-no-repeat focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 "+(u?"cursor-not-allowed opacity-50":"cursor-pointer"),tabIndex:0,style:{backgroundSize:"50% 100%",backgroundPosition:"left"},"aria-valuemin":s,"aria-valuemax":a,"aria-valuenow":p,"aria-valuetext":`${p.toFixed(y).replace("-0.00","0.00")}`,disabled:u}),x?l.jsxs("div",{className:"trab mt-1 flex justify-between",children:[l.jsx("span",{className:"text-xs text-gray-500",children:s}),l.jsx("span",{className:"text-xs text-gray-500",children:a})]}):l.jsx("div",{className:"mt-1",style:{height:"1rem"}})]})]})});const Oj=n.forwardRef((e,t)=>{const n=zf(),{title:s,main:a,buttons:r,selection:o,className:i,leftButtons:c,description:d="",mainClassName:u,headerClassName:m,footerClassName:p,showCloseButton:h,overlayClassName:x,showCancelButton:f=!0}=e,{selectHandler:g,selectClasses:v,selectText:b,isLoading:y}=o||{};return l.jsxs(V_,{overlayClassName:x,showCloseButton:h,ref:t,className:Op("w-11/12 border-none bg-background text-foreground",i??""),onClick:e=>e.stopPropagation(),children:[l.jsxs($_,{className:Op(m??""),children:[l.jsx(U_,{children:s}),d&&l.jsx(H_,{className:"items-center justify-center",children:d})]}),l.jsx("div",{className:Op("px-0 py-2",u),children:null!=a?a:null}),l.jsxs(B_,{className:p,children:[l.jsx("div",{children:null!=c?l.jsx("div",{className:"mt-3 flex h-auto gap-3 max-sm:w-full max-sm:flex-col sm:mt-0 sm:flex-row",children:c}):null}),l.jsxs("div",{className:"flex h-auto gap-3 max-sm:w-full max-sm:flex-col sm:flex-row",children:[f&&l.jsx(z_,{asChild:!0,children:l.jsx(c_,{variant:"outline",children:n("com_ui_cancel")})}),null!=r?r:null,o?l.jsx(z_,{onClick:g,disabled:y,className:`${v??"bg-gray-800 text-white transition-colors hover:bg-gray-700 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-gray-200 dark:text-gray-800 dark:hover:bg-gray-200"} flex h-10 items-center justify-center rounded-lg border-none px-4 py-2 text-sm disabled:opacity-80 max-sm:order-first max-sm:w-full sm:order-none`,children:!0===y?l.jsx(Gb,{className:"size-4 text-white"}):b}):null]})]})]})});n.forwardRef(({className:e,options:t,onSelect:s,...a},r)=>{const[o,i]=n.useState(!1),[c,d]=n.useState(a.value||""),[u,m]=n.useState(-1),p=n.useRef(null),h=e=>{d(e),i(!1),m(-1),s&&s(e),a.onChange&&a.onChange({target:{value:e}})};return n.useEffect(()=>{const e=e=>{p.current&&!p.current.contains(e.target)&&(i(!1),m(-1))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),l.jsxs("div",{className:"relative",ref:p,children:[l.jsxs("div",{className:"relative",children:[l.jsx(M_,{...a,value:c,onChange:e=>{d(e.target.value),a.onChange&&a.onChange(e)},onKeyDown:e=>{switch(e.key){case"ArrowDown":e.preventDefault(),o?m(e=>e<t.length-1?e+1:e):i(!0);break;case"ArrowUp":e.preventDefault(),m(e=>e>0?e-1:0);break;case"Enter":e.preventDefault(),o&&-1!==u&&h(t[u]),i(!1);break;case"Escape":i(!1),m(-1)}},"aria-haspopup":"listbox","aria-controls":"dropdown-list",className:Op("bg-surface-secondary",e??""),ref:r}),l.jsx("button",{type:"button",className:"text-tertiary hover:text-secondary absolute inset-y-0 right-0 flex items-center rounded-md px-2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring-primary",onClick:()=>i(!o),"aria-label":o?"Close dropdown":"Open dropdown",children:l.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),o&&l.jsx("ul",{id:"dropdown-list",role:"listbox",className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md border border-border-medium bg-surface-secondary shadow-lg focus:ring-1 focus:ring-inset focus:ring-ring-primary",children:t.map((e,t)=>l.jsx("li",{role:"option","aria-selected":t===u,className:Op("cursor-pointer rounded-md px-3 py-2","focus:bg-surface-tertiary focus:outline-none focus:ring-1 focus:ring-inset focus:ring-ring-primary",t===u?"text-primary bg-surface-active":"text-secondary hover:bg-surface-tertiary"),onClick:()=>h(e),onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),h(e))},tabIndex:0,children:e},t))})]})}).displayName="InputWithDropdown";const Dj=({value:e,onChange:t,isSearching:n,placeholder:s})=>{const a=!0===n,r=null!=e&&e.length>0;return l.jsxs("div",{className:"relative w-full",children:[l.jsx("div",{className:"relative rounded-lg transition-all duration-500 ease-in-out",children:l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"absolute left-3 top-1/2 z-50 -translate-y-1/2",children:l.jsx(Oe,{className:Op("\n                h-4 w-4 transition-all duration-500 ease-in-out",a&&r?"text-blue-400":"text-gray-400")})}),l.jsx("input",{type:"text",value:e,onChange:t,placeholder:s,className:"\n              peer relative z-20 w-full rounded-lg bg-surface-secondary px-10\n              py-2 outline-none ring-0 backdrop-blur-sm transition-all\n              duration-500 ease-in-out placeholder:text-gray-400\n              focus:outline-none focus:ring-0\n            "}),l.jsx("div",{className:`\n              pointer-events-none absolute inset-0 z-20 rounded-lg\n              bg-gradient-to-r from-gray-500/20 via-gray-600/20 to-gray-500/20\n              transition-all duration-500 ease-in-out\n              ${a&&r?"opacity-100 blur-sm":"opacity-0 blur-none"}\n            `}),l.jsx("div",{className:`\n              absolute right-3 top-1/2 z-20 -translate-y-1/2\n              transition-all duration-500 ease-in-out\n              ${a&&r?"scale-100 opacity-100":"scale-0 opacity-0"}\n            `,children:l.jsxs("div",{className:"relative h-2 w-2",children:[l.jsx("div",{className:"absolute inset-0 animate-ping rounded-full bg-gray-500/60"}),l.jsx("div",{className:"absolute inset-0 rounded-full bg-gray-500"})]})})]})}),l.jsx("div",{className:`\n          absolute -inset-8 -z-10\n          transition-all duration-700 ease-in-out\n          ${a&&r?"scale-105 opacity-100":"scale-100 opacity-0"}\n        `,children:l.jsxs("div",{className:"absolute inset-0",children:[l.jsx("div",{className:`\n              bg-gradient-radial absolute inset-0 from-gray-500/10 to-transparent\n              transition-opacity duration-700 ease-in-out\n              ${a&&r?"animate-pulse-slow opacity-100":"opacity-0"}\n            `}),l.jsx("div",{className:`\n              absolute inset-0 bg-gradient-to-r from-gray-600/5 via-gray-500/5 to-gray-600/5\n              blur-xl transition-all duration-700 ease-in-out\n              ${a&&r?"animate-gradient-x opacity-100":"opacity-0"}\n            `})]})}),l.jsx("div",{className:"\n          absolute inset-0 -z-20 scale-100 bg-gradient-to-r from-gray-500/10 \n          via-purple-500/10 to-blue-500/10 opacity-0 blur-xl\n          transition-all duration-500 ease-in-out\n          peer-focus:scale-105 peer-focus:opacity-100\n        "})]})};function zj({title:e="Plugins",value:t,disabled:s,setSelected:a,availableValues:r,showAbove:o=!1,showLabel:i=!0,containerClassName:c,optionsClassName:d="",labelClassName:u="",isSelected:p,className:h,searchPlaceholder:x,optionValueKey:f="value"}){const[g,v]=n.useState(!1),b=n.useRef(null),y=["select-plugin","plugins-label","selected-plugins"];Gy(b,()=>v(!1),y);const[_,j]=Pj({availableOptions:r,placeholder:x,getTextKeyOverride:e=>(e.name||"").toUpperCase()}),w=Boolean(j)?_:r,N={className:"top-full mt-3"};o&&(N.className="bottom-full mb-3");const C={open:g};return l.jsx("div",{className:Op("flex items-center justify-center gap-2",c??""),children:l.jsx("div",{className:"relative w-full",children:l.jsx(po,{value:t,onChange:e=>{a(e),v(!0)},disabled:s,children:()=>l.jsxs(l.Fragment,{children:[l.jsxs(ho,{className:Op("relative flex w-full cursor-default flex-col rounded-md border border-black/10 bg-white py-2 pl-3 pr-10 text-left focus:outline-none focus:ring-0 focus:ring-offset-0 dark:border-gray-600 dark:border-white/20 dark:bg-gray-800 sm:text-sm",h??""),id:y[0],onClick:()=>v(e=>!e),...C,children:[" ",i&&l.jsx(xo,{className:Op("block text-xs text-gray-700 dark:text-gray-500",u),id:y[1],"data-headlessui-state":"",children:e}),l.jsx("span",{className:"inline-flex w-full truncate",id:y[2],children:l.jsxs("span",{className:Op("flex h-6 items-center gap-1 truncate text-sm text-gray-800 dark:text-white",i?"":"text-xs"),children:[!i&&e.length>0&&l.jsxs("span",{className:"text-xs text-gray-700 dark:text-gray-500",children:[e,":"]}),l.jsx("span",{className:"flex h-6 items-center gap-1 truncate",children:l.jsx("div",{className:"flex gap-1",children:t.map((e,t)=>l.jsxs("div",{className:"relative",style:{width:"16px",height:"16px"},children:[e.icon?l.jsx("img",{src:e.icon,alt:`${e} logo`,className:"h-full w-full rounded-sm bg-white"}):l.jsx(De,{className:"h-full w-full rounded-sm bg-white"}),l.jsx("div",{className:"absolute inset-0 rounded-sm ring-1 ring-inset ring-black/10"})]},t))})})]})}),l.jsx("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:l.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4  text-gray-400",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",style:o?{transform:"scaleY(-1)"}:{},children:l.jsx("polyline",{points:"6 9 12 15 18 9"})})})]}),l.jsx(fo,{show:g,as:m.Fragment,leave:"transition ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",...N,children:l.jsxs(go,{ref:b,className:Op("absolute z-50 mt-2 max-h-60 w-full overflow-auto rounded bg-white text-base text-xs ring-1 ring-black/10 focus:outline-none dark:bg-gray-800 dark:ring-white/20 dark:last:border-0 md:w-[100%]",d),children:[j,w.map((e,t)=>{if(!e)return null;const n=p(e[f]);return l.jsx(vo,{value:e[f],className:"group relative flex h-[42px] cursor-pointer select-none items-center overflow-hidden border-b border-black/10 pl-3 pr-9 text-gray-800 last:border-0 hover:bg-gray-20 dark:border-white/20 dark:text-white dark:hover:bg-gray-700",children:l.jsxs("span",{className:"flex items-center gap-1.5 truncate",children:[!e.isButton&&l.jsx("span",{className:"h-6 w-6 shrink-0",children:l.jsxs("div",{className:"relative",style:{width:"100%",height:"100%"},children:[e.icon?l.jsx("img",{src:e.icon,alt:`${e.name} logo`,className:"h-full w-full rounded-sm bg-white"}):l.jsx(De,{className:"h-full w-full rounded-sm bg-white"}),l.jsx("div",{className:"absolute inset-0 rounded-sm ring-1 ring-inset ring-black/10"})]})}),l.jsx("span",{className:Op("flex h-6 items-center gap-1 text-gray-800 dark:text-gray-200",n?"font-semibold":""),children:e.name}),e.isButton&&l.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-800 dark:text-gray-200",children:l.jsx(ze,{})}),n&&!e.isButton&&l.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-800 dark:text-gray-200",children:l.jsx(qb,{})})]})},t)})]})})]})})})})}const Fj=({currentPage:e,maxPage:t,onChangePage:n})=>{const s=zf(),a=[...Array(t).keys()].map(e=>e+1),r=e=>{e<1||e>t||n(e)};return l.jsxs("div",{className:"flex gap-2 text-sm text-black/60 dark:text-white/70",children:[l.jsxs("div",{role:"button",tabIndex:0,"aria-label":"Previous page",onClick:()=>r(e-1),onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||n(e-1)},className:"flex cursor-default items-center text-sm "+(1===e?"text-black/70 opacity-50 dark:text-white/70":"text-black/70 hover:text-black/50 dark:text-white/70 dark:hover:text-white/50"),style:{userSelect:"none"},children:[l.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("polyline",{points:"15 18 9 12 15 6"})}),s("com_ui_prev")]}),a.map(t=>l.jsx("div",{role:"button",tabIndex:0,className:"flex h-5 w-5 items-center justify-center text-sm "+(e===t?"text-blue-600 hover:text-blue-600 dark:text-blue-600 dark:hover:text-blue-600":"text-black/70 hover:text-black/50 dark:text-white/70 dark:hover:text-white/50"),style:{userSelect:"none"},onClick:()=>n(t),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||n(t)},children:t},t)),l.jsxs("div",{role:"button","aria-label":"Next page",tabIndex:0,onClick:()=>r(e+1),onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||n(e+1)},className:"flex cursor-default items-center text-sm "+(e===t?"text-black/70 opacity-50 dark:text-white/70":"text-black/70 hover:text-black/50 dark:text-white/70 dark:hover:text-white/50"),style:{userSelect:"none"},children:[s("com_ui_next"),l.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("polyline",{points:"9 18 15 12 9 6"})})]})]})};function Vj({content:e,position:t}){return l.jsx(I_,{children:l.jsx(E_,{side:t,className:"w-80 ",children:l.jsx("div",{className:"space-y-2",children:l.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:l.jsx("div",{dangerouslySetInnerHTML:{__html:e}})})})})})}function $j({plugin:e,onSubmit:t,isEntityTool:n}){const{register:s,handleSubmit:a,formState:{errors:r,isDirty:o,isValid:i,isSubmitting:c}}=Rr(),d=zf(),u=(null==e?void 0:e.authConfig)??[];return l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full gap-6 sm:grid-cols-2",children:l.jsxs("form",{className:"col-span-1 flex w-full flex-col items-start justify-start gap-2",method:"POST",onSubmit:a(s=>t({pluginKey:(null==e?void 0:e.pluginKey)??"",action:"install",auth:s,isEntityTool:n})),children:[u.map((e,t)=>{const n=e.authField.split("||")[0];return l.jsxs("div",{className:"flex w-full flex-col gap-1",children:[l.jsx("label",{htmlFor:n,className:"mb-1 text-left text-sm font-medium text-gray-700/70 dark:text-gray-50/70",children:e.label}),l.jsxs(T_,{openDelay:300,children:[l.jsx(R_,{className:"grid w-full items-center gap-2",children:l.jsx("input",{type:"text",autoComplete:"off",id:n,"aria-invalid":!!r[n],"aria-describedby":`${n}-error`,"aria-label":e.label,"aria-required":"true",...s(n,{required:`${e.label} is required.`,minLength:{value:1,message:`${e.label} must be at least 1 character long`}}),className:"flex h-10 max-h-10 w-full resize-none rounded-md border border-gray-200 bg-transparent px-3 py-2 text-sm text-gray-700 shadow-[0_0_10px_rgba(0,0,0,0.05)] outline-none placeholder:text-gray-400 focus:border-gray-400 focus:bg-gray-50 focus:outline-none focus:ring-0 focus:ring-gray-400 focus:ring-opacity-0 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-500 dark:bg-gray-700 dark:text-gray-50 dark:shadow-[0_0_15px_rgba(0,0,0,0.10)] dark:focus:border-gray-400 focus:dark:bg-gray-600 dark:focus:outline-none dark:focus:ring-0 dark:focus:ring-gray-400 dark:focus:ring-offset-0"})}),l.jsx(Vj,{content:e.description,position:"right"})]}),r[n]&&l.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-400",children:r[n].message})]},`${n}-${t}`)}),l.jsx("button",{disabled:!o||!i||c,type:"button",className:"btn btn-primary relative",onClick:()=>{a(s=>t({pluginKey:(null==e?void 0:e.pluginKey)??"",action:"install",auth:s,isEntityTool:n}))()},children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d("com_ui_save"),l.jsx(Fe,{className:"flex h-4 w-4 items-center stroke-2"})]})})]})})})}const Bj=({onSubmit:e,startupConfig:t,error:s,setError:a})=>{var r,o;const i=zf(),{theme:c}=n.useContext(Nv),{register:d,getValues:u,handleSubmit:m,formState:{errors:p,isSubmitting:h}}=Rr(),[x,f]=n.useState(!1),[g,v]=n.useState(null),{data:b}=Sx(),y=null==(r=null==b?void 0:b.ldap)?void 0:r.username,_="dark"===c?"dark":"light",j=Boolean(null==(o=t.turnstile)?void 0:o.siteKey);n.useEffect(()=>{s&&s.includes("422")&&!x&&f(!0)},[s,x]);const w=kf({onMutate:()=>{a(void 0),f(!1)}});if(!t)return null;const N=e=>{var t;const n=null==(t=p[e])?void 0:t.message;return n?l.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:String(n)}):null};return l.jsxs(l.Fragment,{children:[x&&l.jsxs("div",{className:"mt-2 rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-black dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",children:[i("com_auth_email_verification_resend_prompt"),l.jsx("button",{type:"button",className:"ml-2 text-blue-600 hover:underline",onClick:()=>{const e=u("email");if(!e)return f(!1);w.mutate({email:e})},disabled:w.isLoading,children:i("com_auth_email_resend_link")})]}),l.jsxs("form",{className:"mt-6","aria-label":"Login form",method:"POST",onSubmit:m(t=>e(t)),children:[l.jsxs("div",{className:"mb-4",children:[l.jsxs("div",{className:"relative",children:[l.jsx("input",{type:"text",id:"email",autoComplete:y?"username":"email","aria-label":i("com_auth_email"),...d("email",{required:i("com_auth_email_required"),maxLength:{value:120,message:i("com_auth_email_max_length")},pattern:{value:y?/\S+/:/\S+@\S+\.\S+/,message:i("com_auth_email_pattern")}}),"aria-invalid":!!p.email,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-black focus:outline-none dark:focus:border-white",placeholder:" "}),l.jsx("label",{htmlFor:"email",className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-black dark:peer-focus:text-white rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:y?i("com_auth_username").replace(/ \(.*$/,""):i("com_auth_email_address")})]}),N("email")]}),l.jsxs("div",{className:"mb-2",children:[l.jsxs("div",{className:"relative",children:[l.jsx("input",{type:"password",id:"password",autoComplete:"current-password","aria-label":i("com_auth_password"),...d("password",{required:i("com_auth_password_required"),minLength:{value:8,message:i("com_auth_password_min_length")},maxLength:{value:128,message:i("com_auth_password_max_length")}}),"aria-invalid":!!p.password,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-black focus:outline-none dark:focus:border-white",placeholder:" "}),l.jsx("label",{htmlFor:"password",className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-black dark:peer-focus:text-white rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:i("com_auth_password")})]}),N("password")]}),t.passwordResetEnabled&&l.jsx("a",{href:"/forgot-password",className:"inline-flex p-1 text-sm font-medium text-black transition-colors hover:text-gray-700 dark:text-white dark:hover:text-gray-300",children:i("com_auth_password_forgot")}),j&&l.jsx("div",{className:"my-4 flex justify-center",children:l.jsx(to,{siteKey:t.turnstile.siteKey,options:{...t.turnstile.options,theme:_},onSuccess:v,onError:()=>v(null),onExpire:()=>v(null)})}),l.jsx("div",{className:"mt-6",children:l.jsx(c_,{"aria-label":i("com_auth_continue"),"data-testid":"login-button",type:"submit",disabled:j&&!g||h,variant:"submit",className:"h-12 w-full rounded-2xl",children:h?l.jsx(Gb,{}):i("com_auth_continue")})})]})]})};function Uj(){const e=zf(),{error:t,setError:s,login:a}=Rg(),{startupConfig:r}=Ve(),[o,i]=rs(),c="false"===o.get("redirect"),[d,u]=n.useState(c);n.useEffect(()=>{if(c){u(!0);const e=new URLSearchParams(o);e.delete("redirect"),i(e,{replace:!0})}},[c,o,i]);const m=(null==r?void 0:r.openidLoginEnabled)&&(null==r?void 0:r.openidAutoRedirect)&&(null==r?void 0:r.serverDomain)&&!d;return n.useEffect(()=>{m&&(console.log("Auto-redirecting to OpenID provider..."),window.location.href=`${r.serverDomain}/oauth/openid`)},[m,r]),m?l.jsxs("div",{className:"flex min-h-screen flex-col items-center justify-center p-4",children:[l.jsx("p",{className:"text-lg font-semibold",children:e("com_ui_redirecting_to_provider",{0:r.openidLabel})}),l.jsx("div",{className:"mt-4",children:l.jsx(Jy,{enabled:r.openidLoginEnabled,serverDomain:r.serverDomain,oauthPath:"openid",Icon:()=>r.openidImageUrl?l.jsx("img",{src:r.openidImageUrl,alt:"OpenID Logo",className:"h-5 w-5"}):l.jsx(ay,{}),label:r.openidLabel,id:"openid"},"openid")})]}):l.jsxs(l.Fragment,{children:[null!=t&&l.jsx(Zy,{children:e(Vp(t))}),!0===(null==r?void 0:r.emailLoginEnabled)&&l.jsx(Bj,{onSubmit:a,startupConfig:r,error:t,setError:s}),!0===(null==r?void 0:r.registrationEnabled)&&l.jsxs("p",{className:"my-4 text-center text-sm font-light text-gray-700 dark:text-white",children:[" ",e("com_auth_no_account")," ",l.jsx("a",{href:"/register",className:"inline-flex p-1 text-sm font-medium text-black transition-colors hover:text-gray-700 dark:text-white dark:hover:text-gray-300",children:e("com_auth_sign_up")})]})]})}const Hj=()=>{var e,t;const s=k(),a=zf(),{theme:r}=n.useContext(Nv),{startupConfig:o,startupConfigError:i,isFetching:c}=Ve(),{watch:d,register:u,handleSubmit:m,formState:{errors:p}}=Rr({mode:"onChange"}),h=d("password"),[x,f]=n.useState(""),[g,v]=n.useState(!1),[b,y]=n.useState(3),[_,j]=n.useState(null),w=N(),C=new URLSearchParams(w.search).get("token"),S="dark"===r?"dark":"light",T=Boolean(null==(e=null==o?void 0:o.turnstile)?void 0:e.siteKey),R=qf({onMutate:()=>{v(!0)},onSuccess:()=>{v(!1),y(3);const e=setInterval(()=>{y(t=>t<=1?(clearInterval(e),s("/c/new",{replace:!0}),0):t-1)},1e3)},onError:e=>{var t,n,s,a;v(!1),(null==(n=null==(t=e.response)?void 0:t.data)?void 0:n.message)&&f((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)??"")}}),I=(e,t,n,s)=>{var r;return l.jsxs("div",{className:"mb-4",children:[l.jsxs("div",{className:"relative",children:[l.jsx("input",{id:e,type:n,autoComplete:e,"aria-label":a(t),...u(e,s),"aria-invalid":!!p[e],className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-black focus:outline-none dark:focus:border-white",placeholder:" ","data-testid":e}),l.jsx("label",{htmlFor:e,className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-black dark:peer-focus:text-white rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:a(t)})]}),p[e]&&l.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500",children:String(null==(r=p[e])?void 0:r.message)??""})]})};return l.jsxs(l.Fragment,{children:[x&&l.jsxs(Zy,{children:[a("com_auth_error_create")," ",x]}),R.isSuccess&&b>0&&l.jsx("div",{className:"rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-black dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",role:"alert",children:a((null==o?void 0:o.emailEnabled)?"com_auth_registration_success_generic":"com_auth_registration_success_insecure")+" "+a("com_auth_email_verification_redirecting",{0:b.toString()})}),!i&&!c&&l.jsxs(l.Fragment,{children:[l.jsxs("form",{className:"mt-6","aria-label":"Registration form",method:"POST",onSubmit:m(e=>R.mutate({...e,token:C??void 0})),children:[I("name","com_auth_full_name","text",{required:a("com_auth_name_required"),minLength:{value:3,message:a("com_auth_name_min_length")},maxLength:{value:80,message:a("com_auth_name_max_length")}}),I("username","com_auth_username","text",{minLength:{value:2,message:a("com_auth_username_min_length")},maxLength:{value:80,message:a("com_auth_username_max_length")}}),I("email","com_auth_email","email",{required:a("com_auth_email_required"),minLength:{value:1,message:a("com_auth_email_min_length")},maxLength:{value:120,message:a("com_auth_email_max_length")},pattern:{value:/\S+@\S+\.\S+/,message:a("com_auth_email_pattern")}}),I("password","com_auth_password","password",{required:a("com_auth_password_required"),minLength:{value:8,message:a("com_auth_password_min_length")},maxLength:{value:128,message:a("com_auth_password_max_length")}}),I("confirm_password","com_auth_password_confirm","password",{validate:e=>e===h||a("com_auth_password_not_match")}),(null==(t=null==o?void 0:o.turnstile)?void 0:t.siteKey)&&l.jsx("div",{className:"my-4 flex justify-center",children:l.jsx(to,{siteKey:o.turnstile.siteKey,options:{...o.turnstile.options,theme:S},onSuccess:e=>j(e),onError:()=>j(null),onExpire:()=>j(null)})}),l.jsx("div",{className:"mt-6",children:l.jsx(c_,{disabled:Object.keys(p).length>0||g||T&&!_,type:"submit","aria-label":"Submit registration",variant:"submit",className:"h-12 w-full rounded-2xl",children:g?l.jsx(Gb,{}):a("com_auth_continue")})})]}),l.jsxs("p",{className:"my-4 text-center text-sm font-light text-gray-700 dark:text-white",children:[a("com_auth_already_have_account")," ",l.jsx("a",{href:"/login","aria-label":"Login",className:"inline-flex p-1 text-sm font-medium text-black transition-colors hover:text-gray-700 dark:text-white dark:hover:text-gray-300",children:a("com_auth_login")})]})]})]})};function Kj(){const e=zf(),{register:t,handleSubmit:n,watch:s,formState:{errors:a,isSubmitting:r}}=Rr(),o=k(),[i]=rs(),c=s("password"),d=Jf(),{setError:u,setHeaderText:m}=Ve();return d.isSuccess?l.jsx(l.Fragment,{children:l.jsx("div",{className:"relative mt-6 rounded-xl border border-gray-300 bg-white px-6 py-4 text-black shadow-sm transition-all dark:border-gray-600 dark:bg-gray-800 dark:text-white",role:"alert",children:l.jsxs("div",{className:"flex flex-col space-y-4",children:[l.jsx("p",{children:e("com_auth_login_with_new_password")}),l.jsx(c_,{onClick:()=>o("/login"),"aria-label":e("com_auth_sign_in"),variant:"submit",children:e("com_auth_continue")})]})})}):l.jsxs("form",{className:"mt-6","aria-label":"Password reset form",method:"POST",onSubmit:n(e=>{d.mutate(e,{onError:()=>{u("com_auth_error_invalid_reset_token")},onSuccess:()=>{m("com_auth_reset_password_success")}})}),children:[l.jsxs("div",{className:"mb-2",children:[l.jsxs("div",{className:"relative",children:[l.jsx("input",{type:"hidden",id:"token",value:i.get("token")??"",...t("token",{required:"Unable to process: No valid reset token"})}),l.jsx("input",{type:"hidden",id:"userId",value:i.get("userId")??"",...t("userId",{required:"Unable to process: No valid user id"})}),l.jsx("input",{type:"password",id:"password",autoComplete:"current-password","aria-label":e("com_auth_password"),...t("password",{required:e("com_auth_password_required"),minLength:{value:8,message:e("com_auth_password_min_length")},maxLength:{value:128,message:e("com_auth_password_max_length")}}),"aria-invalid":!!a.password,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-black focus:outline-none dark:focus:border-white",placeholder:" "}),l.jsx("label",{htmlFor:"password",className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-black dark:peer-focus:text-white rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:e("com_auth_password")})]}),a.password&&l.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:a.password.message})]}),l.jsxs("div",{className:"mb-2",children:[l.jsxs("div",{className:"relative",children:[l.jsx("input",{type:"password",id:"confirm_password","aria-label":e("com_auth_password_confirm"),...t("confirm_password",{validate:t=>t===c||e("com_auth_password_not_match")}),"aria-invalid":!!a.confirm_password,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-black focus:outline-none dark:focus:border-white",placeholder:" "}),l.jsx("label",{htmlFor:"confirm_password",className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-black dark:peer-focus:text-white rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:e("com_auth_password_confirm")})]}),a.confirm_password&&l.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:a.confirm_password.message}),a.token&&l.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:a.token.message}),a.userId&&l.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:a.userId.message})]}),l.jsx("div",{className:"mt-6",children:l.jsx(c_,{type:"submit","aria-label":e("com_auth_submit_registration"),disabled:!!a.password||!!a.confirm_password||r,variant:"submit",className:"h-12 w-full rounded-2xl",children:r?l.jsx(Gb,{}):e("com_auth_continue")})})]})}function Gj(){const e=k(),t=zf(),[s]=rs(),[a,r]=n.useState(3),[o,i]=n.useState(""),[c,d]=n.useState(!1),[u,m]=n.useState(!1),p=n.useMemo(()=>s.get("token")||"",[s]),h=n.useMemo(()=>s.get("email")||"",[s]),x=n.useCallback(()=>{r(3);const t=setInterval(()=>{r(n=>n<=1?(clearInterval(t),e("/c/new",{replace:!0}),0):n-1)},1e3)},[e]),f=Cf({onSuccess:()=>{i(t("com_auth_email_verification_success")+" "),m(!0),x()},onError:e=>{i(t("com_auth_email_verification_failed")+" "),d(!0),m(!0)}}),g=kf({onSuccess:()=>{i(t("com_auth_email_resent_success")+" "),x()},onError:()=>{i(t("com_auth_email_resent_failed")+" ")},onMutate:()=>d(!1)}),v=()=>{g.mutate({email:h})};n.useEffect(()=>{u||f.isLoading||(p&&h?f.mutate({email:h,token:p}):(i(h?t("com_auth_email_verification_failed_token_missing")+" ":t("com_auth_email_verification_invalid")+" "),d(!0),m(!0)))},[p,h,u,f]);const b=()=>l.jsxs("div",{className:"flex flex-col items-center justify-center",children:[l.jsx("h1",{className:"mb-4 text-center text-3xl font-semibold text-black dark:text-white",children:o}),a>0&&l.jsx("p",{className:"text-center text-lg text-gray-600 dark:text-gray-400",children:t("com_auth_email_verification_redirecting",{0:a.toString()})}),c&&0===a&&l.jsxs("p",{className:"text-center text-lg text-gray-600 dark:text-gray-400",children:[t("com_auth_email_verification_resend_prompt"),l.jsx("button",{className:"ml-2 text-blue-600 hover:underline",onClick:v,disabled:g.isLoading,children:t("com_auth_email_resend_link")})]})]}),y=()=>l.jsxs("div",{className:"flex flex-col items-center justify-center",children:[l.jsx("h1",{className:"mb-4 text-center text-3xl font-semibold text-black dark:text-white",children:t("com_auth_email_verification_in_progress")}),l.jsx("div",{className:"mt-4 flex justify-center",children:l.jsx(Gb,{className:"h-8 w-8 text-black dark:text-white"})})]});return l.jsxs("div",{className:"flex min-h-screen flex-col items-center justify-center bg-white pt-6 dark:bg-gray-900 sm:pt-0",children:[l.jsx("div",{className:"absolute bottom-0 left-0 m-4",children:l.jsx(Ij,{})}),u?l.jsx(b,{}):l.jsx(y,{})]})}const Wj=()=>{const{error:e}=zb(),t=k();return m.useEffect(()=>{var t;null==(t=null==e?void 0:e.response)||t.status},[e,t]),null},qj=({children:e})=>l.jsx("div",{className:"relative mt-6 rounded-xl border border-gray-300 bg-white px-6 py-4 text-black shadow-sm transition-all dark:border-gray-600 dark:bg-gray-800 dark:text-white",role:"alert",children:e}),Qj=()=>{const e=zf();return l.jsxs("div",{className:"flex flex-col space-y-4",children:[l.jsx("p",{children:e("com_auth_reset_password_if_email_exists")}),l.jsx("a",{className:"inline-flex text-sm font-medium text-black transition-colors hover:text-gray-700 dark:text-white dark:hover:text-gray-300",href:"/login",children:e("com_auth_back_to_login")})]})};function Zj(){const e=zf(),{register:t,handleSubmit:s,formState:{errors:a}}=Rr(),[r,o]=n.useState(void 0),{startupConfig:i,setHeaderText:c}=Ve(),d=Zf(),{isLoading:u}=d;return r?l.jsx(qj,{children:r}):l.jsxs("form",{className:"mt-8 space-y-6","aria-label":"Password reset form",method:"POST",onSubmit:s(t=>{d.mutate(t,{onSuccess:t=>{t.link&&!(null==i?void 0:i.emailEnabled)?(c("com_auth_reset_password"),o(l.jsxs("span",{children:[e("com_auth_click")," ",l.jsx("a",{className:"text-black hover:underline dark:text-white",href:t.link,children:e("com_auth_here")})," ",e("com_auth_to_reset_your_password")]}))):(c("com_auth_reset_password_link_sent"),o(l.jsx(Qj,{})))},onError:()=>{c("com_auth_reset_password_link_sent"),o(l.jsx(Qj,{}))}})}),children:[l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"relative",children:[l.jsx("input",{type:"email",id:"email",autoComplete:"off","aria-label":e("com_auth_email"),...t("email",{required:e("com_auth_email_required"),minLength:{value:3,message:e("com_auth_email_min_length")},maxLength:{value:120,message:e("com_auth_email_max_length")},pattern:{value:/\S+@\S+\.\S+/,message:e("com_auth_email_pattern")}}),"aria-invalid":!!a.email,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-black focus:outline-none dark:focus:border-white",placeholder:" "}),l.jsx("label",{htmlFor:"email",className:"absolute -top-2 left-2 z-10 bg-white px-2 text-sm text-gray-600 transition-all peer-placeholder-shown:top-3 peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-500 peer-focus:-top-2 peer-focus:text-sm peer-focus:text-black dark:bg-gray-900 dark:text-gray-400 dark:peer-focus:text-white",children:e("com_auth_email_address")})]}),a.email&&l.jsx("p",{role:"alert",className:"text-sm font-medium text-red-600 dark:text-red-400",children:a.email.message})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx(c_,{"aria-label":"Continue with password reset",type:"submit",disabled:!!a.email||u,variant:"submit",className:"h-12 w-full rounded-2xl",children:u?l.jsx(Gb,{}):e("com_auth_continue")}),l.jsx("a",{href:"/login",className:"block text-center text-sm font-medium text-black transition-colors hover:text-gray-700 dark:text-white dark:hover:text-gray-300",children:e("com_auth_back_to_login")})]})]})}const Jj=m.memo(()=>{const[e]=rs(),t=e.get("tempToken"),s=null!==t&&""!==t?t:"",{control:a,handleSubmit:r,formState:{errors:o}}=Rr(),i=zf(),{showToast:c}=Of(),[d,u]=n.useState(!1),[m,p]=n.useState(!1),{mutate:h}=xx({onSuccess:e=>{null!=e.token&&""!==e.token&&(window.location.href="/")},onMutate:()=>{p(!0)},onError:e=>{var t,n;p(!1);const s=e,a="string"==typeof(null==(n=null==(t=s.response)?void 0:t.data)?void 0:n.message)?s.response.data.message:"Error verifying 2FA";c({message:a,status:"error"})}}),x=n.useCallback(e=>{const t={tempToken:s};d&&null!=e.backupCode&&""!==e.backupCode?t.backupCode=e.backupCode:null!=e.token&&""!==e.token&&(t.token=e.token),h(t)},[s,d,h]),f=n.useCallback(()=>{u(!0)},[]),g=n.useCallback(()=>{u(!1)},[]);return l.jsx("div",{className:"mt-4",children:l.jsxs("form",{onSubmit:r(x),children:[l.jsx(L_,{className:"flex justify-center break-keep text-center text-sm text-text-primary",children:i("com_auth_two_factor")}),!d&&l.jsxs("div",{className:"my-4 flex justify-center text-text-primary",children:[l.jsx(Ir,{name:"token",control:a,render:({field:{onChange:e,value:t}})=>l.jsxs(ij,{maxLength:6,value:null!=t?t:"",onChange:e,pattern:$e,children:[l.jsxs(lj,{children:[l.jsx(cj,{index:0}),l.jsx(cj,{index:1}),l.jsx(cj,{index:2})]}),l.jsx(dj,{}),l.jsxs(lj,{children:[l.jsx(cj,{index:3}),l.jsx(cj,{index:4}),l.jsx(cj,{index:5})]})]})}),o.token&&l.jsx("span",{className:"text-sm text-red-500",children:o.token.message})]}),d&&l.jsxs("div",{className:"my-4 flex justify-center text-text-primary",children:[l.jsx(Ir,{name:"backupCode",control:a,render:({field:{onChange:e,value:t}})=>l.jsx(ij,{maxLength:8,value:null!=t?t:"",onChange:e,pattern:Be,children:l.jsxs(lj,{children:[l.jsx(cj,{index:0}),l.jsx(cj,{index:1}),l.jsx(cj,{index:2}),l.jsx(cj,{index:3}),l.jsx(cj,{index:4}),l.jsx(cj,{index:5}),l.jsx(cj,{index:6}),l.jsx(cj,{index:7})]})})}),o.backupCode&&l.jsx("span",{className:"text-sm text-red-500",children:o.backupCode.message})]}),l.jsx("div",{className:"flex items-center justify-between",children:l.jsx("button",{type:"submit","aria-label":i("com_auth_continue"),"data-testid":"login-button",disabled:m,className:"w-full rounded-2xl bg-white px-4 py-3 text-sm font-medium text-black transition-colors hover:bg-gray-100 disabled:opacity-80 dark:bg-gray-800 dark:hover:bg-gray-700 dark:text-white border border-gray-300 dark:border-gray-600",children:i(m?"com_auth_email_verifying_ellipsis":"com_ui_verify")})}),l.jsx("div",{className:"mt-4 flex justify-center",children:d?l.jsx("button",{type:"button",onClick:g,className:"inline-flex p-1 text-sm font-medium text-black transition-colors hover:text-gray-700 dark:text-white dark:hover:text-gray-300",children:i("com_ui_use_2fa_code")}):l.jsx("button",{type:"button",onClick:f,className:"inline-flex p-1 text-sm font-medium text-black transition-colors hover:text-gray-700 dark:text-white dark:hover:text-gray-300",children:i("com_ui_use_backup_code")})})]})})});function Yj(){const e=zf(),[t]=rs(),[s,a]=n.useState(3),r=t.get("serverName");return n.useEffect(()=>{const e=setInterval(()=>{a(t=>t<=1?(clearInterval(e),window.close(),0):t-1)},1e3);return()=>clearInterval(e)},[]),l.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 p-8",children:l.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white p-8 text-center shadow-lg",children:[l.jsx("h1",{className:"mb-4 text-3xl font-bold text-gray-900",children:e("com_ui_oauth_success_title")||"Authentication Successful"}),l.jsxs("p",{className:"mb-2 text-sm text-gray-600",children:[e("com_ui_oauth_success_description")||"Your authentication was successful. This window will close in"," ",l.jsx("span",{className:"font-medium text-indigo-500",children:s})," ",e("com_ui_seconds")||"seconds","."]}),r&&l.jsxs("p",{className:"mt-4 text-xs text-gray-500",children:[e("com_ui_oauth_connected_to")||"Connected to",":"," ",l.jsx("span",{className:"font-medium",children:r})]})]})})}function Xj(){const e=zf(),[t]=rs(),n=t.get("error")||"unknown_error";return l.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 p-8",children:l.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white p-8 text-center shadow-lg",children:[l.jsx("div",{className:"mb-4 flex justify-center",children:l.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:l.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),l.jsx("h1",{className:"mb-4 text-3xl font-bold text-gray-900",children:e("com_ui_oauth_error_title")||"Authentication Failed"}),l.jsx("p",{className:"mb-6 text-sm text-gray-600",children:(t=>{switch(t){case"missing_code":return e("com_ui_oauth_error_missing_code")||"Authorization code is missing. Please try again.";case"missing_state":return e("com_ui_oauth_error_missing_state")||"State parameter is missing. Please try again.";case"invalid_state":return e("com_ui_oauth_error_invalid_state")||"Invalid state parameter. Please try again.";case"callback_failed":return e("com_ui_oauth_error_callback_failed")||"Authentication callback failed. Please try again.";default:return e("com_ui_oauth_error_generic")||t.replace(/_/g," ")}})(n)}),l.jsx("button",{onClick:()=>window.close(),className:"rounded-md bg-gray-900 px-4 py-2 text-sm font-medium text-white hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2","aria-label":e("com_ui_close_window")||"Close Window",children:e("com_ui_close_window")||"Close Window"})]})})}const ew=e=>e.split("\n").map(e=>e.trim()).filter(Boolean).map((e,t)=>({number:t+1,content:e})),tw=async()=>{const e=await(async()=>{if("userAgentData"in navigator)try{const e=navigator.userAgentData,t=await e.getHighEntropyValues(["platform","platformVersion"]);return{os:t.platform,version:t.platformVersion}}catch(t){Dp.warn("Failed to get high entropy values"),Dp.error(t)}const e=navigator.userAgent.toLowerCase();return e.includes("mac")?{os:"macOS"}:e.includes("win")?{os:"Windows"}:e.includes("linux")?{os:"Linux"}:e.includes("android")?{os:"Android"}:e.includes("ios")||e.includes("iphone")||e.includes("ipad")?{os:"iOS"}:{os:"Unknown"}})();return{userAgent:navigator.userAgent,platform:e.os,platformVersion:e.version,language:navigator.language,windowSize:`${window.innerWidth}x${window.innerHeight}`}};function nw(){const e=Ue(),t={message:e.message??"An unexpected error occurred",stack:e.stack,status:e.status,statusText:e.statusText,data:e.data};return l.jsx("div",{role:"alert",className:"flex min-h-screen flex-col items-center justify-center bg-surface-primary bg-gradient-to-br",children:l.jsxs("div",{className:"bg-surface-primary/60 mx-4 w-11/12 max-w-4xl rounded-2xl border border-border-light p-8 shadow-2xl backdrop-blur-xl",children:[l.jsx("h2",{className:"mb-6 text-center text-3xl font-medium tracking-tight text-text-primary",children:"Oops! Something Unexpected Occurred"}),l.jsxs("div",{className:"mb-4 rounded-xl border border-red-500/20 bg-red-500/5 p-4 text-sm text-gray-600 dark:text-gray-200",children:[l.jsx("h3",{className:"mb-2 font-medium",children:"Error Message:"}),l.jsx("pre",{className:"whitespace-pre-wrap text-sm font-light leading-relaxed text-text-primary",children:t.message})]}),("number"==typeof t.status||"string"==typeof t.statusText)&&l.jsxs("div",{className:"mb-4 rounded-xl border border-yellow-500/20 bg-yellow-500/5 p-4 text-sm text-text-primary",children:[l.jsx("h3",{className:"mb-2 font-medium",children:"Status:"}),l.jsxs("p",{className:"text-text-primary",children:["number"==typeof t.status&&`${t.status} `,"string"==typeof t.statusText&&t.statusText]})]}),null!=t.stack&&""!==t.stack.trim()&&l.jsxs("details",{className:"group mb-4 rounded-xl border border-border-light p-4",children:[l.jsxs("summary",{className:"mb-2 flex cursor-pointer items-center justify-between text-sm font-medium text-text-primary",children:[l.jsx("span",{children:"Stack Trace"}),l.jsx("div",{className:"flex items-center",children:l.jsx(c_,{variant:"outline",size:"sm",onClick:async()=>{null!=t.stack&&""!==t.stack&&await navigator.clipboard.writeText(t.stack)},className:"ml-2 px-2 py-1 text-xs",children:"Copy"})})]}),l.jsx("div",{className:"overflow-x-auto rounded-lg bg-black/5 p-4 dark:bg-white/5",children:ew(t.stack).map(({number:e,content:t})=>l.jsxs("div",{className:"flex",children:[l.jsx("span",{className:"select-none pr-4 font-mono text-xs text-text-secondary",children:String(e).padStart(3,"0")}),l.jsx("pre",{className:"flex-1 font-mono text-xs leading-relaxed text-text-primary",children:t})]},e))})]}),null!=t.data&&l.jsxs("details",{className:"group mb-4 rounded-xl border border-border-light p-4",children:[l.jsxs("summary",{className:"mb-2 flex cursor-pointer items-center justify-between text-sm font-medium text-text-primary",children:[l.jsx("span",{children:"Additional Details"}),l.jsx("span",{className:"transition-transform group-open:rotate-90",children:">"})]}),l.jsx("pre",{className:"whitespace-pre-wrap text-xs font-light leading-relaxed text-text-primary",children:JSON.stringify(t.data,null,2)})]}),l.jsxs("div",{className:"mt-6 flex flex-col gap-4",children:[l.jsx("p",{className:"text-sm font-light text-text-secondary",children:"Please try one of the following:"}),l.jsxs("ul",{className:"list-inside list-disc text-sm text-text-secondary",children:[l.jsx("li",{children:"Refresh the page"}),l.jsx("li",{children:"Clear your browser cache"}),l.jsx("li",{children:"Check your internet connection"}),l.jsx("li",{children:"Contact the Admin if the issue persists"})]}),l.jsxs("div",{className:"mt-4 flex flex-col items-center gap-4 sm:flex-row sm:justify-center",children:[l.jsx(c_,{variant:"submit",onClick:()=>window.location.reload(),className:"w-full sm:w-auto",children:"Refresh Page"}),l.jsx(c_,{variant:"outline",onClick:async()=>{try{const e=await tw(),n={timestamp:(new Date).toISOString(),browser:e,error:{...t,stack:null!=t.stack&&""!==t.stack.trim()?ew(t.stack):void 0}},s=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),a=URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`error-log-${(new Date).toISOString()}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)}catch(e){Dp.warn("Failed to download error logs:"),Dp.error(e)}},className:"w-full sm:w-auto",children:"Download Error Logs"})]})]})]})})}function sw({startupConfig:e}){var t;const n=zf();if(!e)return null;const s={discord:e.discordLoginEnabled&&l.jsx(Jy,{enabled:e.discordLoginEnabled,serverDomain:e.serverDomain,oauthPath:"discord",Icon:oy,label:n("com_auth_discord_login"),id:"discord"},"discord"),facebook:e.facebookLoginEnabled&&l.jsx(Jy,{enabled:e.facebookLoginEnabled,serverDomain:e.serverDomain,oauthPath:"facebook",Icon:sy,label:n("com_auth_facebook_login"),id:"facebook"},"facebook"),github:e.githubLoginEnabled&&l.jsx(Jy,{enabled:e.githubLoginEnabled,serverDomain:e.serverDomain,oauthPath:"github",Icon:ry,label:n("com_auth_github_login"),id:"github"},"github"),google:e.googleLoginEnabled&&l.jsx(Jy,{enabled:e.googleLoginEnabled,serverDomain:e.serverDomain,oauthPath:"google",Icon:ny,label:n("com_auth_google_login"),id:"google"},"google"),apple:e.appleLoginEnabled&&l.jsx(Jy,{enabled:e.appleLoginEnabled,serverDomain:e.serverDomain,oauthPath:"apple",Icon:iy,label:n("com_auth_apple_login"),id:"apple"},"apple"),openid:e.openidLoginEnabled&&l.jsx(Jy,{enabled:e.openidLoginEnabled,serverDomain:e.serverDomain,oauthPath:"openid",Icon:()=>e.openidImageUrl?l.jsx("img",{src:e.openidImageUrl,alt:"OpenID Logo",className:"h-5 w-5"}):l.jsx(ay,{}),label:e.openidLabel,id:"openid"},"openid"),saml:e.samlLoginEnabled&&l.jsx(Jy,{enabled:e.samlLoginEnabled,serverDomain:e.serverDomain,oauthPath:"saml",Icon:()=>e.samlImageUrl?l.jsx("img",{src:e.samlImageUrl,alt:"SAML Logo",className:"h-5 w-5"}):l.jsx(ly,{}),label:e.samlLabel?e.samlLabel:n("com_auth_saml_login"),id:"saml"},"saml")};return e.socialLoginEnabled&&l.jsxs(l.Fragment,{children:[e.emailLoginEnabled&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"relative mt-6 flex w-full items-center justify-center border border-t border-gray-300 uppercase dark:border-gray-600",children:l.jsx("div",{className:"absolute bg-white px-3 text-xs text-black dark:bg-gray-900 dark:text-white",children:"Or"})}),l.jsx("div",{className:"mt-8"})]}),l.jsx("div",{className:"mt-2",children:null==(t=e.socialLogins)?void 0:t.map(e=>s[e]||null)})]})}const aw=({active:e,children:t})=>e?l.jsxs(l.Fragment,{children:[l.jsx("style",{children:"\n  @keyframes blink-animation {\n    0%,\n    100% {\n      opacity: 1;\n    }\n    50% {\n      opacity: 0;\n    }\n  }"}),l.jsx("div",{style:{animation:"blink-animation 3s infinite"},children:t})]}):l.jsx(l.Fragment,{children:t}),rw=({onHeightChange:e})=>{const{data:t}=$x(),[s,a]=b(sx.hideBannerHint),r=n.useRef(null);if(n.useEffect(()=>{e&&r.current&&e(r.current.offsetHeight)},[t,s,e]),!t||t.bannerId&&s.includes(t.bannerId))return null;return l.jsxs("div",{ref:r,className:"sticky top-0 z-20 flex items-center bg-neutral-900 from-gray-700 to-gray-900 px-2 py-1 text-slate-50 dark:bg-gradient-to-r dark:text-white md:relative",children:[l.jsx("div",{className:"w-full truncate px-4 text-center text-sm",dangerouslySetInnerHTML:{__html:t.message}}),l.jsx("button",{type:"button","aria-label":"Dismiss banner",className:"h-8 w-8 opacity-80 hover:opacity-100",onClick:()=>{a([...s,t.bannerId]),e&&e(0)},children:l.jsx(re,{className:"mx-auto h-4 w-4"})})]})};function ow({startupConfig:e}){var t,n;const s=zf();if(!e)return null;const a=null==(t=e.interface)?void 0:t.privacyPolicy,r=null==(n=e.interface)?void 0:n.termsOfService,o=(null==a?void 0:a.externalUrl)&&l.jsx("a",{className:"text-sm text-black dark:text-white",href:a.externalUrl,target:a.openNewTab?"_blank":void 0,rel:"noreferrer",children:s("com_ui_privacy_policy")}),i=(null==r?void 0:r.externalUrl)&&l.jsx("a",{className:"text-sm text-black dark:text-white",href:r.externalUrl,target:r.openNewTab?"_blank":void 0,rel:"noreferrer",children:s("com_ui_terms_of_service")});return l.jsxs("div",{className:"align-end m-4 flex justify-center gap-2",role:"contentinfo",children:[o,o&&i&&l.jsx("div",{className:"border-r-[1px] border-gray-300 dark:border-gray-600"}),i]})}function iw({children:e,header:t,isFetching:s,startupConfig:a,startupConfigError:r,pathname:o,error:i}){const c=zf(),{theme:d}=n.useContext(Nv),u=wv(d)?"/assets/hanzo-logo-dark.svg":"/assets/hanzo-logo-light.svg",m=null!=r,p=()=>m?l.jsx("div",{className:"mx-auto sm:max-w-sm",children:l.jsx(Zy,{children:c("com_auth_error_login_server")})}):"com_auth_error_invalid_reset_token"===i?l.jsx("div",{className:"mx-auto sm:max-w-sm",children:l.jsxs(Zy,{children:[c("com_auth_error_invalid_reset_token")," ",l.jsx("a",{className:"font-semibold text-black hover:underline dark:text-white",href:"/forgot-password",children:c("com_auth_click_here")})," ",c("com_auth_to_try_again")]})}):null!=i&&i?l.jsx("div",{className:"mx-auto sm:max-w-sm",children:l.jsx(Zy,{children:c(i)})}):null;return l.jsxs("div",{className:"relative flex min-h-screen flex-col bg-white dark:bg-gray-900",children:[l.jsx(rw,{}),l.jsx(aw,{active:s,children:l.jsx("div",{className:"mt-6 h-10 w-full bg-cover",children:l.jsx("img",{src:u,className:"h-full w-full object-contain",alt:c("com_ui_logo",{0:(null==a?void 0:a.appTitle)??"Hanzo"})})})}),l.jsx(p,{}),l.jsx("div",{className:"absolute bottom-0 left-0 md:m-4",children:l.jsx(Ij,{})}),l.jsx("div",{className:"flex flex-grow items-center justify-center",children:l.jsxs("div",{className:"w-authPageWidth overflow-hidden bg-white px-6 py-4 dark:bg-gray-900 sm:max-w-md sm:rounded-lg",children:[!m&&!s&&l.jsx("h1",{className:"mb-4 text-center text-3xl font-semibold text-black dark:text-white",style:{userSelect:"none"},children:t}),e,!o.includes("2fa")&&(o.includes("login")||o.includes("register"))&&l.jsx(sw,{startupConfig:a})]})}),l.jsx(ow,{startupConfig:a})]})}const lw={"/login":"com_auth_welcome_back","/register":"com_auth_create_account","/forgot-password":"com_auth_reset_password","/reset-password":"com_auth_reset_password","/login/2fa":"com_auth_verify_your_identity"};function cw({isAuthenticated:e}){const[t,s]=n.useState(null),[a,r]=n.useState(null),[o,i]=n.useState(null),{data:c,isFetching:d,error:u}=Sx({enabled:!e||null===o}),m=zf(),p=k(),h=N();n.useEffect(()=>{e&&p("/c/new",{replace:!0}),c&&i(c)},[e,p,c]),n.useEffect(()=>{document.title=(null==o?void 0:o.appTitle)||"Hanzo"},[null==o?void 0:o.appTitle]),n.useEffect(()=>{s(null),r(null)},[h.pathname]);const x={error:t,setError:s,headerText:a,setHeaderText:r,startupConfigError:u,startupConfig:o,isFetching:d};return l.jsx(iw,{header:m(a||lw[h.pathname]),isFetching:d,startupConfig:o,startupConfigError:u,pathname:h.pathname,error:t,children:l.jsx(He,{context:x})})}function dw(){const{isAuthenticated:e}=Rg(),[t,s]=b(sx.queriesEnabled);return n.useEffect(()=>{if(t)return;const e=setTimeout(()=>{s(!0)},500);return()=>{clearTimeout(e)}},[t,s]),l.jsx(cw,{isAuthenticated:e})}const uw=({name:e,onSave:t})=>{const s=n.useRef(null),a=n.useRef(),[r,o]=n.useState(!1),[i,c]=n.useState(e),d=()=>{const e=null==i?void 0:i.trim();t(e||""),o(!1)};return n.useEffect(()=>{var e;r&&(null==(e=s.current)||e.focus())},[r]),n.useEffect(()=>{c(e)},[e]),l.jsx("div",{className:"flex items-center",children:l.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",alignItems:"center"},className:"gap-2",children:r?l.jsxs(l.Fragment,{children:[l.jsx(M_,{type:"text",value:i??"",onChange:e=>{c(e.target.value)},onKeyDown:t=>{"Escape"===t.key&&(o(!1),c(e)),"Enter"===t.key&&d()},ref:s,className:"flex w-full max-w-none rounded-lg text-2xl font-bold transition duration-200",style:{whiteSpace:"nowrap",textOverflow:"ellipsis"}}),l.jsx(c_,{onClick:()=>{d(),clearTimeout(a.current)},variant:"ghost",size:"sm",className:"h-10 flex-shrink-0","aria-label":"Save prompt name",children:l.jsx(Ry,{className:"icon-md"})})]}):l.jsxs(l.Fragment,{children:[l.jsx(L_,{className:"text-2xl font-bold",style:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:i}),l.jsx(c_,{onClick:()=>{o(!0)},variant:"ghost",size:"sm","aria-label":"Edit prompt name",className:"h-10 flex-shrink-0",children:l.jsx(Bb,{className:"icon-md"})})]})})})};function mw({setName:e,className:t=""}){const s=zf(),[a,r]=n.useState(""),o=sx.promptsCategory||qh("promptsCategory",""),i=y(o),c=_(sx.promptsCategory),{categories:d}=Rb("h-4 w-4"),[u,m]=n.useState(!1),p=n.useMemo(()=>[...[{value:Xc.ALL,label:s("com_ui_all_proper"),icon:l.jsx(Ke,{className:"h-4 w-4 text-text-primary"})},{value:Xc.MY_PROMPTS,label:s("com_ui_my_prompts"),icon:l.jsx(Ge,{className:"h-4 w-4 text-text-primary"})},{value:Xc.SHARED_PROMPTS,label:s("com_ui_shared_prompts"),icon:l.jsx(We,{className:"h-4 w-4 text-text-primary"})},{divider:!0,value:null}],...d?[...d]:[{value:Xc.NO_CATEGORY,label:s("com_ui_no_category")}]],[d,s]),h=n.useCallback(e=>{e===Xc.ALL?i(""):i(e)},[i]);return n.useEffect(()=>{m(!0);const e=setTimeout(()=>{m(!1)},500);return()=>clearTimeout(e)},[a]),l.jsxs("div",{className:Op("flex w-full gap-2 text-text-primary",t),children:[l.jsx(fj,{value:c||Xc.ALL,onChange:h,options:p,className:"bg-transparent",icon:l.jsx(Ke,{className:"h-4 w-4"}),label:"Filter: ",ariaLabel:s("com_ui_filter_prompts"),iconOnly:!0}),l.jsx(Dj,{value:a,onChange:t=>{r(t.target.value),e(t.target.value)},isSearching:u,placeholder:s("com_ui_filter_prompts_name")})]})}const pw=sx.promptsEditorMode||qh("promptsEditorMode",Vo.SIMPLE),hw=sx.alwaysMakeProd||qh("alwaysMakeProd",!0),xw=()=>{const e=zf(),[t,n]=b(pw),s=y(hw);return l.jsx("div",{className:"relative flex h-10 items-center justify-center rounded-xl border border-border-light bg-surface-primary transition-all duration-300",children:l.jsxs("div",{className:"relative flex w-48 items-stretch md:w-64",children:[l.jsx("div",{className:"absolute rounded-lg bg-surface-hover shadow-lg transition-all duration-300 ease-in-out",style:{top:"1px",left:t===Vo.SIMPLE?"2px":"calc(50% + 2px)",width:"calc(50% - 4px)",height:"calc(100% - 2px)"}}),l.jsx("button",{type:"button",onClick:()=>{s(!0),n(Vo.SIMPLE)},className:"relative z-10 flex-1 rounded-xl px-3 py-2 text-sm font-medium transition-all duration-300 md:px-6 "+(t===Vo.SIMPLE?"text-text-primary":"text-text-secondary hover:text-text-primary"),children:l.jsx("span",{className:"relative",children:e("com_ui_simple")})}),l.jsx("button",{type:"button",onClick:()=>n(Vo.ADVANCED),className:"relative z-10 flex-1 rounded-xl px-3 py-2 text-sm font-medium transition-all duration-300 md:px-6 "+(t===Vo.ADVANCED?"text-text-primary":"text-text-secondary hover:text-text-primary"),children:l.jsx("span",{className:"relative",children:e("com_ui_advanced")})})]})})},fw=({control:e,promptPerm:t,label:n,confirmChange:s})=>l.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[n,l.jsx(Ir,{name:t,control:e,render:({field:e})=>l.jsx(Q_,{...e,checked:e.value,onCheckedChange:t=>{!1===t&&s?s(t,e.onChange):e.onChange(t)},value:e.value.toString()})})]}),gw=()=>{const e=zf(),{user:t,roles:s}=Rg(),{showToast:a}=Of(),[r,o]=n.useState(null),{mutate:i,isLoading:c}=(e=>{const t=Aa(),{onMutate:n,onSuccess:s,onError:a}=e??{};return Oa(e=>(_d.partial().parse(e.updates),Tu(e)),{onSuccess:(e,n,a)=>{t.invalidateQueries([Pd.roles,n.roleName]),s&&s(e,n,a)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update prompt permissions:",t),a&&a(...e)},onMutate:n})})({onSuccess:()=>{a({status:"success",message:e("com_ui_saved")})},onError:()=>{a({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[d,u]=n.useState(!1),[m,p]=n.useState(Id.USER),h=n.useMemo(()=>{var e,t;return(null==(e=null==s?void 0:s[m])?void 0:e.permissions)?null==(t=s[m])?void 0:t.permissions[bd.PROMPTS]:Md[m].permissions[bd.PROMPTS]},[s,m]),{reset:x,control:f,setValue:g,getValues:v,handleSubmit:b,formState:{isSubmitting:y}}=Rr({mode:"onChange",defaultValues:h});if(n.useEffect(()=>{var e,t;x(null==(t=null==(e=null==s?void 0:s[m])?void 0:e.permissions)?void 0:t[bd.PROMPTS])},[s,m,x]),(null==t?void 0:t.role)!==Id.ADMIN)return null;const _=[{promptPerm:yd.SHARED_GLOBAL,label:e("com_ui_prompts_allow_share_global")},{promptPerm:yd.CREATE,label:e("com_ui_prompts_allow_create")},{promptPerm:yd.USE,label:e("com_ui_prompts_allow_use")}],j=[{label:Id.USER,onClick:()=>{p(Id.USER)}},{label:Id.ADMIN,onClick:()=>{p(Id.ADMIN)}}];return l.jsxs(l.Fragment,{children:[l.jsxs(A_,{children:[l.jsx(O_,{asChild:!0,children:l.jsxs(c_,{size:"sm",variant:"outline",className:"mr-2 h-10 w-fit gap-1 border transition-all dark:bg-transparent dark:hover:bg-surface-tertiary sm:m-0",children:[l.jsx(qe,{className:"cursor-pointer","aria-hidden":"true"}),l.jsx("span",{className:"hidden sm:flex",children:e("com_ui_admin")})]})}),l.jsxs(V_,{className:"w-11/12 max-w-lg border-border-light bg-surface-primary text-text-primary",children:[l.jsx(U_,{children:`${e("com_ui_admin_settings")} - ${e("com_ui_prompts")}`}),l.jsxs("div",{className:"p-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),l.jsx(kj,{unmountOnHide:!0,menuId:"prompt-role-dropdown",isOpen:d,setIsOpen:u,trigger:l.jsx(Qe,{className:"inline-flex w-1/5 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:m}),items:j,itemClassName:"items-center justify-center",sameWidth:!0})]}),l.jsxs("form",{onSubmit:b(e=>{i({roleName:m,updates:e})}),children:[l.jsx("div",{className:"py-5",children:_.map(({promptPerm:t,label:n})=>l.jsxs("div",{children:[l.jsx(fw,{control:f,promptPerm:t,label:n,getValues:v,setValue:g,...m===Id.ADMIN&&t===yd.USE?{confirmChange:(e,t)=>o({newValue:e,callback:t})}:{}}),m===Id.ADMIN&&t===yd.USE&&l.jsx(l.Fragment,{children:l.jsxs("div",{className:"mb-2 max-w-full whitespace-normal break-words text-sm text-red-600",children:[l.jsx("span",{children:e("com_ui_admin_access_warning")}),"\n",l.jsxs("a",{href:"https://www.hanzo.ai/docs/configuration/chat_yaml/object_structure/interface",target:"_blank",rel:"noreferrer",className:"inline-flex items-center text-blue-500 underline",children:[e("com_ui_more_info"),l.jsx(Ze,{size:16,className:"ml-1"})]})]})})]},t))}),l.jsx("div",{className:"flex justify-end",children:l.jsx(c_,{type:"submit",disabled:y||c,variant:"submit",children:e("com_ui_save")})})]})]})]})]}),l.jsx(A_,{open:null!==r,onOpenChange:e=>{e||o(null)},children:l.jsx(Oj,{showCloseButton:!0,title:e("com_ui_confirm_change"),className:"w-11/12 max-w-lg",main:l.jsx("p",{className:"mb-4",children:e("com_ui_confirm_admin_use_change")}),selection:{selectHandler:()=>{r&&r.callback(r.newValue),o(null)},selectClasses:"bg-surface-destructive hover:bg-surface-destructive-hover text-white transition-colors duration-200",selectText:e("com_ui_confirm_action"),isLoading:!1}})})]})},vw=/prompts\/(?!new(?:\/|$)).*$/,bw=sx.promptsName||qh("promptsName",""),yw=sx.promptsCategory||qh("promptsCategory",""),_w=sx.promptsEditorMode||qh("promptsEditorMode",Vo.SIMPLE);function jw(){const e=N(),t=zf(),{user:s}=Rg(),{prevLocationPath:a}=n.useContext(tv),r=n.useMemo(()=>(e=>{if(!e||e.includes("/d/"))return"new";const t=e.split("/");return t[t.length-1]})(a),[a]),o=y(bw),i=y(yw);_(_w);const c=Ev("/c/"+r,n.useCallback(()=>{o(""),i("")},[o,i])),d=Ev("/d/prompts"),u=n.useMemo(()=>vw.test(e.pathname),[e.pathname]);return l.jsxs("div",{className:"mr-2 mt-2 flex h-10 items-center justify-between",children:[l.jsx(s_,{className:"mt-1 px-2 dark:text-gray-200",children:l.jsxs(a_,{children:[l.jsx(r_,{className:"hover:dark:text-white",children:l.jsxs(o_,{href:"/",className:"flex flex-row items-center gap-1",onClick:c,children:[l.jsx(Je,{className:"icon-xs","aria-hidden":"true"}),l.jsx("span",{className:"hidden md:flex",children:t("com_ui_back_to_chat")}),l.jsx("span",{className:"flex md:hidden",children:t("com_ui_chat")})]})}),l.jsx(i_,{}),l.jsx(r_,{className:"hover:dark:text-white",children:l.jsxs(o_,{href:"/d/prompts",className:"flex flex-row items-center gap-1",onClick:d,children:[l.jsx(Ye,{className:"h-4 w-4 dark:text-gray-300","aria-hidden":"true"}),t("com_ui_prompts")]})})]})}),l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[u&&l.jsx(xw,{}),(null==s?void 0:s.role)===Id.ADMIN&&l.jsx(gw,{})]})]})}const ww=n.memo(function({prevPage:e,nextPage:t,hasPreviousPage:n,hasNextPage:s,isFetching:a,isChatRoute:r}){const o=zf();return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"flex gap-2",children:!r&&l.jsx(Ij,{returnThemeOnly:!0})}),l.jsxs("div",{className:"flex items-center justify-between gap-2",role:"navigation","aria-label":"Pagination",children:[l.jsx(c_,{variant:"outline",size:"sm",onClick:()=>e(),disabled:!n,children:o("com_ui_prev")}),l.jsx(c_,{variant:"outline",size:"sm",onClick:()=>t(),disabled:!s||a,children:o("com_ui_next")})]})]})});function Nw({className:e}){const t=zf(),s=sx.promptsName||qh("promptsName",""),a=sx.promptsCategory||qh("promptsCategory",""),r=y(s),o=y(a),i=Ev("/d/prompts",n.useCallback(()=>{r(""),o("")},[r,o]));return l.jsx(c_,{variant:"outline",className:Op(e,"bg-transparent"),onClick:e=>{i(e)},"aria-label":"Manage Prompts",role:"button",children:t("com_ui_manage")})}const Cw=n.memo(function({group:e,instanceProjectId:t}){const s=M(),a=k(),r=zf(),{user:o}=Rg(),i=n.useRef(null),[d,u]=n.useState(e.name),m=n.useMemo(()=>(null==o?void 0:o.id)===e.author,[null==o?void 0:o.id,e.author]),p=n.useMemo(()=>{var n;return t&&(null==(n=e.projectIds)?void 0:n.includes(t))},[e.projectIds,t]),h=Tf({onMutate:()=>{i.current&&clearTimeout(i.current)}}),x=Ef({onSuccess:(t,n)=>{n.id===e._id&&a("/d/prompts")}}),{isLoading:f}=h,g=n.useCallback(()=>{console.log(e._id??"",{name:d}),h.mutate({id:e._id??"",payload:{name:d}})},[e._id,d,h]),v=n.useCallback(t=>{"Enter"===t.key&&(t.preventDefault(),a(`/d/prompts/${e._id}`,{replace:!0}))},[e._id,a]),b=n.useCallback(()=>{x.mutate({id:e._id??""})},[e._id,x]),y=n.useCallback(()=>{a(`/d/prompts/${e._id}`,{replace:!0})},[e._id,a]);return l.jsx("div",{className:Op("mx-2 my-2 flex cursor-pointer rounded-lg border border-border-light bg-surface-primary p-3 shadow-sm transition-all duration-300 ease-in-out hover:bg-surface-secondary",s.promptId===e._id&&"bg-surface-hover"),onClick:y,onKeyDown:v,role:"button",tabIndex:0,"aria-label":`${e.name} prompt group`,children:l.jsxs("div",{className:"flex w-full items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-2 truncate pr-2",children:[l.jsx(kb,{category:e.category??"",className:"icon-lg","aria-hidden":"true"}),l.jsx(L_,{className:"text-md cursor-pointer truncate font-semibold text-text-primary",children:e.name})]}),l.jsxs("div",{className:"flex h-full items-center gap-2",children:[p&&l.jsx(c,{className:"icon-md text-black dark:text-white","aria-label":r("com_ui_global_group")}),(m||(null==o?void 0:o.role)===Id.ADMIN)&&l.jsxs(l.Fragment,{children:[l.jsxs(A_,{children:[l.jsx(O_,{asChild:!0,children:l.jsx(c_,{variant:"ghost",onClick:e=>e.stopPropagation(),className:"h-8 w-8 p-0 hover:bg-surface-hover","aria-label":r("com_ui_rename_prompt")+" "+e.name,children:l.jsx(Xe,{className:"icon-sm text-text-primary","aria-hidden":"true"})})}),l.jsx(Oj,{showCloseButton:!1,title:r("com_ui_rename_prompt"),className:"w-11/12 max-w-lg",main:l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(M_,{value:d,onChange:e=>u(e.target.value),className:"w-full","aria-label":r("com_ui_rename_prompt")+" "+e.name})})}),selection:{selectHandler:g,selectClasses:"bg-surface-submit hover:bg-surface-submit-hover text-white disabled:hover:bg-surface-submit",selectText:r("com_ui_save"),isLoading:f}})]}),l.jsxs(A_,{children:[l.jsx(O_,{asChild:!0,children:l.jsx(c_,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:e=>e.stopPropagation(),"aria-label":r("com_ui_delete_prompt")+" "+e.name,children:l.jsx(py,{className:"icon-sm text-text-primary","aria-hidden":"true"})})}),l.jsx(Oj,{showCloseButton:!1,title:r("com_ui_delete_prompt"),className:"w-11/12 max-w-lg",main:l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsxs(L_,{htmlFor:"confirm-delete",className:"text-left text-sm font-medium",children:[r("com_ui_delete_confirm")," ",l.jsx("strong",{children:e.name})]})})}),selection:{selectHandler:b,selectClasses:"bg-red-600 dark:bg-red-600 hover:bg-red-700 dark:hover:bg-red-800 text-white",selectText:r("com_ui_delete")}})]})]})]})]})})});function kw(e){return`https://www.google.com/s2/favicons?domain=${e}&sz=32`}function Sw(e){const t=e.replace(/(^\w+:|^)\/\//,"").split("/")[0];return t.startsWith("www.")?t.substring(4):t}function Tw({domain:e,className:t=""}){return l.jsxs("div",{className:Op("relative size-4 flex-shrink-0 overflow-hidden rounded-full",t),children:[l.jsx("div",{className:"absolute inset-0 rounded-full bg-white"}),l.jsx("img",{src:kw(e),alt:e,className:"relative size-full"}),l.jsx("div",{className:"border-border-light/10 absolute inset-0 rounded-full border dark:border-transparent"})]})}function Rw({source:e,label:t,onMouseEnter:n,onMouseLeave:s,children:a}){const r=zf(),o=Sw(e.link||"");return l.jsx("span",{className:"relative ml-0.5 inline-block",children:l.jsx(et,{showTimeout:150,hideTimeout:150,children:l.jsxs("span",{className:"flex items-center",children:[l.jsx(tt,{render:l.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"ml-1 inline-block h-5 max-w-36 cursor-pointer items-center overflow-hidden text-ellipsis whitespace-nowrap rounded-xl border border-border-heavy bg-surface-secondary px-2 text-xs font-medium no-underline transition-colors hover:bg-surface-hover dark:border-border-medium dark:hover:bg-surface-tertiary",onMouseEnter:n,onMouseLeave:s,children:t})}),l.jsxs(nt,{className:"ml-0.5 rounded-full text-text-primary focus:outline-none focus:ring-2 focus:ring-ring",children:[l.jsx(st,{children:r("com_citation_more_details",{label:t})}),l.jsx(at,{className:"icon-sm"})]}),l.jsxs(rt,{gutter:16,className:"dark:shadow-lg-dark z-[999] w-[300px] max-w-[calc(100vw-2rem)] rounded-xl border border-border-medium bg-surface-secondary p-3 text-text-primary shadow-lg",portal:!0,unmountOnHide:!0,children:[a,!a&&l.jsxs(l.Fragment,{children:[l.jsxs("span",{className:"mb-2 flex items-center",children:[l.jsx(Tw,{domain:o,className:"mr-2"}),l.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"line-clamp-2 cursor-pointer overflow-hidden text-sm font-bold text-[#0066cc] hover:underline dark:text-blue-400 md:line-clamp-3",children:e.attribution||o})]}),l.jsx("h4",{className:"mb-1.5 mt-0 text-xs text-text-primary md:text-sm",children:e.title||e.link}),e.snippet&&l.jsx("span",{className:"my-2 text-ellipsis break-all text-xs text-text-secondary md:text-sm",children:e.snippet})]})]})]})})})}const Iw=n.createContext({hoveredCitationId:null,setHoveredCitationId:()=>{}}),Ew={search:"organic",ref:"references",news:"topStories"};function Mw(e){var t;const s=zf(),{citations:a,citationId:r}=(null==(t=e.node)?void 0:t.properties)??{},{setHoveredCitationId:o}=n.useContext(Iw),[i,c]=n.useState(0),d=function(e){const{searchResults:t}=pv(),n=[];for(const{turn:s,refType:a,index:r}of e){const e=Ew[a.toLowerCase()]?Ew[a.toLowerCase()]:a;if(!t||!t[s]||!t[s][e])continue;const o=t[s][e][r];o&&n.push({...o,turn:s,refType:a.toLowerCase(),index:r,link:o.link??"",title:o.title??"",snippet:o.snippet??"",attribution:o.attribution??""})}return n}(a||[]);if(!d||0===d.length)return null;const u=d.length,m=null==d?void 0:d[i];return l.jsxs(Rw,{source:m,label:(()=>{if(!d||0===d.length)return s("com_citation_source");const e=d[0],t=d.length-1,n=e.attribution||e.title||Sw(e.link||"")||s("com_citation_source");return t>0?`${n} +${t}`:n})(),onMouseEnter:()=>o(r||null),onMouseLeave:()=>o(null),children:[u>1&&l.jsxs("span",{className:"mb-2 flex items-center justify-between border-b border-border-heavy pb-2",children:[l.jsxs("span",{className:"flex gap-2",children:[l.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),i>0&&c(i-1)},disabled:0===i,style:{opacity:0===i?.5:1},className:"flex cursor-pointer items-center justify-center border-none bg-transparent p-0 text-base",children:""}),l.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),i<u-1&&c(i+1)},disabled:i===u-1,style:{opacity:i===u-1?.5:1},className:"flex cursor-pointer items-center justify-center border-none bg-transparent p-0 text-base",children:""})]}),l.jsxs("span",{className:"text-xs text-text-tertiary",children:[i+1,"/",u]})]}),l.jsxs("span",{className:"mb-2 flex items-center",children:[l.jsx(Tw,{domain:Sw(m.link||""),className:"mr-2"}),l.jsx("a",{href:m.link,target:"_blank",rel:"noopener noreferrer",className:"line-clamp-2 cursor-pointer overflow-hidden text-sm font-bold text-[#0066cc] hover:underline dark:text-blue-400 md:line-clamp-3",children:m.attribution})]}),l.jsx("h4",{className:"mb-1.5 mt-0 text-xs text-text-primary md:text-sm",children:m.title}),l.jsx("p",{className:"my-2 text-ellipsis break-all text-xs text-text-secondary md:text-sm",children:m.snippet})]})}function Pw(e){var t;const s=zf(),{citation:a,citationId:r}=(null==(t=e.node)?void 0:t.properties)??{},{setHoveredCitationId:o}=n.useContext(Iw),i=function({turn:e,index:t,refType:n}){const{searchResults:s}=pv();if(!n)return;const a=Ew[n.toLowerCase()]?Ew[n.toLowerCase()]:n;if(!s||!s[e]||!s[e][a])return;const r=s[e][a][t];return r?{...r,turn:e,refType:n.toLowerCase(),index:t,link:r.link??"",title:r.title??"",snippet:r.snippet??"",attribution:r.attribution??""}:void 0}({turn:(null==a?void 0:a.turn)||0,refType:null==a?void 0:a.refType,index:(null==a?void 0:a.index)||0});if(!i)return null;return l.jsx(Rw,{source:i,label:i.attribution||i.title||Sw(i.link||"")||s("com_citation_source"),onMouseEnter:()=>o(r||null),onMouseLeave:()=>o(null)})}const Lw=n.memo(function({children:e,citationId:t}){const s=function(e){const{hoveredCitationId:t}=n.useContext(Iw);return e&&t===e}(t);return l.jsx("span",{className:"rounded px-0 py-0.5 transition-colors "+(s?"bg-amber-300/20":""),children:e})});function Aw({file:e,fileType:t}){return l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 36 36",fill:"none",className:"h-10 w-10 flex-shrink-0",width:"36",height:"36",children:[l.jsx("rect",{width:"36",height:"36",rx:"6",fill:t.fill}),((null==e?void 0:e.progress)??1)>=1&&l.jsx(l.Fragment,{children:l.jsx(t.paths,{})})]})}function Ow(e){const t=(null==e?void 0:e.toLowerCase())??"";return t&&/\b(o\d)\b/i.test(t)?"#000000":t.includes("gpt-4")?"#AB68FF":"#19C37D"}function Dw(e,t){return!0===(null==e?void 0:e.toLowerCase().includes("code"))?l.jsx(vy,{size:.75*t}):/gemini|learnlm|gemma/.test((null==e?void 0:e.toLowerCase())??"")?l.jsx(by,{size:.7*t}):l.jsx(gy,{size:.7*t})}function zw(e){return!0===(null==e?void 0:e.toLowerCase().includes("code"))?"Codey":!0===(null==e?void 0:e.toLowerCase().includes("gemini"))||!0===(null==e?void 0:e.toLowerCase().includes("learnlm"))?"Gemini":!0===(null==e?void 0:e.toLowerCase().includes("gemma"))?"Gemma":"PaLM2"}const Fw=n.memo(e=>{const{error:t,button:n,iconURL:s="",endpoint:a,size:r=30,model:o="",assistantName:i,agentName:c}=e,d={icon:s?l.jsx("div",{className:"relative flex h-6 w-6 items-center justify-center",children:l.jsx("div",{title:i,style:{width:r,height:r},className:Op("overflow-hidden rounded-full",e.className??""),children:l.jsx("img",{className:"shadow-stroke h-full w-full object-cover",src:s,alt:i,style:{height:"80",width:"80"}})})}):l.jsx("div",{className:"h-6 w-6",children:l.jsx("div",{className:"shadow-stroke flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:l.jsx(Sy,{className:"h-2/3 w-2/3 text-gray-400"})})}),name:a},u={icon:s?l.jsx("div",{className:"relative flex h-6 w-6 items-center justify-center",children:l.jsx("div",{title:c,style:{width:r,height:r},className:Op("overflow-hidden rounded-full",e.className??""),children:l.jsx("img",{className:"shadow-stroke h-full w-full object-cover",src:s,alt:c,style:{height:"80",width:"80"}})})}):l.jsx("div",{className:"h-6 w-6",children:l.jsx("div",{className:"shadow-stroke flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:l.jsx(q,{className:"h-2/3 w-2/3 text-gray-400"})})}),name:a},m={[vi.assistants]:d,[vi.agents]:u,[vi.azureAssistants]:d,[vi.azureOpenAI]:{icon:l.jsx(xy,{size:.5555555555555556*r}),bg:"linear-gradient(0.375turn, #61bde2, #4389d0)",name:"ChatGPT"},[vi.openAI]:{icon:l.jsx($b,{size:.5555555555555556*r}),bg:Ow(o),name:"ChatGPT"},[vi.gptPlugins]:{icon:l.jsx(Vb,{size:.7*r}),bg:`rgba(69, 89, 164, ${!0===n?.75:1})`,name:"Plugins"},[vi.google]:{icon:Dw(o,r),name:zw(o)},[vi.anthropic]:{icon:l.jsx(cy,{size:.5555555555555556*r}),bg:"#d09a74",name:"Claude"},[vi.bedrock]:{icon:l.jsx(Ey,{className:"icon-xl text-white"}),bg:"#268672",name:Oc[vi.bedrock]},[vi.custom]:{icon:l.jsx(Zb,{size:.7*r}),name:"Custom"},null:{icon:l.jsx($b,{size:.7*r}),bg:"grey",name:"N/A"},default:{icon:l.jsx("div",{className:"h-6 w-6",children:l.jsx("div",{className:"overflow-hidden rounded-full",children:l.jsx(Vy,{iconURL:s,endpoint:a??"",className:"h-full w-full object-contain",context:"message"})})}),name:a}};let{icon:p,bg:h,name:x}=null!=a&&a&&m[a]?m[a]??{}:m.default;return s&&m[s]&&({icon:p,bg:h,name:x}=m[s]),ji(a)?p:l.jsxs("div",{title:x??"",style:{background:null!=h&&h||"transparent",width:r,height:r},className:Op("relative flex h-9 w-9 items-center justify-center rounded-sm p-1 text-white",e.className??""),children:[p,!0===t&&l.jsx("span",{className:"absolute right-0 top-[20px] -mr-2 flex h-3 w-3 items-center justify-center rounded-full border border-white bg-red-500 text-[10px] text-white",children:"!"})]})}),Vw=n.memo(({size:e,user:t,avatarSrc:s,username:a,className:r})=>{const[o,i]=n.useState(!1);return l.jsx("div",{title:a,style:{width:e,height:e},className:Op("relative flex items-center justify-center",r??""),children:((null==t?void 0:t.avatar)||(null==t?void 0:t.username)&&""!==(null==t?void 0:t.username.trim()))&&!o?l.jsx("img",{className:"rounded-full",src:((null==t?void 0:t.avatar)??"")||s,alt:"avatar",onError:()=>{i(!0)}}):l.jsx("div",{style:{backgroundColor:"rgb(121, 137, 255)",width:"20px",height:"20px",boxShadow:"rgba(240, 246, 252, 0.1) 0px 0px 0px 1px"},className:"relative flex h-9 w-9 items-center justify-center rounded-sm p-1 text-white",children:l.jsx(Ny,{})})})});Vw.displayName="UserAvatar";const $w=n.memo(e=>{const{user:t}=Rg(),{size:n=30,isCreatedByUser:s}=e,a=sb(t),r=zf();if(s){const s=(null==t?void 0:t.name)??(null==t?void 0:t.username)??r("com_nav_user");return l.jsx(Vw,{size:n,user:t,avatarSrc:a,username:s,className:e.className})}return l.jsx(Fw,{...e})});$w.displayName="Icon";const Bw=e=>{const{size:t=30,iconURL:n="",iconClassName:s,error:a}=e;let r="default";"string"==typeof e.endpoint&&(r=e.endpoint);const o={[vi.azureOpenAI]:{icon:l.jsx(xy,{className:s}),name:e.chatGptLabel??"ChatGPT"},[vi.openAI]:{icon:l.jsx(fy,{className:s}),name:e.chatGptLabel??"ChatGPT"},[vi.gptPlugins]:{icon:l.jsx(hy,{}),name:"Plugins"},[vi.google]:{icon:l.jsx(yy,{}),name:e.modelLabel??"Google"},[vi.anthropic]:{icon:l.jsx(cy,{className:"icon-md shrink-0 dark:text-white"}),name:e.modelLabel??"Claude"},[vi.custom]:{icon:l.jsx(Zb,{}),name:"Custom"},[vi.chatGPTBrowser]:{icon:l.jsx(Jb,{}),name:"ChatGPT"},[vi.assistants]:{icon:l.jsx(Ty,{className:"icon-sm"}),name:"Assistant"},[vi.azureAssistants]:{icon:l.jsx(Ty,{className:"icon-sm"}),name:"Assistant"},[vi.agents]:{icon:l.jsx(q,{className:"icon-sm"}),name:e.modelLabel??Oc[vi.agents]},[vi.bedrock]:{icon:l.jsx(Ey,{className:"icon-xl text-text-primary"}),name:e.modelLabel??Oc[vi.bedrock]},default:{icon:l.jsx(Vy,{iconURL:n,endpoint:r,className:"icon-sm",context:"nav"}),name:r}};let{icon:i,name:c}=o[r]??o.default;return n&&null!=o[n]&&({icon:i,name:c}=o[n]),l.jsxs("div",{"data-testid":"convo-icon",title:c,"aria-hidden":"true",style:{width:t,height:t},className:Op("relative flex items-center justify-center rounded-sm text-text-secondary",e.className??""),children:[i,!0===a&&l.jsx("span",{className:"absolute right-0 top-[20px] -mr-2 flex h-4 w-4 items-center justify-center rounded-full border border-white bg-red-500 text-[10px] text-text-secondary",children:"!"})]})},Uw=n.memo(({iconURL:e,altName:t,containerStyle:s={width:20,height:20},imageStyle:a={width:"100%",height:"100%"},className:r="icon-md mr-1 shrink-0 overflow-hidden rounded-full",endpoint:o})=>{const[i,c]=n.useState(!1),d=o&&By[o]?By[o]:By.unknown;return i||!e?l.jsxs("div",{className:"relative",style:{...s,margin:"2px"},children:[l.jsx("div",{className:r,children:l.jsx(d,{endpoint:o,context:"menu-item",size:s.width})}),i&&e&&l.jsx("div",{className:"absolute flex items-center justify-center rounded-full bg-red-500",style:{width:"14px",height:"14px",top:0,right:0},children:l.jsx(ot,{size:10,className:"text-white"})})]}):l.jsx("div",{className:r,style:s,children:l.jsx("img",{src:e,alt:t??"Icon",style:a,className:"object-cover",onError:()=>{c(!0)},loading:"lazy",decoding:"async",width:Number(s.width)||20,height:Number(s.height)||20})})});Uw.displayName="URLIcon";const Hw={"menu-item":"relative flex h-full items-center justify-center overflow-hidden rounded-full",message:"icon-md",default:"icon-xl relative flex h-full overflow-hidden rounded-full"},Kw={"menu-item":{width:"20px",height:"20px"},default:{width:"100%",height:"100%"}},Gw={default:{width:"100%",height:"100%"}},Ww=n.memo(({iconURL:e="",modelLabel:t="",endpointIconURL:s,assistantAvatar:a,assistantName:r,agentAvatar:o,agentName:i,context:c})=>{const d=n.useMemo(()=>By[e]??By.unknown,[e]);return n.useMemo(()=>!(!e||!e.includes("http")&&!e.startsWith("/images/")),[e])?l.jsx(Uw,{iconURL:e,altName:t,className:Hw[c??"default"]??Hw.default,containerStyle:Kw[c??"default"]??Kw.default,imageStyle:Gw[c??"default"]??Gw.default}):l.jsx("div",{className:"shadow-stroke relative flex h-full items-center justify-center rounded-full bg-white text-black",children:d&&l.jsx(d,{size:41,context:c,className:"h-2/3 w-2/3",agentName:i,iconURL:s,assistantName:r,avatar:a||o})})});function qw({conversation:e,endpointsConfig:t,assistantMap:s,agentsMap:a,className:r="",containerClassName:o="",context:i,size:c}){var d,u;const m=(null==e?void 0:e.iconURL)??"";let p=null==e?void 0:e.endpoint;p=wp({endpointsConfig:t,iconURL:m,endpoint:p});const{entity:h,isAgent:x}=n.useMemo(()=>Cp({endpoint:p,agentsMap:a,assistantMap:s,agent_id:null==e?void 0:e.agent_id,assistant_id:null==e?void 0:e.assistant_id}),[p,null==e?void 0:e.agent_id,null==e?void 0:e.assistant_id,a,s]),f=(null==h?void 0:h.name)??"",g=x?null==(d=null==h?void 0:h.avatar)?void 0:d.filepath:null==(u=null==h?void 0:h.metadata)?void 0:u.avatar,v=fp(t,p,"iconURL"),b=Np({endpoint:p,endpointsConfig:t,endpointIconURL:v}),y=By[b]??null;return l.jsx(l.Fragment,{children:m&&m.includes("http")?l.jsx(Ww,{iconURL:m,modelLabel:(null==e?void 0:e.chatGptLabel)??(null==e?void 0:e.modelLabel)??"",endpointIconURL:v,assistantAvatar:g,assistantName:f,agentAvatar:g,agentName:f,context:i}):l.jsx("div",{className:o,children:p&&null!=y&&l.jsx(y,{size:c,context:i,endpoint:p,className:r,iconURL:v,assistantName:f,agentName:f,avatar:g})})})}function Qw({conversation:e,endpointsConfig:t,className:n="mr-0",assistantMap:s,context:a}){var r,o;const i=(null==e?void 0:e.iconURL)??"";let c=null==e?void 0:e.endpoint;c=wp({endpointsConfig:t,iconURL:i,endpoint:c});const d=fp(t,c,"type"),u=fp(t,c,"iconURL"),m=ji(c)?null==(r=null==s?void 0:s[c])?void 0:r[(null==e?void 0:e.assistant_id)??""]:null,p=m&&(null==(o=m.metadata)?void 0:o.avatar)||"",h=m&&(m.name??""),x=p||i;return x&&(x.includes("http")||x.startsWith("/images/"))?l.jsx(Ww,{iconURL:x,modelLabel:(null==e?void 0:e.chatGptLabel)??(null==e?void 0:e.modelLabel)??"",context:a,endpointIconURL:u,assistantAvatar:p,assistantName:h??""}):l.jsx(Bw,{size:20,iconURL:u,endpoint:c,endpointType:d,model:null==e?void 0:e.model,error:!1,className:n,isCreatedByUser:!1,chatGptLabel:void 0,modelLabel:void 0})}const Zw={max:"com_endpoint_openai_max",temp:"com_endpoint_openai_temp",topp:"com_endpoint_openai_topp",freq:"com_endpoint_openai_freq",pres:"com_endpoint_openai_pres",resend:"com_endpoint_openai_resend_files",detail:"com_endpoint_openai_detail"},Jw={anthropic:{temp:"com_endpoint_anthropic_temp",topp:"com_endpoint_anthropic_topp",topk:"com_endpoint_anthropic_topk",maxoutputtokens:"com_endpoint_anthropic_maxoutputtokens",resend:Zw.resend,promptcache:"com_endpoint_anthropic_prompt_cache"},google:{temp:"com_endpoint_google_temp",topp:"com_endpoint_google_topp",topk:"com_endpoint_google_topk",maxoutputtokens:"com_endpoint_google_maxoutputtokens"},openAI:Zw,azureOpenAI:Zw,gptPlugins:{func:"com_endpoint_func_hover",skip:"com_endpoint_skip_hover",...Zw}};function Yw({endpoint:e,type:t,side:n}){var s;const a=zf(),r=null==(s=Jw[e])?void 0:s[t];return r?l.jsx(I_,{children:l.jsx(E_,{side:n,className:"z-[999] w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:a(r)})})})}):null}function Xw({conversation:e,setOption:t,models:s,readonly:a}){const r=zf(),o=n.useMemo(()=>({label:r("com_endpoint_use_active_assistant"),value:""}),[r]),i=ig(e=>Zo(e.data)),{model:c,endpoint:d,assistant_id:u,endpointType:m,promptPrefix:p,instructions:h}=e??{},x=n.useMemo(()=>Object.values(i[d??""]??{}),[i,d]),f=n.useMemo(()=>{const e=x.map(({id:e,name:t})=>({label:t,value:e}));return[o,...e].filter(Boolean)},[x,o]),[g,v]=vv({setOption:t,optionKey:"promptPrefix",initialValue:p}),[b,y]=vv({setOption:t,optionKey:"instructions",initialValue:h}),_=n.useMemo(()=>{var e;return null!=u&&u?null==(e=i[d??""])?void 0:e[u]:null},[u,i,d]),j=n.useMemo(()=>s.map(e=>({label:e===(null==_?void 0:_.model)?`${e} (${r("com_endpoint_assistant_model")})`:e,value:e})),[s,_,r]),[w,N]=n.useState(null!=_?{label:_.name??"",value:_.id}:o);if(n.useEffect(()=>{""===w.value&&t("presetOverride")({assistant_id:w.value})},[w]),!e)return null;const C=t("model"),k=m??d;return l.jsxs("div",{className:"grid grid-cols-6 gap-6",children:[l.jsx("div",{className:"col-span-6 flex flex-col items-center justify-start gap-6 sm:col-span-3",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(Lj,{value:c??"",setValue:Km(C),availableValues:j,disabled:a,className:Op(Wp,"flex w-full resize-none",Gp),containerClassName:"flex w-full resize-none"})})}),l.jsx("div",{className:"col-span-6 flex flex-col items-center justify-start gap-6 px-3 sm:col-span-3",children:l.jsxs(T_,{openDelay:300,children:[l.jsx(R_,{className:"grid w-full items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(Lj,{title:r("com_endpoint_assistant"),value:w,setValue:Km(e=>{var n;if(!e)return void N(o);const s=null==(n=i[d??""])?void 0:n[e];s?(N({label:s.name??"",value:s.id||""}),t("assistant_id")(s.id),s.model&&C(s.model)):N(o)}),availableValues:f,disabled:a,className:Op(Wp,"flex w-full resize-none",Gp),containerClassName:"flex w-full resize-none"})})}),l.jsx(Yw,{endpoint:k??"",type:"temp",side:Go.Left})]})}),l.jsxs("div",{className:"col-span-6 flex flex-col items-center justify-start gap-6",children:[l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsxs(L_,{htmlFor:"promptPrefix",className:"text-left text-sm font-medium",children:[r("com_endpoint_prompt_prefix_assistants")," ",l.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default_blank"),")"]})]}),l.jsx(me,{id:"promptPrefix",disabled:a,value:v??"",onChange:g,placeholder:r("com_endpoint_prompt_prefix_assistants_placeholder"),className:Op(Wp,"flex max-h-[240px] min-h-[80px] w-full resize-none px-3 py-2 ")})]}),l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsxs(L_,{htmlFor:"instructions",className:"text-left text-sm font-medium",children:[r("com_endpoint_instructions_assistants")," ",l.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default_blank"),")"]})]}),l.jsx(me,{id:"instructions",disabled:a,value:y??"",onChange:b,placeholder:r("com_endpoint_instructions_assistants_placeholder"),className:Op(Wp,"flex max-h-[240px] min-h-[80px] w-full resize-none px-3 py-2 ")})]})]})]})}const eN=n.memo(function({selectedValue:e,displayValue:t,items:s,setValue:a,ariaLabel:r,searchPlaceholder:o,selectPlaceholder:i,containerClassName:c,isCollapsed:d,SelectIcon:u,showCarat:m,className:p,disabled:h,iconClassName:x,iconSide:f="left",selectId:g}){const[v,b]=n.useState(""),y=n.useRef(null),[_,j]=n.useState(null),w=e=>({id:`item-${e.value}`,value:e.value,label:e.label,icon:e.icon}),N=it({defaultItems:s.map(w),resetValueOnHide:!0,value:v,setValue:b}),C=je({combobox:N,defaultItems:s.map(w),value:e,setValue:a}),k=n.useMemo(()=>L(s,v,{keys:["value","label"],baseSort:(e,t)=>e.index<t.index?-1:1}).map(w),[v,s]);n.useEffect(()=>{y.current&&!d&&j(y.current.offsetWidth)},[d]);const S=Op("flex h-5 w-5 items-center justify-center overflow-hidden rounded-full",x),T=Op("mr-2 flex h-5 w-5 items-center justify-center overflow-hidden rounded-full",x);return l.jsxs("div",{className:Op("flex w-full items-center justify-center px-1",c),children:[l.jsx(lt,{store:C,className:"sr-only",children:r}),l.jsxs(we,{ref:y,store:C,id:g,disabled:h,className:Op("flex items-center justify-center gap-2 rounded-full bg-surface-secondary","text-text-primary hover:bg-surface-tertiary","border border-border-light",d?"h-10 w-10":"h-10 w-full rounded-xl px-3 py-2 text-sm",p),children:[null!=u&&"left"===f&&l.jsx("div",{className:S,children:u}),!d&&l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"flex-grow truncate text-left",children:null!=t?t||i:e||i}),null!=u&&"right"===f&&l.jsx("div",{className:S,children:u}),m&&l.jsx(at,{className:"h-4 w-4 text-text-secondary"})]})]}),l.jsxs(Ce,{store:C,gutter:4,portal:!0,className:Op("animate-popover z-50 overflow-hidden rounded-xl border border-border-light bg-surface-secondary shadow-lg"),style:{width:d?"300px":_??"300px"},children:[l.jsx("div",{className:"py-1.5",children:l.jsxs("div",{className:"relative",children:[l.jsx(Oe,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-text-primary"}),l.jsx(ce,{store:N,autoSelect:!0,placeholder:o,className:"w-full rounded-md bg-surface-secondary py-2 pl-9 pr-3 text-sm text-text-primary focus:outline-none"})]})}),l.jsx("div",{className:"max-h-[300px] overflow-auto",children:l.jsx(ct,{store:N,children:l.jsx(dt,{store:C,items:k,itemSize:36,overscan:5,children:({value:e,icon:t,label:n,...s})=>l.jsxs(ue,{...s,className:Op("flex w-full cursor-pointer items-center px-3 text-sm","text-text-primary hover:bg-surface-tertiary","data-[active-item]:bg-surface-tertiary"),render:l.jsx(ke,{value:e}),children:[null!=t&&"left"===f&&l.jsx("div",{className:T,children:t}),l.jsx("span",{className:"flex-grow truncate text-left",children:n}),null!=t&&"right"===f&&l.jsx("div",{className:T,children:t})]},s.id)})})})]})]})});function tN({side:e,description:t,disabled:n,langCode:s,sideOffset:a=30,className:r}){const o=zf();if(n)return null;const i=s?o(t):t;return l.jsx(I_,{children:l.jsx(E_,{side:e,className:`z-[999] w-80 ${r}`,sideOffset:a,children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"whitespace-pre-wrap text-sm text-text-secondary",children:i})})})})}const nN={[fd.Slider]:function({label:e="",settingKey:t,defaultValue:s,range:a,description:r="",columnSpan:o,setOption:i,optionType:c,options:d,readonly:u=!1,showDefault:m=!1,includeInput:p=!0,labelCode:h=!1,descriptionCode:x=!1,conversation:f}){const g=zf(),{preset:v}=rg(),b=n.useMemo(()=>(!a&&d&&d.length>0)??!1,[d,a]),[y,_,j]=vv({optionKey:t,initialValue:c!==gd.Custom?null==f?void 0:f[t]:s,setter:()=>({}),setOption:i,delay:b?0:450});_v({preset:v,settingKey:t,defaultValue:s,conversation:f,inputValue:_,setInputValue:j});const w=n.useMemo(()=>b?(null==f?void 0:f[t])??s:_,[f,s,t,_,b]),N=n.useMemo(()=>b&&d?d.reduce((e,t,n)=>(e[t]=n,e),{}):{},[b,d]),C=n.useMemo(()=>b&&d?d.reduce((e,t,n)=>(e[n]=t,e),{}):{},[b,d]),k=n.useCallback(e=>{y(b?C[e]:e)},[b,y,C]),S=n.useMemo(()=>b&&d?d.length-1:a?a.max:0,[b,d,a]);return a||b?l.jsx("div",{className:Op("flex flex-col items-center justify-start gap-2",null!=o?`col-span-${o}`:"col-span-full"),children:l.jsxs(T_,{openDelay:300,children:[l.jsxs(R_,{className:"grid w-full items-center gap-2",children:[l.jsxs("div",{className:"flex w-full items-center justify-between",children:[l.jsxs(L_,{htmlFor:`${t}-dynamic-setting`,className:"text-left text-sm font-medium",children:[h?g(e)??e:e||t," ",m&&l.jsxs("small",{className:"opacity-40",children:["(",g("com_endpoint_default"),": ",s,")"]})]}),p&&!b?l.jsx(P_,{id:`${t}-dynamic-setting-input-number`,disabled:u,value:_??s,onChange:e=>y(Number(e)),max:a?a.max:((null==d?void 0:d.length)??0)-1,min:a?a.min:0,step:a?a.step??1:1,controls:!1,className:Op(Wp,Op(qp,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))}):l.jsx(M_,{id:`${t}-dynamic-setting-input`,disabled:u,value:w??s,onChange:()=>({}),className:Op(Wp,Op(qp,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),l.jsx(K_,{id:`${t}-dynamic-setting-slider`,disabled:u,value:[b?N[w??""]:_??s],onValueChange:e=>k(e[0]),onDoubleClick:()=>y(s),max:S,min:a?a.min:0,step:a?a.step??1:1,className:"flex h-4 w-full"})]}),r&&l.jsx(tN,{description:x?g(r)??r:r,side:Go.Left})]})}):null},[fd.Dropdown]:function({label:e="",settingKey:t,defaultValue:s,description:a="",columnSpan:r,setOption:o,optionType:i,options:c,readonly:d=!1,showLabel:u=!0,showDefault:m=!1,labelCode:p=!1,descriptionCode:h=!1,placeholder:x="",placeholderCode:f=!1,conversation:g}){const v=zf(),{preset:b}=rg(),[y,_]=n.useState(null),j=n.useMemo(()=>i===gd.Custom?y:(null==g?void 0:g[t])??s,[g,s,i,t,y]);return _v({preset:b,settingKey:t,defaultValue:s,conversation:g,inputValue:y,setInputValue:_,preventDelayedUpdate:!0}),c&&0!==c.length?l.jsx("div",{className:Op("flex flex-col items-center justify-start gap-6",null!=r?`col-span-${r}`:"col-span-full"),children:l.jsxs(T_,{openDelay:300,children:[l.jsxs(R_,{className:"grid w-full items-center gap-2",children:[!0===u&&l.jsx("div",{className:"flex w-full justify-between",children:l.jsxs(L_,{htmlFor:`${t}-dynamic-dropdown`,className:"text-left text-sm font-medium",children:[p?v(e)??e:e||t,m&&l.jsxs("small",{className:"opacity-40",children:["(",v("com_endpoint_default"),": ",s,")"]})]})}),l.jsx(Lj,{showLabel:!1,emptyTitle:!0,disabled:d,value:j,setValue:e=>{i!==gd.Custom?o(t)(e):_(e)},availableValues:c,containerClassName:"w-full",id:`${t}-dynamic-dropdown`,placeholder:f?v(x)??x:x})]}),a&&l.jsx(tN,{description:h?v(a)??a:a,side:Go.Left})]})}):null},[fd.Switch]:function({label:e="",settingKey:t,defaultValue:s,description:a="",columnSpan:r,setOption:o,readonly:i=!1,showDefault:c=!1,labelCode:d=!1,descriptionCode:u=!1,conversation:m}){const p=zf(),{preset:h}=rg(),[x,f]=n.useState(!!s);_v({preset:h,settingKey:t,defaultValue:s,conversation:m,inputValue:x,setInputValue:f,preventDelayedUpdate:!0});const g=(null==m?void 0:m[t])??s;return l.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=r?`col-span-${r}`:"col-span-full"),children:l.jsxs(T_,{openDelay:300,children:[l.jsxs(R_,{className:"grid w-full items-center gap-2",children:[l.jsx("div",{className:"flex justify-between",children:l.jsxs(L_,{htmlFor:`${t}-dynamic-switch`,className:"text-left text-sm font-medium",children:[d?p(e)??e:e||t," ",c&&l.jsxs("small",{className:"opacity-40",children:["(",p("com_endpoint_default"),":"," ",null!=s?"com_ui_on":"com_ui_off",")"]})]})}),l.jsx(Q_,{id:`${t}-dynamic-switch`,checked:g,onCheckedChange:e=>{f(e),o(t)(e)},disabled:i,className:"flex"})]}),a&&l.jsx(tN,{description:u?p(a)??a:a,side:Go.Left})]})})},[fd.Textarea]:function({label:e="",settingKey:t,defaultValue:n,description:s="",columnSpan:a,setOption:r,optionType:o,placeholder:i="",readonly:c=!1,showDefault:d=!1,labelCode:u=!1,descriptionCode:m=!1,placeholderCode:p=!1,conversation:h}){const x=zf(),{preset:f}=rg(),[g,v,b]=vv({optionKey:t,initialValue:o!==gd.Custom?null==h?void 0:h[t]:n,setter:()=>({}),setOption:r});return _v({preset:f,settingKey:t,defaultValue:void 0===n?"":n,conversation:h,inputValue:v,setInputValue:b}),l.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=a?`col-span-${a}`:"col-span-full"),children:l.jsxs(T_,{openDelay:300,children:[l.jsxs(R_,{className:"grid w-full items-center gap-2",children:[l.jsx("div",{className:"flex w-full justify-between",children:l.jsxs(L_,{htmlFor:`${t}-dynamic-textarea`,className:"text-left text-sm font-medium",children:[u?x(e)??e:e||t," ",d&&l.jsxs("small",{className:"opacity-40",children:["(",void 0!==n&&n.length?`${x("com_endpoint_default")}: ${n}`:x("com_endpoint_default_blank"),")"]})]})}),l.jsx(aj,{id:`${t}-dynamic-textarea`,disabled:c,value:v??"",onChange:g,placeholder:p?x(i)??i:i,className:Op("flex max-h-[138px] min-h-[100px] w-full resize-none rounded-lg bg-surface-secondary px-3 py-2 focus:outline-none")})]}),s&&l.jsx(tN,{description:m?x(s)??s:s,side:Go.Left})]})})},[fd.Input]:function({label:e="",settingKey:t,defaultValue:n,description:s="",columnSpan:a,setOption:r,optionType:o,placeholder:i="",readonly:c=!1,showDefault:d=!1,labelCode:u=!1,descriptionCode:m=!1,placeholderCode:p=!1,conversation:h}){const x=zf(),{preset:f}=rg(),[g,v,b]=vv({optionKey:t,initialValue:o!==gd.Custom?null==h?void 0:h[t]:n,setter:()=>({}),setOption:r});_v({preset:f,settingKey:t,defaultValue:void 0===n?"":n,conversation:h,inputValue:v,setInputValue:b});const y=p&&x(i)||i;return l.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=a?`col-span-${a}`:"col-span-full"),children:l.jsxs(T_,{openDelay:300,children:[l.jsxs(R_,{className:"grid w-full items-center gap-2",children:[l.jsx("div",{className:"flex w-full justify-between",children:l.jsxs(L_,{htmlFor:`${t}-dynamic-input`,className:"text-left text-sm font-medium",children:[u?x(e)||e:e||t," ",d&&l.jsxs("small",{className:"opacity-40",children:["(",void 0!==n&&n.length?`${x("com_endpoint_default")}: ${n}`:x("com_endpoint_default_blank"),")"]})]})}),l.jsx(M_,{id:`${t}-dynamic-input`,disabled:c,value:v??n??"",onChange:e=>{g(e,!isNaN(Number(e.target.value)))},placeholder:y,className:Op("flex h-10 max-h-10 w-full resize-none border-none bg-surface-secondary px-3 py-2")})]}),s&&l.jsx(tN,{description:m&&x(s)||s,side:Go.Left})]})})},[fd.Checkbox]:function({label:e="",settingKey:t,defaultValue:s,description:a="",columnSpan:r,setOption:o,optionType:i,readonly:c=!1,showDefault:d=!1,labelCode:u=!1,descriptionCode:m=!1,conversation:p}){const h=zf(),{preset:x}=rg(),[f,g,v]=vv({optionKey:t,initialValue:i!==gd.Custom?null==p?void 0:p[t]:s,setter:()=>({}),setOption:o}),b=n.useMemo(()=>(null==p?void 0:p[t])??s,[p,s,t]);return _v({preset:x,settingKey:t,defaultValue:s,conversation:p,inputValue:g,setInputValue:v}),l.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=r?`col-span-${r}`:"col-span-full"),children:l.jsxs(T_,{openDelay:300,children:[l.jsx(R_,{className:"grid w-full items-center",children:l.jsxs("div",{className:"flex justify-start gap-4",children:[l.jsxs(L_,{htmlFor:`${t}-dynamic-checkbox`,className:"text-left text-sm font-medium",children:[u?h(e)??e:e||t," ",d&&l.jsxs("small",{className:"opacity-40",children:["(",h("com_endpoint_default"),":"," ",h(null!=s?"com_ui_yes":"com_ui_no"),")"]})]}),l.jsx(d_,{id:`${t}-dynamic-checkbox`,disabled:c,checked:b,onCheckedChange:e=>{f(e),o(t)(e)},className:"mt-[2px] focus:ring-opacity-20 dark:border-gray-500 dark:bg-gray-700 dark:text-gray-50 dark:focus:ring-gray-600 dark:focus:ring-opacity-50 dark:focus:ring-offset-0"})]})}),a&&l.jsx(tN,{description:m?h(a)??a:a,side:Go.Left})]})})},[fd.Tags]:function({label:e="",settingKey:t,defaultValue:s=[],description:a="",columnSpan:r,setOption:o,placeholder:i="",readonly:c=!1,showDefault:d=!1,labelCode:u=!1,descriptionCode:m=!1,placeholderCode:p=!1,descriptionSide:h=Go.Left,conversation:x,minTags:f,maxTags:g}){const v=zf(),{preset:b}=rg(),{showToast:y}=Of(),_=n.useRef(null),[j,w]=n.useState(""),[N,C]=n.useState(s??[]),k=n.useCallback(e=>{C(e),o(t)(e)},[o,t]),S=n.useCallback(()=>{_.current&&_.current.focus()},[_]),T=null==x?void 0:x[t],R=n.useMemo(()=>T??s??[],[T,s]),I=n.useCallback(e=>{if(!R)return;if(null!=f&&R.length<=f)return void y({message:v("com_ui_min_tags",{0:f+""}),status:"warning"});const t=R.filter((t,n)=>n!==e);k(t)},[v,f,R,y,k]),E=n.useCallback(()=>{if(!j)return;let e=[...R??[],j];null!=g&&e.length>g&&(y({message:v("com_ui_max_tags",{0:g+""}),status:"warning"}),e=e.slice(-g)),k(e),w("")},[j,R,k,g,y,v]);return _v({preset:b,settingKey:t,defaultValue:void 0===s?[]:s,inputValue:N,setInputValue:C,preventDelayedUpdate:!0,conversation:x}),l.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=r?`col-span-${r}`:"col-span-full"),children:l.jsxs(T_,{openDelay:300,children:[l.jsxs(R_,{className:"grid w-full items-center gap-2",children:[l.jsx("div",{className:"flex w-full justify-between",children:l.jsxs(L_,{htmlFor:`${t}-dynamic-input`,className:"text-left text-sm font-medium",children:[u?v(e)??e:e||t," ",d&&l.jsxs("small",{className:"opacity-40",children:["(",void 0!==s&&s.length?`${v("com_endpoint_default")}: ${s}`:v("com_endpoint_default_blank"),")"]})]})}),l.jsx("div",{children:l.jsxs("div",{className:"mb-2 flex flex-wrap break-all rounded-lg bg-surface-secondary",children:[R&&R.length>0&&l.jsx("div",{className:"flex w-full gap-1 p-1",children:R.map((e,t)=>l.jsx(sj,{label:e,onClick:S,onRemove:()=>{I(t),_.current&&_.current.focus()}},`${e}-${t}`))}),l.jsx(M_,{ref:_,id:`${t}-dynamic-input`,disabled:c,value:j,onKeyDown:e=>{R&&("Backspace"!==e.key||j||I(R.length-1),"Enter"===e.key&&E())},onChange:e=>w(e.target.value),placeholder:p?v(i)??i:i,className:Op("flex h-10 max-h-10 border-none bg-surface-secondary px-3 py-2")})]})})]}),a&&l.jsx(tN,{description:m?v(a)??a:a,side:h})]})})},[fd.Combobox]:function({label:e="",settingKey:t,defaultValue:s,description:a="",columnSpan:r,setOption:o,options:i,items:c,showLabel:d=!0,showDefault:u=!1,labelCode:m=!1,descriptionCode:p=!1,searchPlaceholderCode:h=!1,selectPlaceholderCode:x=!1,conversation:f,isCollapsed:g=!1,SelectIcon:v=null,selectPlaceholder:b="",searchPlaceholder:y=""}){const _=zf(),{preset:j}=rg(),[w,N]=n.useState(null),C=n.useMemo(()=>(null==f?void 0:f[t])??s,[f,s,t]),k=n.useMemo(()=>null!=c?c:(i??[]).map(e=>({label:e,value:e})),[i,c]),S=n.useCallback(e=>{N(e),o(t)(e)},[o,t]);return _v({preset:j,settingKey:t,defaultValue:s,conversation:f,inputValue:w,setInputValue:N,preventDelayedUpdate:!0}),0===(k??i??[]).length?null:l.jsx("div",{className:Op("flex flex-col items-center justify-start gap-6",null!=r?`col-span-${r}`:"col-span-full"),children:l.jsxs(T_,{openDelay:300,children:[l.jsxs(R_,{className:"grid w-full items-center gap-2",children:[!0===d&&l.jsx("div",{className:"flex w-full justify-between",children:l.jsxs(L_,{htmlFor:`${t}-dynamic-combobox`,className:"text-left text-sm font-medium",children:[m?_(e)??e:e||t,u&&l.jsxs("small",{className:"opacity-40",children:["(",_("com_endpoint_default"),": ",s,")"]})]})}),l.jsx(eN,{displayValue:C,selectPlaceholder:!0===x?_(b):b,searchPlaceholder:!0===h?_(y):y,isCollapsed:g,ariaLabel:t,selectedValue:C??"",setValue:S,items:k,SelectIcon:v})]}),a&&l.jsx(tN,{description:p?_(a)??a:a,side:Go.Left})]})})}};function sN({conversation:e,setOption:t,models:s,readonly:a}){const r=n.useMemo(()=>{const[t,n]=_i((null==e?void 0:e.endpointType)??(null==e?void 0:e.endpoint)??"",(null==e?void 0:e.model)??"");return wm[t]??wm[n]},[e]);if(!r)return null;const o=n=>{if(!n)return null;const r=nN[n.component];if(!r)return null;const{key:o,default:i,...c}=n,d={key:o,settingKey:o,defaultValue:i,...c,readonly:a,setOption:t,conversation:e};return"model"===o?l.jsx(r,{...d,options:s}):l.jsx(r,{...d})};return l.jsx("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:l.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-5",children:[l.jsx("div",{className:"flex flex-col gap-6 md:col-span-3",children:r.col1.map(o)}),l.jsx("div",{className:"flex flex-col gap-6 md:col-span-2",children:r.col2.map(o)})]})})}function aN({conversation:e,setOption:t,models:n,readonly:s}){const a=zf(),r=zi[vi.google],{model:o,modelLabel:i,promptPrefix:c,temperature:d,topP:u,topK:m,maxContextTokens:p,maxOutputTokens:h}=e??{},[x,f]=vv({setOption:t,optionKey:"maxContextTokens",initialValue:p});if(!e)return null;const g=t("model"),v=t("modelLabel"),b=t("promptPrefix"),y=t("temperature"),_=t("topP"),j=t("topK"),w=t("maxOutputTokens");return l.jsxs("div",{className:"grid grid-cols-5 gap-6",children:[l.jsxs("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 sm:col-span-3",children:[l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(Lj,{value:o??"",setValue:g,availableValues:n,disabled:s,className:Op(Wp,"flex w-full resize-none",Gp),containerClassName:"flex w-full resize-none"})}),l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsxs(L_,{htmlFor:"modelLabel",className:"text-left text-sm font-medium",children:[a("com_endpoint_custom_name")," ",l.jsxs("small",{className:"opacity-40",children:["(",a("com_endpoint_default_blank"),")"]})]}),l.jsx(M_,{id:"modelLabel",disabled:s,value:i||"",onChange:e=>v(e.target.value??null),placeholder:a("com_endpoint_google_custom_name_placeholder"),className:Op(Wp,"flex h-10 max-h-10 w-full resize-none px-3 py-2",Kp)})]}),l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsxs(L_,{htmlFor:"promptPrefix",className:"text-left text-sm font-medium",children:[a("com_endpoint_prompt_prefix")," ",l.jsxs("small",{className:"opacity-40",children:["(",a("com_endpoint_default_blank"),")"]})]}),l.jsx(me,{id:"promptPrefix",disabled:s,value:c||"",onChange:e=>b(e.target.value??null),placeholder:a("com_endpoint_prompt_prefix_placeholder"),className:Op(Wp,"flex max-h-[138px] min-h-[100px] w-full resize-none px-3 py-2 ")})]})]}),l.jsxs("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 px-3 sm:col-span-2",children:[l.jsxs(T_,{openDelay:300,children:[l.jsx(R_,{className:"grid w-full items-center gap-2",children:l.jsxs("div",{className:"mt-1 flex w-full justify-between",children:[l.jsxs(L_,{htmlFor:"max-context-tokens",className:"text-left text-sm font-medium",children:[a("com_endpoint_context_tokens")," "]}),l.jsx(P_,{id:"max-context-tokens",stringMode:!1,disabled:s,value:f,onChange:x,placeholder:a("com_nav_theme_system"),min:10,max:2e6,step:1e3,controls:!1,className:Op(Wp,Op(qp,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200","w-1/3"))})]})}),l.jsx(tN,{description:"com_endpoint_context_info",langCode:!0,side:Go.Left})]}),l.jsxs(T_,{openDelay:300,children:[l.jsxs(R_,{className:"grid w-full items-center gap-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsxs(L_,{htmlFor:"temp-int",className:"text-left text-sm font-medium",children:[a("com_endpoint_temperature")," ",l.jsxs("small",{className:"opacity-40",children:["(",a("com_endpoint_default"),": ",r.temperature.default,")"]})]}),l.jsx(P_,{id:"temp-int",disabled:s,value:d,onChange:e=>y(e??r.temperature.default),max:r.temperature.max,min:r.temperature.min,step:r.temperature.step,controls:!1,className:Op(Wp,Op(qp,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),l.jsx(K_,{disabled:s,value:[d??r.temperature.default],onValueChange:e=>y(e[0]),onDoubleClick:()=>y(r.temperature.default),max:r.temperature.max,min:r.temperature.min,step:r.temperature.step,className:"flex h-4 w-full"})]}),l.jsx(Yw,{endpoint:e.endpoint??"",type:"temp",side:Go.Left})]}),l.jsxs(T_,{openDelay:300,children:[l.jsxs(R_,{className:"grid w-full items-center gap-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsxs(L_,{htmlFor:"top-p-int",className:"text-left text-sm font-medium",children:[a("com_endpoint_top_p")," ",l.jsxs("small",{className:"opacity-40",children:["(",a("com_endpoint_default_with_num",{0:r.topP.default+""}),")"]})]}),l.jsx(P_,{id:"top-p-int",disabled:s,value:u,onChange:e=>_(e??r.topP.default),max:r.topP.max,min:r.topP.min,step:r.topP.step,controls:!1,className:Op(Wp,Op(qp,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),l.jsx(K_,{disabled:s,value:[u??r.topP.default],onValueChange:e=>_(e[0]),onDoubleClick:()=>_(r.topP.default),max:r.topP.max,min:r.topP.min,step:r.topP.step,className:"flex h-4 w-full"})]}),l.jsx(Yw,{endpoint:e.endpoint??"",type:"topp",side:Go.Left})]}),l.jsxs(T_,{openDelay:300,children:[l.jsxs(R_,{className:"grid w-full items-center gap-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsxs(L_,{htmlFor:"top-k-int",className:"text-left text-sm font-medium",children:[a("com_endpoint_top_k")," ",l.jsxs("small",{className:"opacity-40",children:["(",a("com_endpoint_default_with_num",{0:r.topK.default+""}),")"]})]}),l.jsx(P_,{id:"top-k-int",disabled:s,value:m,onChange:e=>j(e??r.topK.default),max:r.topK.max,min:r.topK.min,step:r.topK.step,controls:!1,className:Op(Wp,Op(qp,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),l.jsx(K_,{disabled:s,value:[m??r.topK.default],onValueChange:e=>j(e[0]),onDoubleClick:()=>j(r.topK.default),max:r.topK.max,min:r.topK.min,step:r.topK.step,className:"flex h-4 w-full"})]}),l.jsx(Yw,{endpoint:e.endpoint??"",type:"topk",side:Go.Left})]}),l.jsxs(T_,{openDelay:300,children:[l.jsxs(R_,{className:"grid w-full items-center gap-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsxs(L_,{htmlFor:"max-tokens-int",className:"text-left text-sm font-medium",children:[a("com_endpoint_max_output_tokens")," ",l.jsxs("small",{className:"opacity-40",children:["(",a("com_endpoint_default_with_num",{0:r.maxOutputTokens.default+""}),")"]})]}),l.jsx(P_,{id:"max-tokens-int",disabled:s,value:h,onChange:e=>w(Number(e)),max:r.maxOutputTokens.max,min:r.maxOutputTokens.min,step:r.maxOutputTokens.step,controls:!1,className:Op(Wp,Op(qp,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),l.jsx(K_,{disabled:s,value:[h??r.maxOutputTokens.default],onValueChange:e=>w(e[0]),onDoubleClick:()=>w(r.maxOutputTokens.default),max:r.maxOutputTokens.max,min:r.maxOutputTokens.min,step:r.maxOutputTokens.step,className:"flex h-4 w-full"})]}),l.jsx(Yw,{endpoint:e.endpoint??"",type:"maxoutputtokens",side:Go.Left})]})]})]})}function rN({conversation:e,setOption:t,setTools:s,checkPluginSelection:a,models:r,readonly:o}){const i=zf(),c=_(sx.availableTools),{data:d}=Yf({select:Yo}),u=n.useMemo(()=>(null==e?void 0:e.tools)?Xo(e.tools,null==d?void 0:d.map):[],[e,d]),m=n.useMemo(()=>c?Object.values(c):[],[c]),{model:p,modelLabel:h,chatGptLabel:x,promptPrefix:f,temperature:g,top_p:v,frequency_penalty:b,presence_penalty:y,maxContextTokens:j}=e??{},[w,N]=vv({setOption:t,optionKey:"chatGptLabel",initialValue:h??x}),[C,k]=vv({setOption:t,optionKey:"promptPrefix",initialValue:f}),[S,T]=vv({setOption:t,optionKey:"temperature",initialValue:g}),[R,I]=vv({setOption:t,optionKey:"top_p",initialValue:v}),[E,M]=vv({setOption:t,optionKey:"frequency_penalty",initialValue:b}),[P,L]=vv({setOption:t,optionKey:"presence_penalty",initialValue:y}),[A,O]=vv({setOption:t,optionKey:"maxContextTokens",initialValue:j}),D=t("model");return e?l.jsxs("div",{className:"grid grid-cols-5 gap-6",children:[l.jsxs("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 sm:col-span-3",children:[l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(Lj,{title:i("com_endpoint_completion_model"),value:p??"",setValue:D,availableValues:r,disabled:o,className:Op(Wp,"flex w-full resize-none",Gp),containerClassName:"flex w-full resize-none"})}),l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsxs(L_,{htmlFor:"chatGptLabel",className:"text-left text-sm font-medium",children:[i("com_endpoint_custom_name")," ",l.jsx("small",{className:"opacity-40",children:i("com_endpoint_default_empty")})]}),l.jsx(M_,{id:"chatGptLabel",disabled:o,value:N||"",onChange:e=>w(e.target.value??null),placeholder:i("com_endpoint_openai_custom_name_placeholder"),className:Op(Wp,"flex h-10 max-h-10 w-full resize-none px-3 py-2",Kp)})]}),l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsxs(L_,{htmlFor:"promptPrefix",className:"text-left text-sm font-medium",children:[i("com_endpoint_prompt_prefix")," ",l.jsx("small",{className:"opacity-40",children:i("com_endpoint_default_empty")})]}),l.jsx(me,{id:"promptPrefix",disabled:o,value:k||"",onChange:e=>C(e.target.value??null),placeholder:i("com_endpoint_plug_set_custom_instructions_for_gpt_placeholder"),className:Op(Wp,"flex max-h-[138px] min-h-[100px] w-full resize-none px-3 py-2 ")})]})]})]}),l.jsxs("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 px-3 sm:col-span-2",children:[l.jsx(zj,{showAbove:!1,showLabel:!1,setSelected:s,value:u,optionValueKey:"pluginKey",availableValues:m,isSelected:a,searchPlaceholder:i("com_ui_select_search_plugin"),className:Op(Wp,"flex w-full resize-none",Kp),optionsClassName:"w-full max-h-[275px] dark:bg-gray-700 z-10 border dark:border-gray-600",containerClassName:"flex w-full resize-none border border-transparent",labelClassName:"dark:text-white"}),l.jsxs(T_,{openDelay:300,children:[l.jsx(R_,{className:"grid w-full items-center gap-2",children:l.jsxs("div",{className:"mt-1 flex w-full justify-between",children:[l.jsxs(L_,{htmlFor:"max-context-tokens",className:"text-left text-sm font-medium",children:[i("com_endpoint_context_tokens")," "]}),l.jsx(P_,{id:"max-context-tokens",stringMode:!1,disabled:o,value:O,onChange:A,placeholder:i("com_nav_theme_system"),min:10,max:2e6,step:1e3,controls:!1,className:Op(Wp,Op(qp,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200","w-1/3"))})]})}),l.jsx(tN,{description:"com_endpoint_context_info",langCode:!0,side:Go.Left})]}),l.jsxs(T_,{openDelay:300,children:[l.jsxs(R_,{className:"grid w-full items-center gap-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsxs(L_,{htmlFor:"temp-int",className:"text-left text-sm font-medium",children:[i("com_endpoint_temperature")," ",l.jsxs("small",{className:"opacity-40",children:["(",i("com_endpoint_default_with_num",{0:"0.8"}),")"]})]}),l.jsx(P_,{id:"temp-int",disabled:o,value:T,onChange:e=>S(Number(e)),max:2,min:0,step:.01,controls:!1,className:Op(Wp,Op(qp,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),l.jsx(K_,{disabled:o,value:[T??.8],onValueChange:e=>S(e[0]),onDoubleClick:()=>S(.8),max:2,min:0,step:.01,className:"flex h-4 w-full"})]}),l.jsx(Yw,{endpoint:e.endpoint??"",type:"temp",side:Go.Left})]}),l.jsxs(T_,{openDelay:300,children:[l.jsxs(R_,{className:"grid w-full items-center gap-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsxs(L_,{htmlFor:"top-p-int",className:"text-left text-sm font-medium",children:[i("com_endpoint_top_p")," ",l.jsxs("small",{className:"opacity-40",children:["(",i("com_endpoint_default_with_num",{0:"1"}),")"]})]}),l.jsx(P_,{id:"top-p-int",disabled:o,value:I,onChange:e=>R(Number(e)),max:1,min:0,step:.01,controls:!1,className:Op(Wp,Op(qp,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),l.jsx(K_,{disabled:o,value:[I??1],onValueChange:e=>R(e[0]),onDoubleClick:()=>R(1),max:1,min:0,step:.01,className:"flex h-4 w-full"})]}),l.jsx(Yw,{endpoint:e.endpoint??"",type:"topp",side:Go.Left})]}),l.jsxs(T_,{openDelay:300,children:[l.jsxs(R_,{className:"grid w-full items-center gap-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsxs(L_,{htmlFor:"freq-penalty-int",className:"text-left text-sm font-medium",children:[i("com_endpoint_frequency_penalty")," ",l.jsxs("small",{className:"opacity-40",children:["(",i("com_endpoint_default_with_num",{0:"0"}),")"]})]}),l.jsx(P_,{id:"freq-penalty-int",disabled:o,value:M,onChange:e=>E(Number(e)),max:2,min:-2,step:.01,controls:!1,className:Op(Wp,Op(qp,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),l.jsx(K_,{disabled:o,value:[M??0],onValueChange:e=>E(e[0]),onDoubleClick:()=>E(0),max:2,min:-2,step:.01,className:"flex h-4 w-full"})]}),l.jsx(Yw,{endpoint:e.endpoint??"",type:"freq",side:Go.Left})]}),l.jsxs(T_,{openDelay:300,children:[l.jsxs(R_,{className:"grid w-full items-center gap-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsxs(L_,{htmlFor:"pres-penalty-int",className:"text-left text-sm font-medium",children:[i("com_endpoint_presence_penalty")," ",l.jsxs("small",{className:"opacity-40",children:["(",i("com_endpoint_default_with_num",{0:"0"}),")"]})]}),l.jsx(P_,{id:"pres-penalty-int",disabled:o,value:L,onChange:e=>P(Number(e)),max:2,min:-2,step:.01,controls:!1,className:Op(Wp,Op(qp,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),l.jsx(K_,{disabled:o,value:[L??0],onValueChange:e=>P(e[0]),onDoubleClick:()=>P(0),max:2,min:-2,step:.01,className:"flex h-4 w-full"})]}),l.jsx(Yw,{endpoint:e.endpoint??"",type:"pres",side:Go.Left})]})]})]}):null}function oN({readonly:e,examples:t,setExample:n,addExample:s,removeExample:a}){const r=zf();return l.jsxs(l.Fragment,{children:[l.jsx("div",{id:"examples-grid",className:"grid gap-6 sm:grid-cols-2",children:t.map((s,a)=>l.jsxs(m.Fragment,{children:[l.jsx("div",{className:`col-span-${1===t.length?"1":"full"} flex flex-col items-center justify-start gap-6 sm:col-span-1`,children:l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsxs(L_,{htmlFor:`input-${a}`,className:"text-left text-sm font-medium",children:[r("com_ui_input")," ",l.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default_blank"),")"]})]}),l.jsx(me,{id:`input-${a}`,disabled:e,value:s.input.content||"",onChange:e=>n(a,"input",e.target.value??null),placeholder:"Set example input. Example is ignored if empty.",className:Op(Wp,"flex max-h-[138px] min-h-[75px] w-full resize-none px-3 py-2 ")})]})}),l.jsx("div",{className:`col-span-${1===t.length?"1":"full"} flex flex-col items-center justify-start gap-6 sm:col-span-1`,children:l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsxs(L_,{htmlFor:`output-${a}`,className:"text-left text-sm font-medium",children:[r("com_endpoint_output")," ",l.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default_blank"),")"]})]}),l.jsx(me,{id:`output-${a}`,disabled:e,value:s.output.content||"",onChange:e=>n(a,"output",e.target.value??null),placeholder:"Set example output. Example is ignored if empty.",className:Op(Wp,"flex max-h-[300px] min-h-[75px] w-full resize-none px-3 py-2 ")})]})})]},a))}),l.jsxs("div",{className:"flex justify-center",children:[l.jsx(c_,{type:"button",className:"mr-2 mt-1 h-auto items-center justify-center bg-transparent px-3 py-2 text-xs font-medium font-normal text-black hover:bg-gray-100 hover:text-black focus:ring-0 focus:ring-offset-0 dark:bg-transparent dark:text-white dark:hover:bg-gray-700 dark:hover:text-white dark:focus:outline-none dark:focus:ring-offset-0",onClick:a,children:l.jsx(ye,{className:"w-[16px]"})}),l.jsx(c_,{type:"button",className:"mt-1 h-auto items-center justify-center bg-transparent px-3 py-2 text-xs font-medium font-normal text-black hover:bg-gray-100 hover:text-black focus:ring-0 focus:ring-offset-0 dark:bg-transparent dark:text-white dark:hover:bg-gray-700 dark:hover:text-white dark:focus:outline-none dark:focus:ring-offset-0",onClick:s,children:l.jsx(_e,{className:"w-[16px]"})})]})]})}function iN({conversation:e,setOption:t,models:n,readonly:s}){const a=zf();if(!e)return null;const{agent:r,skipCompletion:o,model:i,temperature:c}=e.agentOptions??{},d=t("model"),u=t("temperature"),m=t("agent"),p=t("skipCompletion");return l.jsxs("div",{className:"grid grid-cols-5 gap-6",children:[l.jsx("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 sm:col-span-3",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(Lj,{title:a("com_endpoint_agent_model"),value:i??"",setValue:d,availableValues:n,disabled:s,className:Op(Wp,"flex w-full resize-none",Gp),containerClassName:"flex w-full resize-none"})})}),l.jsxs("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 px-3 sm:col-span-2",children:[l.jsxs(T_,{openDelay:300,children:[l.jsxs(R_,{className:"grid w-full items-center gap-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsxs(L_,{htmlFor:"temp-int",className:"text-left text-sm font-medium",children:[a("com_endpoint_temperature")," ",l.jsxs("small",{className:"opacity-40",children:["(",a("com_endpoint_default"),": 0)"]})]}),l.jsx(P_,{id:"temp-int",disabled:s,value:c,onChange:e=>u(Number(e)),max:2,min:0,step:.01,controls:!1,className:Op(Wp,Op(qp,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),l.jsx(K_,{disabled:s,value:[c??0],onValueChange:e=>u(e[0]),onDoubleClick:()=>u(1),max:2,min:0,step:.01,className:"flex h-4 w-full"})]}),l.jsx(Yw,{endpoint:e.endpoint??"",type:"temp",side:Go.Left})]}),l.jsxs("div",{className:"grid w-full grid-cols-2 items-center gap-10",children:[l.jsxs(T_,{openDelay:500,children:[l.jsxs(R_,{className:"flex w-[100px] flex-col items-center space-y-4 text-center",children:[l.jsx("label",{htmlFor:"functions-agent",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:l.jsx("small",{children:a("com_endpoint_plug_use_functions")})}),l.jsx(Q_,{id:"functions-agent",checked:"functions"===r,onCheckedChange:e=>{m(e?"functions":"classic")},disabled:s,className:"ml-4 mt-2"})]}),l.jsx(Yw,{endpoint:e.endpoint??"",type:"func",side:Go.Bottom})]}),l.jsxs(T_,{openDelay:500,children:[l.jsxs(R_,{className:"ml-[-60px] flex w-[100px] flex-col items-center space-y-4 text-center",children:[l.jsx("label",{htmlFor:"skip-completion",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:l.jsx("small",{children:a("com_endpoint_plug_skip_completion")})}),l.jsx(Q_,{id:"skip-completion",checked:!0===o,onCheckedChange:e=>{p(e)},disabled:s,className:"ml-4 mt-2"})]}),l.jsx(Yw,{endpoint:e.endpoint??"",type:"skip",side:Go.Bottom})]})]})]})]})}function lN({conversation:e,models:t,isPreset:n=!1}){var s,a;const{optionSettings:r}=rg(),{setOption:o,setExample:i,addExample:c,removeExample:d}=yv(n?e:null);if(!e)return null;const{examples:u,model:m}=e,p=null==(s=null==m?void 0:m.toLowerCase())?void 0:s.includes("gemini"),h=!p&&(null==(a=null==m?void 0:m.toLowerCase())?void 0:a.includes("chat")),x=!p&&!h&&/code|text/.test(m??""),{showExamples:f}=r;return f&&h&&!x?l.jsx(oN,{examples:u??[{input:{content:""},output:{content:""}}],setExample:i,addExample:c,removeExample:d}):l.jsx(aN,{conversation:e,setOption:o,models:t})}function cN({conversation:e,models:t,isPreset:n=!1}){const{showAgentSettings:s}=rg(),{setOption:a,setTools:r,setAgentOption:o,checkPluginSelection:i}=yv(n?e:null);return e?s?l.jsx(iN,{conversation:e,setOption:o,models:t}):l.jsx(rN,{conversation:e,setOption:a,setTools:r,checkPluginSelection:i,models:t}):null}const dN={[vi.assistants]:Xw,[vi.azureAssistants]:Xw,[vi.agents]:sN,[vi.openAI]:sN,[vi.custom]:sN,[vi.azureOpenAI]:sN,[vi.anthropic]:function({conversation:e,setOption:t,models:s,readonly:a}){const r=n.useMemo(()=>{const[t,n]=_i((null==e?void 0:e.endpointType)??(null==e?void 0:e.endpoint)??"",(null==e?void 0:e.model)??"");return wm[t]??wm[n]},[e]);if(!r)return null;const o=n=>{if(!n)return null;const r=nN[n.component];if(!r)return null;const{key:o,default:i,...c}=n,d={key:o,settingKey:o,defaultValue:i,...c,readonly:a,setOption:t,conversation:e};return"model"===o?l.jsx(r,{...d,options:s}):l.jsx(r,{...d})};return l.jsx("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:l.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-5",children:[l.jsx("div",{className:"flex flex-col gap-6 md:col-span-3",children:r.col1.map(o)}),l.jsx("div",{className:"flex flex-col gap-6 md:col-span-2",children:r.col2.map(o)})]})})},[vi.bedrock]:function({conversation:e,setOption:t,models:s,readonly:a}){const r=n.useMemo(()=>{const[t,n]=_i((null==e?void 0:e.endpointType)??(null==e?void 0:e.endpoint)??"",(null==e?void 0:e.model)??"");return wm[t]??wm[n]},[e]);if(!r)return null;const o=n=>{if(!n)return null;const r=nN[n.component];if(!r)return null;const{key:o,default:i,...c}=n,d={key:o,settingKey:o,defaultValue:i,...c,readonly:a,setOption:t,conversation:e};return"model"===o?l.jsx(r,{...d,options:s}):l.jsx(r,{...d})};return l.jsx("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:l.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-5",children:[l.jsx("div",{className:"flex flex-col gap-6 md:col-span-3",children:r.col1.map(o)}),l.jsx("div",{className:"flex flex-col gap-6 md:col-span-2",children:r.col2.map(o)})]})})}};function uN({conversation:e,setOption:t,isPreset:n=!1,className:s=""}){var a;const r=Gf(),{data:o}=kx(),i=_(sx.currentSettingsView),c=fp(o,(null==e?void 0:e.endpoint)??"","type")??(null==e?void 0:e.endpoint)??"";if(!c||i!==Kl.default)return null;const{settings:d,multiViewSettings:u}={settings:dN,multiViewSettings:{[vi.google]:lN,[vi.gptPlugins]:cN}},{endpoint:m}=e,p=(null==(a=r.data)?void 0:a[m??""])??[],h=d[c];if(h)return l.jsx("div",{className:Op("h-[500px] overflow-y-auto md:mb-2 md:h-[350px]",s),children:l.jsx(h,{conversation:e,setOption:t,models:p,isPreset:n})});const x=u[c];return null==x?null:l.jsx("div",{className:Op("hide-scrollbar h-[500px] overflow-y-auto md:mb-2 md:h-[350px]",s),children:l.jsx(x,{conversation:e,models:p,isPreset:n})})}const mN=({open:e,onOpenChange:t,preset:s})=>{const[a,r]=n.useState(s.title??"My Preset"),o=Wf(),{showToast:i}=Of(),c=zf(),d=()=>{const e=$p({preset:{...s,title:a}}),n=e.title?`\`${e.title}\``:c("com_endpoint_preset_title");o.mutate(e,{onSuccess:()=>{i({message:`${n} ${c("com_ui_saved")}`}),t(!1)},onError:()=>{i({message:c("com_endpoint_preset_save_error"),severity:Wo.ERROR})}})};n.useEffect(()=>{r(s.title??c("com_endpoint_my_preset"))},[e]);return l.jsx(A_,{open:e,onOpenChange:t,children:l.jsx(Oj,{title:c("com_endpoint_save_as_preset"),className:"z-[90] w-11/12 sm:w-1/4",overlayClassName:"z-[80]",showCloseButton:!1,main:l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsx(L_,{htmlFor:"preset-custom-name",className:"text-left text-sm font-medium",children:c("com_endpoint_preset_name")}),l.jsx(M_,{id:"preset-custom-name",value:a||"",onChange:e=>r(e.target.value||""),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),d())},placeholder:c("com_endpoint_preset_custom_name_placeholder"),"aria-label":c("com_endpoint_preset_name"),className:Op(Wp,"flex h-10 max-h-10 w-full resize-none border-border-medium px-3 py-2 ",Kp)})]})}),selection:{selectHandler:d,selectClasses:"bg-white hover:bg-gray-100 text-black dark:bg-gray-800 dark:hover:bg-gray-700 dark:text-white border border-gray-300 dark:border-gray-600",selectText:c("com_ui_save")}})})},pN={[Ml.openai]:vi.openAI,[Ml.azure]:vi.azureOpenAI},hN={[Ml.openai]:"bg-white/75 dark:bg-black/65",[Ml.azure]:"azure-bg-color",[Ml.azure_blob]:"azure-bg-color",[Ml.execute_code]:"bg-black text-white opacity-85",[Ml.text]:"bg-blue-500 dark:bg-blue-900 opacity-85 text-white",[Ml.vectordb]:"bg-yellow-700 dark:bg-yellow-900 opacity-85 text-white"};function xN({source:e,isCodeFile:t,className:n="absolute right-0 bottom-0 rounded-full p-[0.15rem] text-gray-600 transition-colors"}){if(!0===t)return l.jsx("div",{className:Op(n,hN[Ml.execute_code]??""),children:l.jsx("span",{className:"flex items-center justify-center",children:l.jsx(ut,{className:"h-3 w-3"})})});if(e===Ml.text)return l.jsx("div",{className:Op(n,hN[e]??""),children:l.jsx("span",{className:"flex items-center justify-center",children:l.jsx(mt,{className:"h-3 w-3"})})});if(e===Ml.vectordb)return l.jsx("div",{className:Op(n,hN[e]??""),children:l.jsx("span",{className:"flex items-center justify-center",children:l.jsx(pt,{className:"h-3 w-3"})})});const s=pN[e??""];return s?l.jsx("div",{className:Op(n,hN[e??""]??""),children:l.jsx("span",{className:"flex items-center justify-center",children:l.jsx(Bw,{endpoint:s,size:14,isCreatedByUser:!1,iconClassName:"h-3 w-3"})})}):null}const fN=({file:e,fileType:t,className:n=""})=>{var s;return l.jsxs("div",{className:Op("relative size-10 shrink-0 overflow-hidden rounded-xl",n),children:[l.jsx(Aw,{file:e,fileType:t}),l.jsx(xN,{source:null==e?void 0:e.source,isCodeFile:!!(null==(s=null==e?void 0:e.metadata)?void 0:s.fileIdentifier)}),"number"==typeof(null==e?void 0:e.progress)&&(null==e?void 0:e.progress)<1&&l.jsx(Gb,{bgOpacity:.2,color:"white",className:"absolute inset-0 m-2.5 flex items-center justify-center"})]})},gN=({artifact:e})=>{const t=zf(),s=N(),a=y(sx.artifactsVisibility),[r,o]=b(sx.artifactsState),i=y(sx.currentArtifactId),c=w(sx.currentArtifactId),[d,u]=b(sx.visibleArtifacts),m=n.useRef(Cr(e=>{Dp.log("artifacts_visibility","Setting artifact to visible state from Artifact button",e),u(t=>({...t,[e.id]:e}))},750));if(n.useEffect(()=>{if(null==e||null==(null==e?void 0:e.id)||""===e.id)return;if(!s.pathname.includes("/c/"))return;const t=m.current;return t(e),()=>{t.cancel()}},[e,s.pathname]),null==e)return null;const p=Im("artifact");return l.jsxs("div",{className:"group relative my-4 rounded-xl text-sm text-text-primary",children:[l.jsx("button",{type:"button",onClick:()=>{s.pathname.includes("/c/")&&(c(),a(!0),null==(null==r?void 0:r[e.id])&&o(d),setTimeout(()=>{i(e.id)},15))},className:"relative overflow-hidden rounded-xl border border-border-medium transition-all duration-300 hover:border-border-xheavy hover:shadow-lg",children:l.jsx("div",{className:"w-fit bg-surface-tertiary p-2",children:l.jsxs("div",{className:"flex flex-row items-center gap-2",children:[l.jsx(fN,{fileType:p,className:"relative"}),l.jsxs("div",{className:"overflow-hidden text-left",children:[l.jsx("div",{className:"truncate font-medium",children:e.title}),l.jsx("div",{className:"truncate text-text-secondary",children:t("com_ui_artifact_click")})]})]})})}),l.jsx("br",{})]})},vN=()=>e=>{ht(e,["textDirective","leafDirective","containerDirective"],(e,t,n)=>{if("textDirective"===e.type){const s=`:${e.name}`;n&&Array.isArray(n.children)&&"number"==typeof t&&(n.children[t]={type:"text",value:s})}if("artifact"===e.name)return e.data={hName:e.name,hProperties:e.attributes,...e.data},e})},bN="untitled",yN="unknown",_N="lc-no-identifier";function jN({node:e,...t}){const s=N(),{messageId:a}=ev(),{getNextIndex:r,resetCounter:o}=n.useContext(ov),i=n.useRef(r(!1)).current,c=y(Yp),[d,u]=n.useState(null),m=n.useRef(kr(e=>{e()},25)),p=n.useCallback(()=>{const e=Zp(t.children);Dp.log("artifacts","updateArtifact: content.length",e.length);const n=t.title??bN,r=t.type??yN,o=t.identifier??_N,l=`${o}_${r}_${n}_${a}`.replace(/\s+/g,"_").toLowerCase();m.current(()=>{const t=Date.now();if(l===`${_N}_${yN}_${bN}_${a}`)return;const d={id:l,identifier:o,title:n,type:r,content:e,messageId:a,index:i,lastUpdateTime:t};if(!s.pathname.includes("/c/"))return u(d);c(t=>{var n;return null!=(null==t?void 0:t[l])&&(null==(n=t[l])?void 0:n.content)===e?t:{...t,[l]:d}}),u(d)})},[t.type,t.title,c,t.children,t.identifier,a,i,s.pathname]);return n.useEffect(()=>{o(),p()},[p,o]),l.jsx(gN,{artifact:d})}const wN=({currentIndex:e,totalCount:t,onPrevious:n,onNext:s})=>t<=1?null:l.jsxs("div",{className:"flex items-center justify-start gap-1 self-center bg-gray-700 pb-2 text-xs",children:[l.jsx("button",{className:"hover-button rounded-md p-1 text-gray-400 hover:bg-gray-700 hover:text-gray-200 disabled:hover:text-gray-400",type:"button",onClick:n,disabled:0===e,children:l.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"1.5",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("polyline",{points:"15 18 9 12 15 6"})})}),l.jsxs("span",{className:"flex-shrink-0 tabular-nums",children:[e+1," / ",t]}),l.jsx("button",{className:"hover-button rounded-md p-1 text-gray-400 hover:bg-gray-700 hover:text-gray-200 disabled:hover:text-gray-400",type:"button",onClick:s,disabled:e===t-1,children:l.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"1.5",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("polyline",{points:"9 18 15 12 9 6"})})})]});function NN({onRemove:e}){const t=zf();return l.jsx("button",{type:"button",className:"absolute right-1 top-1 -translate-y-1/2 translate-x-1/2 rounded-full bg-surface-secondary p-0.5 transition-colors duration-200 hover:bg-surface-primary",onClick:e,"aria-label":t("com_ui_attach_remove"),children:l.jsx("span",{"aria-hidden":"true",children:l.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"icon-sm",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",children:[l.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),l.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})})}const CN=({file:e,overrideType:t,buttonClassName:n,containerClassName:s,onDelete:a,onClick:r})=>{const o=Im(t??e.type);return l.jsxs("div",{className:Op("group relative inline-block text-sm text-text-primary",s),children:[l.jsx("button",{type:"button",onClick:r,"aria-label":e.filename,className:Op("relative overflow-hidden rounded-2xl border border-border-light bg-surface-hover-alt",n),children:l.jsx("div",{className:"w-56 p-1.5",children:l.jsxs("div",{className:"flex flex-row items-center gap-2",children:[l.jsx(fN,{file:e,fileType:o,className:"relative"}),l.jsxs("div",{className:"overflow-hidden",children:[l.jsx("div",{className:"truncate font-medium",title:e.filename,children:e.filename}),l.jsx("div",{className:"truncate text-text-secondary",title:o.title,children:o.title})]})]})})}),a&&l.jsx(NN,{onRemove:a})]})};function kN({isOpen:e,onOpenChange:t,src:s="",downloadImage:a,args:r}){const o=zf(),[i,c]=n.useState(!1),[d,u]=n.useState(null),m=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]};return n.useEffect(()=>{e&&s&&(async e=>{try{const t=(await fetch(e,{method:"HEAD"})).headers.get("Content-Length");if(t){const e=parseInt(t,10);return m(e)}const n=await fetch(e),s=await n.blob();return m(s.size)}catch(t){return console.error("Error getting image size:",t),null}})(s).then(u)},[e,s]),l.jsx(A_,{open:e,onOpenChange:t,children:l.jsxs(V_,{showCloseButton:!1,className:"h-full w-full rounded-none bg-transparent",disableScroll:!1,overlayClassName:"bg-surface-primary opacity-95 z-50",children:[l.jsxs("div",{className:"absolute left-0 top-0 z-10 flex items-center justify-between p-4 transition-all duration-500 ease-in-out "+(i?"right-80":"right-0"),children:[l.jsx(rj,{description:o("com_ui_close"),render:l.jsx(c_,{onClick:()=>t(!1),variant:"ghost",className:"h-10 w-10 p-0 hover:bg-surface-hover",children:l.jsx(re,{className:"size-6"})})}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(rj,{description:o("com_ui_download"),render:l.jsx(c_,{onClick:()=>a(),variant:"ghost",className:"h-10 w-10 p-0",children:l.jsx(xt,{className:"size-6"})})}),l.jsx(rj,{description:o(i?"com_ui_hide_image_details":"com_ui_show_image_details"),render:l.jsx(c_,{onClick:()=>c(!i),variant:"ghost",className:"h-10 w-10 p-0",children:i?l.jsx(ft,{className:"size-6"}):l.jsx(gt,{className:"size-6"})})})]})]}),l.jsx("div",{className:"flex h-full transition-all duration-500 ease-in-out "+(i?"mr-80":"mr-0"),children:l.jsx("div",{className:"flex flex-1 items-center justify-center px-4 pb-4 pt-20",children:l.jsx("img",{src:s,alt:"Image",className:"max-h-full max-w-full object-contain",style:{maxHeight:"calc(100vh - 6rem)",maxWidth:"100%"}})})}),l.jsx("div",{className:"shadow-l-lg fixed right-0 top-0 z-20 h-full w-80 transform rounded-l-2xl border-l border-border-light bg-surface-primary transition-transform duration-500 ease-in-out "+(i?"translate-x-0":"translate-x-full"),children:l.jsxs("div",{className:"h-full overflow-y-auto p-6",children:[l.jsxs("div",{className:"mb-4",children:[l.jsx("h3",{className:"mb-2 text-lg font-semibold text-text-primary",children:o("com_ui_image_details")}),l.jsx("div",{className:"mb-4 h-px bg-border-medium"})]}),l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("h4",{className:"mb-2 text-sm font-medium text-text-primary",children:o("com_ui_prompt")}),l.jsx("div",{className:"rounded-md bg-surface-tertiary p-3",children:l.jsx("p",{className:"text-sm leading-relaxed text-text-primary",children:(null==r?void 0:r.prompt)||"No prompt available"})})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"mb-3 text-sm font-medium text-text-primary",children:o("com_ui_generation_settings")}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("span",{className:"text-sm text-text-primary",children:[o("com_ui_size"),":"]}),l.jsx("span",{className:"text-sm font-medium text-text-primary",children:(null==r?void 0:r.size)||"Unknown"})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("span",{className:"text-sm text-text-primary",children:[o("com_ui_quality"),":"]}),l.jsx("span",{className:"rounded px-2 py-1 text-xs font-medium capitalize "+("high"===(null==r?void 0:r.quality)?"bg-gray-100 text-gray-800":"low"===(null==r?void 0:r.quality)?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"),children:(null==r?void 0:r.quality)||"Standard"})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("span",{className:"text-sm text-text-primary",children:[o("com_ui_file_size"),":"]}),l.jsx("span",{className:"text-sm font-medium text-text-primary",children:d||"Loading..."})]})]})]})]})]})})]})})}const SN=({imagePath:e,altText:t,height:s,width:a,placeholderDimensions:r,className:o,args:i})=>{const[c,d]=n.useState(!1),[u,m]=n.useState(!1),p=n.useRef(null),{width:h,height:x}=n.useMemo(()=>{var e,t;return Fp({originalWidth:Number((null==(e=null==r?void 0:r.width)?void 0:e.split("px")[0])??a),originalHeight:Number((null==(t=null==r?void 0:r.height)?void 0:t.split("px")[0])??s),containerRef:p})},[r,s,a]);return l.jsx("div",{ref:p,children:l.jsxs("div",{className:Op("relative mt-1 flex h-auto w-full max-w-lg items-center justify-center overflow-hidden rounded-lg border border-border-light text-text-secondary-alt shadow-md",o),children:[l.jsx("button",{type:"button","aria-label":`View ${t} in dialog`,onClick:()=>d(!0),className:"cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:l.jsx(vt.LazyLoadImage,{alt:t,onLoad:()=>m(!0),visibleByDefault:!0,className:Op("opacity-100 transition-opacity duration-100",u?"opacity-100":"opacity-0"),src:e,style:{width:`${h}`,height:"auto",color:"transparent",display:"block"},placeholder:l.jsx(q_,{className:Op("h-auto w-full",`h-[${x}] w-[${h}]`),"aria-label":"Loading image","aria-busy":"true"})})}),u&&l.jsx(kN,{isOpen:c,onOpenChange:d,src:e,downloadImage:async()=>{try{const n=await fetch(e);if(!n.ok)throw new Error(`Failed to fetch image: ${n.status}`);const s=await n.blob(),a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=t||"image.png",document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a)}catch(n){console.error("Download failed:",n);const s=document.createElement("a");s.href=e,s.download=t||"image.png",document.body.appendChild(s),s.click(),document.body.removeChild(s)}},args:i})]})})},TN=({href:e,filename:t})=>{const{showToast:n}=Of(),{refetch:s}=Ex(e);return{handleDownload:async e=>{e.preventDefault();try{const e=await s();if(null==e.data||""===e.data)return console.error("Error downloading file: No data found"),void n({status:"error",message:"Error downloading file"});const a=document.createElement("a");a.href=e.data,a.setAttribute("download",t),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(e.data)}catch(a){console.error("Error downloading file:",a)}}}},RN=({href:e,filename:t,children:n})=>{const{handleDownload:s}=TN({href:e,filename:t});return l.jsx("a",{href:e,onClick:s,target:"_blank",rel:"noopener noreferrer",className:"!text-blue-400 visited:!text-purple-400 hover:underline",children:n})},IN=n.memo(({attachment:e})=>{var t;const[s,a]=n.useState(!1),{handleDownload:r}=TN({href:e.filepath??"",filename:e.filename??""}),o=null==(t=e.filename)?void 0:t.split(".").pop();return n.useEffect(()=>{const e=setTimeout(()=>a(!0),50);return()=>clearTimeout(e)},[]),e.filepath?l.jsx("div",{className:Op("file-attachment-container","transition-all duration-300 ease-out",s?"translate-y-0 opacity-100":"translate-y-2 opacity-0"),style:{transformOrigin:"center top",willChange:"opacity, transform",WebkitFontSmoothing:"subpixel-antialiased"},children:l.jsx(CN,{file:e,onClick:r,overrideType:o,containerClassName:"max-w-fit",buttonClassName:"bg-surface-secondary hover:cursor-pointer hover:bg-surface-hover active:bg-surface-secondary focus:bg-surface-hover hover:border-border-heavy active:border-border-heavy"})}):null}),EN=n.memo(({attachment:e})=>{const[t,s]=n.useState(!1),{width:a,height:r,filepath:o=null}=e;return n.useEffect(()=>{s(!1);const e=setTimeout(()=>s(!0),100);return()=>clearTimeout(e)},[e]),l.jsx("div",{className:Op("image-attachment-container","transition-all duration-500 ease-out",t?"scale-100 opacity-100":"scale-[0.98] opacity-0"),style:{transformOrigin:"center top",willChange:"opacity, transform",WebkitFontSmoothing:"subpixel-antialiased"},children:l.jsx(SN,{altText:e.filename,imagePath:o??"",height:r??0,width:a??0,className:"mb-4"})})});function MN({attachments:e}){if(!e||0===e.length)return null;const t=[],n=[];return e.forEach(e=>{const{width:s,height:a,filepath:r=null}=e;gl.test(e.filename)&&null!=s&&null!=a&&null!=r?n.push(e):e.type!==ri.web_search&&t.push(e)}),l.jsxs(l.Fragment,{children:[t.length>0&&l.jsx("div",{className:"my-2 flex flex-wrap items-center gap-2.5",children:t.map((e,t)=>e.filepath?l.jsx(IN,{attachment:e},`file-${t}`):null)}),n.length>0&&l.jsx("div",{className:"mb-2 flex flex-wrap items-center",children:n.map((e,t)=>l.jsx(EN,{attachment:e},`image-${t}`))})]})}function PN({progress:e,error:t,toolName:n="image_gen_oai"}){const s=zf(),a=s(t?"com_ui_error":"image_edit_oai"===n?e>=1?"com_ui_image_edited":e>=.7?"com_ui_final_touch":e>=.5?"com_ui_adding_details":e>=.3?"com_ui_edit_editing_image":"com_ui_getting_started":e>=1?"com_ui_image_created":e>=.7?"com_ui_final_touch":e>=.5?"com_ui_adding_details":e>=.3?"com_ui_creating_image":"com_ui_getting_started");return l.jsx("div",{className:Op("progress-text-content pointer-events-none absolute left-0 top-0 inline-flex w-full items-center gap-2 overflow-visible whitespace-nowrap"),children:l.jsx("span",{className:"font-medium "+(e<1?"shimmer":""),children:a})})}function LN({initialProgress:e=.1,isSubmitting:t,toolName:s,args:a="",output:r,attachments:o}){var i,c;const[d,u]=n.useState(e),m=n.useRef(null),p="string"==typeof r&&r.toLowerCase().includes("error processing tool"),h=!t&&e<1||!0===p;let x,f,g,v="high";try{g="string"==typeof a?JSON.parse(a):a}catch(I){console.error("Error parsing args:",I),g={}}try{const e=g;if(e&&"string"==typeof e.size){const[t,n]=e.size.split("x").map(e=>parseInt(e,10));isNaN(t)||isNaN(n)||(x=t,f=n)}else!e||"string"==typeof e.size&&e.size||(x=void 0,f=void 0);if(e&&"string"==typeof e.quality){const t=e.quality.toLowerCase();"low"!==t&&"medium"!==t&&"high"!==t||(v=t)}}catch(E){x=void 0,f=void 0}const b=null==o?void 0:o[0],{width:y,height:_,filepath:j=null,filename:w=""}=b||{};let N=x??y,C=f??_;void 0!==N&&void 0!==C||(N=1024,C=1024);const[k,S]=n.useState({width:"auto",height:"auto"}),T=n.useRef(null),R=n.useCallback(()=>{if(N&&C&&T.current){const e=Fp({originalWidth:N,originalHeight:C,containerRef:T});S(e)}},[N,C]);return n.useEffect(()=>{if(t){u(e),m.current&&clearInterval(m.current);let t=2e4;"low"===v?t=1e4:"high"===v&&(t=5e4);const n=Math.floor(.3*t),s=200,a=(Math.floor(Math.random()*n)+t)/s;let r=0;m.current=setInterval(()=>{if(r++,r>=a)clearInterval(m.current),u(.9);else{const e=r/a;let t;if(e<.8)t=Math.pow(e,1.1);else{const n=(e-.8)/.2;t=.8+.2*(1-Math.pow(1-n,2))}u(.1+.8*t)}},s)}return()=>{m.current&&clearInterval(m.current)}},[e,v]),n.useEffect(()=>{(e>=1||h)&&(u(e),m.current&&clearInterval(m.current))},[e,h]),n.useEffect(()=>{R();const e=new ResizeObserver(()=>{R()});return T.current&&e.observe(T.current),()=>{e.disconnect()}},[R]),l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"relative my-2.5 flex size-5 shrink-0 items-center gap-2.5",children:l.jsx(PN,{progress:d,error:h,toolName:s})}),l.jsx("div",{className:"relative mb-2 flex w-full justify-start",children:l.jsxs("div",{ref:T,className:"w-full max-w-lg",children:["auto"!==k.width&&d<1&&l.jsx(Nj,{variant:"default",progress:d,randomness:.6,width:k.width,height:k.height}),l.jsx(SN,{altText:w,imagePath:j??"",width:Number(null==(i=k.width)?void 0:i.split("px")[0]),height:Number(null==(c=k.height)?void 0:c.split("px")[0]),placeholderDimensions:{width:k.width,height:k.height},args:g})]})})]})}const AN=n.memo(({content:e="",codeExecution:t=!0})=>{const n=[[ao],[ro,{detect:!0,ignoreMissing:!0,subset:hp}]];return l.jsx(iv,{children:l.jsx(cv,{children:l.jsx(so,{remarkPlugins:[oo,io,[lo,{singleDollarTextMath:!1}]],rehypePlugins:n,components:{code:t?xC:fC,a:gC,p:vC},children:e})})})}),ON=n.memo(({text:e,isCreatedByUser:t,showCursor:s})=>{const{messageId:a}=ev(),{isSubmitting:r,latestMessage:o}=rg(),i=_(sx.enableUserMsgMarkdown),c=n.useMemo(()=>s&&r,[s,r]),d=n.useMemo(()=>a===(null==o?void 0:o.messageId),[a,null==o?void 0:o.messageId]),u=n.useMemo(()=>t?i?l.jsx(AN,{content:e}):l.jsx(l.Fragment,{children:e}):l.jsx(bC,{content:e,isLatestMessage:d}),[t,i,e,d]);return l.jsx("div",{className:Op(r?"submitting":"",c&&e.length?"result-streaming":"","markdown prose message-content dark:prose-invert light w-full break-words",t&&!i&&"whitespace-pre-wrap",t?"dark:text-gray-20":"dark:text-gray-100"),children:u})}),DN="group mt-3 flex w-fit items-center justify-center rounded-xl bg-surface-tertiary px-3 py-2 text-xs leading-[18px] animate-thinking-appear",zN="icon-sm ml-1.5 transform-gpu text-text-primary transition-transform duration-200",FN="relative pl-3 text-text-secondary",VN="absolute left-0 h-[calc(100%-10px)] border-l-2 border-border-medium dark:border-border-heavy",$N="absolute left-0 h-[calc(100%)] border-l-2 border-border-medium dark:border-border-heavy",BN="whitespace-pre-wrap leading-[26px]",UN=n.memo(({isPart:e,children:t})=>l.jsxs("div",{className:FN,children:[l.jsx("div",{className:!0===e?$N:VN}),l.jsx("p",{className:BN,children:t})]})),HN=n.memo(({isExpanded:e,onClick:t,label:n})=>l.jsxs("button",{type:"button",onClick:t,className:DN,children:[l.jsx(bt,{size:14,className:"mr-1.5 text-text-secondary"}),n,l.jsx(at,{className:`${zN} ${e?"rotate-180":""}`})]})),KN=n.memo(({children:e})=>{const t=zf(),s=_(sx.showThinking),[a,r]=n.useState(s),o=n.useCallback(e=>{e.preventDefault(),r(e=>!e)},[]),i=n.useMemo(()=>t("com_ui_thoughts"),[t]);return null==e?null:l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"mb-5",children:l.jsx(HN,{isExpanded:a,onClick:o,label:i})}),l.jsx("div",{className:Op("grid transition-all duration-300 ease-out",a&&"mb-8"),style:{gridTemplateRows:a?"1fr":"0fr"},children:l.jsx("div",{className:"overflow-hidden",children:l.jsx(UN,{isPart:!0,children:e})})})]})});HN.displayName="ThinkingButton",UN.displayName="ThinkingContent",KN.displayName="Thinking";const GN=n.memo(KN),WN=n.memo(({reasoning:e})=>{const{isExpanded:t,nextType:s}=ev(),a=n.useMemo(()=>e.replace(/^<think>\s*/,"").replace(/\s*<\/think>$/,"").trim(),[e]);return a?l.jsx("div",{className:Op("grid transition-all duration-300 ease-out",s!==td.THINK&&t&&"mb-8"),style:{gridTemplateRows:t?"1fr":"0fr"},children:l.jsx("div",{className:"overflow-hidden",children:l.jsx(UN,{isPart:!0,children:a})})}):null}),qN=n.memo(()=>l.jsx("div",{className:"text-message mb-[0.625rem] flex min-h-[20px] flex-col items-start gap-3 overflow-visible",children:l.jsx("div",{className:"markdown prose dark:prose-invert light w-full break-words dark:text-gray-100",children:l.jsx("div",{className:"absolute",children:l.jsx("p",{className:"submitting relative",children:l.jsx("span",{className:"result-thinking"})})})})})),QN=({output:e="",renderImages:t,attachments:s})=>{const a=zf(),r=n.useMemo(()=>{if(!e)return"";return e.split("Generated files:")[0].trim()},[e]),{imageAttachments:o,nonImageAttachments:i}=n.useMemo(()=>{const e=[],n=[];return null==s||s.forEach(t=>{const{width:s,height:a,filepath:r=null}=t;gl.test(t.filename)&&null!=s&&null!=a&&null!=r?e.push(t):n.push(t)}),{imageAttachments:!0===t?e:null,nonImageAttachments:n}},[s,t]),c=e=>{const t=new Date,n="number"==typeof e.expiresAt?new Date(e.expiresAt):null;return!!n&&wr(t,n)?`${e.filename} ${a("com_download_expired")}`:l.jsxs(RN,{href:e.filepath,filename:e.filename,children:["- ",e.filename," ",a("com_click_to_download")]})};return l.jsxs(l.Fragment,{children:[r&&l.jsx("div",{children:r}),i.length>0&&l.jsxs("div",{children:[l.jsx("p",{children:a("com_generated_files")}),i.map((e,t)=>l.jsxs(m.Fragment,{children:[c(e),t<i.length-1&&", "]},e.filepath))]}),null==o?void 0:o.map((e,t)=>{const{width:n,height:s,filepath:a}=e;return l.jsx(SN,{altText:e.filename,imagePath:a,height:s,width:n},t)})]})};function ZN(){return l.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full bg-transparent text-text-secondary",children:l.jsx(re,{className:"size-4"})})}function JN(){return l.jsx("div",{className:"flex size-4 items-center justify-center rounded-full bg-brand-purple text-white","data-projection-id":"162",children:l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 8 8",fill:"none",width:"8",height:"8",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.66607 0.376042C8.01072 0.605806 8.10385 1.07146 7.87408 1.4161L3.54075 7.9161C3.40573 8.11863 3.18083 8.24304 2.93752 8.24979C2.69421 8.25654 2.46275 8.1448 2.31671 7.95008L0.150044 5.06119C-0.098484 4.72982 -0.0313267 4.25972 0.300044 4.01119C0.631415 3.76266 1.10152 3.82982 1.35004 4.16119L2.88068 6.20204L6.62601 0.584055C6.85577 0.239408 7.32142 0.146278 7.66607 0.376042Z",fill:"currentColor"})})})}const YN="progress-text-wrapper text-token-text-secondary relative -mt-[0.75px] h-5 w-full leading-5",XN=({popover:e,children:t})=>e?l.jsx("div",{className:YN,children:l.jsx(ca,{asChild:!0,children:l.jsx("div",{className:"progress-text-content absolute left-0 top-0 overflow-visible whitespace-nowrap",style:{opacity:1,transform:"none"},"data-projection-id":"78",children:t})})}):l.jsx("div",{className:YN,children:l.jsx("div",{className:"progress-text-content absolute left-0 top-0 overflow-visible whitespace-nowrap",style:{opacity:1,transform:"none"},"data-projection-id":"78",children:t})});function eC({progress:e,onClick:t,inProgressText:n,finishedText:s,authText:a,hasInput:r=!0,popover:o=!1,isExpanded:i=!1,error:c=!1}){const d=c?s:e<1?a??n:s,u=c?l.jsx(ZN,{}):e<1?l.jsx(Gb,{}):l.jsx(JN,{}),m=e<1&&!c;return l.jsx(XN,{popover:o,children:l.jsxs("button",{type:"button",className:Op("inline-flex w-full items-center gap-2",r?"":"pointer-events-none"),disabled:!r,onClick:r?t:void 0,children:[u,l.jsx("span",{className:m?"shimmer":"",children:d}),r&&(i?l.jsx(yt,{className:"size-4 shrink-0 translate-y-[1px]"}):l.jsx(at,{className:"size-4 shrink-0 translate-y-[1px]"}))]})})}const tC=({output:e=""})=>{const t=n.useMemo(()=>{if(!e)return"";return e.split("Generated files:")[0].trim()},[e]);return t&&l.jsx("pre",{className:"shrink-0",children:l.jsx("div",{className:"text-text-primary",children:t})})};function nC({initialProgress:e=.1,args:t,output:s="",attachments:a}){const r=zf(),o=_(sx.showCode),[i,c]=n.useState(o),d=n.useRef(null),[u,m]=n.useState(0),[p,h]=n.useState(!1),x=s.length>0,f=n.useRef(s),g=n.useRef(i),{lang:v,code:b}=function(e){return n.useMemo(()=>{let t=e;try{t=JSON.parse(e)}catch{}if("object"==typeof t)return t;const n=e.match(/"lang"\s*:\s*"(\w+)"/),s=e.match(/"code"\s*:\s*"(.+?)(?="\s*,\s*"(session_id|args)"|"\s*})/s);let a="";return s&&(a=s[1],a.endsWith('"}')&&(a=a.slice(0,-2)),a=a.replace(/\\n/g,"\n").replace(/\\"/g,'"').replace(/\\\\/g,"\\")),{lang:n?n[1]:"",code:a}},[e])}(t),y=ab(e);return n.useEffect(()=>{s!==f.current&&(f.current=s,i&&d.current&&setTimeout(()=>{if(d.current){const e=d.current.scrollHeight;m(e)}},10))},[s,i]),n.useEffect(()=>{if(i!==g.current)if(g.current=i,i&&d.current)h(!0),requestAnimationFrame(()=>{if(d.current){const e=d.current.scrollHeight;m(e)}const e=setTimeout(()=>{h(!1)},500);return()=>clearTimeout(e)});else if(!i){h(!0),m(0);const e=setTimeout(()=>{h(!1)},500);return()=>clearTimeout(e)}},[i]),n.useEffect(()=>{if(!d.current)return;const e=new ResizeObserver(e=>{if(i&&!p)for(const t of e)t.target===d.current&&m(t.contentRect.height)});return e.observe(d.current),()=>{e.disconnect()}},[i,p]),l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"relative my-2.5 flex size-5 shrink-0 items-center gap-2.5",children:l.jsx(eC,{progress:y,onClick:()=>c(e=>!e),inProgressText:r("com_ui_analyzing"),finishedText:r("com_ui_analyzing_finished"),hasInput:!!b.length,isExpanded:i})}),l.jsx("div",{className:"relative mb-2",style:{height:i?u:0,overflow:"hidden",transition:"height 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)",opacity:i?1:0,transformOrigin:"top",willChange:"height, opacity",perspective:"1000px",backfaceVisibility:"hidden",WebkitFontSmoothing:"subpixel-antialiased"},children:l.jsxs("div",{className:Op("code-analyze-block mt-0.5 overflow-hidden rounded-xl bg-surface-primary",i&&"shadow-lg"),ref:d,style:{transform:i?"translateY(0) scale(1)":"translateY(-8px) scale(0.98)",opacity:i?1:0,transition:"transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)"},children:[i&&l.jsx("div",{style:{transform:i?"translateY(0)":"translateY(-4px)",opacity:i?1:0,transition:"transform 0.35s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.35s cubic-bezier(0.16, 1, 0.3, 1)"},children:l.jsx(AN,{content:b?`\`\`\`${v}\n${b}\n\`\`\``:"",codeExecution:!1})}),x&&l.jsx("div",{className:Op("bg-surface-tertiary p-4 text-xs",i?"border-t border-surface-primary-contrast":""),style:{transform:i?"translateY(0)":"translateY(-6px)",opacity:i?1:0,transition:"transform 0.45s cubic-bezier(0.16, 1, 0.3, 1) 0.05s, opacity 0.45s cubic-bezier(0.19, 1, 0.22, 1) 0.05s",boxShadow:i?"0 -1px 0 rgba(0,0,0,0.05)":"none"},children:l.jsx("div",{className:"prose flex flex-col-reverse",children:l.jsx(tC,{output:s})})})]})}),a&&a.length>0&&l.jsx(MN,{attachments:a})]})}function sC(e){var t,s;const{message:a,conversation:r,assistant:o,agent:i}=e,c=n.useMemo(()=>({...r??{},...{...a,iconURL:(null==a?void 0:a.iconURL)??""}}),[r,a]),d=c.iconURL??"";let u=c.endpoint;u=wp({endpointsConfig:void 0,iconURL:d,endpoint:u});const m=(o?o.name:"")??"",p=(o?null==(t=o.metadata)?void 0:t.avatar:"")??"",h=(i?i.name:"")??"",x=(i?null==(s=null==i?void 0:i.avatar)?void 0:s.filepath:"")??"",f=n.useMemo(()=>{let e="";return o?e=p:i&&(e=x),e},[o,i,p,x]);return console.log("MessageIcon",{endpoint:u,iconURL:d,assistantName:m,assistantAvatar:p,agentName:h,agentAvatar:x}),!0!==(null==a?void 0:a.isCreatedByUser)&&d&&d.includes("http")?l.jsx(Ww,{iconURL:d,modelLabel:c.chatGptLabel??c.modelLabel??"",context:"message",assistantAvatar:p,assistantName:m,agentAvatar:x,agentName:h}):!0===(null==a?void 0:a.isCreatedByUser)?l.jsx("div",{style:{backgroundColor:"rgb(121, 137, 255)",width:"20px",height:"20px",boxShadow:"rgba(240, 246, 252, 0.1) 0px 0px 0px 1px"},className:"relative flex h-9 w-9 items-center justify-center rounded-sm p-1 text-white",children:l.jsx(Ny,{})}):l.jsx(Fw,{...c,endpoint:u,iconURL:f,model:(null==a?void 0:a.model)??(null==r?void 0:r.model),assistantName:m,agentName:h,size:28.8})}const aC=({currentAgentId:e})=>{const t=zf(),s=cg()||{},a=n.useMemo(()=>s[e],[s,e]);return e?l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"absolute -left-6 flex h-full w-4 items-center justify-center",children:l.jsxs("div",{className:"relative h-full w-4",children:[l.jsx("div",{className:"absolute left-0 top-0 h-1/2 w-px border border-border-medium"}),l.jsx("div",{className:"absolute left-0 top-1/2 h-px w-3 border border-border-medium"})]})}),l.jsxs("div",{className:"my-4 flex items-center gap-2",children:[l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:l.jsx(sC,{message:{endpoint:vi.agents,isCreatedByUser:!1},agent:a})}),l.jsx("div",{className:"text-base font-medium text-text-primary",children:(null==a?void 0:a.name)||t("com_ui_agent")})]})]}):null},rC=n.memo(({message:e})=>{const t=n.useMemo(()=>{var t;return(null==(t=null==e?void 0:e.files)?void 0:t.filter(e=>{var t;return null==(t=e.type)?void 0:t.startsWith("image/")}))||[]},[null==e?void 0:e.files]),s=n.useMemo(()=>{var t;return(null==(t=null==e?void 0:e.files)?void 0:t.filter(e=>{var t;return!(!0===(null==(t=e.type)?void 0:t.startsWith("image/")))}))||[]},[null==e?void 0:e.files]);return l.jsxs(l.Fragment,{children:[s.length>0&&s.map(e=>l.jsx(CN,{file:e},e.file_id)),t.length>0&&t.map(e=>l.jsx(SN,{imagePath:e.preview??e.filepath??"",height:e.height??1920,width:e.width??1080,altText:e.filename??"Uploaded Image",placeholderDimensions:{height:`${e.height??1920}px`,width:`${e.height??1080}px`}},e.file_id))]})}),oC=({children:e,message:t})=>l.jsxs("div",{className:"text-message flex min-h-[20px] flex-col items-start gap-3 overflow-visible [.text-message+&]:mt-5",dir:"auto",children:[!0===(null==t?void 0:t.isCreatedByUser)&&l.jsx(rC,{message:t}),e]}),iC=({text:e,index:t,messageId:s,isSubmitting:a,enterEdit:r})=>{const o=zf(),{addedIndex:i}=Kg(),{getMessages:c,setMessages:d,conversation:u}=rg(),[m,p]=b(sx.latestMessageFamily(i)),{conversationId:h=""}=u??{},x=n.useMemo(()=>{var e;return null==(e=c())?void 0:e.find(e=>e.messageId===s)},[c,s]),f=n.useRef(null),g=Kf(h??""),v="rtl"===_(sx.chatDirection).toLowerCase(),{register:y,handleSubmit:j,setValue:w}=Rr({defaultValues:{text:e??""}});n.useEffect(()=>{const e=f.current;if(e){const t=e.value.length;e.focus(),e.setSelectionRange(t,t)}},[]);const N=n.useCallback(e=>{"Escape"===e.key&&(e.preventDefault(),r(!0))},[r]),{ref:C,...k}=y("text",{required:!0,onChange:e=>{w("text",e.target.value,{shouldValidate:!0})}});return l.jsxs(oC,{message:x,children:[l.jsx("div",{className:"bg-token-main-surface-primary relative flex w-full flex-grow flex-col overflow-hidden rounded-2xl border border-border-medium text-text-primary [&:has(textarea:focus)]:border-border-heavy [&:has(textarea:focus)]:shadow-[0_2px_6px_rgba(0,0,0,.05)]",children:l.jsx(aj,{...k,ref:e=>{C(e),f.current=e},onKeyDown:N,"data-testid":"message-text-editor",className:Op("markdown prose dark:prose-invert light whitespace-pre-wrap break-words pl-3 md:pl-4","m-0 w-full resize-none border-0 bg-transparent py-[10px]","placeholder-text-secondary focus:ring-0 focus-visible:ring-0 md:py-3.5",v?"text-right":"text-left","max-h-[65vh] pr-3 md:max-h-[75vh] md:pr-4",Gp),dir:v?"rtl":"ltr"})}),l.jsxs("div",{className:"mt-2 flex w-full justify-center text-center",children:[l.jsx("button",{className:"btn btn-secondary relative mr-2",disabled:a,onClick:j(e=>{var n;const a=c();if(!a)return;g.mutate({index:t,conversationId:h??"",text:e.text,messageId:s}),s===(null==m?void 0:m.messageId)&&p({...m,text:e.text});if(!a.some(e=>e.messageId===s))return r(!0);const o=null==(n=null==x?void 0:x.content)?void 0:n.map((n,s)=>n.type===td.TEXT&&s===t?{...n,text:e.text}:n);d(a.map(e=>e.messageId===s?{...e,content:o}:e)),r(!0)}),children:o("com_ui_save")}),l.jsx("button",{className:"btn btn-neutral relative",onClick:()=>r(!0),children:o("com_ui_cancel")})]})]})};function lC({isOpen:e,onSubmit:t,onRevoke:n,onOpenChange:s,isUserProvided:a,isToolAuthenticated:r,register:o,handleSubmit:i,triggerRef:c,triggerRefs:d}){const u=zf();return l.jsx(A_,{open:e,onOpenChange:s,triggerRef:c,triggerRefs:d,children:l.jsx(Oj,{className:"w-11/12 sm:w-[450px]",title:"",main:l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"mb-4 text-center font-medium",children:u("com_ui_hanzo_code_api_title")}),l.jsx("div",{className:"mb-4 text-center text-sm",children:u("com_ui_hanzo_code_api_subtitle")}),l.jsxs("div",{className:"mb-6",children:[l.jsx("div",{className:"mx-auto mb-4 flex max-w-[400px] flex-wrap justify-center gap-3",children:["python.svg","nodedotjs.svg","tsnode.svg","rust.svg","go.svg","c.svg","cplusplus.svg","php.svg","fortran.svg","r.svg"].map(e=>l.jsx("div",{className:"h-6 w-6",children:l.jsx("img",{src:`/assets/${e}`,alt:"",className:"h-full w-full object-contain opacity-[0.85] dark:invert"})},e))}),l.jsx("a",{href:"https://code.hanzo.ai/pricing",target:"_blank",rel:"noopener noreferrer",className:"block text-center text-[15px] font-medium text-blue-500 underline decoration-1 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300",children:u("com_ui_hanzo_code_api_key")})]}),l.jsx("form",{onSubmit:i(t),children:l.jsx(M_,{type:"password",placeholder:u("com_ui_enter_api_key"),autoComplete:"one-time-code",readOnly:!0,onFocus:e=>e.target.readOnly=!1,...o("apiKey",{required:!0})})})]}),selection:{selectHandler:i(t),selectClasses:"bg-white hover:bg-gray-100 text-black dark:bg-gray-800 dark:hover:bg-gray-700 dark:text-white border border-gray-300 dark:border-gray-600",selectText:u("com_ui_save")},buttons:a&&r&&l.jsx(c_,{onClick:n,className:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",children:u("com_ui_revoke")}),showCancelButton:!0})})}const cC=m.memo(({lang:e,codeRef:t,blockIndex:s})=>{const a=zf(),{showToast:r}=Of(),o=Gx(ri.execute_code,{onError:()=>{r({message:a("com_ui_run_code_error"),status:"error"})}}),{messageId:i,conversationId:c,partIndex:d}=ev(),u=n.useMemo(()=>function(e){const t=e.toLowerCase().trim(),n=xp[t];return n||""}(e),[e]),{data:m}=Hx({toolId:ri.execute_code},{retry:1}),p=n.useMemo(()=>(null==m?void 0:m.message)??!1,[null==m?void 0:m.message]),h=n.useMemo(()=>(null==m?void 0:m.authenticated)??!1,[null==m?void 0:m.authenticated]),{methods:x,onSubmit:f,isDialogOpen:g,setIsDialogOpen:v,handleRevokeApiKey:b}=_b({}),y=n.useCallback(async()=>{var e;if(!h)return void v(!0);const n=(null==(e=t.current)?void 0:e.textContent)??"";"string"==typeof n&&0!==n.length&&"string"==typeof u&&0!==u.length&&o.mutate({partIndex:d,messageId:i,blockIndex:s,conversationId:c??"",lang:u,code:n})},[t,o,d,i,s,c,u,v,h]),_=n.useMemo(()=>Cr(y,1e3,{leading:!0}),[y]);return n.useEffect(()=>()=>{_.cancel()},[_]),"string"!=typeof u||0===u.length?null:l.jsxs(l.Fragment,{children:[l.jsxs("button",{type:"button",className:Op("ml-auto flex gap-2"),onClick:_,disabled:o.isLoading,children:[o.isLoading?l.jsx(Gb,{className:"animate-spin",size:18}):l.jsx(V,{size:18}),a("com_ui_run_code")]}),l.jsx(lC,{onSubmit:f,isOpen:g,register:x.register,onRevoke:b,onOpenChange:v,handleSubmit:x.handleSubmit,isToolAuthenticated:h,isUserProvided:p===fi.USER_PROVIDED})]})}),dC=m.memo(({lang:e,error:t,codeRef:s,blockIndex:a,plugin:r=null,allowExecution:o=!0})=>{const i=zf(),[c,d]=n.useState(!1);return l.jsxs("div",{className:"relative flex items-center justify-between rounded-tl-md rounded-tr-md bg-gray-700 px-4 py-2 font-sans text-xs text-gray-200 dark:bg-gray-700",children:[l.jsx("span",{className:"",children:e}),!0===r?l.jsx(_t,{className:"ml-auto flex h-4 w-4 gap-2 text-white/50"}):l.jsxs("div",{className:"flex items-center justify-center gap-4",children:[!0===o&&l.jsx(cC,{lang:e,codeRef:s,blockIndex:a}),l.jsx("button",{type:"button",className:Op("ml-auto flex gap-2",!0===t?"h-4 w-4 items-start text-white/50":""),onClick:async()=>{var e;const t=null==(e=s.current)?void 0:e.textContent;null!=t&&(d(!0),D(t.trim(),{format:"text/plain"}),setTimeout(()=>{d(!1)},3e3))},children:c?l.jsxs(l.Fragment,{children:[l.jsx(qb,{className:"h-[18px] w-[18px]"}),!0===t?"":i("com_ui_copied")]}):l.jsxs(l.Fragment,{children:[l.jsx(Wb,{}),!0===t?"":i("com_ui_copy_code")]})})]})]})}),uC=({lang:e,blockIndex:t,codeChildren:s,classProp:a="",allowExecution:r=!0,plugin:o=null,error:i})=>{const c=n.useRef(null),d=n.useContext(dv),{messageId:u,partIndex:m}=ev(),p=r?`${u}_${m??0}_${t??0}_${ri.execute_code}`:"",[h,x]=n.useState(0),f=null==d?void 0:d[p],[g,v]=n.useState((null==d?void 0:d[p])??null);n.useEffect(()=>{f&&(v(f),x(f.length-1))},[f]);const b=n.useMemo(()=>null==g?void 0:g[h],[g,h]),y=!(!0!==o&&!0!==i),_=y?"json":e;return l.jsxs("div",{className:"w-full rounded-md bg-gray-900 text-xs text-white/80",children:[l.jsx(dC,{lang:e,error:i,codeRef:c,blockIndex:t,plugin:!0===o,allowExecution:r}),l.jsx("div",{className:Op(a,"overflow-y-auto p-4"),children:l.jsx("code",{ref:c,className:Op(y?"!whitespace-pre-wrap":`hljs language-${_} !whitespace-pre`),children:s})}),!0===r&&g&&g.length>0&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"bg-gray-700 p-4 text-xs",children:l.jsx("div",{className:"prose flex flex-col-reverse text-white",style:{color:"white"},children:l.jsx("pre",{className:"shrink-0",children:l.jsx(QN,{output:(null==b?void 0:b.result)??"",attachments:(null==b?void 0:b.attachments)??[],renderImages:!0})})})}),g.length>1&&l.jsx(wN,{currentIndex:h,totalCount:g.length,onPrevious:()=>{h>0&&x(h-1)},onNext:()=>{g&&h<g.length-1&&x(h+1)}})]})]})};function mC(e,t){const n=e.substring(0,t),s=n.lastIndexOf("\\ue200"),a=n.lastIndexOf("\\ue201");return-1===s||-1!==a&&a>s}function pC(e,t){ob.lastIndex=t,ib.lastIndex=t,lb.lastIndex=t;const n=ob.exec(e),s=ib.exec(e);let a,r=null;for(lb.lastIndex=t;!r&&null!==(a=lb.exec(e));)mC(e,a.index)&&(r=a);let o=null,i="",l=-1,c=-1;return n&&(!o||n.index<l||-1===l)&&(o=n,i="span",l=n.index,c=0),s&&(!o||s.index<l||-1===l)&&(o=s,i="composite",l=s.index,c=0),r&&(!o||r.index<l||-1===l)&&(o=r,i="standalone",l=r.index,c=0),o?{type:i,match:o,index:c}:null}function hC(){return e=>{!function(e){ht(e,"text",(e,t,n)=>{var s;const a=e,r=n;if("string"!=typeof a.value)return;const o=a.value,i=[];let l=0;const c=new Map,d={span:0,composite:0,standalone:0};for(;l<o.length;){const e=pC(o,l);if(!e){const e=o.substring(l).replace(cb,"");e&&i.push({type:"text",value:e});break}const{type:t,match:n}=e,s=n.index,a=n[0];if(s>l){const e=o.substring(l,s).replace(cb,"");e&&i.push({type:"text",value:e})}const r=`${t}-${d[t]}-${s}`;switch(c.set(s,r),t){case"span":{const e=a.replace(/\\ue203|\\ue204/g,"");let t=null;const n=s+a.length,r=pC(o,n);if(r&&("standalone"===r.type||"composite"===r.type)&&r.match.index-n<5){const e=r.match.index,n=r.type;t=`${n}-${d[n]}-${e}`}i.push({type:"highlighted-text",data:{hName:"highlighted-text",hProperties:{citationId:t}},children:[{type:"text",value:e}]}),d.span++;break}case"composite":{const e=a,t=new RegExp(lb.source,"g");let n;const s=[];for(;null!==(n=t.exec(e));){const e=Number(n[1]),t=n[2],a=Number(n[3]);s.push({turn:e,refType:t,index:a})}s.length>0&&i.push({type:"composite-citation",data:{hName:"composite-citation",hProperties:{citations:s,citationId:r}}}),d.composite++;break}case"standalone":{const e=Number(n[1]),t=n[2],s=Number(n[3]);i.push({type:"citation",data:{hName:"citation",hProperties:{citation:{turn:e,refType:t,index:s},citationType:"standalone",citationId:r}}}),d.standalone++;break}}l=s+a.length}if(i.length>0&&void 0!==t)return null==(s=r.children)||s.splice(t,1,...i),t+i.length;a.value!==a.value.replace(cb,"")&&(a.value=a.value.replace(cb,""))})}(e)}}const xC=n.memo(({className:e,children:t})=>{const s=Zv({permissionType:bd.RUN_CODE,permission:yd.USE}),a=/language-(\w+)/.exec(e??""),r=a&&a[1],o="math"===r,i="string"==typeof t&&1===t.split("\n").length,{getNextIndex:c,resetCounter:d}=n.useContext(lv),u=n.useRef(c(o||i)).current;return n.useEffect(()=>{d()},[t,d]),o?l.jsx(l.Fragment,{children:t}):i?l.jsx("code",{onDoubleClick:Qp,className:e,children:t}):l.jsx(uC,{lang:r??"text",codeChildren:t,blockIndex:u,allowExecution:s})}),fC=n.memo(({className:e,children:t})=>{const n=/language-(\w+)/.exec(e??""),s=n&&n[1];return"math"===s?t:"string"==typeof t&&1===t.split("\n").length?l.jsx("code",{onDoubleClick:Qp,className:e,children:t}):l.jsx(uC,{lang:s??"text",codeChildren:t,allowExecution:!1})}),gC=n.memo(({href:e,children:t})=>{const s=_(sx.user),{showToast:a}=Of(),r=zf(),{file_id:o="",filename:i="",filepath:c}=n.useMemo(()=>{const t=new RegExp(`(?:files|outputs)/${null==s?void 0:s.id}/([^\\s]+)`),n=e.match(t);if(n&&n[0]){const e=n[0],t=e.split("/"),s=t.pop();return{file_id:t.pop(),filename:s,filepath:e}}return{file_id:"",filename:"",filepath:""}},[null==s?void 0:s.id,e]),{refetch:d}=Ix((null==s?void 0:s.id)??"",o),u={target:"_new"};if(!o||!i)return l.jsx("a",{href:e,...u,children:t});return u.onClick=async e=>{e.preventDefault();try{const e=await d();if(null==e.data||""===e.data)return console.error("Error downloading file: No data found"),void a({status:"error",message:r("com_ui_download_error")});const t=document.createElement("a");t.href=e.data,t.setAttribute("download",i),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(e.data)}catch(t){console.error("Error downloading file:",t)}},u.target="_blank",l.jsx("a",{href:(null==c?void 0:c.startsWith("files/"))?`/api/${c}`:`/api/files/${c}`,...u,children:t})}),vC=n.memo(({children:e})=>l.jsx("p",{className:"mb-2 whitespace-pre-wrap",children:e})),bC=n.memo(({content:e="",isLatestMessage:t})=>{const s=_(sx.LaTeXParsing),a=""===e,r=n.useMemo(()=>a?"":s?Bm(e):e,[e,s,a]),o=n.useMemo(()=>[[ao],[ro,{detect:!0,ignoreMissing:!0,subset:hp}]],[]),i=[oo,io,co,vN,[lo,{singleDollarTextMath:!1}],hC];return a?l.jsx("div",{className:"absolute",children:l.jsx("p",{className:"relative",children:l.jsx("span",{className:t?"result-thinking":""})})}):l.jsx(iv,{children:l.jsx(cv,{children:l.jsx(so,{remarkPlugins:i,rehypePlugins:o,components:{code:xC,a:gC,p:vC,artifact:jN,citation:Pw,"highlighted-text":Lw,"composite-citation":Mw},children:r})})})}),yC=/{{(.*?)}}/g,_C=({children:e})=>l.jsx("p",{children:m.Children.map(e,e=>(e=>"object"==typeof e&&null!==e||"string"!=typeof e?e:e.split(yC).map((e,t)=>t%2==1?l.jsx("b",{className:"ml-[0.5] rounded-lg bg-amber-100 p-[1px] font-medium text-yellow-800 dark:border-yellow-500/50 dark:bg-transparent dark:text-yellow-500/90",children:`{{${e}}}`},t):e))(e))}),jC=e=>{const t=e.trim();if(t.includes(":")){const[e,n]=t.split(":");if(n&&n.includes("|"))return{variable:e.trim(),type:"select",options:n.split("|").map(e=>e.trim())}}return{variable:t,type:"text"}};function wC({group:e,onClose:t}){var s;const a=zf(),{user:r}=Rg(),o=n.useMemo(()=>{var t;return pd({text:(null==(t=e.productionPrompt)?void 0:t.prompt)??"",user:r})},[null==(s=e.productionPrompt)?void 0:s.prompt,r]),{allVariables:i,uniqueVariables:c,variableIndexMap:d}=n.useMemo(()=>(e=>{const t=/{{(.*?)}}/g;let n;const s=[],a=[],r=new Set,o=new Map,i=new Map;for(;null!==(n=t.exec(e));){const e=n[1];s.push(e);const t=o.get(e)??0;o.set(e,t+1),t>0?r.add(e):(a.push(e),i.set(e,a.length-1))}return{allVariables:s,uniqueVariables:a,repeatedVariables:r,variableIndexMap:i}})(o),[o]),{submitPrompt:u}=Wv(),{control:m,handleSubmit:p}=Rr({defaultValues:{fields:c.map(e=>({variable:ip(e),value:"",config:jC(e)}))}}),{fields:h}=Er({control:m,name:"fields"}),x=Mr({control:m,name:"fields"});if(!c.length)return null;return l.jsx("div",{className:"mx-auto p-1 md:container",children:l.jsxs("form",{onSubmit:p(e=>{let n=o;e.fields.forEach(({variable:e,value:t})=>{if(!t)return;const s=e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"),a=new RegExp(s,"g");n=n.replace(a,t)}),u(n),t()}),className:"space-y-4",children:[l.jsx("div",{className:"mb-6 max-h-screen max-w-[90vw] overflow-auto rounded-md bg-surface-tertiary p-4 text-text-secondary dark:bg-surface-primary sm:max-w-full md:max-h-96",children:l.jsx(so,{remarkPlugins:[oo,io,[lo,{singleDollarTextMath:!1}]],rehypePlugins:[[ao],[ro,{ignoreMissing:!0}]],components:{code:fC,p:_C},className:"markdown prose dark:prose-invert light my-1 max-h-[50vh] max-w-full break-words dark:text-text-secondary",children:(()=>{let e=o;return i.forEach(t=>{const n=`{{${t}}}`,s=d.get(t),a=x[s].value;if(a===n||""===a||!a)return;const r=""!==a?`**${a}**`:n;e=e.replaceAll(n,r)}),e})()})}),l.jsx("div",{className:"space-y-4",children:h.map((e,t)=>l.jsx("div",{className:"flex flex-col space-y-2",children:l.jsx(Ir,{name:`fields.${t}.value`,control:m,render:({field:{onChange:n,onBlur:s,value:a,ref:r}})=>"select"===e.config.type?l.jsx(W_,{options:e.config.options||[],placeholder:e.config.variable,className:Op(Wp,"rounded px-3 py-2 focus:bg-surface-tertiary"),value:a,onChange:n,onBlur:s}):l.jsx(aj,{ref:r,value:a,onChange:n,onBlur:s,id:`fields.${t}.value`,className:Op(Wp,"rounded px-3 py-2 focus:bg-surface-tertiary"),placeholder:e.config.variable,maxRows:8})})},e.id))}),l.jsx("div",{className:"flex justify-end",children:l.jsx(c_,{type:"submit",variant:"submit",children:a("com_ui_submit")})})]})})}const NC=({open:e,onClose:t,group:s})=>{var a;const r=n.useMemo(()=>{var e;return op((null==(e=null==s?void 0:s.productionPrompt)?void 0:e.prompt)??"")},[null==(a=null==s?void 0:s.productionPrompt)?void 0:a.prompt]);return s&&r?l.jsx(A_,{open:e,onOpenChange:e=>{e||t()},children:l.jsxs(V_,{className:"max-h-[90vh] max-w-full overflow-y-auto bg-white dark:border-gray-700 dark:bg-gray-850 dark:text-gray-300 md:max-w-[60vw]",children:[l.jsx(U_,{children:s.name}),l.jsx(wC,{group:s,onClose:t})]})}):null},CC={code:({children:e})=>l.jsx("code",{onDoubleClick:Qp,className:"rounded-md bg-surface-primary-alt p-1 text-xs text-text-secondary md:text-sm",children:e})},kC=({promptText:e,showInfo:t=!0})=>{const s=zf(),a=n.useMemo(()=>(e=>{const t=/{{(.*?)}}/g;let n;const s=new Set;for(;null!==(n=t.exec(e));)s.add(n[1]);return Array.from(s)})(e||""),[e]);return l.jsxs("div",{className:"rounded-xl border border-border-light bg-transparent p-4 shadow-md",children:[l.jsxs("h3",{className:"flex items-center gap-2 py-2 text-lg font-semibold text-text-primary",children:[l.jsx(jt,{className:"icon-sm","aria-hidden":"true"}),s("com_ui_variables")]}),l.jsxs("div",{className:"flex flex-col space-y-4",children:[a.length?l.jsx("div",{className:"flex flex-wrap gap-2",children:a.map((e,t)=>l.jsx("span",{className:Op("rounded-full border border-border-light px-3 py-1 text-text-primary",null!=ed[e.toLowerCase()]?"bg-amber-100 text-yellow-800 border-yellow-600 dark:border-yellow-500/50 dark:bg-transparent dark:text-yellow-500/90":""),children:null!=ed[e.toLowerCase()]?e.toLowerCase():e},t))}):l.jsx("div",{className:"text-sm text-text-secondary",children:l.jsx(so,{components:CC,className:"markdown prose dark:prose-invert",children:s("com_ui_variables_info")})}),l.jsx(G_,{className:"my-3 text-text-primary"}),t&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("span",{className:"text-sm font-medium text-text-primary",children:s("com_ui_special_variables")}),l.jsx("span",{className:"text-sm text-text-secondary",children:l.jsx(so,{components:CC,className:"markdown prose dark:prose-invert",children:s("com_ui_special_variables_more_info")})})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-sm font-medium text-text-primary",children:s("com_ui_dropdown_variables")}),l.jsx("span",{className:"text-sm text-text-secondary",children:l.jsx(so,{components:CC,className:"markdown prose dark:prose-invert",children:s("com_ui_dropdown_variables_info")})})]})]})]})]})},SC=({initialValue:e,onValueChange:t,disabled:s,tabIndex:a})=>{const r=zf(),[o,i]=n.useState(e||""),[c,d]=n.useState((null==e?void 0:e.length)||0);n.useEffect(()=>{i(e||""),d((null==e?void 0:e.length)||0)},[e]),n.useEffect(()=>{d(o.length)},[o]);return s&&!o?null:l.jsx("div",{className:"rounded-xl border border-border-light shadow-md",children:l.jsxs("h3",{className:"flex h-10 items-center gap-1 pl-4 text-sm text-text-secondary",children:[l.jsx(_t,{className:"icon-sm","aria-hidden":"true"}),l.jsx(M_,{type:"text",tabIndex:a,disabled:s,placeholder:r("com_ui_description_placeholder"),value:o,onChange:e=>{e.target.value.length<=120&&(i(e.target.value),null==t||t(e.target.value))},className:"border-none"}),!s&&l.jsx("span",{className:"mr-4 w-10 text-xs text-text-secondary md:text-sm",children:`${c}/120`})]})})},TC=({initialValue:e,onValueChange:t,disabled:s,tabIndex:a})=>{const r=zf(),[o,i]=n.useState(e||""),[c,d]=n.useState((null==e?void 0:e.length)||0);n.useEffect(()=>{i(e||""),d((null==e?void 0:e.length)||0)},[e]),n.useEffect(()=>{d(o.length)},[o]);return!0!==s||o?l.jsx("div",{className:"rounded-xl border border-border-light shadow-md",children:l.jsxs("h3",{className:"flex h-10 items-center gap-1 pl-4 text-sm text-text-secondary",children:[l.jsx(wt,{className:"icon-sm","aria-hidden":"true"}),l.jsx(M_,{type:"text",tabIndex:a,disabled:s,placeholder:r("com_ui_command_placeholder"),value:o,onChange:e=>{let n=e.target.value.toLowerCase();n=n.replace(/\s/g,"-").replace(/[^a-z0-9-]/g,""),n.length<=Zc.COMMANDS_MAX_LENGTH&&(i(n),null==t||t(n))},className:"border-none"}),!0!==s&&l.jsx("span",{className:"mr-4 w-10 text-xs text-text-secondary md:text-sm",children:`${c}/${Zc.COMMANDS_MAX_LENGTH}`})]})}):null},RC=({group:e})=>{var t,s;const a=zf(),{user:r}=Rg(),o=n.useMemo(()=>{var t;return pd({text:(null==(t=null==e?void 0:e.productionPrompt)?void 0:t.prompt)??"",user:r})},[null==(t=null==e?void 0:e.productionPrompt)?void 0:t.prompt,r]);return e?l.jsxs("div",{children:[l.jsx("div",{className:"flex flex-col items-center justify-between p-4 text-text-primary sm:flex-row",children:l.jsx("div",{className:"mb-1 flex flex-row items-center font-bold sm:text-xl md:mb-0 md:text-2xl",children:l.jsxs("div",{className:"mb-1 flex items-center md:mb-0",children:[l.jsx("div",{className:"rounded pr-2",children:((null==(s=e.category)?void 0:s.length)??0)>0?l.jsx(kb,{category:e.category??""}):null}),l.jsx(L_,{className:"text-2xl font-bold",children:e.name})]})})}),l.jsx("div",{className:"flex h-full max-h-screen flex-col overflow-y-auto md:flex-row",children:l.jsxs("div",{className:"flex flex-1 flex-col gap-4 p-0 md:max-h-[calc(100vh-150px)] md:p-2",children:[l.jsxs("div",{children:[l.jsx("h2",{className:"flex items-center justify-between rounded-t-lg border border-border-light py-2 pl-4 text-base font-semibold text-text-primary",children:a("com_ui_prompt_text")}),l.jsx("div",{className:"group relative min-h-32 rounded-b-lg border border-border-light p-4 transition-all duration-150",children:l.jsx(so,{remarkPlugins:[oo,io,[lo,{singleDollarTextMath:!1}]],rehypePlugins:[[ao],[ro,{ignoreMissing:!0}]],components:{p:_C,code:fC},className:"markdown prose dark:prose-invert light dark:text-gray-70 my-1 break-words",children:o})})]}),l.jsx(kC,{promptText:o,showInfo:!1}),l.jsx(SC,{initialValue:e.oneliner,disabled:!0}),l.jsx(TC,{initialValue:e.command,disabled:!0})]})})]}):null},IC=({group:e,open:t,onOpenChange:n})=>l.jsx(A_,{open:t,onOpenChange:n,children:l.jsx(V_,{className:"max-h-[90vh] w-11/12 max-w-full overflow-y-auto md:max-w-[60vw]",children:l.jsx("div",{className:"p-2",children:l.jsx(RC,{group:e})})})});function EC({category:e,name:t,snippet:n,onClick:s,children:a}){return l.jsxs("div",{onClick:s,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),null==s||s(e))},className:"relative my-2 flex w-full cursor-pointer flex-col gap-2 rounded-xl border border-border-light px-3 pb-4 pt-3 text-start\n          align-top text-[15px] shadow-sm transition-all duration-300 ease-in-out hover:bg-surface-tertiary hover:shadow-lg",role:"button",tabIndex:0,"aria-labelledby":`card-title-${t}`,"aria-describedby":`card-snippet-${t}`,"aria-label":`Card for ${t}`,children:[l.jsxs("div",{className:"flex w-full justify-between gap-2",children:[l.jsxs("div",{className:"flex flex-row gap-2",children:[l.jsx(kb,{category:e,className:"icon-md","aria-hidden":"true"}),l.jsx(L_,{id:`card-title-${t}`,className:"break-word select-none text-balance text-sm font-semibold text-text-primary",title:t,children:t})]}),l.jsx("div",{children:a})]}),l.jsx("div",{id:`card-snippet-${t}`,className:"ellipsis max-w-full select-none text-balance text-sm text-text-secondary",children:n})]})}const MC=n.memo(function({group:e,instanceProjectId:t}){var s;const a=zf(),{user:r}=Rg(),{submitPrompt:o}=Wv(),[i,d]=n.useState(!1),[u,m]=n.useState(!1),p=Ev(`/d/prompts/${e._id}`),h=n.useMemo(()=>{var n;return null!=t&&(null==(n=e.projectIds)?void 0:n.includes(t))},[e,t]),x=n.useMemo(()=>(null==r?void 0:r.id)===e.author,[r,e]);return l.jsxs(l.Fragment,{children:[l.jsx(EC,{name:e.name,category:e.category??"",onClick:()=>{var t;const n=null==(t=e.productionPrompt)?void 0:t.prompt;(null==n?void 0:n.trim())&&(op(n)?m(!0):o(n))},snippet:"string"==typeof e.oneliner&&e.oneliner.length>0?e.oneliner:(null==(s=e.productionPrompt)?void 0:s.prompt)??"",children:l.jsxs("div",{className:"flex flex-row items-center gap-2",children:[!0===h&&l.jsx(c,{className:"icon-md text-black dark:text-white","aria-label":"Global prompt group"}),l.jsxs(u_,{modal:!1,children:[l.jsx(m_,{asChild:!0,children:l.jsxs("button",{id:`prompt-actions-${e._id}`,"aria-label":`${e.name} - Actions Menu`,"aria-expanded":"false","aria-controls":`prompt-menu-${e._id}`,"aria-haspopup":"menu",onClick:e=>{e.stopPropagation()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||e.stopPropagation()},className:"z-50 inline-flex h-8 w-8 items-center justify-center rounded-lg border border-border-medium bg-transparent p-0 text-sm font-medium transition-all duration-300 ease-in-out hover:border-border-heavy hover:bg-surface-hover focus:border-border-heavy focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",children:[l.jsx(Nt,{className:"icon-md text-text-secondary","aria-hidden":"true"}),l.jsx("span",{className:"sr-only",children:a("com_ui_sr_actions_menu",{0:e.name})+" "+a("com_ui_prompt")})]})}),l.jsxs(h_,{id:`prompt-menu-${e._id}`,"aria-label":`Available actions for ${e.name}`,className:"z-50 w-fit rounded-xl",collisionPadding:2,align:"end",children:[l.jsxs(x_,{role:"menuitem",onClick:e=>{e.stopPropagation(),d(!0)},className:"w-full cursor-pointer rounded-lg text-text-secondary hover:bg-surface-hover focus:bg-surface-hover disabled:cursor-not-allowed",children:[l.jsx(Ct,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),l.jsx("span",{children:a("com_ui_preview")})]}),x&&l.jsx(p_,{children:l.jsxs(x_,{disabled:!x,className:"cursor-pointer rounded-lg text-text-secondary hover:bg-surface-hover focus:bg-surface-hover disabled:cursor-not-allowed",onClick:e=>{e.stopPropagation(),p(e)},children:[l.jsx(kt,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),l.jsx("span",{children:a("com_ui_edit")})]})})]})]})]})}),l.jsx(IC,{group:e,open:i,onOpenChange:d}),l.jsx(NC,{open:u,onClose:()=>m(!1),group:e})]})});function PC({groups:e=[],isChatRoute:t,isLoading:n}){const s=k(),a=zf(),{data:r={}}=Sx(),{instanceProjectId:o}=r,i=Zv({permissionType:bd.PROMPTS,permission:yd.CREATE});return l.jsxs("div",{className:"flex h-full flex-col",children:[i&&l.jsx("div",{className:"flex w-full justify-end",children:l.jsxs(c_,{variant:"outline",className:"w-full bg-transparent "+(t?"":"mx-2"),onClick:()=>s("/d/prompts/new"),children:[l.jsx(_e,{className:"size-4","aria-hidden":!0}),a("com_ui_create_prompt")]})}),l.jsx("div",{className:"flex-grow overflow-y-auto",children:l.jsxs("div",{className:"overflow-y-auto overflow-x-hidden",children:[n&&t&&l.jsx(q_,{className:"my-2 flex h-[84px] w-full rounded-2xl border-0 px-3 pb-4 pt-3"}),n&&!t&&Array.from({length:10}).map((e,t)=>l.jsx(q_,{className:"w-100 mx-2 my-2 flex h-14 rounded-lg border-0 p-4"},t)),!n&&0===e.length&&t&&l.jsx("div",{className:"my-2 flex h-[84px] w-full items-center justify-center rounded-2xl border border-border-light bg-transparent px-3 pb-4 pt-3 text-text-primary",children:a("com_ui_nothing_found")}),!n&&0===e.length&&!t&&l.jsx("div",{className:"my-12 flex w-full items-center justify-center text-lg font-semibold text-text-primary",children:a("com_ui_nothing_found")}),e.map(e=>t?l.jsx(MC,{group:e,instanceProjectId:o},e._id):l.jsx(Cw,{group:e,instanceProjectId:o},e._id))]})})]})}function LC({children:e,isDetailView:t,className:s="",nextPage:a,prevPage:r,isFetching:o,hasNextPage:i,groupsQuery:c,promptGroups:d,hasPreviousPage:u}){const m=N(),p=Uy("(max-width: 1024px)"),h=n.useMemo(()=>{var e;return null==(e=m.pathname)?void 0:e.startsWith("/c/")},[m.pathname]);return l.jsxs("div",{className:Op("mr-2 flex h-auto w-auto min-w-72 flex-col gap-2 lg:w-1/4 xl:w-1/4",!0===t&&p?"hidden":"",s),children:[e,l.jsx("div",{className:"flex-grow overflow-y-auto",children:l.jsx(PC,{groups:d,isChatRoute:h,isLoading:!!c.isLoading})}),l.jsxs("div",{className:"flex items-center justify-between",children:[h&&l.jsx(Nw,{className:"select-none"}),l.jsx(ww,{nextPage:a,prevPage:r,isFetching:o,hasNextPage:i,isChatRoute:h,hasPreviousPage:u})]})]})}function AC(){const e=M(),t=k(),s=Ib(),a=n.useMemo(()=>!(!e.promptId&&"new"!==e["*"]),[e]),r=Zv({permissionType:bd.PROMPTS,permission:yd.USE});return n.useEffect(()=>{let e;return r||(e=setTimeout(()=>{t("/c/new")},1e3)),()=>{clearTimeout(e)}},[r,t]),r?l.jsxs("div",{className:"flex h-screen w-full flex-col bg-surface-primary p-0 lg:p-2",children:[l.jsx(jw,{}),l.jsxs("div",{className:"flex w-full flex-grow flex-row divide-x overflow-hidden dark:divide-gray-600",children:[l.jsx(LC,{isDetailView:a,...s,children:l.jsx("div",{className:"mx-2 mt-1 flex flex-row items-center justify-between",children:l.jsx(mw,{setName:s.setName})})}),l.jsx("div",{className:Op("scrollbar-gutter-stable w-full overflow-y-auto lg:w-3/4 xl:w-3/4",a?"block":"hidden md:block"),children:l.jsx(He,{context:s})})]})]}):null}const OC=sx.alwaysMakeProd||qh("alwaysMakeProd",!0);function DC({onCheckedChange:e,className:t=""}){const[n,s]=b(OC),a=zf();return l.jsxs("div",{className:Op("flex select-none items-center justify-end gap-2 text-xs",t),children:[l.jsx(Q_,{id:"alwaysMakeProd",checked:n,onCheckedChange:t=>{s(t),e&&e(t)},"data-testid":"alwaysMakeProd","aria-label":"Always make prompt production"}),l.jsxs("div",{children:[a("com_nav_always_make_prod")," "]})]})}const zC=Object.keys(ed).map(e=>({label:`com_ui_special_var_${e}`,value:`{{${e}}}`}));function FC({fieldName:e="prompt",className:t=""}){const s=n.useId(),a=zf(),r=Pr(),{setValue:o,getValues:i}=r,[c,d]=n.useState(!1);return l.jsx("div",{className:t,title:`${a("com_ui_add")} ${a("com_ui_special_variables")}`,children:l.jsx(kj,{portal:!0,mountByState:!0,unmountOnHide:!0,preserveTabOrder:!0,isOpen:c,setIsOpen:d,trigger:l.jsxs(Qe,{id:"variables-menu-button","aria-label":`${a("com_ui_add")} ${a("com_ui_special_variables")}`,className:"flex h-8 items-center gap-1 rounded-md border border-border-medium bg-surface-secondary px-2 py-0 text-sm text-text-primary transition-colors duration-200 hover:bg-surface-tertiary",children:[l.jsx(St,{className:"mr-1 h-3 w-3 text-text-secondary","aria-hidden":!0}),a("com_ui_special_variables")]}),items:zC.map(t=>({label:a(t.label)||t.label,onClick:()=>((t,n)=>{const s=i(e)||"",r=s.length>0?"\n\n":"",l=a(t);o(e,s+r+l+": "+n),d(!1)})(t.label,t.value)})),menuId:s,className:"z-30"})})}const VC=n.memo(({name:e,isEditing:t,setIsEditing:s})=>{const a=zf(),{control:r}=Pr(),o=sx.promptsEditorMode||qh("promptsEditorMode",Vo.SIMPLE),i=_(o),{dirtyFields:c}=Lr({control:r}),{prompt:d}=c,u=n.useMemo(()=>t&&null==(null==d?void 0:d.length)?Qb:t?Ry:kt,[t,d]),m=[[ao],[ro,{detect:!0,ignoreMissing:!0,subset:hp}]];return l.jsxs("div",{className:"flex max-h-[85vh] flex-col sm:max-h-[85vh]",children:[l.jsxs("h2",{className:"flex items-center justify-between rounded-t-xl border border-border-light py-1.5 pl-3 text-sm font-semibold text-text-primary sm:py-2 sm:pl-4 sm:text-base",children:[l.jsx("span",{className:"max-w-[200px] truncate sm:max-w-none",children:a("com_ui_prompt_text")}),l.jsxs("div",{className:"flex flex-shrink-0 flex-row items-center gap-3 sm:gap-6",children:[i===Vo.ADVANCED&&l.jsx(DC,{className:"hidden sm:flex"}),l.jsx(FC,{fieldName:e}),l.jsx("button",{type:"button",onClick:()=>s(e=>!e),"aria-label":a(t?"com_ui_save":"com_ui_edit"),className:"mr-1 rounded-lg p-1.5 sm:mr-2 sm:p-1",children:l.jsx(u,{className:Op("h-5 w-5 sm:h-6 sm:w-6",t?"p-[0.05rem]":"text-secondary-alt hover:text-text-primary")})})]})]}),l.jsxs("div",{role:"button",className:Op("w-full flex-1 overflow-auto rounded-b-xl border border-border-light p-2 shadow-md transition-all duration-150 sm:p-4",{"cursor-pointer bg-surface-primary hover:bg-surface-secondary active:bg-surface-tertiary":!t}),onClick:()=>!t&&s(!0),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!t&&s(!0)},tabIndex:0,children:[!t&&l.jsx(kt,{className:"icon-xl absolute inset-0 m-auto hidden h-6 w-6 text-text-primary opacity-25 group-hover:block sm:h-8 sm:w-8"}),l.jsx(Ir,{name:e,control:r,render:({field:e})=>t?l.jsx(aj,{...e,autoFocus:!0,className:"w-full resize-none overflow-y-auto rounded bg-transparent text-sm text-text-primary focus:outline-none sm:text-base",minRows:3,maxRows:14,onBlur:()=>s(!1),onKeyDown:e=>{"Escape"===e.key&&(e.preventDefault(),s(!1))}}):l.jsx("div",{className:Op("overflow-y-auto text-sm sm:text-base"),style:{minHeight:"4.5em",maxHeight:"21em",overflow:"auto"},children:l.jsx(so,{remarkPlugins:[oo,io,[lo,{singleDollarTextMath:!1}]],rehypePlugins:m,components:{p:_C,code:fC},className:"markdown prose dark:prose-invert light my-1 w-full break-words text-text-primary",children:e.value})})})]})]})}),$C=({currentCategory:e,onValueChange:t,className:s=""})=>{const{t:a}=Tr(),r=Pr(),{categories:o,emptyCategory:i}=Rb(),c=r.control,d=r.watch,u=r.setValue,m=d?d("category"):e,p=n.useMemo(()=>(o??[]).find(t=>t.value===(m??e))??i,[m,o,e,i]),h=n.useMemo(()=>p.value||"icon"in p?p:{...p,icon:l.jsx("span",{className:"i-heroicons-tag"}),label:p.label||a("com_ui_empty_category")},[p,a]);return r?l.jsx(Ir,{name:"category",control:c,render:()=>l.jsx(fj,{value:h.value??"",label:h.value?void 0:a("com_ui_category"),onChange:e=>{u("category",e,{shouldDirty:!1}),localStorage.setItem(Jc.LAST_PROMPT_CATEGORY,e),null==t||t(e)},"aria-labelledby":"category-selector-label",ariaLabel:"Prompt's category selector",className:s,options:o||[],renderValue:()=>l.jsxs("div",{className:"flex items-center space-x-2",children:["icon"in h&&null!=h.icon&&l.jsx("span",{children:h.icon}),l.jsx("span",{children:h.label})]})})}):l.jsx(fj,{value:e??"",onChange:e=>{localStorage.setItem(Jc.LAST_PROMPT_CATEGORY,e),null==t||t(e)},"aria-labelledby":"category-selector-label",ariaLabel:"Prompt's category selector",className:s,options:o||[],renderValue:()=>l.jsxs("div",{className:"flex items-center space-x-2",children:["icon"in h&&null!=h.icon&&l.jsx("span",{children:h.icon}),l.jsx("span",{children:h.label})]})})};function BC(){const e=k(),t=zf();return l.jsx("div",{className:"relative min-h-full w-full px-4",children:l.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:l.jsxs("div",{className:"text-center font-bold dark:text-gray-200",children:[l.jsx("h1",{className:"text-lg font-bold dark:text-gray-200 md:text-2xl",children:t("com_ui_prompt_preview_not_shared")}),l.jsx(c_,{className:"mt-4",onClick:()=>{e("/d/prompts")},children:t("com_ui_back_to_prompts")})]})})})}const UC=({description:e})=>l.jsx(rj,{description:e,"aria-label":e,render:l.jsx("div",{className:"flex items-center justify-center",children:l.jsx(It,{className:"h-4 w-4 text-amber-500"})})}),HC=({tags:e})=>{const t=zf();return e.includes("latest")&&e.includes("production")?l.jsx("span",{className:"absolute bottom-3 right-3",children:l.jsx(UC,{description:t("com_ui_latest_production_version")})}):l.jsx("span",{className:"flex gap-1 text-sm",children:e.map((e,n)=>l.jsx(rj,{description:t("production"===e?"com_ui_currently_production":"com_ui_latest_version"),"aria-label":t("production"===e?"com_ui_currently_production":"com_ui_latest_version"),render:l.jsx(sj,{label:e,className:Op("w-24 justify-center border border-transparent","production"===e?"bg-gray-100 text-black dark:border-gray-500 dark:bg-gray-800 dark:text-white":"bg-blue-100 text-blue-500 dark:border-blue-500 dark:bg-transparent dark:text-blue-500"),labelClassName:"flex items-center m-0 justify-center gap-1",LabelNode:"production"===e?l.jsx("div",{className:"flex items-center",children:l.jsx("span",{className:"slow-pulse size-2 rounded-full bg-gray-500"})}):"latest"===e?l.jsx("div",{className:"flex items-center",children:l.jsx(Rt,{className:"size-4"})}):null})},`${e}-${n}`))})},KC=({prompt:e,index:t,isSelected:n,totalVersions:s,onClick:a,authorName:r,tags:o})=>{const i=zf();return l.jsx("button",{type:"button",className:Op("group relative w-full rounded-lg border border-border-light p-4 transition-all duration-300",n?"bg-surface-hover shadow-xl":"bg-surface-primary shadow-sm hover:bg-surface-secondary"),onClick:a,"aria-selected":n,role:"tab","aria-label":i("com_ui_version_var",{0:""+(s-t)}),children:l.jsxs("div",{className:"flex flex-col gap-2",children:[l.jsxs("div",{className:"flex items-start justify-between lg:flex-col xl:flex-row",children:[l.jsx("h3",{className:"font-bold text-text-primary",children:i("com_ui_version_var",{0:""+(s-t)})}),l.jsx("time",{className:"text-xs text-text-secondary",dateTime:e.createdAt,children:_r(new Date(e.createdAt),"yyyy-MM-dd HH:mm")})]}),l.jsxs("div",{className:"flex items-center gap-1 lg:flex-col xl:flex-row",children:[r&&l.jsxs(L_,{className:"text-left text-xs text-text-secondary",children:["by ",r]}),o.length>0&&l.jsx(HC,{tags:o})]})]})})},GC=({prompts:e,group:t,selectionIndex:n,setSelectionIndex:s})=>{const a=zf();return l.jsxs("section",{className:"my-6","aria-label":"Prompt Versions",children:[l.jsx("header",{className:"mb-6",children:l.jsxs("h2",{className:"flex items-center gap-2 text-base font-semibold text-text-primary",children:[l.jsx(Tt,{className:"h-5 w-5 text-black dark:text-white"}),a("com_ui_versions")]})}),l.jsx("div",{className:"flex flex-col gap-3",role:"tablist","aria-label":"Version history",children:e.map((a,r)=>{const o=[];return 0===r&&o.push("latest"),a._id===(null==t?void 0:t.productionId)&&o.push("production"),l.jsx(KC,{prompt:a,index:r,isSelected:r===n,totalVersions:e.length,onClick:()=>s(r),authorName:null==t?void 0:t.authorName,tags:o},a._id)})})]})},WC=({name:e,disabled:t,selectHandler:n})=>{const s=zf();return l.jsxs(A_,{children:[l.jsx(O_,{asChild:!0,children:l.jsx(c_,{variant:"destructive",size:"sm","aria-label":"Delete version",className:"h-10 w-10 p-0.5",disabled:t,onClick:e=>{e.stopPropagation()},children:l.jsx(Et,{className:"size-5 cursor-pointer text-white"})})}),l.jsx(Oj,{showCloseButton:!1,title:s("com_ui_delete_prompt"),className:"max-w-[450px]",main:l.jsx(l.Fragment,{children:l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(L_,{htmlFor:"dialog-delete-confirm-prompt",className:"text-left text-sm font-medium",children:s("com_ui_delete_confirm_prompt_version_var",{0:e})})})})}),selection:{selectHandler:n,selectClasses:"bg-surface-destructive hover:bg-surface-destructive-hover transition-colors duration-200 text-white",selectText:s("com_ui_delete")}})]})};function qC(){return l.jsxs("div",{children:[l.jsx("div",{className:"flex flex-col items-center justify-between px-4 dark:text-gray-200 sm:flex-row",children:l.jsx(q_,{className:"mb-1 flex h-10 w-32 flex-row items-center font-bold sm:text-xl md:mb-0 md:h-12 md:text-2xl"})}),l.jsx("div",{className:"flex h-full w-full flex-col md:flex-row",children:l.jsx("div",{className:"flex-1 overflow-y-auto border-border-medium-alt p-4 md:max-h-[calc(100vh-150px)] md:border-r",children:l.jsx(q_,{className:"h-96"})})})]})}const QC=({group:e,disabled:t})=>{const s=zf(),{showToast:a}=Of(),r=Tf(),{data:o={},isFetching:i}=Sx(),{instanceProjectId:c}=o,d=n.useMemo(()=>((null==e?void 0:e.projectIds)??[]).includes(c),[e,c]),{control:u,setValue:m,handleSubmit:p,formState:{isSubmitting:h}}=Rr({mode:"onChange",defaultValues:{[yd.SHARED_GLOBAL]:d}});if(n.useEffect(()=>{m(yd.SHARED_GLOBAL,d)},[d,m]),null==e||!c)return null;return l.jsxs(A_,{children:[l.jsx(O_,{asChild:!0,children:l.jsx(c_,{variant:"default",size:"sm","aria-label":"Share prompt",className:"h-10 w-10 border border-transparent bg-blue-500/90 p-0.5 transition-all hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-800",disabled:t,children:l.jsx(We,{className:"size-5 cursor-pointer text-white"})})}),l.jsxs(V_,{className:"w-11/12 max-w-lg",role:"dialog","aria-labelledby":"dialog-title",children:[l.jsx(U_,{id:"dialog-title",className:"truncate pr-2",title:e.name,children:s("com_ui_share_var",{0:`"${e.name}"`})}),l.jsxs("form",{className:"p-2",onSubmit:p(t=>{const n=e._id??"";if(""===n||!c)return;if(!0===t[yd.SHARED_GLOBAL]&&d)return void a({message:s("com_ui_prompt_already_shared_to_all"),status:"info"});const i={};!0===t[yd.SHARED_GLOBAL]?i.projectIds=[o.instanceProjectId]:i.removeProjectIds=[o.instanceProjectId],r.mutate({id:n,payload:i})}),"aria-describedby":"form-description",children:[l.jsx("div",{id:"form-description",className:"sr-only",children:s("com_ui_share_form_description")}),l.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2 py-4",children:[l.jsx("div",{className:"flex items-center",id:"share-to-all-users",children:s("com_ui_share_to_all_users")}),l.jsx(Ir,{name:yd.SHARED_GLOBAL,control:u,disabled:!0===i||r.isLoading||!c,render:({field:e})=>l.jsx(Q_,{...e,checked:e.value,onCheckedChange:e.onChange,value:e.value.toString(),"aria-labelledby":"share-to-all-users"})})]}),l.jsx("div",{className:"flex justify-end",children:l.jsx(z_,{asChild:!0,children:l.jsx(c_,{type:"submit",disabled:h||i,variant:"submit","aria-label":s("com_ui_save"),children:s("com_ui_save")})})})]})]})]})},ZC=sx.alwaysMakeProd||qh("alwaysMakeProd",!0),JC=sx.promptsEditorMode||qh("promptsEditorMode",Vo.SIMPLE),YC=()=>{const e=M(),t=zf(),{user:s}=Rg(),a=_(ZC),{showToast:r}=Of(),o=e.promptId||"",[i,c]=n.useState(0),d=_(JC),u=n.useRef(!1),[m,p]=n.useState(!1),[h,x]=n.useState(!0),[f,g]=n.useState(!1),v="320px",{data:b,isLoading:y}=af(o),{data:j=[],isLoading:w}=(N={groupId:o},C={enabled:!!o},La([Pd.prompts,N.groupId??""],()=>ku(N),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...C,enabled:void 0===(null==C?void 0:C.enabled)||C.enabled}));var N,C;const k=n.useMemo(()=>!(!s||!b)&&s.id===b.author,[s,b]),S=Rr({defaultValues:{prompt:"",promptName:b?b.name:"",category:b?b.category:""}}),{handleSubmit:T,setValue:R,reset:I,watch:E}=S,P=E("prompt"),L=n.useMemo(()=>j.length>0?j[i]:void 0,[j,i]),{groupsQuery:A}=Ve(),O=Zv({permissionType:bd.PROMPTS,permission:yd.SHARED_GLOBAL}),D=Tf({onError:()=>{r({status:"error",message:t("com_ui_prompt_update_error")})}}),z=Mf(),F=If(),V=Rf({onMutate:e=>{I({prompt:e.prompt.prompt,category:e.group?e.group.category:""},{keepDirtyValues:!0})},onSuccess(e){a&&null!=e.prompt._id&&e.prompt._id&&e.prompt.groupId&&z.mutate({id:e.prompt._id,groupId:e.prompt.groupId,productionPrompt:{prompt:e.prompt.prompt}}),I({prompt:e.prompt.prompt,promptName:e.group?e.group.name:"",category:e.group?e.group.category:""})}}),$=n.useCallback(e=>{if(!e)return;if(!L)return;const t={prompt:{type:L.type??"text",groupId:L.groupId??"",prompt:e}};e!==L.prompt&&V.mutate(t)},[L,V]),B=n.useCallback(()=>{y||w||x(!1)},[y,w]);n.useEffect(()=>{u.current&&!m&&T(e=>$(e.prompt))(),u.current=m},[m,$,T]),n.useEffect(()=>{B()},[e.promptId,d,null==b?void 0:b.productionId,j,B]),n.useEffect(()=>{R("prompt",L?L.prompt:"",{shouldDirty:!1}),R("category",b?b.category:"",{shouldDirty:!1})},[L,b,R]),n.useEffect(()=>{const e=()=>{window.matchMedia("(min-width: 1022px)").matches&&g(!1)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const U=n.useCallback(Cr(e=>{if(!b||!b._id)return console.warn("Group not found");D.mutate({id:b._id,payload:{oneliner:e}})},950),[D,b]),H=n.useCallback(Cr(e=>{if(!b||!b._id)return console.warn("Group not found");D.mutate({id:b._id,payload:{command:e}})},950),[D,b]);if(h)return l.jsx(qC,{});if(!k&&A.data&&(null==s?void 0:s.role)!==Id.ADMIN){const t=Pp(A.data,t=>t._id===e.promptId);return t?l.jsx(RC,{group:t}):l.jsx(BC,{})}if(!b||null==b._id)return null;const K=b._id,G=b.name,W=b.category,q=()=>l.jsxs("div",{className:"h-full w-full overflow-y-auto bg-surface-primary px-4",style:{maxHeight:"calc(100vh - 100px)"},children:[l.jsxs("div",{className:"mb-2 flex flex-col lg:flex-row lg:items-center lg:justify-center lg:gap-x-2 xl:flex-row xl:space-y-0",children:[l.jsx($C,{currentCategory:W,onValueChange:e=>D.mutate({id:K,payload:{name:G,category:e}})}),l.jsxs("div",{className:"mt-2 flex flex-row items-center justify-center gap-x-2 lg:mt-0",children:[O&&l.jsx(QC,{group:b,disabled:y}),d===Vo.ADVANCED&&l.jsx(c_,{variant:"submit",size:"sm","aria-label":"Make prompt production",className:"h-10 w-10 border border-transparent p-0.5 transition-all",onClick:()=>{if(!L)return void console.warn("No prompt is selected");const{_id:e="",prompt:t}=L;z.mutate({id:e,groupId:K,productionPrompt:{prompt:t}})},disabled:y||!L||L._id===b.productionId||z.isLoading,children:l.jsx(Mt,{className:"size-5 cursor-pointer text-white"})}),l.jsx(WC,{name:G,disabled:y,selectHandler:()=>{L&&L._id?F.mutate({_id:L._id,groupId:K}):console.warn("No prompt is selected or prompt _id is missing")}})]})]}),d===Vo.ADVANCED&&(w?Array.from({length:6}).map((e,t)=>l.jsx("div",{className:"my-2",children:l.jsx(q_,{className:"h-[72px] w-full"})},t)):j.length>0&&l.jsx(GC,{group:b,prompts:j,selectionIndex:i,setSelectionIndex:c}))]});return l.jsx(Ar,{...S,children:l.jsx("form",{className:"mt-4 flex w-full",onSubmit:T(e=>$(e.prompt)),children:l.jsxs("div",{className:"relative w-full",children:[l.jsx("div",{className:"h-full w-full",style:{transform:`translateX(${f?`-${v}`:"0"})`,transition:"transform 0.3s ease-in-out"},children:l.jsxs("div",{className:"flex h-full",children:[l.jsxs("div",{className:"flex-1 overflow-hidden px-4",children:[l.jsx("div",{className:"mb-4 flex items-center gap-2 text-text-primary",children:y?l.jsx(q_,{className:"mb-1 flex h-10 w-32 font-bold sm:text-xl md:mb-0 md:h-12 md:text-2xl"}):l.jsxs(l.Fragment,{children:[l.jsx(uw,{name:G,onSave:e=>{b._id&&D.mutate({id:b._id,payload:{name:e}})}}),l.jsx("div",{className:"flex-1"}),l.jsx(c_,{type:"button",variant:"ghost",className:"h-10 w-10 border border-border-light p-0 lg:hidden",onClick:()=>g(!0),"aria-label":t("com_endpoint_open_menu"),children:l.jsx(Nt,{className:"size-5"})}),l.jsx("div",{className:"hidden lg:block",children:d===Vo.SIMPLE&&l.jsx(q,{})})]})}),w?l.jsx(q_,{className:"h-96","aria-live":"polite"}):l.jsxs("div",{className:"mb-2 flex h-full flex-col gap-4",children:[l.jsx(VC,{name:"prompt",isEditing:m,setIsEditing:p}),l.jsx(kC,{promptText:P}),l.jsx(SC,{initialValue:b.oneliner??"",onValueChange:U}),l.jsx(TC,{initialValue:b.command??"",onValueChange:H})]})]}),d===Vo.ADVANCED&&l.jsx("div",{className:"hidden w-1/4 border-l border-border-light lg:block",children:l.jsx(q,{})})]})}),l.jsx("button",{type:"button",className:Op("absolute inset-0 z-40 cursor-default",f?"opacity-100":"pointer-events-none opacity-0"),style:{transition:"opacity 0.3s ease-in-out"},onClick:()=>g(!1),"aria-hidden":!f,tabIndex:f?0:-1,"aria-label":t("com_ui_close_menu")}),l.jsx("div",{className:"absolute inset-y-0 right-0 z-50 lg:hidden",style:{width:v,transform:`translateX(${f?"0":"100%"})`,transition:"transform 0.3s ease-in-out"},role:"dialog","aria-modal":"true","aria-label":"Mobile navigation panel",children:l.jsx("div",{className:"h-full",children:l.jsx("div",{className:"h-full overflow-auto",children:l.jsx(q,{})})})})]})})})};function XC(){return l.jsx("div",{className:"h-full w-full content-center text-center font-bold dark:text-gray-200",children:"Select or Create a Prompt"})}const ek={name:"",prompt:"",type:"text",category:"",oneliner:void 0,command:void 0},tk=({defaultValues:e=ek})=>{const t=zf(),s=k(),a=Zv({permissionType:bd.PROMPTS,permission:yd.CREATE});n.useEffect(()=>{let e;return a||(e=setTimeout(()=>{s("/c/new")},1e3)),()=>{clearTimeout(e)}},[a,s]);const r=Rr({defaultValues:{...e,category:localStorage.getItem(Jc.LAST_PROMPT_CATEGORY)??""}}),{watch:o,control:i,handleSubmit:c,formState:{isDirty:d,isSubmitting:u,errors:m,isValid:p}}=r,h=Rf({onSuccess:e=>{s(`/d/prompts/${e.prompt.groupId}`,{replace:!0})}}),x=o("prompt");return a?l.jsx(Ar,{...r,children:l.jsxs("form",{onSubmit:c(e=>{const{name:t,category:n,oneliner:s,command:a,...r}=e,o={name:t,category:n};((null==s?void 0:s.length)??0)>0&&(o.oneliner=s),((null==a?void 0:a.length)??0)>0&&(o.command=a),h.mutate({prompt:r,group:o})}),className:"w-full px-4 py-2",children:[l.jsx("div",{className:"mb-1 flex flex-col items-center justify-between font-bold sm:text-xl md:mb-0 md:text-2xl",children:l.jsxs("div",{className:"flex w-full flex-col items-center justify-between sm:flex-row",children:[l.jsx(Ir,{name:"name",control:i,rules:{required:t("com_ui_prompt_name_required")},render:({field:e})=>l.jsxs("div",{className:"mb-1 flex items-center md:mb-0",children:[l.jsx(M_,{...e,type:"text",className:"mr-2 w-full border border-border-medium p-2 text-2xl text-text-primary placeholder:text-text-tertiary dark:placeholder:text-text-secondary",placeholder:`${t("com_ui_prompt_name")}*`,tabIndex:0}),l.jsx("div",{className:Op("mt-1 w-56 text-sm text-red-500",m.name?"visible h-auto":"invisible h-0"),children:m.name?m.name.message:" "})]})}),l.jsx($C,{})]})}),l.jsxs("div",{className:"flex w-full flex-col gap-4 md:mt-[1.075rem]",children:[l.jsxs("div",{children:[l.jsxs("h2",{className:"flex items-center justify-between rounded-t-lg border border-border-medium py-2 pl-4 pr-1 text-base font-semibold dark:text-gray-200",children:[l.jsxs("span",{children:[t("com_ui_prompt_text"),"*"]}),l.jsx(FC,{fieldName:"prompt",className:"mr-2"})]}),l.jsx("div",{className:"min-h-32 rounded-b-lg border border-border-medium p-4 transition-all duration-150",children:l.jsx(Ir,{name:"prompt",control:i,rules:{required:t("com_ui_prompt_text_required")},render:({field:e})=>l.jsxs("div",{children:[l.jsx(aj,{...e,className:"w-full rounded border border-border-medium px-2 py-1 focus:outline-none dark:bg-transparent dark:text-gray-200",minRows:6,tabIndex:0}),l.jsx("div",{className:"mt-1 text-sm text-red-500 "+(m.prompt?"visible h-auto":"invisible h-0"),children:m.prompt?m.prompt.message:" "})]})})})]}),l.jsx(kC,{promptText:x}),l.jsx(SC,{onValueChange:e=>r.setValue("oneliner",e),tabIndex:0}),l.jsx(TC,{onValueChange:e=>r.setValue("command",e),tabIndex:0}),l.jsx("div",{className:"mt-4 flex justify-end",children:l.jsx(c_,{"aria-label":t("com_ui_create_prompt"),tabIndex:0,type:"submit",disabled:!d||u||!p,children:t("com_ui_create_prompt")})})]})]})}):null};function nk(){const e=Aa(),{isAuthenticated:t}=Rg(),s=(()=>{const e=N(),t=n.useRef();return n.useEffect(()=>{var n;t.current=null==(n=e.state)?void 0:n.prevLocation},[e]),t})(),a=sx.useClearConvoState(),[r,o]=n.useState("");return n.useEffect(()=>{var e;o((null==(e=s.current)?void 0:e.pathname)||"")},[s]),n.useEffect(()=>{e.removeQueries([Pd.messages,"new"]),a()},[e,a]),t?l.jsx(tv.Provider,{value:{prevLocationPath:r},children:l.jsx("div",{className:"h-screen w-full",children:l.jsx(He,{})})}):null}const sk={path:"d/*",element:l.jsx(nk,{}),children:[{path:"prompts/*",element:l.jsx(AC,{}),children:[{index:!0,element:l.jsx(XC,{})},{path:"new",element:l.jsx(tk,{})},{path:":promptId",element:l.jsx(YC,{})}]},{path:"*",element:l.jsx(Pt,{to:"/d/files",replace:!0})}]};function ak({message:e,searchResults:t}){const s=zf(),[a,r]=n.useState(!1),o=mb({text:e.text,content:e.content,searchResults:t});return l.jsx("div",{className:"visible mt-0 flex justify-center gap-1 self-end text-gray-400 lg:justify-start",children:l.jsx("button",{className:"ml-0 flex items-center gap-1.5 rounded-md p-1 text-xs hover:text-gray-900 dark:text-gray-400/70 dark:hover:text-gray-200 disabled:dark:hover:text-gray-400 md:group-hover:visible md:group-[.final-completion]:visible",onClick:()=>o(r),type:"button",title:s(a?"com_ui_copied_to_clipboard":"com_ui_copy_to_clipboard"),children:a?l.jsx(qb,{className:"h-[18px] w-[18px]"}):l.jsx(Wb,{})})})}const rk={[Wc.MODERATION]:"com_error_moderation",[Wc.NO_USER_KEY]:"com_error_no_user_key",[Wc.INVALID_USER_KEY]:"com_error_invalid_user_key",[Wc.NO_BASE_URL]:"com_error_no_base_url",[Wc.INVALID_ACTION]:`com_error_${Wc.INVALID_ACTION}`,[Wc.INVALID_REQUEST]:`com_error_${Wc.INVALID_REQUEST}`,[Wc.NO_SYSTEM_MESSAGES]:`com_error_${Wc.NO_SYSTEM_MESSAGES}`,[Wc.EXPIRED_USER_KEY]:(e,t)=>{const{expiredAt:n,endpoint:s}=e;return t("com_error_expired_user_key",{0:s,1:n})},[Wc.INPUT_LENGTH]:(e,t)=>{const{info:n}=e;return t("com_error_input_length",{0:n})},[Wc.INVALID_AGENT_PROVIDER]:(e,t)=>{const{info:n}=e;return t("com_error_invalid_agent_provider",{0:Oc[n]??n})},[Wc.GOOGLE_ERROR]:e=>{const{info:t}=e;return t},[Gc.BAN]:"Your account has been temporarily banned due to violations of our service.",invalid_api_key:'Invalid API key. Please check your API key and try again. You can do this by clicking on the model logo in the left corner of the textbox and selecting "Set Token" for the current selected endpoint. Thank you for your understanding.',insufficient_quota:'We apologize for any inconvenience caused. The default API key has reached its limit. To continue using this service, please set up your own API key. You can do this by clicking on the model logo in the left corner of the textbox and selecting "Set Token" for the current selected endpoint. Thank you for your understanding.',concurrent:e=>{const{limit:t}=e;return`Only ${t} message${t>1?"s":""} at a time. Please allow any other responses to complete before sending another message, or wait one minute.`},message_limit:e=>{const{max:t,windowInMinutes:n}=e;return`You hit the message limit. You have a cap of ${t} message${t>1?"s":""} per ${n>1?`${n} minutes`:"minute"}.`},token_balance:e=>{const{balance:t,tokenCost:n,promptTokens:s,generations:a}=e,r=`Insufficient Funds! Balance: ${t}. Prompt tokens: ${s}. Cost: ${n}.`;return l.jsxs(l.Fragment,{children:[r,a&&l.jsxs(l.Fragment,{children:[l.jsx("br",{}),l.jsx("br",{})]}),a&&l.jsx(uC,{lang:"Generations",error:!0,codeChildren:ti(JSON.stringify(a))})]})}},ok=({text:e})=>{const t=zf(),n=function(e){let t=0,n=-1;for(let s=0;s<e.length;s++)if("{"===e[s])0===t&&(n=s),t++;else if("}"===e[s]&&(t--,0===t&&-1!==n))return e.slice(n,s+1);return""}(e),s=`Something went wrong. Here's the specific error message we encountered: ${e.length>512&&!n?e.slice(0,512)+"...":e}`;if(!ei(n))return s;const a=JSON.parse(n),r=a.code||a.type,o=r&&rk[r];return o&&"function"==typeof rk[r]?rk[r](a,t):o&&o.startsWith("com_error")?t(rk[r]):o?rk[r]:s},ik=({text:e,message:t,isSubmitting:s,ask:a,enterEdit:r,siblingIdx:o,setSiblingIdx:i})=>{const{addedIndex:c}=Kg(),d=n.useRef(null),u=n.useRef(null),{getMessages:m,setMessages:p,conversation:h}=rg(),[x,f]=b(sx.latestMessageFamily(c)),g=n.useRef(null),{conversationId:v,parentMessageId:y,messageId:j}=t,w=Hf(v??""),N=zf(),C="rtl"===_(sx.chatDirection).toLowerCase(),{register:k,handleSubmit:S,setValue:T}=Rr({defaultValues:{text:e??""}});n.useEffect(()=>{const e=g.current;if(e){const t=e.value.length;e.focus(),e.setSelectionRange(t,t)}},[]);const R=n.useCallback(e=>{var t,n;"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),null==(t=u.current)||t.click()),"s"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),null==(n=d.current)||n.click()),"Escape"===e.key&&(e.preventDefault(),r(!0))},[r]),{ref:I,...E}=k("text",{required:!0,onChange:e=>{T("text",e.target.value,{shouldValidate:!0})}});return l.jsxs(oC,{message:t,children:[l.jsx("div",{className:"bg-token-main-surface-primary relative flex w-full flex-grow flex-col overflow-hidden rounded-2xl border border-border-medium text-text-primary [&:has(textarea:focus)]:border-border-heavy [&:has(textarea:focus)]:shadow-[0_2px_6px_rgba(0,0,0,.05)]",children:l.jsx(aj,{...E,ref:e=>{I(e),g.current=e},onKeyDown:R,"data-testid":"message-text-editor",className:Op("markdown prose dark:prose-invert light whitespace-pre-wrap break-words pl-3 md:pl-4","m-0 w-full resize-none border-0 bg-transparent py-[10px]","placeholder-text-secondary focus:ring-0 focus-visible:ring-0 md:py-3.5",C?"text-right":"text-left","max-h-[65vh] pr-3 md:max-h-[75vh] md:pr-4",Gp),dir:C?"rtl":"ltr"})}),l.jsxs("div",{className:"mt-2 flex w-full justify-center text-center",children:[l.jsx(rj,{description:"Ctrl + Enter /  + Enter",render:l.jsx("button",{ref:u,className:"btn btn-primary relative mr-2",disabled:s,onClick:S(e=>{if(t.isCreatedByUser)a({text:e.text,parentMessageId:y,conversationId:v},{isResubmission:!0,overrideFiles:t.files}),i((o??0)-1);else{const t=m(),n=null==t?void 0:t.find(e=>e.messageId===y);if(!n)return;a({...n},{editedText:e.text,editedMessageId:j,isRegenerate:!0,isEdited:!0}),i((o??0)-1)}r(!0)}),children:N("com_ui_save_submit")})}),l.jsx(rj,{description:"Shift + Enter",render:l.jsx("button",{ref:d,className:"btn btn-secondary relative mr-2",disabled:s,onClick:S(e=>{const n=m();if(!n)return;w.mutate({conversationId:v??"",model:(null==h?void 0:h.model)??"gpt-3.5-turbo",text:e.text,messageId:j}),t.messageId===(null==x?void 0:x.messageId)&&f({...x,text:e.text});n.some(e=>e.messageId===j)?p(n.map(t=>t.messageId===j?{...t,text:e.text}:t)):t.text=e.text,r(!0)}),children:N("com_ui_save")})}),l.jsx(rj,{description:"Esc",render:l.jsx("button",{className:"btn btn-neutral relative",onClick:()=>r(!0),children:N("com_ui_cancel")})})]})]})},lk=({text:e,message:t,className:s=""})=>{const a=zf();return"Error connecting to server, try refreshing the page."===e?(console.log("error message",t),l.jsx(n.Suspense,{fallback:l.jsx("div",{className:"text-message mb-[0.625rem] flex min-h-[20px] flex-col items-start gap-3 overflow-visible",children:l.jsx("div",{className:"markdown prose dark:prose-invert light w-full break-words dark:text-gray-100",children:l.jsx("div",{className:"absolute",children:l.jsx("p",{className:"submitting relative",children:l.jsx("span",{className:"result-thinking"})})})})}),children:l.jsx(Tj,{delay:5500,children:l.jsx(oC,{message:t,children:l.jsx("div",{className:Op("rounded-md border border-red-500 bg-red-500/10 px-3 py-2 text-sm text-gray-600 dark:text-gray-200",s),children:a("com_ui_error_connection")})})})})):l.jsx(oC,{message:t,children:l.jsx("div",{role:"alert","aria-live":"assertive",className:Op("rounded-xl border border-red-500/20 bg-red-500/5 px-3 py-2 text-sm text-gray-600 dark:text-gray-200",s),children:l.jsx(ok,{text:e})})})},ck=({text:e,isCreatedByUser:t,message:s,showCursor:a})=>{const{isSubmitting:r,latestMessage:o}=rg(),i=_(sx.enableUserMsgMarkdown),c=n.useMemo(()=>!0===a&&r,[a,r]),d=n.useMemo(()=>s.messageId===(null==o?void 0:o.messageId),[s.messageId,null==o?void 0:o.messageId]);let u;return u=t?i?l.jsx(AN,{content:e}):l.jsx(l.Fragment,{children:e}):l.jsx(bC,{content:e,isLatestMessage:d}),l.jsx(oC,{message:s,children:l.jsx("div",{className:Op(r?"submitting":"",c&&e.length?"result-streaming":"","markdown prose message-content dark:prose-invert light w-full break-words",t&&!i&&"whitespace-pre-wrap",t?"dark:text-gray-20":"dark:text-gray-100"),children:u})})},dk=({message:e})=>l.jsx(lk,{message:e,text:"The response is incomplete; it's either still processing, was cancelled, or censored. Refresh or try a different prompt."}),uk=n.memo(({text:e,edit:t,error:s,unfinished:a,isSubmitting:r,isLast:o,...i})=>{const{message:c}=i,{messageId:d}=c,{thinkingContent:u,regularContent:m}=n.useMemo(()=>{const t=e.match(/:::thinking([\s\S]*?):::/);return{thinkingContent:t?t[1].trim():"",regularContent:t?e.replace(/:::thinking[\s\S]*?:::/,"").trim():e}},[e]),p=n.useMemo(()=>o&&r,[o,r]),h=n.useMemo(()=>!r&&a?l.jsx(n.Suspense,{children:l.jsx(Tj,{delay:250,children:l.jsx(dk,{message:c})})}):null,[r,a,c]);return s?l.jsx(lk,{message:i.message,text:e}):t?l.jsx(ik,{text:e,isSubmitting:r,...i}):l.jsxs(l.Fragment,{children:[u.length>0&&l.jsx(GN,{children:u},`thinking-${d}`),l.jsx(ck,{showCursor:p,text:m,...i},`display-${d}`),h]})});function mk({source:e,isNews:t,expanded:n=!1}){const s=zf(),a=Sw(e.link);return n?l.jsxs("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"flex w-full flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 hover:bg-surface-tertiary",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Tw,{domain:a}),l.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:a})]}),l.jsxs("div",{className:"mt-1",children:[l.jsx("span",{className:"line-clamp-2 text-sm font-medium text-text-primary md:line-clamp-3",children:e.title||e.link}),"snippet"in e&&e.snippet&&l.jsx("span",{className:"mt-1 line-clamp-2 text-xs text-text-secondary md:line-clamp-3",children:e.snippet})]})]}):l.jsx("span",{className:"not-prose relative inline-block h-full w-full",children:l.jsx(et,{showTimeout:150,hideTimeout:150,children:l.jsxs("div",{className:"flex h-full items-center",children:[l.jsx(tt,{render:l.jsxs("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"flex h-full w-full flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 hover:bg-surface-tertiary",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Tw,{domain:a}),l.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:a})]}),l.jsx("div",{className:"mt-1",children:l.jsx("span",{className:"line-clamp-2 text-sm font-medium text-text-primary md:line-clamp-3",children:e.title||e.link})})]})}),l.jsxs(nt,{className:"absolute right-2 rounded-full text-text-primary focus:outline-none focus:ring-2 focus:ring-ring",children:[l.jsx(st,{children:s("com_citation_more_details",{label:a})}),l.jsx(at,{className:"icon-sm"})]}),l.jsx(rt,{gutter:16,className:"dark:shadow-lg-dark z-[999] w-[300px] max-w-[calc(100vw-2rem)] rounded-xl border border-border-medium bg-surface-secondary p-3 text-text-primary shadow-lg",portal:!0,unmountOnHide:!0,children:l.jsxs("div",{className:"flex gap-3",children:[l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"mb-2 flex items-center",children:[l.jsx(Tw,{domain:a,className:"mr-2"}),l.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"line-clamp-2 cursor-pointer overflow-hidden text-sm font-bold text-[#0066cc] hover:underline dark:text-blue-400 md:line-clamp-3",children:e.attribution||a})]}),l.jsx("h4",{className:"mb-1.5 mt-0 text-xs text-text-primary md:text-sm",children:e.title||e.link}),"snippet"in e&&e.snippet&&l.jsx("span",{className:"my-2 text-ellipsis break-all text-xs text-text-secondary md:text-sm",children:e.snippet})]}),"imageUrl"in e&&e.imageUrl&&l.jsx("div",{className:"h-24 w-24 flex-shrink-0 overflow-hidden rounded-md",children:l.jsx("img",{src:e.imageUrl,alt:e.title||s("com_sources_image_alt"),className:"h-full w-full object-cover"})})]})})]})})})}function pk({image:e}){const t=zf();return l.jsx("a",{href:e.imageUrl,target:"_blank",rel:"noopener noreferrer",className:"group overflow-hidden rounded-lg bg-surface-secondary transition-all duration-300 hover:bg-surface-tertiary",children:e.imageUrl&&l.jsxs("div",{className:"relative aspect-square w-full overflow-hidden",children:[l.jsx("img",{src:e.imageUrl,alt:e.title||t("com_sources_image_alt"),className:"size-full object-cover"}),e.title&&l.jsx("div",{className:"absolute bottom-0 left-0 right-0 w-full border-none bg-gray-900/80 p-1 text-xs font-medium text-white backdrop-blur-sm",children:l.jsx("span",{className:"truncate",children:e.title})})]})})}function hk({sources:e,start:t=0,end:n=3}){let s=[t,n];return t<0&&(s=[t]),l.jsx("div",{className:"relative flex",children:e.slice(...s).map((e,t)=>l.jsx(Tw,{domain:Sw(e.link),className:t>0?"ml-[-6px]":""},`icon-${t}`))})}function xk({sources:e,limit:t=3}){const n=zf(),s=e.slice(0,t),a=e.slice(t),r=a.length>0;return l.jsx("div",{className:"scrollbar-none grid w-full grid-cols-4 gap-2 overflow-x-auto",children:l.jsxs(A_,{children:[s.map((e,t)=>l.jsx("div",{className:"w-full min-w-[120px]",children:l.jsx(mk,{source:e})},`source-${t}`)),r&&l.jsx(O_,{className:"flex flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 hover:bg-surface-tertiary",children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(hk,{sources:a}),l.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:n("com_sources_more_sources",{count:a.length})})]})}),l.jsxs(V_,{className:"flex max-h-[80vh] max-w-full flex-col overflow-hidden rounded-lg bg-surface-primary p-0 md:max-w-[600px]",children:[l.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-border-light bg-surface-primary px-3 py-2",children:[l.jsx(U_,{className:"text-base font-medium",children:n("com_sources_title")}),l.jsx(z_,{className:"rounded-full p-1 text-text-secondary hover:bg-surface-tertiary hover:text-text-primary","aria-label":n("com_ui_close"),children:l.jsx(re,{className:"h-4 w-4"})})]}),l.jsx("div",{className:"flex-1 overflow-y-auto px-3 py-2",children:l.jsx("div",{className:"flex flex-col gap-2",children:[...s,...a].map((e,t)=>l.jsxs("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"flex gap-2 rounded-lg px-2 py-2 transition-colors hover:bg-surface-tertiary",children:[l.jsx(Tw,{domain:Sw(e.link),className:"h-5 w-5 flex-shrink-0"}),l.jsxs("div",{className:"min-w-0 flex-1",children:[l.jsx("h3",{className:"mb-0.5 truncate text-sm font-medium text-text-primary",children:e.title||e.link}),"snippet"in e&&e.snippet&&l.jsx("p",{className:"mb-1 line-clamp-2 text-xs text-text-secondary md:line-clamp-3",children:e.snippet}),l.jsx("span",{className:"text-xs text-text-secondary-alt",children:Sw(e.link)})]}),"imageUrl"in e&&e.imageUrl&&l.jsx("div",{className:"hidden h-12 w-12 flex-shrink-0 overflow-hidden rounded-md sm:block",children:l.jsx("img",{src:e.imageUrl,alt:e.title||n("com_sources_image_alt"),className:"h-full w-full object-cover"})})]},`more-source-${t}`))})})]})]})})}function fk({label:e,icon:t}){return l.jsxs("div",{className:"flex items-center gap-2 rounded-md px-3 py-1 text-sm transition-colors hover:bg-surface-tertiary hover:text-text-primary",children:[m.cloneElement(t,{size:14}),l.jsx("span",{children:e})]})}function gk(){const e=zf(),{searchResults:t}=pv(),{organicSources:s,topStories:a,images:r,hasAnswerBox:o}=n.useMemo(()=>{if(!t)return{organicSources:[],topStories:[],images:[],hasAnswerBox:!1};const e=new Map,n=new Map,s=new Map;let a=!1;return Object.values(t).forEach(t=>{var r,o,i,l;t&&((null==(r=t.organic)?void 0:r.length)&&t.organic.forEach(t=>{t.link&&e.set(t.link,t)}),(null==(o=t.references)?void 0:o.length)&&t.references.forEach(t=>{"image"!==t.type?t.link&&e.set(t.link,t):s.set(t.link,{...t,imageUrl:t.link})}),(null==(i=t.topStories)?void 0:i.length)&&t.topStories.forEach(e=>{e.link&&n.set(e.link,e)}),(null==(l=t.images)?void 0:l.length)&&t.images.forEach(e=>{e.imageUrl&&s.set(e.imageUrl,e)}),t.answerBox&&(a=!0))}),{organicSources:Array.from(e.values()),topStories:Array.from(n.values()),images:Array.from(s.values()),hasAnswerBox:a}},[t]),i=n.useMemo(()=>{const t=[];return(s.length||a.length||o)&&t.push({label:l.jsx(fk,{label:e("com_sources_tab_all"),icon:l.jsx(Lt,{})}),content:l.jsx(xk,{sources:[...s,...a]})}),a.length&&t.push({label:l.jsx(fk,{label:e("com_sources_tab_news"),icon:l.jsx(At,{})}),content:l.jsx(xk,{sources:a,limit:3})}),r.length&&t.push({label:l.jsx(fk,{label:e("com_sources_tab_images"),icon:l.jsx(Ot,{})}),content:l.jsx("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5",children:r.map((e,t)=>l.jsx(pk,{image:e},`image-${t}`))})}),t},[s,a,r,o,e]);return i.length?l.jsx(e_,{tabs:i,containerClassName:"flex min-w-full mb-4",tabListClassName:"flex items-center mb-2 border-b border-border-light overflow-x-auto",tabPanelClassName:"w-full overflow-x-auto scrollbar-none md:mx-0 md:px-0",tabClassName:"flex items-center whitespace-nowrap text-xs font-medium text-token-text-secondary px-1 pt-2 pb-1 border-b-2 border-transparent data-[state=active]:text-text-primary outline-none"}):null}function vk({radius:e,circumference:t,offset:n}){return l.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",className:"absolute left-1/2 top-1/2 h-[23px] w-[23px] -translate-x-1/2 -translate-y-1/2 text-brand-purple",children:[l.jsx("circle",{className:"origin-[50%_50%] -rotate-90 stroke-brand-purple/25 dark:stroke-brand-purple/50",strokeWidth:"7.826086956521739",fill:"transparent",r:e,cx:"60",cy:"60"}),l.jsx("circle",{className:"origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]",stroke:"currentColor",strokeWidth:"7.826086956521739",strokeDasharray:`${t} ${t}`,strokeDashoffset:n,fill:"transparent",r:e,cx:"60",cy:"60"})]})}function bk({error:e,isSubmitting:t,progress:n,children:s}){return!t&&n<1||!0===e?l.jsx(ZN,{}):l.jsx(l.Fragment,{children:s})}function yk(){return l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20",width:"20",height:"20",style:{width:"100%",height:"100%",transform:"translate3d(0px, 0px, 0px)"},preserveAspectRatio:"xMidYMid meet",children:[l.jsxs("defs",{children:[l.jsx("clipPath",{id:"__lottie_element_258",children:l.jsx("rect",{width:"20",height:"20",x:"0",y:"0"})}),l.jsx("clipPath",{id:"__lottie_element_263",children:l.jsx("path",{d:"M0,0 L20000,0 L20000,20000 L0,20000z"})}),l.jsx("clipPath",{id:"__lottie_element_270",children:l.jsx("path",{d:"M0,0 L20000,0 L20000,20000 L0,20000z"})})]}),l.jsx("g",{clipPath:"url(#__lottie_element_258)",children:l.jsxs("g",{clipPath:"url(#__lottie_element_263)",style:{display:"block"},transform:"matrix(0.9999999403953552,0,0,0.9999999403953552,-10000,-10000)",opacity:"1",children:[l.jsxs("g",{clipPath:"url(#__lottie_element_270)",style:{display:"block"},transform:"matrix(0.9999988675117493,0,0,0.9999988675117493,10.01171875,10.01171875)",opacity:"1",children:[l.jsx("g",{style:{display:"block"},transform:"matrix(1,0,0,1,10000,10000)",opacity:"1",children:l.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,-3.25,-2.125)",children:l.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:" M0,0.75 C0,0.3357900083065033 0.3357900083065033,8.881784197001252e-16 0.75,8.881784197001252e-16 C2.4166667461395264,8.881784197001252e-16 4.083333492279053,8.881784197001252e-16 5.75,8.881784197001252e-16 C6.1641998291015625,8.881784197001252e-16 6.5,0.3357900083065033 6.5,0.75 C6.5,1.1642099618911743 6.1641998291015625,1.5 5.75,1.5 C4.083333492279053,1.5 2.4166667461395264,1.5 0.75,1.5 C0.3357900083065033,1.5 0,1.1642099618911743 0,0.75 C0,0.75 0,0.75 0,0.75 C0,0.75 0,0.75 0,0.75"})})}),l.jsx("g",{style:{display:"block"},transform:"matrix(1,0,0,1,10000,10000)",opacity:"1",children:l.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,-3.25,0.625)",children:l.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:" M0,0.75 C0,0.3357999920845032 0.3357900083065033,0 0.75,0 C1.9166666269302368,0 3.0833332538604736,0 4.25,0 C4.6641998291015625,0 5,0.3357999920845032 5,0.75 C5,1.164199948310852 4.6641998291015625,1.5 4.25,1.5 C3.0833332538604736,1.5 1.9166666269302368,1.5 0.75,1.5 C0.3357900083065033,1.5 0,1.164199948310852 0,0.75 C0,0.75 0,0.75 0,0.75 C0,0.75 0,0.75 0,0.75"})})})]}),l.jsx("g",{style:{display:"block"},transform:"matrix(1,0,0,1,10000,10000)",opacity:"1",children:l.jsxs("g",{opacity:"1",transform:"matrix(1,0,0,1,10,10)",children:[l.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:" M-3.13,-5.25 C-3.09,-5.25 -3.04,-5.25 -3,-5.25 C-2.59,-5.25 -2.25,-4.91 -2.25,-4.5 C-2.25,-4.09 -2.59,-3.75 -3,-3.75 C-3.03,-3.75 -3.07,-3.75 -3.1,-3.75 C-3.53,-3.75 -3.81,-3.75 -4.02,-3.73 C-4.23,-3.72 -4.3,-3.69 -4.34,-3.67 C-4.48,-3.6 -4.6,-3.48 -4.67,-3.34 C-4.69,-3.3 -4.72,-3.23 -4.73,-3.02 C-4.75,-2.81 -4.75,-2.53 -4.75,-2.1 C-4.75,-2.07 -4.75,-2.03 -4.75,-2 C-4.75,-1.59 -5.09,-1.25 -5.5,-1.25 C-5.91,-1.25 -6.25,-1.59 -6.25,-2 C-6.25,-2.04 -6.25,-2.09 -6.25,-2.13 C-6.25,-2.52 -6.25,-2.87 -6.23,-3.15 C-6.2,-3.44 -6.15,-3.74 -6,-4.02 C-5.79,-4.44 -5.44,-4.79 -5.02,-5 C-4.74,-5.15 -4.44,-5.2 -4.15,-5.23 C-3.87,-5.25 -3.52,-5.25 -3.13,-5.25 C-3.13,-5.25 -3.13,-5.25 -3.13,-5.25 C-3.13,-5.25 -3.13,-5.25 -3.13,-5.25 M6.25,-2.13 C6.25,-2.09 6.25,-2.04 6.25,-2 C6.25,-1.59 5.91,-1.25 5.5,-1.25 C5.09,-1.25 4.75,-1.59 4.75,-2 C4.75,-2.03 4.75,-2.07 4.75,-2.1 C4.75,-2.53 4.75,-2.81 4.73,-3.02 C4.72,-3.23 4.69,-3.3 4.67,-3.34 C4.6,-3.48 4.48,-3.6 4.34,-3.67 C4.3,-3.69 4.23,-3.72 4.02,-3.73 C3.81,-3.75 3.53,-3.75 3.1,-3.75 C3.07,-3.75 3.03,-3.75 3,-3.75 C2.59,-3.75 2.25,-4.09 2.25,-4.5 C2.25,-4.91 2.59,-5.25 3,-5.25 C3.04,-5.25 3.09,-5.25 3.13,-5.25 C3.52,-5.25 3.87,-5.25 4.15,-5.23 C4.44,-5.2 4.74,-5.15 5.02,-5 C5.44,-4.79 5.79,-4.44 6,-4.02 C6.15,-3.74 6.2,-3.44 6.23,-3.15 C6.25,-2.87 6.25,-2.52 6.25,-2.13 C6.25,-2.13 6.25,-2.13 6.25,-2.13 C6.25,-2.13 6.25,-2.13 6.25,-2.13 M-3.13,5.25 C-3.09,5.25 -3.04,5.25 -3,5.25 C-2.59,5.25 -2.25,4.91 -2.25,4.5 C-2.25,4.09 -2.59,3.75 -3,3.75 C-3.03,3.75 -3.07,3.75 -3.1,3.75 C-3.53,3.75 -3.81,3.75 -4.02,3.73 C-4.23,3.72 -4.3,3.69 -4.34,3.67 C-4.48,3.6 -4.6,3.48 -4.67,3.34 C-4.69,3.3 -4.72,3.23 -4.73,3.02 C-4.75,2.81 -4.75,2.53 -4.75,2.1 C-4.75,2.07 -4.75,2.03 -4.75,2 C-4.75,1.59 -5.09,1.25 -5.5,1.25 C-5.91,1.25 -6.25,1.59 -6.25,2 C-6.25,2.04 -6.25,2.09 -6.25,2.13 C-6.25,2.52 -6.25,2.87 -6.23,3.15 C-6.2,3.44 -6.15,3.74 -6,4.02 C-5.79,4.44 -5.44,4.79 -5.02,5 C-4.74,5.15 -4.44,5.2 -4.15,5.23 C-3.87,5.25 -3.52,5.25 -3.13,5.25 C-3.13,5.25 -3.13,5.25 -3.13,5.25 C-3.13,5.25 -3.13,5.25 -3.13,5.25 M6.25,2.13 C6.25,2.09 6.25,2.04 6.25,2 C6.25,1.59 5.91,1.25 5.5,1.25 C5.09,1.25 4.75,1.59 4.75,2 C4.75,2.03 4.75,2.07 4.75,2.1 C4.75,2.53 4.75,2.81 4.73,3.02 C4.72,3.23 4.69,3.3 4.67,3.34 C4.6,3.48 4.48,3.6 4.34,3.67 C4.3,3.69 4.23,3.72 4.02,3.73 C3.81,3.75 3.53,3.75 3.1,3.75 C3.07,3.75 3.03,3.75 3,3.75 C2.59,3.75 2.25,4.09 2.25,4.5 C2.25,4.91 2.59,5.25 3,5.25 C3.04,5.25 3.09,5.25 3.13,5.25 C3.52,5.25 3.87,5.25 4.15,5.23 C4.44,5.2 4.74,5.15 5.02,5 C5.44,4.79 5.79,4.44 6,4.02 C6.15,3.74 6.2,3.44 6.23,3.15 C6.25,2.87 6.25,2.52 6.25,2.13 C6.25,2.13 6.25,2.13 6.25,2.13 C6.25,2.13 6.25,2.13 6.25,2.13"}),l.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,-6.250000476837158,-5.250000476837158)",children:l.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:"M0 0"})}),l.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,2.25,-5.250000476837158)",children:l.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:"M0 0"})}),l.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,-6.250000476837158,1.25)",children:l.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:"M0 0"})}),l.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,2.25,1.25)",children:l.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:"M0 0"})})]})})]})})]})}function _k({initialProgress:e=.1,isSubmitting:t}){const n=ab(e),s=56.08695652173913,a=2*Math.PI*s,r=a-n*a,o=n>=2;return l.jsxs("div",{className:"my-2.5 flex items-center gap-2.5",children:[l.jsx("div",{className:"relative h-5 w-5 shrink-0",children:n<1?l.jsx(bk,{progress:n,isSubmitting:t,error:o,children:l.jsxs("div",{className:"absolute left-0 top-0 flex h-full w-full items-center justify-center rounded-full bg-transparent text-white",style:{opacity:1,transform:"none"},children:[l.jsx("div",{children:l.jsx(yk,{})}),l.jsx(vk,{radius:s,circumference:a,offset:r})]})}):o?l.jsx(ZN,{}):l.jsx(JN,{})}),l.jsx(eC,{progress:n,onClick:()=>({}),inProgressText:"Searching my knowledge",finishedText:"Used Retrieval",hasInput:!1,popover:!1})]})}function jk({initialProgress:e=.1,code:t,outputs:s=[]}){const a=zf(),r=ab(e),o=_(sx.showCode),[i,c]=n.useState(o),d=s.reduce((e,t)=>t.logs?e+t.logs+"\n":e,"");return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"my-2.5 flex items-center gap-2.5",children:l.jsx(eC,{progress:r,onClick:()=>c(e=>!e),inProgressText:a("com_ui_analyzing"),finishedText:a("com_ui_analyzing_finished"),hasInput:!!t.length,isExpanded:i})}),i&&l.jsxs("div",{className:"code-analyze-block mb-3 mt-0.5 overflow-hidden rounded-xl bg-black",children:[l.jsx(AN,{content:t?`\`\`\`python\n${t}\n\`\`\``:""}),d&&l.jsxs("div",{className:"bg-gray-700 p-4 text-xs",children:[l.jsx("div",{className:"mb-1 text-gray-400",children:a("com_ui_result")}),l.jsx("div",{className:"prose flex flex-col-reverse text-white",style:{color:"white"},children:l.jsx("pre",{className:"shrink-0",children:d})})]})]})]})}function wk({initialProgress:e=.1,isSubmitting:t,isLast:s,output:a}){const r=zf(),{searchResults:o}=pv(),i="string"==typeof a&&a.toLowerCase().includes("error processing"),c=!t&&e<1||!0===i,d=!s&&1===e,u=t&&s&&1===e,m=n.useMemo(()=>{if(d&&!u)return[];if(!o)return[];const e=Object.values(o),t=e[e.length-1];return t?u?[...t.organic||[],...t.topStories||[]]:[...t.organic||[],...t.topStories||[]].filter(e=>!0===e.processed):[]},[o,d,u]),p=n.useMemo(()=>o?Object.values(o).length:0,[o]),h=n.useMemo(()=>Math.min(e,.99),[e]),x=m.length>0,f=n.useMemo(()=>{let e=p>1?"com_ui_web_searching_again":"com_ui_web_searching";return x&&(e="com_ui_web_search_processing"),u&&(e="com_ui_web_search_reading"),r(e)},[p,r,x,u]);return d||c?null:l.jsx(l.Fragment,{children:l.jsxs("div",{className:"relative my-2.5 flex size-5 shrink-0 items-center gap-2.5",children:[x&&l.jsx("div",{className:"mr-2",children:l.jsx(hk,{sources:m,start:-5})}),l.jsx(eC,{finishedText:"",hasInput:!1,error:c,isExpanded:!1,progress:h,inProgressText:f})]})})}function Nk({text:e,maxHeight:t=320}){return l.jsx("div",{className:"rounded-lg bg-surface-tertiary p-2 text-xs text-text-primary",style:{position:"relative",maxHeight:t,overflow:"auto"},children:l.jsx("pre",{className:"m-0 whitespace-pre-wrap break-words",style:{overflowWrap:"break-word"},children:l.jsx("code",{children:e})})})}function Ck({input:e,output:t,domain:n,function_name:s,pendingAuth:a}){const r=zf(),o=e=>{try{return JSON.stringify(JSON.parse(e),null,2)}catch{return e}};let i=null!=n&&n?r("com_assistants_domain_info",{0:n}):r("com_assistants_function_use",{0:s});return!0===a&&(i=null!=n&&n?r("com_assistants_action_attempt",{0:n}):r("com_assistants_attempt_info")),l.jsx("div",{className:"w-full p-2",children:l.jsxs("div",{style:{opacity:1},children:[l.jsx("div",{className:"mb-2 text-sm font-medium text-text-primary",children:i}),l.jsx("div",{children:l.jsx(Nk,{text:o(e),maxHeight:250})}),t&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"my-2 text-sm font-medium text-text-primary",children:r("com_ui_result")}),l.jsx("div",{children:l.jsx(Nk,{text:o(t),maxHeight:250})})]})]})})}function kk({initialProgress:e=.1,isSubmitting:t,name:s,args:a="",output:r,attachments:o,auth:i}){const c=zf(),[d,u]=n.useState(!1),m=n.useRef(null),[p,h]=n.useState(0),[x,f]=n.useState(!1),g=n.useRef(d),{function_name:v,domain:b,isMCPToolCall:y}=n.useMemo(()=>{if("string"!=typeof s)return{function_name:"",domain:null,isMCPToolCall:!1};if(s.includes(Zc.mcp_delimiter)){const[e,t]=s.split(Zc.mcp_delimiter);return{function_name:e||"",domain:t&&(t.replaceAll("---",".")||null),isMCPToolCall:!0}}const[e,t]=s.includes(ii)?s.split(ii):[s,""];return{function_name:e||"",domain:t&&(t.replaceAll("---",".")||null),isMCPToolCall:!1}},[s]),_="string"==typeof r&&r.toLowerCase().includes("error processing tool"),j=n.useMemo(()=>{if("string"==typeof a)return a;try{return JSON.stringify(a,null,2)}catch(e){return Dp.error("client/src/components/Chat/Messages/Content/ToolCall.tsx - Failed to stringify args",e),""}},[a]),w=n.useMemo(()=>((null==j?void 0:j.length)??0)>0||((null==r?void 0:r.length)??0)>0,[j,r]),N=n.useMemo(()=>{const e=i??"";if(!e)return"";try{return new URL(e).hostname}catch(t){return""}},[i]),C=ab(e),k=!t&&C<1||!0===_;return n.useLayoutEffect(()=>{if(d!==g.current){g.current=d,f(!0),d&&m.current?requestAnimationFrame(()=>{if(m.current){const e=m.current.scrollHeight;h(e+4)}}):h(0);const e=setTimeout(()=>{f(!1)},400);return()=>clearTimeout(e)}},[d]),n.useEffect(()=>{if(!m.current)return;const e=new ResizeObserver(e=>{if(d&&!x)for(const t of e)t.target===m.current&&h(t.contentRect.height+4)});return e.observe(m.current),()=>{e.disconnect()}},[d,x]),l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"relative my-2.5 flex h-5 shrink-0 items-center gap-2.5",children:l.jsx(eC,{progress:C,onClick:()=>u(e=>!e),inProgressText:v?c("com_assistants_running_var",{0:v}):c("com_assistants_running_action"),authText:!k&&N.length>0?c("com_ui_requires_auth"):void 0,finishedText:k?c("com_ui_cancelled"):!0===y?c("com_assistants_completed_function",{0:v}):null!=b&&b&&b.length!==Zc.ENCODED_DOMAIN_LENGTH?c("com_assistants_completed_action",{0:b}):c("com_assistants_completed_function",{0:v}),hasInput:w,isExpanded:d,error:k})}),l.jsx("div",{className:"relative",style:{height:d?p:0,overflow:"hidden",transition:"height 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)",opacity:d?1:0,transformOrigin:"top",willChange:"height, opacity",perspective:"1000px",backfaceVisibility:"hidden",WebkitFontSmoothing:"subpixel-antialiased"},children:l.jsx("div",{className:Op("overflow-hidden rounded-xl border border-border-light bg-surface-secondary shadow-md",d&&"shadow-lg"),style:{transform:d?"translateY(0) scale(1)":"translateY(-8px) scale(0.98)",opacity:d?1:0,transition:"transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)"},children:l.jsx("div",{ref:m,children:d&&w&&l.jsx(Ck,{input:j??"",output:r,domain:N||(b??""),function_name:v,pendingAuth:N.length>0&&!k&&C<1},"tool-call-info")})})}),null!=i&&i&&C<1&&!k&&l.jsxs("div",{className:"flex w-full flex-col gap-2.5",children:[l.jsx("div",{className:"mb-1 mt-2",children:l.jsx(c_,{className:"font-mediu inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm",variant:"default",rel:"noopener noreferrer",onClick:()=>window.open(i,"_blank","noopener,noreferrer"),children:c("com_ui_sign_in_to_domain",{0:N})})}),l.jsxs("p",{className:"flex items-center text-xs text-text-warning",children:[l.jsx(Dt,{className:"mr-1.5 inline-block h-4 w-4"}),c("com_assistants_allow_sites_you_trust")]})]}),o&&o.length>0&&l.jsx(MN,{attachments:o})]})}function Sk({initialProgress:e=.1,args:t=""}){const s=ab(e),a=56.08695652173913,r=2*Math.PI*a,o=r-s*r,[i,c]=n.useState(!1);return l.jsxs("div",{className:"my-2.5 flex items-center gap-2.5",children:[l.jsx("div",{className:"relative h-5 w-5 shrink-0",children:l.jsxs("div",{className:"absolute left-0 top-0 flex h-full w-full items-center justify-center rounded-full bg-transparent text-white",style:{opacity:1,transform:"none"},"data-projection-id":"106",children:[l.jsx("div",{children:l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20",width:"20",height:"20",style:{width:"100%",height:"100%",transform:"translate3d(0px, 0px, 0px)"},preserveAspectRatio:"xMidYMid meet",children:[l.jsx("g",{className:"move-up",children:l.jsx("path",{fill:"rgb(177,98,253)",fillOpacity:"1",d:"M11.812616,5.914505C11.535567,5.360465,10.744857,5.360465,10.467807,5.914505C9.369731,8.110632,8.271654,10.306758,7.173676,12.502885C6.923041,13.002725,7.286122,13.590845,7.844972,13.590845C10.041112,13.590845,12.237252,13.590845,14.433392,13.590845C14.992292,13.590845,15.355792,13.002725,15.105892,12.502885C14.007888,10.306758,12.909805,8.110632,11.812616,5.914505C11.812616,5.914505,11.812616,5.914505,11.812616,5.914505C11.812616,5.914505,11.812616,5.914505,11.812616,5.914505M7.216073,8.914505C6.939024,8.360465,6.148304,8.360465,5.871264,8.914505C5.274365,10.10828,4.677499,11.302055,4.080601,12.495835C3.83003,12.99568,4.193122,13.58379,4.751975,13.58379C5.946767,13.58379,7.14156,13.58379,8.336353,13.58379C8.895213,13.58379,9.258683,12.99568,9.008763,12.495835C8.411867,11.302055,7.81497,10.10828,7.216073,8.914505C7.216073,8.914505,7.216073,8.914505,7.216073,8.914505C7.216073,8.914505,7.216073,8.914505,7.216073,8.914505"})}),l.jsx("g",{style:{display:"block"},transform:"matrix(-1,0,0,-1,10,10)",opacity:"1",className:"moon-rise",children:l.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,3.75,5.5)",children:l.jsx("path",{fill:"rgb(177,98,253)",fillOpacity:"1",d:" M2.660290002822876,2.2502501010894775 C2.7567598819732666,2.2502501010894775 2.850860118865967,2.241950035095215 2.9425699710845947,2.225330114364624 C3.034290075302124,2.208709955215454 3.1081299781799316,2.1867599487304688 3.164109945297241,2.1594600677490234 C3.239150047302246,2.120300054550171 3.305850028991699,2.100709915161133 3.364219903945923,2.100709915161133 C3.405900001525879,2.100709915161133 3.438659906387329,2.113770008087158 3.462480068206787,2.1398799419403076 C3.487489938735962,2.165990114212036 3.5,2.2009999752044678 3.5,2.2449100017547607 C3.5,2.2698400020599365 3.4958300590515137,2.2983200550079346 3.487489938735962,2.3303699493408203 C3.4803500175476074,2.362410068511963 3.468440055847168,2.3968300819396973 3.4517600536346436,2.433619976043701 C3.3803000450134277,2.5950300693511963 3.287990093231201,2.7410099506378174 3.1748299598693848,2.871570110321045 C3.0628700256347656,3.002120018005371 2.9348299503326416,3.1142799854278564 2.790709972381592,3.2080399990081787 C2.646589994430542,3.3029799461364746 2.4905600547790527,3.375380039215088 2.3226099014282227,3.425230026245117 C2.15585994720459,3.4750800132751465 1.9825600385665894,3.5 1.8027100563049316,3.5 C1.5430500507354736,3.5 1.3036400079727173,3.4554901123046875 1.0844800472259521,3.3664801120758057 C0.8653200268745422,3.2786500453948975 0.6741499900817871,3.1540400981903076 0.5109699964523315,2.9926199913024902 C0.34898999333381653,2.831209897994995 0.22333000600337982,2.641319990158081 0.1340000033378601,2.4229400157928467 C0.04467000067234039,2.2045600414276123 0,1.9660099744796753 0,1.7072700262069702 C0,1.4639699459075928 0.04645000025629997,1.2325400114059448 0.1393599957227707,1.012969970703125 C0.23226000368595123,0.7922199964523315 0.3626900017261505,0.5975800156593323 0.5306299924850464,0.4290440082550049 C0.6997600197792053,0.2593249976634979 0.8968899846076965,0.12877200543880463 1.121999979019165,0.03738600015640259 C1.1541600227355957,0.024329999461770058 1.1833399534225464,0.01483600027859211 1.2095500230789185,0.008901000022888184 C1.2369400262832642,0.0029670000076293945 1.2631399631500244,2.220446049250313e-16 1.288159966468811,2.220446049250313e-16 C1.335800051689148,2.220446049250313e-16 1.3733199834823608,0.014241999946534634 1.4007099866867065,0.042725998908281326 C1.4292999505996704,0.07121100276708603 1.4435900449752808,0.10681600123643875 1.4435900449752808,0.14954200387001038 C1.4435900449752808,0.1780260056257248 1.438230037689209,0.2076980024576187 1.4275100231170654,0.23855499923229218 C1.41798996925354,0.2682270109653473 1.404289960861206,0.2996779978275299 1.3864200115203857,0.3329089879989624 C1.3625999689102173,0.3768230080604553 1.3423500061035156,0.4302310049533844 1.3256800174713135,0.493133008480072 C1.309000015258789,0.5548499822616577 1.296489953994751,0.6225000023841858 1.288159966468811,0.6960800290107727 C1.2798199653625488,0.7684800028800964 1.2756500244140625,0.8414700031280518 1.2756500244140625,0.9150599837303162 C1.2756500244140625,1.1215699911117554 1.3072099685668945,1.3073099851608276 1.3703399896621704,1.4722800254821777 C1.4346599578857422,1.6372499465942383 1.5269700288772583,1.7778899669647217 1.6472699642181396,1.8941999673843384 C1.7675700187683105,2.0093300342559814 1.9128799438476562,2.097749948501587 2.083209991455078,2.1594600677490234 C2.2547199726104736,2.2199900150299072 2.44707989692688,2.2502501010894775 2.660290002822876,2.2502501010894775 C2.660290002822876,2.2502501010894775 2.660290002822876,2.2502501010894775 2.660290002822876,2.2502501010894775 C2.660290002822876,2.2502501010894775 2.660290002822876,2.2502501010894775 2.660290002822876,2.2502501010894775"})})})]})}),l.jsx(vk,{radius:a,circumference:r,offset:o})]})}),l.jsx(eC,{progress:s,onClick:()=>c(e=>!e),inProgressText:"Creating Image",finishedText:"Finished.",hasInput:!1})]})}const Tk=n.memo(({part:e,isSubmitting:t,attachments:n,isLast:s,showCursor:a,isCreatedByUser:r})=>{var o,i;if(!e)return null;if(e.type===td.ERROR)return l.jsx(lk,{text:e[td.ERROR]??("string"==typeof e[td.TEXT]?e[td.TEXT]:null==(o=e.text)?void 0:o.value)??"",className:"my-2"});if(e.type===td.AGENT_UPDATE)return l.jsxs(l.Fragment,{children:[l.jsx(aC,{currentAgentId:null==(i=e[td.AGENT_UPDATE])?void 0:i.agentId}),s&&a&&l.jsx(oC,{children:l.jsx(qN,{})})]});if(e.type===td.TEXT){const t="string"==typeof e.text?e.text:e.text.value;return"string"!=typeof t?null:null==e.tool_call_ids||t?l.jsx(oC,{children:l.jsx(ON,{text:t,isCreatedByUser:r,showCursor:a})}):null}if(e.type===td.THINK){const t="string"==typeof e.think?e.think:e.think.value;return"string"!=typeof t?null:l.jsx(WN,{reasoning:t})}if(e.type===td.TOOL_CALL){const o=e[td.TOOL_CALL];if(!o)return null;const i="args"in o&&(!o.type||o.type===sd.TOOL_CALL);if(i&&o.name===ri.execute_code)return l.jsx(nC,{args:"string"==typeof o.args?o.args:"",output:o.output??"",initialProgress:o.progress??.1,attachments:n});if(i&&("image_gen_oai"===o.name||"image_edit_oai"===o.name))return l.jsx(LN,{initialProgress:o.progress??.1,isSubmitting:t,toolName:o.name,args:"string"==typeof o.args?o.args:"",output:o.output??"",attachments:n});if(i&&o.name===ri.web_search)return l.jsx(wk,{output:o.output??"",initialProgress:o.progress??.1,isSubmitting:t,attachments:n,isLast:s});if(i)return l.jsx(kk,{args:o.args??"",name:o.name||"",output:o.output??"",initialProgress:o.progress??.1,isSubmitting:t,attachments:n,auth:o.auth,expires_at:o.expires_at});if(o.type===sd.CODE_INTERPRETER){const e=o[sd.CODE_INTERPRETER];return l.jsx(jk,{initialProgress:o.progress??.1,code:e.input,outputs:e.outputs??[]})}if(o.type===sd.RETRIEVAL||o.type===sd.FILE_SEARCH)return l.jsx(_k,{initialProgress:o.progress??.1,isSubmitting:t});if(o.type===sd.FUNCTION&&sd.FUNCTION in o&&Uc.has(o.function.name))return l.jsx(Sk,{initialProgress:o.progress??.1,args:o.function.arguments});if(o.type===sd.FUNCTION&&sd.FUNCTION in o)return Mi(o)?t&&a?l.jsx(oC,{children:l.jsx(ON,{text:"",isCreatedByUser:r,showCursor:a})}):null:l.jsx(kk,{initialProgress:o.progress??.1,isSubmitting:t,args:o.function.arguments,name:o.function.name,output:o.function.output})}else if(e.type===td.IMAGE_FILE){const t=e[td.IMAGE_FILE],n=t.height??1920,s=t.width??1080;return l.jsx(SN,{imagePath:t.filepath,height:n,width:s,altText:t.filename??"Uploaded Image",placeholderDimensions:{height:n+"px",width:s+"px"}})}return null}),Rk=({message:e,attachments:t,searchResults:s})=>{const a=_(sx.enableUserMsgMarkdown),{messageId:r}=e,o=n.useMemo(()=>qo(t??[]),[t]);return Array.isArray(e.content)&&e.content.length>0?l.jsxs(mv.Provider,{value:{searchResults:s},children:[l.jsx(gk,{}),e.content.filter(e=>e).map((t,n)=>{var s;if(!t)return null;const a=(null==(s=null==t?void 0:t[td.TOOL_CALL])?void 0:s.id)??"",i=o[a];return l.jsx(Tk,{showCursor:!1,isSubmitting:!1,isCreatedByUser:e.isCreatedByUser,attachments:i,part:t},`display-${r}-${n}`)}),!0===e.unfinished&&l.jsx(n.Suspense,{children:l.jsx(Tj,{delay:250,children:l.jsx(dk,{message:e},`unfinished-${r}`)})})]}):l.jsx("div",{className:Op("markdown prose dark:prose-invert light w-full break-words",e.isCreatedByUser&&!a&&"whitespace-pre-wrap",e.isCreatedByUser?"dark:text-gray-20":"dark:text-gray-70"),dir:"auto",children:l.jsx(AN,{content:e.text||""})})};function Ik({siblingIdx:e,siblingCount:t,setSiblingIdx:n}){if(void 0===e)return null;if(void 0===t)return null;const s=Op("hover-button rounded-lg p-1.5 text-text-secondary-alt transition-colors duration-200","hover:text-text-primary hover:bg-surface-hover","md:group-hover:visible md:group-focus-within:visible md:group-[.final-completion]:visible","focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white focus-visible:outline-none");return t>1?l.jsxs("nav",{className:"visible flex items-center justify-center gap-2 self-center pt-0 text-xs","aria-label":"Sibling message navigation",children:[l.jsx("button",{className:s,type:"button",onClick:()=>{n&&n(e-1)},disabled:0==e,"aria-label":"Previous sibling message","aria-disabled":0==e,children:l.jsx(zt,{size:"19","aria-hidden":"true"})}),l.jsxs("span",{className:"flex-shrink-0 flex-grow tabular-nums","aria-live":"polite","aria-atomic":"true",role:"status",children:[e+1," / ",t]}),l.jsx("button",{className:s,type:"button",onClick:()=>{n&&n(e+1)},disabled:e==t-1,"aria-label":"Next sibling message","aria-disabled":e==t-1,children:l.jsx(te,{size:"19","aria-hidden":"true"})})]}):null}function Ek(e){var t;let n="";for(let s=0;s<e.length;s++){n+=ti(`${(null==(t=e[s])?void 0:t.inputStr)??e[s]}`),e.length>1&&s!==e.length-1&&(n+=",\n")}return n}const Mk=n.memo(({plugin:e})=>{const{isSharedConvo:t}=n.useContext($g),{data:s={}}=kx({enabled:!t,select:e=>{var t;return null==(t=null==e?void 0:e.gptPlugins)?void 0:t.plugins}}),a=n.useCallback(e=>e?"n/a"===e||"self reflection"===e?e:s[e]??"self reflection":null,[s]);if(!e||!e.latest)return null;const r=a(e.latest);if(!r||r&&"n/a"===r)return null;return l.jsx("div",{className:"my-2 flex flex-col items-start",children:l.jsx(bo,{children:({open:t})=>{const n={className:Op(t?"rotate-180 transform":"","h-4 w-4")};return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:Op(e.loading?"bg-gray-100":"bg-gray-20","my-1 flex items-center rounded p-3 text-xs text-gray-800"),children:[l.jsx("div",{children:l.jsx("div",{className:"flex items-center gap-3",children:l.jsx("div",{children:e.loading||"self reflection"!==r?"self reflection"===r?"I'm  thinking...":l.jsxs(l.Fragment,{children:[e.loading?"Using":"Used"," ",l.jsx("b",{children:r}),e.loading?"...":""]}):"Finished"})})}),e.loading&&l.jsx(Gb,{className:"ml-1 text-black"}),l.jsx(yo,{className:"ml-12 flex items-center gap-2",children:l.jsx(at,{...n})})]}),l.jsxs(_o,{className:"mt-3 flex max-w-full flex-col gap-3",children:[l.jsx(uC,{lang:r?`REQUEST TO ${r.toUpperCase()}`:"REQUEST",codeChildren:Ek(e.inputs??[]),plugin:!0,classProp:"max-h-[450px]"}),e.outputs&&e.outputs.length>0&&l.jsx(uC,{lang:r?`RESPONSE FROM ${r.toUpperCase()}`:"RESPONSE",codeChildren:ti(e.outputs??""),plugin:!0,classProp:"max-h-[450px]"})]})]})}})})});function Pk({children:e,classes:t="",onClick:n}){return l.jsx("div",{className:Op("mt-1 flex justify-start gap-3 empty:hidden lg:flex",t),onClick:n,children:e})}function Lk(e){const t=_(sx.fontSize),{message:n,siblingIdx:s,siblingCount:a,conversation:r,setSiblingIdx:o,currentEditId:i,setCurrentEditId:c}=e,{attachments:d,searchResults:u}=rb({messageId:null==n?void 0:n.messageId,attachments:null==n?void 0:n.attachments});if(!n)return null;const{text:m="",children:p,error:h=!1,messageId:x="",unfinished:f=!1,isCreatedByUser:g=!0}=n;let v="";return v=g?"anonymous":n.sender??"",l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"text-token-text-primary w-full border-0 bg-transparent dark:border-0 dark:bg-transparent",children:l.jsx("div",{className:"m-auto justify-center p-4 py-2 md:gap-6",children:l.jsxs("div",{className:"final-completion group mx-auto flex flex-1 gap-3 md:max-w-[47rem] md:px-5 lg:px-1 xl:max-w-[55rem] xl:px-5",children:[l.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-end",children:l.jsx("div",{children:l.jsx("div",{className:"pt-0.5",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:l.jsx(sC,{message:n,conversation:r})})})})}),l.jsxs("div",{className:Op("relative flex w-11/12 flex-col",g?"":"agent-turn"),children:[l.jsx("div",{className:Op("select-none font-semibold",t),children:v}),l.jsx("div",{className:"flex-col gap-1 md:gap-3",children:l.jsx("div",{className:"flex max-w-full flex-grow flex-col gap-0",children:l.jsxs(Xg.Provider,{value:{messageId:x,isExpanded:!1,conversationId:null==r?void 0:r.conversationId},children:[n.plugin&&l.jsx(Mk,{plugin:n.plugin}),n.content?l.jsx(Rk,{message:n,attachments:d,searchResults:u}):l.jsx(uk,{edit:!1,error:h,isLast:!1,ask:()=>({}),text:m||"",message:n,isSubmitting:!1,enterEdit:()=>({}),unfinished:f,siblingIdx:s??0,isCreatedByUser:g,setSiblingIdx:o??(()=>({}))})]})})}),l.jsxs(Pk,{classes:"text-xs",children:[l.jsx(Ik,{siblingIdx:s,siblingCount:a,setSiblingIdx:o}),l.jsx(ak,{message:n,searchResults:u})]})]})]})})}),l.jsx(Ak,{messageId:x,messagesTree:p??[],currentEditId:i,setCurrentEditId:c},x)]})}function Ak({messageId:e,messagesTree:t,currentEditId:s,setCurrentEditId:a}){const[r,o]=b(sx.messagesSiblingIdxFamily(e));if(n.useEffect(()=>{o(0)},[null==t?void 0:t.length]),n.useEffect(()=>{null!=(null==t?void 0:t.length)&&r>=t.length&&o(0)},[r,null==t?void 0:t.length,o]),!t||!t.length)return null;const i=t[t.length-r-1];return i?l.jsx(Lk,{message:i,currentEditId:s,setCurrentEditId:a,siblingIdx:t.length-r-1,siblingCount:t.length,setSiblingIdx:e=>{o(((null==t?void 0:t.length)??0)-e-1)}},i.messageId):null}function Ok({messagesTree:e,conversationId:t}){const s=zf(),[a,r]=n.useState(-1);return l.jsx("div",{className:"flex-1 pb-[50px]",children:l.jsx("div",{className:"dark:gpt-dark-gray relative h-full",children:l.jsx("div",{style:{height:"100%",overflowY:"auto",width:"100%"},children:l.jsxs("div",{className:"flex flex-col pb-9 text-sm dark:bg-transparent",children:[e&&0==e.length||null===e?l.jsx("div",{className:"flex w-full items-center justify-center gap-1 bg-gray-50 p-3 text-sm text-gray-500 dark:border-gray-800/50 dark:bg-gray-800 dark:text-gray-300",children:s("com_ui_nothing_found")}):l.jsx(l.Fragment,{children:l.jsx("div",{children:l.jsx(Ak,{messagesTree:e,messageId:t??null,setCurrentEditId:r,currentEditId:a??null},t)})}),l.jsx("div",{className:"dark:gpt-dark-gray group h-0 w-full flex-shrink-0 dark:border-gray-800/50"})]})})})})}function Dk({className:e}){var t,s;const{data:a}=Sx(),r=zf(),o=null==(t=null==a?void 0:a.interface)?void 0:t.privacyPolicy,i=null==(s=null==a?void 0:a.interface)?void 0:s.termsOfService,c=null!=(null==o?void 0:o.externalUrl)&&l.jsx("a",{className:"text-text-secondary underline",href:o.externalUrl,target:!0===o.openNewTab?"_blank":void 0,rel:"noreferrer",children:r("com_ui_privacy_policy")}),d=null!=(null==i?void 0:i.externalUrl)&&l.jsx("a",{className:"text-text-secondary underline",href:i.externalUrl,target:!0===i.openNewTab?"_blank":void 0,rel:"noreferrer",children:r("com_ui_terms_of_service")}),u=("string"==typeof(null==a?void 0:a.customFooter)?a.customFooter:"[Hanzo Chat "+Zc.VERSION+"](https://hanzo.ai) - "+r("com_ui_latest_footer")).split("|");n.useEffect(()=>{if(null!=(null==a?void 0:a.analyticsGtmId)&&void 0===window.google_tag_manager){const e={gtmId:a.analyticsGtmId};T.initialize(e)}},[null==a?void 0:a.analyticsGtmId]);const p=[...u.map((e,t)=>l.jsx(m.Fragment,{children:l.jsx(so,{components:{a:({node:e,href:t,children:n,...s})=>l.jsx("a",{className:"text-text-secondary underline",href:t,target:"_blank",rel:"noreferrer",...s,children:n}),p:({node:e,...t})=>l.jsx("span",{...t})},children:e.trim()})},`main-content-part-${t}`)),c,d].filter(Boolean);return l.jsx("div",{className:"relative w-full",children:l.jsx("div",{className:e??"absolute bottom-0 left-0 right-0 hidden items-center justify-center gap-2 px-2 py-2 text-center text-xs text-text-primary sm:flex md:px-[60px]",role:"contentinfo",children:p.map((e,t)=>{const n=t===p.length-1;return l.jsxs(m.Fragment,{children:[e,!n&&l.jsx("div",{className:"h-2 border-r-[1px] border-border-medium"},`separator-${t}`)]},`footer-element-${t}`)})})})}const zk=n.memo(function(){const e=zf(),{data:t}=Sx(),{shareId:s}=M(),{data:a,isLoading:r}=Uf(s??""),o=a&&zp({messages:a.messages}),i=0===(null==o?void 0:o.length)?null:o??null;let c="";var d;let u;return c=null!=(null==t?void 0:t.appTitle)&&null!=(null==a?void 0:a.title)?`${a.title} | ${t.appTitle}`:(null==a?void 0:a.title)??(null==t?void 0:t.appTitle)??document.title,d=c,n.useEffect(()=>{document.title=d},[d]),u=r?l.jsx("div",{className:"flex h-screen items-center justify-center",children:l.jsx(Gb,{className:""})}):a&&i&&0!==i.length?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"final-completion group mx-auto flex min-w-[40rem] flex-col gap-3 pb-6 pt-4 md:max-w-[47rem] md:px-5 lg:px-1 xl:max-w-[55rem] xl:px-5",children:[l.jsx("h1",{className:"text-4xl font-bold",children:a.title}),l.jsx("div",{className:"border-b border-border-medium pb-6 text-base text-text-secondary",children:new Date(a.createdAt).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),l.jsx(Ok,{messagesTree:i,conversationId:a.conversationId})]}):l.jsx("div",{className:"flex h-screen items-center justify-center",children:e("com_ui_shared_link_not_found")}),l.jsx($g.Provider,{value:{isSharedConvo:!0},children:l.jsx("main",{className:"relative flex w-full grow overflow-hidden dark:bg-surface-secondary",style:{paddingBottom:"50px"},children:l.jsx("div",{className:"transition-width relative flex h-full w-full flex-1 flex-col items-stretch overflow-hidden pt-0 dark:bg-surface-secondary",children:l.jsxs("div",{className:"flex h-full flex-col text-text-primary",role:"presentation",children:[u,l.jsx("div",{className:"w-full border-t-0 pl-0 pt-2 md:w-[calc(100%-.5rem)] md:border-t-0 md:border-transparent md:pl-0 md:pt-0 md:dark:border-transparent",children:l.jsx(Dk,{className:"fixed bottom-0 left-0 right-0 z-50 flex items-center justify-center gap-2 bg-gradient-to-t from-surface-secondary to-transparent px-2 pb-2 pt-8 text-xs text-text-secondary md:px-[60px]"})})]})})})})});function Fk(){return l.jsx(zk,{})}const Vk=()=>{const{conversation:e}=rg(),t=cg(),s=sv(),{data:a}=kx(),r=n.useMemo(()=>{let t=(null==e?void 0:e.endpoint)??"";return[vi.chatGPTBrowser,vi.azureOpenAI,vi.gptPlugins].includes(t)&&(t=vi.openAI),wp({endpointsConfig:a,iconURL:null==e?void 0:e.iconURL,endpoint:t})},[null==e?void 0:e.endpoint,null==e?void 0:e.iconURL,a]),{data:o=new Map}=nf(r,{select:e=>new Map(e.map(e=>[e.assistant_id,e]))}),{entity:i,isAgent:c}=Cp({endpoint:r,agentsMap:t,assistantMap:s,agent_id:null==e?void 0:e.agent_id,assistant_id:null==e?void 0:e.assistant_id}),d=n.useMemo(()=>{var e,t;return(null==(e=null==i?void 0:i.conversation_starters)?void 0:e.length)?i.conversation_starters:c?[]:(null==(t=o.get((null==i?void 0:i.id)??""))?void 0:t.conversation_starters)??[]},[o,c,i]),{submitMessage:u}=Wv(),m=n.useCallback(e=>u({text:e}),[u]);return d.length?l.jsx("div",{className:"mt-8 flex flex-wrap justify-center gap-3 px-4",children:d.slice(0,Zc.MAX_CONVO_STARTERS).map((e,t)=>l.jsx("button",{onClick:()=>m(e),className:"relative flex w-40 cursor-pointer flex-col gap-2 rounded-2xl border border-border-medium px-3 pb-4 pt-3 text-start align-top text-[15px] shadow-[0_0_2px_0_rgba(0,0,0,0.05),0_4px_6px_0_rgba(0,0,0,0.02)] transition-colors duration-300 ease-in-out fade-in hover:bg-surface-tertiary",children:l.jsx("p",{className:"break-word line-clamp-3 overflow-hidden text-balance break-all text-text-secondary",children:e})},t))}):null};function $k({scrollHandler:e}){return l.jsx("button",{onClick:e,className:"premium-scroll-button absolute bottom-5 right-1/2 cursor-pointer border border-border-light bg-surface-secondary","aria-label":"Scroll to bottom",children:l.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",className:"text-text-secondary",children:l.jsx("path",{d:"M17 13L12 18L7 13M12 6L12 17",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})}function Bk({memoryArtifacts:e}){const t=zf();if(0===e.length)return null;const n=e.filter(e=>"update"===e.type),s=e.filter(e=>"delete"===e.type);return 0===n.length&&0===s.length?null:l.jsxs("div",{className:"space-y-4 p-4",children:[n.length>0&&l.jsxs("div",{children:[l.jsx("h4",{className:"mb-2 text-sm font-semibold text-text-primary",children:t("com_ui_memory_updated_items")}),l.jsx("div",{className:"space-y-2",children:n.map((e,t)=>l.jsxs("div",{className:"rounded-lg p-3",children:[l.jsx("div",{className:"mb-1 text-xs font-medium uppercase tracking-wide text-text-secondary",children:e.key}),l.jsx("div",{className:"whitespace-pre-wrap text-sm text-text-primary",children:e.value})]},`update-${t}`))})]}),s.length>0&&l.jsxs("div",{children:[l.jsx("h4",{className:"mb-2 text-sm font-semibold text-text-primary",children:t("com_ui_memory_deleted_items")}),l.jsx("div",{className:"space-y-2",children:s.map((e,n)=>l.jsxs("div",{className:"rounded-lg p-3 opacity-60",children:[l.jsx("div",{className:"mb-1 text-xs font-medium uppercase tracking-wide text-text-secondary",children:e.key}),l.jsx("div",{className:"text-sm italic text-text-secondary",children:t("com_ui_memory_deleted")})]},`delete-${n}`))})]})]})}function Uk({attachments:e}){const t=zf(),[s,a]=n.useState(!1),r=n.useRef(null),[o,i]=n.useState(0),[c,d]=n.useState(!1),u=n.useRef(s),m=n.useMemo(()=>{const t=[];for(const n of e??[])null!=(null==n?void 0:n[ri.memory])&&t.push(n[ri.memory]);return t},[e]);return n.useLayoutEffect(()=>{if(s!==u.current){u.current=s,d(!0),s&&r.current?requestAnimationFrame(()=>{if(r.current){const e=r.current.scrollHeight;i(e+4)}}):i(0);const e=setTimeout(()=>{d(!1)},400);return()=>clearTimeout(e)}},[s]),n.useEffect(()=>{if(!r.current)return;const e=new ResizeObserver(e=>{if(s&&!c)for(const t of e)t.target===r.current&&i(t.contentRect.height+4)});return e.observe(r.current),()=>{e.disconnect()}},[s,c]),m&&0!==m.length?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"flex items-center",children:l.jsx("div",{className:"inline-block",children:l.jsxs("button",{className:"outline-hidden my-1 flex items-center gap-1 text-sm font-semibold text-text-secondary-alt transition-colors hover:text-text-primary",type:"button",onClick:()=>a(e=>!e),"aria-expanded":s,"aria-label":t("com_ui_memory_updated"),children:[l.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"mb-[-1px]",children:[l.jsx("path",{d:"M6 3C4.89543 3 4 3.89543 4 5V13C4 14.1046 4.89543 15 6 15L6 3Z",fill:"currentColor"}),l.jsx("path",{d:"M7 3V15H8.18037L8.4899 13.4523C8.54798 13.1619 8.69071 12.8952 8.90012 12.6858L12.2931 9.29289C12.7644 8.82153 13.3822 8.58583 14 8.58578V3.5C14 3.22386 13.7761 3 13.5 3H7Z",fill:"currentColor"}),l.jsx("path",{d:"M11.3512 15.5297L9.73505 15.8529C9.38519 15.9229 9.07673 15.6144 9.14671 15.2646L9.46993 13.6484C9.48929 13.5517 9.53687 13.4628 9.60667 13.393L12.9996 10C13.5519 9.44771 14.4473 9.44771 14.9996 10C15.5519 10.5523 15.5519 11.4477 14.9996 12L11.6067 15.393C11.5369 15.4628 11.448 15.5103 11.3512 15.5297Z",fill:"currentColor"})]}),t("com_ui_memory_updated")]})})}),l.jsx("div",{className:"relative",style:{height:s?o:0,overflow:"hidden",transition:"height 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)",opacity:s?1:0,transformOrigin:"top",willChange:"height, opacity",perspective:"1000px",backfaceVisibility:"hidden",WebkitFontSmoothing:"subpixel-antialiased"},children:l.jsx("div",{className:Op("overflow-hidden rounded-xl border border-border-light bg-surface-primary-alt shadow-md",s&&"shadow-lg"),style:{transform:s?"translateY(0) scale(1)":"translateY(-8px) scale(0.98)",opacity:s?1:0,transition:"transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)"},children:l.jsx("div",{ref:r,children:s&&l.jsx(Bk,{memoryArtifacts:m},"memory-info")})})})]}):null}const Hk=n.memo(({content:e,messageId:t,conversationId:s,attachments:a,searchResults:r,isCreatedByUser:o,isLast:i,isSubmitting:c,edit:d,enterEdit:u,siblingIdx:m,setSiblingIdx:p})=>{const h=zf(),[x,f]=b(sx.showThinking),[g,v]=n.useState(x),y=n.useMemo(()=>qo(a??[]),[a]),_=n.useMemo(()=>{const t=(null==e?void 0:e.some(e=>(null==e?void 0:e.type)===td.THINK))??!1,n=(null==e?void 0:e.every(e=>{if((null==e?void 0:e.type)!==td.THINK)return!0;if("string"==typeof e.think){return e.think.replace(/<\/?think>/g,"").trim().length>0}return!1}))??!1;return t&&n},[e]);return e?!0===d&&u&&p?l.jsx(l.Fragment,{children:e.map((e,n)=>(null==e?void 0:e.type)!==td.TEXT||"string"!=typeof e.text?null:l.jsx(iC,{index:n,text:e.text,messageId:t,isSubmitting:c,enterEdit:u,siblingIdx:m??null,setSiblingIdx:p},`edit-${t}-${n}`))}):l.jsx(l.Fragment,{children:l.jsxs(mv.Provider,{value:{searchResults:r},children:[l.jsx(Uk,{attachments:a}),l.jsx(gk,{}),_&&l.jsx("div",{className:"mb-5",children:l.jsx(HN,{isExpanded:g,onClick:()=>v(e=>{const t=!e;return f(t),t}),label:h(c&&i?"com_ui_thinking":"com_ui_thoughts")})}),e.filter(e=>e).map((n,a)=>{var r,d;const u=(null==(r=null==n?void 0:n[td.TOOL_CALL])?void 0:r.id)??"",m=y[u];return l.jsx(Xg.Provider,{value:{messageId:t,isExpanded:g,conversationId:s,partIndex:a,nextType:null==(d=e[a+1])?void 0:d.type},children:l.jsx(Tk,{part:n,attachments:m,isSubmitting:c,isCreatedByUser:o,isLast:a===e.length-1,showCursor:a===e.length-1&&i},`part-${t}-${a}`)},`provider-${t}-${a}`)})]})}):null}),Kk=n.memo(({isCard:e})=>e?l.jsx("div",{className:"mt-1 h-[27px] bg-transparent"}):null),Gk={[Yc.DIRECT_PATH]:"com_ui_fork_visible",[Yc.INCLUDE_BRANCHES]:"com_ui_fork_branches",[Yc.TARGET_LEVEL]:"com_ui_fork_all_target",[Yc.DEFAULT]:"com_ui_fork_from_message"},Wk=l.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 20 20",fill:"currentColor",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"})}),qk=({children:e,setting:t,onClick:n,setActiveSetting:s,timeoutRef:a,hoverInfo:r,hoverTitle:o,hoverDescription:i,label:c})=>{const d=zf();return l.jsx(et,{placement:"right-start",children:l.jsxs("div",{className:"flex flex-col items-center",children:[l.jsx(tt,{render:l.jsxs(Gt,{onClick:()=>n(t),onMouseEnter:()=>{a.current&&(clearTimeout(a.current),a.current=null),s(Gk[t])},onMouseLeave:()=>{a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{s(Gk[Yc.DEFAULT])},175)},className:"mx-0.5 w-14 flex-1 rounded-xl border-2 border-border-medium bg-surface-secondary text-text-secondary transition duration-200 ease-in-out hover:bg-surface-hover hover:text-text-primary","aria-label":c,children:[e,l.jsx(st,{children:c})]})}),l.jsxs(nt,{className:"rounded-full text-text-secondary focus:outline-none focus:ring-2 focus:ring-ring",children:[l.jsx(st,{children:d("com_ui_fork_more_details_about",{0:c})}),Wk]}),(null!=r&&""!==r||null!=o&&""!==o||null!=i&&""!==i)&&l.jsx(rt,{gutter:16,shift:40,flip:!1,className:"z-[999] w-80 rounded-2xl border border-border-medium bg-surface-secondary p-4 text-text-primary shadow-md",portal:!0,unmountOnHide:!0,children:l.jsx("div",{className:"space-y-2",children:l.jsxs("p",{className:"flex flex-col gap-2 text-sm text-text-secondary",children:[r&&r,o&&l.jsx("span",{className:"flex flex-wrap gap-1 font-bold",children:o}),i&&i]})})})]})})},Qk=({id:e,checked:t,onToggle:n,labelKey:s,infoKey:a,showToastOnCheck:r=!1})=>{const o=zf(),{showToast:i}=Of();return l.jsxs(et,{placement:"right-start",children:[l.jsxs("div",{className:"flex items-center",children:[l.jsx("div",{className:"flex h-6 w-full select-none items-center justify-start rounded-md text-sm text-text-secondary hover:text-text-primary",children:l.jsx(tt,{render:l.jsxs("div",{children:[l.jsx(Wt,{id:e,checked:t,onChange:e=>{const t=e.target.checked;t&&r&&i({message:o("com_ui_fork_remember_checked"),status:"info"}),n(t)},className:"h-4 w-4 rounded-sm border border-primary ring-offset-background transition duration-300 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground","aria-label":o(s)}),l.jsx("label",{htmlFor:e,className:"ml-2 cursor-pointer",children:o(s)})]})})}),l.jsxs(nt,{className:"rounded-full text-text-secondary focus:outline-none focus:ring-2 focus:ring-ring",children:[l.jsx(st,{children:o(a)}),Wk]})]}),l.jsx(rt,{gutter:14,shift:40,flip:!1,className:"z-[999] w-80 rounded-2xl border border-border-medium bg-surface-secondary p-4 text-text-primary shadow-md",portal:!0,unmountOnHide:!0,children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:o(a)})})})]})};function Zk({messageId:e,conversationId:t,forkingSupported:s=!1,latestMessageId:a,isLast:r=!1}){const o=zf(),{showToast:i}=Of(),[c,d]=n.useState(!1),{navigateToConvo:u}=bv(),[m,p]=n.useState(!1),h=n.useRef(null),[x,f]=b(sx.forkSetting),[g,v]=n.useState(Gk.default),[y,_]=b(sx.splitAtTarget),[j,w]=b(sx.rememberDefaultFork),N=Ft({placement:"bottom"}),C=Op("hover-button rounded-lg p-1.5 text-text-secondary-alt transition-colors duration-200","hover:text-text-primary hover:bg-surface-hover","md:group-hover:visible md:group-focus-within:visible md:group-[.final-completion]:visible",!r&&"md:opacity-0 md:group-hover:opacity-100 md:group-focus-within:opacity-100","focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white focus-visible:outline-none",m&&"active text-text-primary bg-surface-hover"),k=(e=>{const t=Aa(),{onSuccess:n,...s}=e||{};return Oa(e=>yu(e),{onSuccess:(e,s,a)=>{if(!s.conversationId)return;const r=e.conversation,o=r.conversationId;o&&(t.setQueryData([Pd.conversation,o],r),tp(t,r),t.setQueryData([Pd.messages,o],e.messages),t.invalidateQueries({queryKey:[Pd.allConversations],refetchPage:(e,t)=>0===t}),null==n||n(e,s,a))},...s})})({onSuccess:e=>{u(e.conversation),i({message:o("com_ui_fork_success"),status:"success"})},onMutate:()=>{i({message:o("com_ui_fork_processing"),status:"info"})},onError:()=>{i({message:o("com_ui_fork_error"),status:"error"})}}),S=t??"";if(!s||!S||!e)return null;const T=t=>{c&&(w(!0),f(t)),k.mutate({messageId:e,conversationId:S,option:t,splitAtTarget:y,latestMessageId:a})},R=[{setting:Yc.DIRECT_PATH,label:o(Gk[Yc.DIRECT_PATH]),icon:l.jsx(Vt,{className:"h-full w-full rotate-90 p-2"}),hoverTitle:l.jsxs(l.Fragment,{children:[l.jsx(Vt,{className:"h-5 w-5 rotate-90"}),o(Gk[Yc.DIRECT_PATH])]}),hoverDescription:o("com_ui_fork_info_visible")},{setting:Yc.INCLUDE_BRANCHES,label:o(Gk[Yc.INCLUDE_BRANCHES]),icon:l.jsx($t,{className:"h-full w-full rotate-180 p-2"}),hoverTitle:l.jsxs(l.Fragment,{children:[l.jsx($t,{className:"h-4 w-4 rotate-180"}),o(Gk[Yc.INCLUDE_BRANCHES])]}),hoverDescription:o("com_ui_fork_info_branches")},{setting:Yc.TARGET_LEVEL,label:o(Gk[Yc.TARGET_LEVEL]),icon:l.jsx(Bt,{className:"h-full w-full p-2"}),hoverTitle:l.jsxs(l.Fragment,{children:[l.jsx(Bt,{className:"h-5 w-5"}),`${o(Gk[Yc.TARGET_LEVEL])} (${o("com_endpoint_default")})`]}),hoverDescription:o("com_ui_fork_info_target")}];return l.jsxs(l.Fragment,{children:[l.jsx(Ut,{store:N,render:l.jsx("button",{className:C,onClick:t=>{j?(t.preventDefault(),k.mutate({messageId:e,splitAtTarget:y,conversationId:S,option:x,latestMessageId:a})):(N.toggle(),p(N.getState().open))},type:"button","aria-label":o("com_ui_fork"),children:l.jsx(Ht,{size:"19"})})}),l.jsxs(Kt,{store:N,gutter:10,className:`popover-animate ${m?"open":""} flex w-60 flex-col gap-3 overflow-hidden rounded-2xl border border-border-medium bg-surface-secondary p-2 px-4 shadow-lg`,style:{outline:"none",pointerEvents:"auto",zIndex:50},portal:!0,unmountOnHide:!0,onClose:()=>p(!1),children:[l.jsxs("div",{className:"flex h-8 w-full items-center justify-center text-sm text-text-primary",children:[o(g),l.jsxs(et,{placement:"right-start",children:[l.jsxs("div",{className:"ml-auto flex h-6 w-6 items-center justify-center gap-1",children:[l.jsx(tt,{render:l.jsx("button",{className:"flex h-5 w-5 cursor-help items-center rounded-full text-text-secondary","aria-label":o("com_ui_fork_info_button_label"),children:l.jsx(_t,{})})}),l.jsxs(nt,{className:"rounded-full text-text-secondary focus:outline-none focus:ring-2 focus:ring-ring",children:[l.jsx(st,{children:o("com_ui_fork_more_info_options")}),Wk]})]}),l.jsx(rt,{gutter:19,shift:40,flip:!1,className:"z-[999] w-80 rounded-2xl border border-border-medium bg-surface-secondary p-4 text-text-primary shadow-md",portal:!0,unmountOnHide:!0,children:l.jsxs("div",{className:"flex flex-col gap-2 space-y-2 text-sm text-text-secondary",children:[l.jsx("span",{children:o("com_ui_fork_info_1")}),l.jsx("span",{children:o("com_ui_fork_info_2")}),l.jsx("span",{children:o("com_ui_fork_info_3",{0:o("com_ui_fork_split_target")})})]})})]})]}),l.jsx("div",{className:"flex h-full w-full items-center justify-center gap-1",children:R.map(e=>l.jsx(qk,{setActiveSetting:v,timeoutRef:h,onClick:T,setting:e.setting,label:e.label,hoverTitle:e.hoverTitle,hoverDescription:e.hoverDescription,children:e.icon},e.setting))}),l.jsx(Qk,{id:"split-target-checkbox",checked:y,onToggle:_,labelKey:"com_ui_fork_split_target",infoKey:"com_ui_fork_info_start"}),l.jsx(Qk,{id:"remember-checkbox",checked:c,onToggle:e=>{e&&i({message:o("com_ui_fork_remember_checked"),status:"info"}),d(e)},labelKey:"com_ui_fork_remember",infoKey:"com_ui_fork_info_remember",showToastOnCheck:!0})]})]})}function Jk({setShowDeleteDialog:e,conversationId:t,setMenuOpen:s,retainView:a,title:r}){const o=zf(),i=k(),c=Aa(),{showToast:d}=Of(),{newConversation:u}=Mg(),{conversationId:m}=M(),p=hf({onSuccess:()=>{e(!1),m!==t&&"new"!==m||(u(),i("/c/new",{replace:!0})),null==s||s(!1),a()},onError:()=>{d({message:o("com_ui_convo_delete_error"),severity:Wo.ERROR,showIcon:!0})}}),h=n.useCallback(()=>{var e,n;const s=c.getQueryData([Pd.messages,t]),a=null==(e=null==s?void 0:s[s.length-1])?void 0:e.thread_id,r=null==(n=null==s?void 0:s[s.length-1])?void 0:n.endpoint;p.mutate({conversationId:t,thread_id:a,endpoint:r,source:"button"})},[t,p,c]);return l.jsxs(V_,{title:o("com_ui_delete_confirm")+" "+r,className:"w-11/12 max-w-md",showCloseButton:!1,children:[l.jsx($_,{children:l.jsx(U_,{children:o("com_ui_delete_conversation")})}),l.jsxs("div",{children:[o("com_ui_delete_confirm")," ",l.jsx("strong",{children:r})," ?"]}),l.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[l.jsx(c_,{"aria-label":"cancel",variant:"outline",onClick:()=>e(!1),children:o("com_ui_cancel")}),l.jsx(c_,{variant:"destructive",onClick:h,disabled:p.isLoading,children:p.isLoading?l.jsx(Gb,{}):o("com_ui_delete")})]})]})}function Yk({conversationId:e,retainView:t,title:n,setMenuOpen:s,showDeleteDialog:a,setShowDeleteDialog:r,triggerRef:o}){return void 0===a||void 0===r?null:e?l.jsx(A_,{open:a,onOpenChange:r,triggerRef:o,children:l.jsx(Jk,{setShowDeleteDialog:r,conversationId:e,setMenuOpen:s,retainView:t,title:n})}):null}function Xk({share:e,conversationId:t,setShareDialogOpen:s,showQR:a,setShowQR:r,setSharedLink:o}){const i=zf(),{showToast:c}=Of(),[d,u]=n.useState(!1),m=(null==e?void 0:e.shareId)??"",{mutateAsync:p,isLoading:h}=(e=>{const t=Aa(),{onSuccess:n,...s}=e||{};return Oa(({conversationId:e})=>{if(!e)throw new Error("Conversation ID is required");return uu(e)},{onSuccess:(e,s,a)=>{t.setQueryData([Pd.sharedLinks,e.conversationId],e),null==n||n(e,s,a)},...s})})({onError:()=>{c({message:i("com_ui_share_error"),severity:Wo.ERROR,showIcon:!0})}}),{mutateAsync:x,isLoading:f}=(e=>{const t=Aa(),{onSuccess:n,...s}=e||{};return Oa(({shareId:e})=>{if(!e)throw new Error("Share ID is required");return mu(e)},{onSuccess:(e,s,a)=>{t.setQueryData([Pd.sharedLinks,e.conversationId],e),null==n||n(e,s,a)},...s})})({onError:()=>{c({message:i("com_ui_share_error"),severity:Wo.ERROR,showIcon:!0})}}),g=uf({onSuccess:async()=>{u(!1),s(!1)}}),v=n.useCallback(e=>`${window.location.protocol}//${window.location.host}/share/${e}`,[]);return l.jsx(l.Fragment,{children:l.jsxs("div",{className:"flex gap-2",children:[!m&&l.jsxs(c_,{disabled:h,variant:"submit",onClick:async()=>{const e=await p({conversationId:t}),n=v(e.shareId);o(n)},children:[!h&&i("com_ui_create_link"),h&&l.jsx(Gb,{className:"size-4"})]}),m&&l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(rj,{description:i("com_ui_refresh_link"),render:e=>l.jsx(c_,{...e,onClick:()=>(async()=>{if(!m)return;const e=await x({shareId:m}),t=v(e.shareId);o(t)})(),variant:"outline",disabled:f,children:f?l.jsx(Gb,{className:"size-4"}):l.jsx(qt,{className:"size-4"})})}),l.jsx(rj,{description:i(a?"com_ui_hide_qr":"com_ui_show_qr"),render:e=>l.jsx(c_,{...e,onClick:()=>r(!a),variant:"outline",children:l.jsx(Qt,{className:"size-4"})})}),l.jsx(rj,{description:i("com_ui_delete"),render:e=>l.jsx(c_,{...e,onClick:()=>u(!0),variant:"destructive",children:l.jsx(Et,{className:"size-4"})})})]}),l.jsx(A_,{open:d,onOpenChange:u,children:l.jsx(Oj,{showCloseButton:!1,title:i("com_ui_delete_shared_link"),className:"max-w-[450px]",main:l.jsx(l.Fragment,{children:l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsxs(L_,{htmlFor:"dialog-confirm-delete",className:"text-left text-sm font-medium",children:[i("com_ui_delete_confirm")," ",l.jsxs("strong",{children:['"',m,'"']})]})})})}),selection:{selectHandler:async()=>{if(m)try{await g.mutateAsync({shareId:m}),c({message:i("com_ui_shared_link_delete_success"),severity:Wo.SUCCESS})}catch(e){console.error("Failed to delete shared link:",e),c({message:i("com_ui_share_delete_error"),severity:Wo.ERROR})}},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 text-white",selectText:i("com_ui_delete")}})})]})})}function eS({conversationId:e,open:t,onOpenChange:s,triggerRef:a,children:r}){const o=zf(),[i,c]=n.useState(!1),[d,u]=n.useState(""),[m,p]=n.useState(!1),{data:h,isLoading:x}=((e,t)=>{const n=za();return Va([Pd.sharedLinks,e],()=>du(e),{enabled:!!e&&e!==Zc.NEW_CONVO&&e!==Zc.PENDING_CONVO,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,onSuccess:t=>{n.setQueryData([Pd.sharedLinks,e],{conversationId:t.conversationId,shareId:t.shareId})},...t})})(e),f=mb({text:d});n.useEffect(()=>{if(void 0!==(null==h?void 0:h.shareId)){const e=`${window.location.protocol}//${window.location.host}/share/${h.shareId}`;u(e)}},[h]);const g=!0===x?null:l.jsx(Xk,{share:h,conversationId:e,setShareDialogOpen:s,showQR:i,setShowQR:c,setSharedLink:u}),v=(null==h?void 0:h.shareId)??"";return l.jsxs(A_,{open:t,onOpenChange:s,triggerRef:a,children:[r,l.jsx(Oj,{buttons:g,showCloseButton:!0,showCancelButton:!1,title:o("com_ui_share_link_to_chat"),className:"max-w-[550px]",main:l.jsxs("div",{children:[l.jsx("div",{className:"h-full py-2 text-text-primary",children:!0===x?l.jsx(Gb,{className:"m-auto h-14 animate-spin"}):!0===(null==h?void 0:h.success)?o("com_ui_share_update_message"):o("com_ui_share_create_message")}),l.jsxs("div",{className:"relative items-center rounded-lg p-2",children:[i&&l.jsx("div",{className:"mb-4 flex flex-col items-center",children:l.jsx(no,{value:d,size:200,marginSize:2,className:"rounded-2xl"})}),v&&l.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-surface-secondary p-2",children:[l.jsx("div",{className:"flex-1 break-all text-sm text-text-secondary",children:d}),l.jsx(c_,{size:"sm",variant:"outline",onClick:()=>{m||f(p)},className:Op("shrink-0",m?"cursor-default":""),children:m?l.jsx(Zt,{className:"size-4"}):l.jsx(Jt,{className:"size-4"})})]})]})]})})]})}const tS=n.memo(function({conversationId:e,title:t,retainView:s,renameHandler:a,isPopoverActive:r,setIsPopoverActive:o,isActiveConvo:i}){const c=zf(),{index:d}=rg(),{data:u}=Sx(),{navigateToConvo:m}=bv(d),{showToast:p}=Of(),h=k(),{conversationId:x}=M(),{newConversation:f}=Mg(),g=n.useRef(null),v=n.useRef(null),[b,y]=n.useState(!1),[_,j]=n.useState(!1),w=df(),N=(e=>{const t=Aa(),{onSuccess:n,...s}=e??{};return Oa(e=>bu(e),{onSuccess:(e,s,a)=>{const r=e.conversation;(null==r?void 0:r.conversationId)&&(t.setQueryData([Pd.conversation,r.conversationId],r),tp(t,r),t.setQueryData([Pd.messages,r.conversationId],e.messages),t.invalidateQueries({queryKey:[Pd.allConversations],refetchPage:(e,t)=>0===t}),null==n||n(e,s,a))},...s})})({onSuccess:e=>{m(e.conversation),p({message:c("com_ui_duplication_success"),status:"success"}),o(!1)},onMutate:()=>{p({message:c("com_ui_duplication_processing"),status:"info"})},onError:()=>{p({message:c("com_ui_duplication_error"),status:"error"})}}),C=N.isLoading,S=w.isLoading,T=n.useCallback(()=>{y(!0)},[]),R=n.useCallback(()=>{j(!0)},[]),I=n.useCallback(async()=>{const t=e??"";t&&w.mutate({conversationId:t,isArchived:!0},{onSuccess:()=>{x!==t&&"new"!==x||(f(),h("/c/new",{replace:!0})),s(),o(!1)},onError:()=>{p({message:c("com_ui_archive_error"),severity:Wo.ERROR,showIcon:!0})}})},[e,x,w,h,f,s,o,p,c]),E=n.useCallback(()=>{N.mutate({conversationId:e??""})},[e,N]),P=n.useMemo(()=>[{label:c("com_ui_share"),onClick:T,icon:l.jsx(We,{className:"icon-sm mr-2 text-text-primary"}),show:u&&u.sharedLinksEnabled,hideOnClick:!1,ref:g,render:e=>l.jsx("button",{...e})},{label:c("com_ui_rename"),onClick:a,icon:l.jsx(Xe,{className:"icon-sm mr-2 text-text-primary"})},{label:c("com_ui_duplicate"),onClick:E,hideOnClick:!1,icon:C?l.jsx(Gb,{className:"size-4"}):l.jsx(Jt,{className:"icon-sm mr-2 text-text-primary"})},{label:c("com_ui_archive"),onClick:I,hideOnClick:!1,icon:S?l.jsx(Gb,{className:"size-4"}):l.jsx(Yt,{className:"icon-sm mr-2 text-text-primary"})},{label:c("com_ui_delete"),onClick:R,icon:l.jsx(Xt,{className:"icon-sm mr-2 text-text-primary"}),hideOnClick:!1,ref:v,render:e=>l.jsx("button",{...e})}],[c,T,u,a,E,C,I,S,R]),L=n.useId();return l.jsxs(l.Fragment,{children:[l.jsx(kj,{portal:!0,mountByState:!0,unmountOnHide:!0,preserveTabOrder:!0,isOpen:r,setIsOpen:o,trigger:l.jsx(Qe,{id:`conversation-menu-${e}`,"aria-label":c("com_nav_convo_menu_options"),className:Op("inline-flex h-7 w-7 items-center justify-center gap-2 rounded-md border-none p-0 text-sm font-medium ring-ring-primary transition-all duration-200 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:opacity-50",!0===i||r?"opacity-100":"opacity-0 focus:opacity-100 group-focus-within:opacity-100 group-hover:opacity-100 data-[open]:opacity-100"),onClick:e=>{e.stopPropagation()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||e.stopPropagation()},children:l.jsx(en,{className:"icon-md text-text-secondary","aria-hidden":!0})}),items:P,menuId:L,className:"z-30"}),b&&l.jsx(eS,{conversationId:e??"",open:b,onOpenChange:y,triggerRef:g}),_&&l.jsx(Yk,{title:t??"",retainView:s,triggerRef:v,setMenuOpen:o,showDeleteDialog:_,conversationId:e??"",setShowDeleteDialog:j})]})},(e,t)=>e.conversationId===t.conversationId&&e.title===t.title&&e.isPopoverActive===t.isPopoverActive&&e.isActiveConvo===t.isActiveConvo),nS=({titleInput:e,setTitleInput:t,onSubmit:s,onCancel:a,localize:r})=>{const o=n.useRef(null);n.useEffect(()=>{o.current&&(o.current.focus(),o.current.select())},[]);return l.jsxs("div",{className:"absolute inset-0 z-20 flex w-full items-center rounded-lg bg-surface-active-alt p-1.5",role:"form","aria-label":r("com_ui_rename_conversation"),children:[l.jsx("input",{ref:o,type:"text",className:"w-full rounded bg-transparent p-0.5 text-sm leading-tight focus-visible:outline-none",value:e,onChange:e=>t(e.target.value),onKeyDown:t=>{switch(t.key){case"Escape":a();break;case"Enter":s(e)}},onBlur:()=>s(e),maxLength:100,"aria-label":r("com_ui_new_conversation_title")}),l.jsxs("div",{className:"flex gap-1",role:"toolbar",children:[l.jsx("button",{onClick:()=>a(),className:"p-1 hover:opacity-70 focus:outline-none focus:ring-2","aria-label":r("com_ui_cancel"),children:l.jsx(re,{className:"h-4 w-4","aria-hidden":"true"})}),l.jsx("button",{onClick:()=>s(e),className:"p-1 hover:opacity-70 focus:outline-none focus:ring-2","aria-label":r("com_ui_save"),children:l.jsx(se,{className:"h-4 w-4","aria-hidden":"true"})})]})]})},sS=({isActiveConvo:e,title:t,onRename:n,isSmallScreen:s,localize:a,children:r})=>l.jsxs("div",{className:Op("flex grow items-center gap-2 overflow-hidden rounded-lg px-2",e?"bg-surface-active-alt":""),title:t??void 0,"aria-current":e?"page":void 0,style:{width:"100%"},children:[r,l.jsx("div",{className:"relative flex-1 grow overflow-hidden whitespace-nowrap",style:{textOverflow:"clip"},onDoubleClick:e=>{s||(e.preventDefault(),e.stopPropagation(),n())},role:"button","aria-label":s?void 0:t||a("com_ui_untitled"),children:t||a("com_ui_untitled")}),l.jsx("div",{className:Op("absolute bottom-0 right-0 top-0 w-20 rounded-r-lg bg-gradient-to-l",e?"from-surface-active-alt":"from-surface-primary-alt from-0% to-transparent group-hover:from-surface-active-alt group-hover:from-40%"),"aria-hidden":"true"})]});function aS({conversation:e,retainView:t,toggleNav:s,isLatestConvo:a}){const r=M(),o=zf(),{showToast:i}=Of(),{navigateToConvo:c}=bv(),{data:d}=kx(),u=n.useMemo(()=>r.conversationId,[r.conversationId]),m=cf(u??""),p=_(sx.allConversationsSelector),h=Uy("(max-width: 768px)"),{conversationId:x,title:f=""}=e,[g,v]=n.useState(f||""),[b,y]=n.useState(!1),[j,w]=n.useState(!1),N=n.useRef(f);n.useEffect(()=>{f!==N.current&&(v(f),N.current=f)},[f]);const C=n.useMemo(()=>{if(x===Zc.NEW_CONVO)return u===Zc.NEW_CONVO;if(u!==Zc.NEW_CONVO)return u===x;return(null==p?void 0:p[0])===x},[u,x,p]),k=()=>{w(!1),v(f),y(!0)},S=t=>{if(t){s();const e=window.location.origin,t=`/c/${x}`;return void window.open(e+t,"_blank")}u===x||j||(s(),"string"==typeof f&&f.length>0&&(document.title=f),c(e,{currentConvoId:u,resetLatestMessage:!x||x===Zc.NEW_CONVO}))},T={title:f,retainView:t,renameHandler:k,isActiveConvo:C,conversationId:x,isPopoverActive:j,setIsPopoverActive:w};return l.jsxs("div",{className:Op("group relative flex h-12 w-full items-center rounded-lg transition-colors duration-200 md:h-9",C?"bg-surface-active-alt":"hover:bg-surface-active-alt"),role:"listitem",tabIndex:0,onClick:e=>{b||0===e.button&&S(e.ctrlKey||e.metaKey)},onKeyDown:e=>{b||"Enter"===e.key&&S(!1)},style:{cursor:b?"default":"pointer"},"data-testid":"convo-item",children:[b?l.jsx(nS,{titleInput:g,setTitleInput:v,onSubmit:async e=>{if(x&&e!==f)try{await m.mutateAsync({conversationId:x,title:e.trim()||o("com_ui_untitled")}),y(!1)}catch(t){v(f),i({message:o("com_ui_rename_failed"),severity:Wo.ERROR,showIcon:!0}),y(!1)}else y(!1)},onCancel:()=>{v(f),y(!1)},localize:o}):l.jsx(sS,{isActiveConvo:C,title:f,onRename:k,isSmallScreen:h,localize:o,children:l.jsx(Qw,{conversation:e,endpointsConfig:d,size:20,context:"menu-item"})}),l.jsx("div",{className:Op("mr-2 flex origin-left",j||C?"pointer-events-auto max-w-[28px] scale-x-100 opacity-100":"pointer-events-none max-w-0 scale-x-0 opacity-0 group-focus-within:pointer-events-auto group-focus-within:max-w-[28px] group-focus-within:scale-x-100 group-focus-within:opacity-100 group-hover:pointer-events-auto group-hover:max-w-[28px] group-hover:scale-x-100 group-hover:opacity-100"),"aria-hidden":!(j||C),children:!b&&l.jsx(tS,{...T})})]})}const rS=n.memo(()=>{const e=zf();return l.jsxs("div",{className:"mx-auto mt-2 flex items-center justify-center gap-2",children:[l.jsx(Gb,{className:"text-text-primary"}),l.jsx("span",{className:"animate-pulse text-text-primary",children:e("com_ui_loading")})]})}),oS=n.memo(({groupName:e})=>{const t=zf();return l.jsx("div",{className:"mt-2 pl-2 pt-1 text-text-secondary",style:{fontSize:"0.7rem"},children:t(e)||e})});oS.displayName="DateLabel";const iS=n.memo(({conversation:e,retainView:t,toggleNav:n,isLatestConvo:s})=>l.jsx(aS,{conversation:e,retainView:t,toggleNav:n,isLatestConvo:s}),(e,t)=>e.conversation.conversationId===t.conversation.conversationId&&e.conversation.title===t.conversation.title&&e.isLatestConvo===t.isLatestConvo&&e.conversation.endpoint===t.conversation.endpoint),lS=n.memo(({conversations:e,moveToTop:t,toggleNav:s,containerRef:a,loadMoreConversations:r,isLoading:o,isSearchLoading:i})=>{const c=Uy("(max-width: 768px)")?44:34,d=n.useMemo(()=>e.filter(Boolean),[e]),u=n.useMemo(()=>Xm(d),[d]),m=n.useMemo(()=>{var e;return(null==(e=d.find(e=>e.updatedAt&&fr(xr(e.updatedAt))))?void 0:e.conversationId)??void 0},[d]),p=n.useMemo(()=>{const e=[];return u.forEach(([t,n])=>{e.push({type:"header",groupName:t}),e.push(...n.map(e=>({type:"convo",convo:e})))}),o&&e.push({type:"loading"}),e},[u,o]),h=n.useMemo(()=>new ko({fixedWidth:!0,defaultHeight:c,keyMapper:e=>{const t=p[e];return"header"===t.type?`header-${e}`:"convo"===t.type?`convo-${t.convo.conversationId}`:"loading"===t.type?`loading-${e}`:`unknown-${e}`}}),[p,c]),x=n.useCallback(({index:e,key:n,parent:a,style:r})=>{const o=p[e];return"loading"===o.type?l.jsx(So,{cache:h,columnIndex:0,parent:a,rowIndex:e,children:({registerChild:e})=>l.jsx("div",{ref:e,style:r,children:l.jsx(rS,{})})},n):l.jsx(So,{cache:h,columnIndex:0,parent:a,rowIndex:e,children:({registerChild:e})=>l.jsx("div",{ref:e,style:r,children:"header"===o.type?l.jsx(oS,{groupName:o.groupName}):"convo"===o.type?l.jsx(iS,{conversation:o.convo,retainView:t,toggleNav:s,isLatestConvo:o.convo.conversationId===m}):null})},n)},[h,p,m,t,s]),f=n.useCallback(({index:e})=>h.getHeight(e,0),[h]),g=n.useMemo(()=>kr(r,300),[r]),v=n.useCallback(({stopIndex:e})=>{e>=p.length-8&&g()},[p.length,g]);return l.jsx("div",{className:"relative flex h-full flex-col pb-2 text-sm text-text-primary",children:i?l.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[l.jsx(Gb,{className:"text-text-primary"}),l.jsx("span",{className:"ml-2 text-text-primary",children:"Loading..."})]}):l.jsx("div",{className:"flex-1",children:l.jsx(To,{children:({width:e,height:t})=>l.jsx(Ro,{ref:a,width:e,height:t,deferredMeasurementCache:h,rowCount:p.length,rowHeight:f,rowRenderer:x,overscanRowCount:10,className:"outline-none",style:{outline:"none"},role:"list","aria-label":"Conversations",onRowsRendered:v,tabIndex:-1})})})})});function cS({isLast:e,index:t,messageId:s,content:a,className:r,renderButton:o}){var i,c;const d=zf(),u=_(sx.playbackRate),{toggleSpeech:m,isSpeaking:p,audioRef:h}=Bf({isLast:e,index:t,content:a}),x=()=>!0===p?l.jsx(wy,{className:"icon-md-heavy h-[18px] w-[18px]"}):l.jsx(jy,{className:"icon-md-heavy h-[18px] w-[18px]"});n.useEffect(()=>{const e=document.getElementById(`audio-${s}`);e&&null!=u&&u>0&&e.playbackRate!==u&&(e.playbackRate=u)},[h,p,u,s]),Dp.log("MessageAudio: audioRef.current?.src, audioRef.current",null==(i=h.current)?void 0:i.src,h.current);const f=()=>{h.current&&(h.current.muted=!1),m()},g=d(!0===p?"com_ui_stop":"com_ui_read_aloud");return l.jsxs(l.Fragment,{children:[o?o({onClick:f,title:g,icon:x(),isActive:p,className:r}):l.jsx("button",{className:r,onClickCapture:f,type:"button",title:g,children:x()}),l.jsx("audio",{ref:h,controls:!0,preload:"none",controlsList:"nodownload nofullscreen noremoteplayback",style:{position:"absolute",overflow:"hidden",display:"none",height:"0px",width:"0px"},src:null==(c=h.current)?void 0:c.src,onError:e=>{Dp.error("Error fetching audio:",e)},id:`audio-${s}`,autoPlay:!0})]})}function dS({isLast:e,index:t,messageId:s,content:a,className:r,renderButton:o}){var i,c;const d=zf(),u=_(sx.playbackRate),{toggleSpeech:m,isSpeaking:p,isLoading:h,audioRef:x}=$f({isLast:e,index:t,messageId:s,content:a}),f=()=>!0===h?l.jsx(Gb,{className:"icon-md-heavy h-[18px] w-[18px]"}):!0===p?l.jsx(wy,{className:"icon-md-heavy h-[18px] w-[18px]"}):l.jsx(jy,{className:"icon-md-heavy h-[18px] w-[18px]"});return n.useEffect(()=>{const e=document.getElementById(`audio-${s}`);e&&null!=u&&u>0&&e.playbackRate!==u&&(e.playbackRate=u)},[x,p,u,s]),Dp.log("MessageAudio: audioRef.current?.src, audioRef.current",null==(i=x.current)?void 0:i.src,x.current),l.jsxs(l.Fragment,{children:[o?o({onClick:()=>{x.current&&(x.current.muted=!1),m()},title:d(!0===p?"com_ui_stop":"com_ui_read_aloud"),icon:f(),isActive:p,className:r}):l.jsx("button",{onClickCapture:()=>{x.current&&(x.current.muted=!1),m()},type:"button",title:d(!0===p?"com_ui_stop":"com_ui_read_aloud"),children:f()}),l.jsx("audio",{ref:x,controls:!0,preload:"none",controlsList:"nodownload nofullscreen noremoteplayback",style:{position:"absolute",overflow:"hidden",display:"none",height:"0px",width:"0px"},src:null==(c=x.current)?void 0:c.src,onError:e=>{Dp.error("Error fetching audio:",e)},id:`audio-${s}`,autoPlay:!0})]})}const uS=n.memo(function(e){const t=_(sx.engineTTS),n={[$o.browser]:cS,[$o.external]:dS}[t];return n?l.jsx(n,{...e}):null}),mS={AlertCircle:ot,PenTool:rn,ImageOff:an,Ban:sn,HelpCircle:nn,CheckCircle:tn,Lightbulb:U,Search:Oe,ThumbsUp:My,ThumbsDown:Py};function pS({tag:e,active:t,onClick:n}){const s=zf(),a=mS[e.icon]||ot,r=s(e.label);return l.jsxs("button",{className:Op("flex w-full items-center gap-3 rounded-xl p-2 text-text-secondary transition-colors duration-200 hover:bg-surface-hover hover:text-text-primary",t&&"bg-surface-hover font-semibold text-text-primary"),onClick:n,type:"button","aria-label":r,"aria-pressed":t,children:[l.jsx(a,{size:"19",bold:t}),l.jsx("span",{children:r})]})}function hS({isLast:e,feedback:t,onFeedback:s,onOther:a}){var r,o;const i=zf(),c=Ft({placement:"bottom"}),d=Ft({placement:"bottom"}),u=n.useMemo(()=>di("thumbsUp"),[]),m=n.useMemo(()=>di("thumbsDown"),[]),p="thumbsUp"===(null==t?void 0:t.rating)?null==(r=t.tag)?void 0:r.key:void 0,h="thumbsDown"===(null==t?void 0:t.rating)?null==(o=t.tag)?void 0:o.key:void 0,x=n.useCallback(e=>{e.preventDefault(),"thumbsUp"===(null==t?void 0:t.rating)?s(void 0):c.toggle()},[t,s,c]),f=n.useCallback(e=>t=>{t.preventDefault(),c.hide(),s({rating:"thumbsUp",tag:e}),"other"===e.key&&(null==a||a())},[s,a,c]),g=n.useCallback(e=>{e.preventDefault(),"thumbsDown"===(null==t?void 0:t.rating)?null==a||a():d.toggle()},[t,a,d]),v=n.useCallback(e=>t=>{t.preventDefault(),d.hide(),s({rating:"thumbsDown",tag:e}),"other"===e.key&&(null==a||a())},[s,a,d]);return l.jsxs(l.Fragment,{children:[l.jsx(Ut,{store:c,render:l.jsx("button",{className:xS("thumbsUp"===(null==t?void 0:t.rating),e),onClick:x,type:"button",title:i("com_ui_feedback_positive"),"aria-pressed":"thumbsUp"===(null==t?void 0:t.rating),"aria-haspopup":"menu",children:l.jsx(My,{size:"19",bold:"thumbsUp"===(null==t?void 0:t.rating)})})}),l.jsx(Kt,{store:c,gutter:8,portal:!0,unmountOnHide:!0,className:"popover-animate flex w-auto flex-col gap-1.5 overflow-hidden rounded-2xl border border-border-medium bg-surface-secondary p-1.5 shadow-lg",children:l.jsx("div",{className:"flex flex-col items-stretch justify-center",children:u.map(e=>l.jsx(pS,{tag:e,active:p===e.key,onClick:f(e)},e.key))})}),l.jsx(Ut,{store:d,render:l.jsx("button",{className:xS("thumbsDown"===(null==t?void 0:t.rating),e),onClick:g,type:"button",title:i("com_ui_feedback_negative"),"aria-pressed":"thumbsDown"===(null==t?void 0:t.rating),"aria-haspopup":"menu",children:l.jsx(Py,{size:"19",bold:"thumbsDown"===(null==t?void 0:t.rating)})})}),l.jsx(Kt,{store:d,gutter:8,portal:!0,unmountOnHide:!0,className:"popover-animate flex w-auto flex-col gap-1.5 overflow-hidden rounded-2xl border border-border-medium bg-surface-secondary p-1.5 shadow-lg",children:l.jsx("div",{className:"flex flex-col items-stretch justify-center",children:m.map(e=>l.jsx(pS,{tag:e,active:h===e.key,onClick:v(e)},e.key))})})]})}function xS(e,t){return Op("hover-button rounded-lg p-1.5 text-text-secondary-alt transition-colors duration-200","hover:text-text-primary hover:bg-surface-hover","md:group-hover:visible md:group-focus-within:visible md:group-[.final-completion]:visible",!t&&"md:opacity-0 md:group-hover:opacity-100 md:group-focus-within:opacity-100","focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white focus-visible:outline-none",e&&"active text-text-primary bg-surface-hover")}function fS({isLast:e=!1,handleFeedback:t,feedback:s}){var a;const r=zf(),[o,i]=n.useState(!1),[c,d]=n.useState(s);n.useEffect(()=>{d(s)},[s]);const u=n.useCallback(e=>{d(e),t({feedback:e})},[t]),m=n.useCallback(e=>{var t;"other"===(null==(t=null==e?void 0:e.tag)?void 0:t.key)?i(!0):i(!1),u(e)},[u]),p=n.useCallback(()=>i(!0),[]),h=n.useCallback(()=>{var e,t;("other"!==(null==(e=null==c?void 0:c.tag)?void 0:e.key)||(null==(t=null==c?void 0:c.text)?void 0:t.trim()))&&(u(c),i(!1))},[c,u]),x=n.useCallback(()=>{d(void 0),t({feedback:void 0}),i(!1)},[t]);return l.jsxs(l.Fragment,{children:[c?(()=>{if(!c)return null;const t="thumbsUp"===c.rating,n=t?My:Py,s=r(t?"com_ui_feedback_positive":"com_ui_feedback_negative");return l.jsx("button",{className:xS(!0,e),onClick:()=>{t?m(void 0):i(!0)},type:"button",title:s,"aria-pressed":"true",children:l.jsx(n,{size:"19",bold:!0})})})():l.jsx(hS,{isLast:e,feedback:c,onFeedback:m,onOther:p}),l.jsx(A_,{open:o,onOpenChange:i,children:l.jsxs(V_,{className:"w-11/12 max-w-lg",children:[l.jsx(U_,{className:"text-token-text-primary text-lg font-semibold leading-6",children:r("com_ui_feedback_more_information")}),l.jsx("textarea",{className:"w-full rounded-xl border border-border-light bg-transparent p-2 text-text-primary",value:(null==c?void 0:c.text)||"",onChange:e=>{d(t=>t?{...t,text:e.target.value}:void 0)},rows:4,placeholder:r("com_ui_feedback_placeholder"),maxLength:500}),l.jsxs("div",{className:"mt-4 flex items-end justify-end gap-2",children:[l.jsx(c_,{variant:"destructive",onClick:x,children:r("com_ui_delete")}),l.jsx(c_,{variant:"submit",onClick:h,disabled:!(null==(a=null==c?void 0:c.text)?void 0:a.trim()),children:r("com_ui_save")})]})]})})]})}const gS=e=>"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.map(e=>{if("string"==typeof e)return e;if("text"in e)return e.text||"";if("think"in e){const t=e.think;return"string"==typeof t?t:t&&"text"in t&&t.text||""}return""}).join(""):e.text||"",vS=n.memo(({id:e,onClick:t,title:n,icon:s,isActive:a=!1,isVisible:r=!0,isDisabled:o=!1,isLast:i=!1,className:c=""})=>{const d=Op("hover-button rounded-lg p-1.5 text-text-secondary-alt transition-colors duration-200","hover:text-text-primary hover:bg-surface-hover","md:group-hover:visible md:group-focus-within:visible md:group-[.final-completion]:visible",!i&&"md:opacity-0 md:group-hover:opacity-100 md:group-focus-within:opacity-100",!r&&"opacity-0","focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white focus-visible:outline-none",a&&r&&"active text-text-primary bg-surface-hover",c);return l.jsx("button",{id:e,className:d,onClick:t,type:"button",title:n,disabled:o,children:s})});vS.displayName="HoverButton";const bS=n.memo(({index:e,isEditing:t,enterEdit:s,copyToClipboard:a,conversation:r,isSubmitting:o,message:i,regenerate:c,handleContinue:d,latestMessage:u,isLast:m,handleFeedback:p})=>{const h=zf(),[x,f]=n.useState(!1),[g]=b(sx.textToSpeech),v=n.useMemo(()=>r?r.endpointType??r.endpoint:"",[r]),y=function({error:e=!1,endpoint:t,messageId:n,isEditing:s=!1,isSubmitting:a,searchResult:r=!1,finish_reason:o="",latestMessageId:i,isCreatedByUser:l=!1}){const c=Boolean([vi.openAI,vi.custom,vi.google,vi.agents,vi.bedrock,vi.anthropic,vi.gptPlugins,vi.azureOpenAI].find(e=>e===t)),d=i===n&&o&&"stop"!==o&&!s&&!r&&c,u=Boolean([vi.azureOpenAI,vi.openAI,vi.custom,vi.agents,vi.bedrock,vi.chatGPTBrowser,vi.google,vi.gptPlugins,vi.anthropic].find(e=>e===t)),m=!l&&!r&&!s&&!a&&u,p=a||e||r||!u||!c&&!l;return{forkingSupported:!ji(t)&&!r,continueSupported:d,regenerateEnabled:m,isEditableEndpoint:c,hideEditButton:p}}({isEditing:t,isSubmitting:o,error:i.error,endpoint:v??"",messageId:i.messageId,searchResult:i.searchResult,finish_reason:i.finish_reason,isCreatedByUser:i.isCreatedByUser,latestMessageId:null==u?void 0:u.messageId}),{hideEditButton:_,regenerateEnabled:j,continueSupported:w,forkingSupported:N,isEditableEndpoint:C}=y;if(!r)return null;const{isCreatedByUser:k,error:S}=i;if(!0===S)return l.jsx("div",{className:"visible flex justify-center self-end lg:justify-start",children:j&&l.jsx(vS,{onClick:c,title:h("com_ui_regenerate"),icon:l.jsx(ey,{size:"19"}),isLast:m})});return l.jsxs("div",{className:"group visible flex justify-center gap-0.5 self-end focus-within:outline-none lg:justify-start",children:[g&&l.jsx(uS,{index:e,isLast:m,messageId:i.messageId,content:gS(i),renderButton:e=>l.jsx(vS,{onClick:e.onClick,title:e.title,icon:e.icon,isActive:e.isActive,isLast:m})}),l.jsx(vS,{onClick:()=>a(f),title:h(x?"com_ui_copied_to_clipboard":"com_ui_copy_to_clipboard"),icon:x?l.jsx(qb,{className:"h-[18px] w-[18px]"}):l.jsx(Wb,{size:"19"}),isLast:m,className:"ml-0 flex items-center gap-1.5 text-xs "+(o&&k?"md:opacity-0 md:group-hover:opacity-100":"")}),C&&l.jsx(vS,{id:`edit-${i.messageId}`,onClick:()=>{if(t)return s(!0);s()},title:h("com_ui_edit"),icon:l.jsx(Bb,{size:"19"}),isActive:t,isVisible:!_,isDisabled:_,isLast:m,className:k?"":"active"}),l.jsx(Zk,{messageId:i.messageId,conversationId:r.conversationId,forkingSupported:N,latestMessageId:null==u?void 0:u.messageId,isLast:m}),!k&&l.jsx(fS,{handleFeedback:p,feedback:i.feedback,isLast:m}),j&&l.jsx(vS,{onClick:c,title:h("com_ui_regenerate"),icon:l.jsx(ey,{size:"19"}),isLast:m,className:"active"}),w&&l.jsx(vS,{onClick:e=>e&&d(e),title:h("com_ui_continue"),icon:l.jsx(ty,{className:"w-19 h-19 -rotate-180"}),isLast:m,className:"active"})]})}),yS=n.memo(({iconData:e,assistant:t,agent:s})=>{Dp.log("icon_data",e,t,s);const{data:a}=kx(),r=n.useMemo(()=>(null==s?void 0:s.name)??"",[s]),o=n.useMemo(()=>{var e;return(null==(e=null==s?void 0:s.avatar)?void 0:e.filepath)??""},[s]),i=n.useMemo(()=>(null==t?void 0:t.name)??"",[t]),c=n.useMemo(()=>{var e;return(null==(e=null==t?void 0:t.metadata)?void 0:e.avatar)??""},[t]),d=n.useMemo(()=>{let e="";return t?e=c:s&&(e=o),e},[t,s,c,o]),u=null==e?void 0:e.iconURL,m=n.useMemo(()=>wp({endpointsConfig:a,iconURL:u,endpoint:null==e?void 0:e.endpoint}),[a,u,null==e?void 0:e.endpoint]),p=n.useMemo(()=>fp(a,m,"iconURL"),[a,m]);return!0!==(null==e?void 0:e.isCreatedByUser)&&null!=u&&u.includes("http")?l.jsx(Ww,{iconURL:u,modelLabel:null==e?void 0:e.modelLabel,context:"message",assistantAvatar:c,agentAvatar:o,endpointIconURL:p,assistantName:i,agentName:r}):l.jsx($w,{isCreatedByUser:(null==e?void 0:e.isCreatedByUser)??!1,endpoint:m,iconURL:d||p,model:null==e?void 0:e.model,assistantName:i,agentName:r,size:28.8})});yS.displayName="MessageIcon";const _S=n.memo(({message:e,isCard:t=!1,siblingIdx:s,siblingCount:a,setSiblingIdx:r,currentEditId:o,isMultiMessage:i=!1,setCurrentEditId:c,isSubmittingFamily:d=!1})=>{var u;const{attachments:m,searchResults:p}=rb({messageId:null==e?void 0:e.messageId,attachments:null==e?void 0:e.attachments}),{edit:h,index:x,agent:f,assistant:g,enterEdit:v,conversation:b,messageLabel:y,isSubmitting:j,latestMessage:w,handleContinue:N,copyToClipboard:C,setLatestMessage:k,regenerateMessage:S,handleFeedback:T}=pb({message:e,searchResults:p,currentEditId:o,isMultiMessage:i,setCurrentEditId:c}),R=_(sx.maximizeChatSpace),I=_(sx.fontSize),E=n.useCallback(()=>S(),[S]),M=n.useMemo(()=>{var t;return!(null==(t=null==e?void 0:e.children)?void 0:t.length)&&((null==e?void 0:e.depth)===(null==w?void 0:w.depth)||-1===(null==e?void 0:e.depth))},[null==e?void 0:e.children,null==e?void 0:e.depth,null==w?void 0:w.depth]),P=(null==e?void 0:e.messageId)===(null==w?void 0:w.messageId),L=M&&!d&&t,A=t&&!d&&P,O=n.useMemo(()=>({endpoint:(null==e?void 0:e.endpoint)??(null==b?void 0:b.endpoint),model:(null==e?void 0:e.model)??(null==b?void 0:b.model),iconURL:null==e?void 0:e.iconURL,modelLabel:y,isCreatedByUser:null==e?void 0:e.isCreatedByUser}),[y,null==b?void 0:b.endpoint,null==b?void 0:b.model,null==e?void 0:e.model,null==e?void 0:e.iconURL,null==e?void 0:e.endpoint,null==e?void 0:e.isCreatedByUser]),D=n.useMemo(()=>L&&!P?()=>{Dp.log(`Message Card click: Setting ${null==e?void 0:e.messageId} as latest message`),Dp.dir(e),k(e)}:void 0,[L,P,e,k]);if(!e)return null;const z={common:"group mx-auto flex flex-1 gap-3 transition-all duration-300 transform-gpu ",card:"relative w-full gap-1 rounded-lg border border-border-medium bg-surface-primary-alt p-2 md:w-1/2 md:gap-3 md:p-4",chat:R?"w-full max-w-full md:px-5 lg:px-1 xl:px-5":"md:max-w-[47rem] xl:max-w-[55rem]"},F={latestCard:A?"bg-surface-secondary":"",cardRender:L?"cursor-pointer transition-colors duration-300":"",focus:"focus:outline-none focus:ring-2 focus:ring-border-xheavy"};return l.jsxs("div",{id:e.messageId,"aria-label":`message-${e.depth}-${e.messageId}`,className:Op(z.common,t?z.card:z.chat,F.latestCard,F.cardRender,F.focus,"message-render"),onClick:D,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!D||D()},role:L?"button":void 0,tabIndex:L?0:void 0,children:[A&&l.jsx("div",{className:"absolute right-0 top-0 m-2 h-3 w-3 rounded-full bg-text-primary"}),l.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-center",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:l.jsx(yS,{iconData:O,assistant:g,agent:f})})}),l.jsxs("div",{className:Op("relative flex w-11/12 flex-col",e.isCreatedByUser?"user-turn":"agent-turn"),children:[l.jsx("h2",{className:Op("select-none font-semibold",I),children:y}),l.jsxs("div",{className:"flex flex-col gap-1",children:[l.jsx("div",{className:"flex max-w-full flex-grow flex-col gap-0",children:l.jsx(Hk,{edit:h,isLast:M,enterEdit:v,siblingIdx:s,messageId:e.messageId,attachments:m,isSubmitting:j,searchResults:p,setSiblingIdx:r,isCreatedByUser:e.isCreatedByUser,conversationId:null==b?void 0:b.conversationId,content:e.content})}),!d&&!j||(null==(u=e.children)?void 0:u.length)?l.jsxs(Pk,{classes:"text-xs",children:[l.jsx(Ik,{siblingIdx:s,siblingCount:a,setSiblingIdx:r}),l.jsx(bS,{index:x,isEditing:h,message:e,enterEdit:v,isSubmitting:j,conversation:b??null,regenerate:E,copyToClipboard:C,handleContinue:N,latestMessage:w,handleFeedback:T,isLast:M})]}):l.jsx(Kk,{isCard:t})]})]})]})}),jS=m.memo(({handleScroll:e,children:t})=>l.jsx("div",{className:"text-token-text-primary w-full border-0 bg-transparent dark:border-0 dark:bg-transparent",onWheel:e,onTouchMove:e,children:t}));function wS(e){const{showSibling:t,conversation:n,handleScroll:s,siblingMessage:a,latestMultiMessage:r,isSubmittingFamily:o}=hb({message:e.message}),{message:i,currentEditId:c,setCurrentEditId:d}=e;if(!i||"object"!=typeof i)return null;const{children:u,messageId:m=null}=i;return l.jsxs(l.Fragment,{children:[l.jsx(jS,{handleScroll:s,children:t?l.jsx("div",{className:"m-auto my-2 flex justify-center p-4 py-2 md:gap-6",children:l.jsxs("div",{className:"flex w-full flex-row flex-wrap justify-between gap-1 md:max-w-5xl md:flex-nowrap md:gap-2 lg:max-w-5xl xl:max-w-6xl",children:[l.jsx(_S,{...e,message:i,isSubmittingFamily:o,isCard:!0}),l.jsx(_S,{...e,isMultiMessage:!0,isCard:!0,message:a??r??void 0,isSubmittingFamily:o})]})}):l.jsx("div",{className:"m-auto justify-center p-4 py-2 md:gap-6 ",children:l.jsx(_S,{...e})})}),l.jsx(TS,{messageId:m,conversation:n,messagesTree:u??[],currentEditId:c,setCurrentEditId:d},m)]})}function NS(e){const t=zf(),{message:s,siblingIdx:a,siblingCount:r,setSiblingIdx:o,currentEditId:i,setCurrentEditId:c}=e,{attachments:d,searchResults:u}=rb({messageId:null==s?void 0:s.messageId,attachments:null==s?void 0:s.attachments}),{edit:m,index:p,agent:h,isLast:x,enterEdit:f,assistant:g,handleScroll:v,conversation:b,isSubmitting:y,latestMessage:j,handleContinue:w,copyToClipboard:N,regenerateMessage:C}=function(e){const t=n.useRef(""),{message:s,currentEditId:a,setCurrentEditId:r}=e,{ask:o,index:i,regenerate:l,isSubmitting:c,conversation:d,latestMessage:u,setAbortScroll:m,handleContinue:p,setLatestMessage:h}=rg(),x=sv(),f=cg(),{text:g,content:v,children:b,messageId:y=null,isCreatedByUser:_}=s??{},j=y===a,w=0===(null==b?void 0:b.length)||void 0===(null==b?void 0:b.length);n.useEffect(()=>{const e=null==d?void 0:d.conversationId;if(e===Zc.NEW_CONVO)return;if(!s)return;if(!w)return;const n=pp(s,e),a={textKey:n,"latestText.current":t.current,messageId:s.messageId,convoId:e};n!==t.current||t.current&&e!==t.current.split(Zc.COMMON_DIVIDER)[2]?(Dp.log("[useMessageHelpers] Setting latest message: ",a),t.current=n,h({...s})):Dp.log("No change in latest message",a)},[w,s,h,null==d?void 0:d.conversationId]);const N=n.useCallback(e=>r&&r(!0===e?-1:y),[y,r]),C=n.useCallback(e=>{kr(()=>{Dp.log("message_scrolling",`useMessageHelpers: setting abort scroll to ${c}, handleScroll event`,e),m(!!c)},500)()},[c,m]),k=n.useMemo(()=>{if(!ji(null==d?void 0:d.endpoint))return;const e=(null==d?void 0:d.endpoint)??"",t=(null==s?void 0:s.model)??"";return(null==x?void 0:x[e])?x[e][t]:void 0},[null==d?void 0:d.endpoint,null==s?void 0:s.model,x]),S=n.useMemo(()=>{if(!wi(null==d?void 0:d.endpoint))return;const e=(null==s?void 0:s.model)??"";return f?f[e]:void 0},[f,null==d?void 0:d.endpoint,null==s?void 0:s.model]),T=mb({text:g,content:v});return{ask:o,edit:j,agent:S,index:i,isLast:w,assistant:k,enterEdit:N,conversation:d,isSubmitting:c,handleScroll:C,latestMessage:u,handleContinue:p,copyToClipboard:T,regenerateMessage:()=>{c&&!0===_||!s||l(s)}}}(e),k=_(sx.fontSize),S=_(sx.maximizeChatSpace),{children:T,messageId:R=null,isCreatedByUser:I}=s??{},E=n.useMemo(()=>{let e="";return!0===I?e=t("com_user_message"):g?e=g.name??t("com_ui_assistant"):h&&(e=h.name??t("com_ui_agent")),e},[g,h,I,t]),M=n.useMemo(()=>({endpoint:(null==s?void 0:s.endpoint)??(null==b?void 0:b.endpoint),model:(null==s?void 0:s.model)??(null==b?void 0:b.model),iconURL:(null==s?void 0:s.iconURL)??(null==b?void 0:b.iconURL),modelLabel:E,isCreatedByUser:null==s?void 0:s.isCreatedByUser}),[E,null==b?void 0:b.endpoint,null==b?void 0:b.iconURL,null==b?void 0:b.model,null==s?void 0:s.model,null==s?void 0:s.iconURL,null==s?void 0:s.endpoint,null==s?void 0:s.isCreatedByUser]);if(!s)return null;const P={common:"group mx-auto flex flex-1 gap-3 transition-all duration-300 transform-gpu",chat:S?"w-full max-w-full md:px-5 lg:px-1 xl:px-5":"md:max-w-[47rem] xl:max-w-[55rem]"};return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"w-full border-0 bg-transparent dark:border-0 dark:bg-transparent",onWheel:v,onTouchMove:v,children:l.jsx("div",{className:"m-auto justify-center p-4 py-2 md:gap-6",children:l.jsxs("div",{id:R??"","aria-label":`message-${s.depth}-${R}`,className:Op(P.common,P.chat,"message-render"),children:[l.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-center",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full pt-0.5",children:l.jsx(yS,{iconData:M,assistant:g,agent:h})})}),l.jsxs("div",{className:Op("relative flex w-11/12 flex-col",I?"user-turn":"agent-turn"),children:[l.jsx("h2",{className:Op("select-none font-semibold text-text-primary",k),children:E}),l.jsxs("div",{className:"flex flex-col gap-1",children:[l.jsx("div",{className:"flex max-w-full flex-grow flex-col gap-0",children:l.jsx(Hk,{edit:m,isLast:x,enterEdit:f,siblingIdx:a,attachments:d,isSubmitting:y,searchResults:u,messageId:s.messageId,setSiblingIdx:o,isCreatedByUser:s.isCreatedByUser,conversationId:null==b?void 0:b.conversationId,content:s.content})}),x&&y?l.jsx("div",{className:"mt-1 h-[27px] bg-transparent"}):l.jsxs(Pk,{classes:"text-xs",children:[l.jsx(Ik,{siblingIdx:a,siblingCount:r,setSiblingIdx:o}),l.jsx(bS,{index:p,isEditing:m,message:s,enterEdit:f,isSubmitting:y,conversation:b??null,regenerate:()=>C(),copyToClipboard:N,handleContinue:w,latestMessage:j,isLast:x})]})]})]})]})})}),l.jsx(TS,{messageId:R,conversation:b,messagesTree:T??[],currentEditId:i,setCurrentEditId:c},R)]})}const CS=n.memo(({message:e,isCard:t=!1,siblingIdx:s,siblingCount:a,setSiblingIdx:r,currentEditId:o,isMultiMessage:i=!1,setCurrentEditId:c,isSubmittingFamily:d=!1})=>{var u;const{ask:m,edit:p,index:h,agent:x,assistant:f,enterEdit:g,conversation:v,messageLabel:b,isSubmitting:y,latestMessage:j,handleContinue:w,copyToClipboard:N,setLatestMessage:C,regenerateMessage:k,handleFeedback:S}=pb({message:e,currentEditId:o,isMultiMessage:i,setCurrentEditId:c}),T=_(sx.maximizeChatSpace),R=_(sx.fontSize),I=n.useCallback(()=>k(),[k]),E=!(null==(u=null==e?void 0:e.children)?void 0:u.length),M=n.useMemo(()=>E&&((null==e?void 0:e.depth)===(null==j?void 0:j.depth)||-1===(null==e?void 0:e.depth)),[E,null==e?void 0:e.depth,null==j?void 0:j.depth]),P=(null==e?void 0:e.messageId)===(null==j?void 0:j.messageId),L=M&&!d&&t,A=t&&!d&&P,O=n.useMemo(()=>({endpoint:(null==e?void 0:e.endpoint)??(null==v?void 0:v.endpoint),model:(null==e?void 0:e.model)??(null==v?void 0:v.model),iconURL:null==e?void 0:e.iconURL,modelLabel:b,isCreatedByUser:null==e?void 0:e.isCreatedByUser}),[b,null==v?void 0:v.endpoint,null==v?void 0:v.model,null==e?void 0:e.model,null==e?void 0:e.iconURL,null==e?void 0:e.endpoint,null==e?void 0:e.isCreatedByUser]),D=n.useMemo(()=>L&&!P?()=>{Dp.log(`Message Card click: Setting ${null==e?void 0:e.messageId} as latest message`),Dp.dir(e),C(e)}:void 0,[L,P,e,C]);if(!e)return null;const z={common:"group mx-auto flex flex-1 gap-3 transition-all duration-300 transform-gpu ",card:"relative w-full gap-1 rounded-lg border border-border-medium bg-surface-primary-alt p-2 md:w-1/2 md:gap-3 md:p-4",chat:T?"w-full max-w-full md:px-5 lg:px-1 xl:px-5":"md:max-w-[47rem] xl:max-w-[55rem]"},F={latestCard:A?"bg-surface-secondary":"",cardRender:L?"cursor-pointer transition-colors duration-300":"",focus:"focus:outline-none focus:ring-2 focus:ring-border-xheavy"};return l.jsxs("div",{id:e.messageId,"aria-label":`message-${e.depth}-${e.messageId}`,className:Op(z.common,t?z.card:z.chat,F.latestCard,F.cardRender,F.focus,"message-render"),onClick:D,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!D||D()},role:L?"button":void 0,tabIndex:L?0:void 0,children:[A&&l.jsx("div",{className:"absolute right-0 top-0 m-2 h-3 w-3 rounded-full bg-text-primary"}),l.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-center",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:l.jsx(yS,{iconData:O,assistant:f,agent:x})})}),l.jsxs("div",{className:Op("relative flex w-11/12 flex-col",e.isCreatedByUser?"user-turn":"agent-turn"),children:[l.jsx("h2",{className:Op("select-none font-semibold",R),children:b}),l.jsxs("div",{className:"flex flex-col gap-1",children:[l.jsx("div",{className:"flex max-w-full flex-grow flex-col gap-0",children:l.jsxs(Xg.Provider,{value:{messageId:e.messageId,conversationId:null==v?void 0:v.conversationId,isExpanded:!1},children:[e.plugin&&l.jsx(Mk,{plugin:e.plugin}),l.jsx(uk,{ask:m,edit:p,isLast:M,text:e.text||"",message:e,enterEdit:g,error:!!e.error,isSubmitting:y,unfinished:e.unfinished??!1,isCreatedByUser:e.isCreatedByUser??!0,siblingIdx:s??0,setSiblingIdx:r??(()=>({}))})]})}),E&&(!0===d||y)?l.jsx(Kk,{isCard:t}):l.jsxs(Pk,{classes:"text-xs",children:[l.jsx(Ik,{siblingIdx:s,siblingCount:a,setSiblingIdx:r}),l.jsx(bS,{index:h,isEditing:p,message:e,enterEdit:g,isSubmitting:y,conversation:v??null,regenerate:I,copyToClipboard:N,handleContinue:w,latestMessage:j,handleFeedback:S,isLast:M})]})]})]})]})}),kS=m.memo(({handleScroll:e,children:t})=>l.jsx("div",{className:"text-token-text-primary w-full border-0 bg-transparent dark:border-0 dark:bg-transparent",onWheel:e,onTouchMove:e,children:t}));function SS(e){const{showSibling:t,conversation:n,handleScroll:s,siblingMessage:a,latestMultiMessage:r,isSubmittingFamily:o}=hb({message:e.message}),{message:i,currentEditId:c,setCurrentEditId:d}=e,u=_(sx.maximizeChatSpace);if(!i||"object"!=typeof i)return null;const{children:m,messageId:p=null}=i;return l.jsxs(l.Fragment,{children:[l.jsx(kS,{handleScroll:s,children:t?l.jsx("div",{className:"m-auto my-2 flex justify-center p-4 py-2 md:gap-6",children:l.jsxs("div",{className:Op("flex w-full flex-row flex-wrap justify-between gap-1 md:flex-nowrap md:gap-2",u?"w-full max-w-full":"md:max-w-5xl xl:max-w-6xl"),children:[l.jsx(CS,{...e,message:i,isSubmittingFamily:o,isCard:!0}),l.jsx(CS,{...e,isMultiMessage:!0,isCard:!0,message:a??r??void 0,isSubmittingFamily:o})]})}):l.jsx("div",{className:"m-auto justify-center p-4 py-2 md:gap-6 ",children:l.jsx(CS,{...e})})}),l.jsx(TS,{messageId:p,conversation:n,messagesTree:m??[],currentEditId:c,setCurrentEditId:d},p)]})}function TS({messageId:e,messagesTree:t,currentEditId:s,setCurrentEditId:a}){const[r,o]=b(sx.messagesSiblingIdxFamily(e)),i=n.useCallback(e=>{o(((null==t?void 0:t.length)??0)-e-1)},[null==t?void 0:t.length,o]);if(n.useEffect(()=>{o(0)},[null==t?void 0:t.length]),n.useEffect(()=>{(null==t?void 0:t.length)&&r>=t.length&&o(0)},[r,null==t?void 0:t.length,o]),!t||!t.length)return null;const c=t[t.length-r-1];return c?ji(c.endpoint)&&c.content?l.jsx(NS,{message:c,currentEditId:s,setCurrentEditId:a,siblingIdx:t.length-r-1,siblingCount:t.length,setSiblingIdx:i},c.messageId):c.content?l.jsx(wS,{message:c,currentEditId:s,setCurrentEditId:a,siblingIdx:t.length-r-1,siblingCount:t.length,setSiblingIdx:i},c.messageId):l.jsx(SS,{message:c,currentEditId:s,setCurrentEditId:a,siblingIdx:t.length-r-1,siblingCount:t.length,setSiblingIdx:i},c.messageId):null}function RS({messagesTree:e}){const t=zf(),s=_(sx.fontSize),{screenshotTargetRef:a}=Sv(),r=_(sx.showScrollButton),[o,i]=n.useState(-1),{conversation:c,scrollableRef:d,messagesEndRef:u,showScrollButton:m,handleSmoothToRef:p,debouncedHandleScroll:h}=xb(e),{conversationId:x}=c??{};return l.jsx(l.Fragment,{children:l.jsx("div",{className:"relative flex-1 overflow-hidden overflow-y-auto",children:l.jsxs("div",{className:"relative h-full",children:[l.jsx("div",{className:"scrollbar-gutter-stable",onScroll:h,ref:d,style:{height:"100%",overflowY:"auto",width:"100%"},children:l.jsxs("div",{className:"flex flex-col pb-9 dark:bg-transparent",children:[e&&0==e.length||null===e?l.jsx("div",{className:Op("flex w-full items-center justify-center p-3 text-text-secondary",s),children:t("com_ui_nothing_found")}):l.jsx(l.Fragment,{children:l.jsx("div",{ref:a,children:l.jsx(TS,{messagesTree:e,messageId:x??null,setCurrentEditId:i,currentEditId:o??null},x)})}),l.jsx("div",{id:"messages-end",className:"group h-0 w-full flex-shrink-0",ref:u})]})}),l.jsx(Yr,{in:m&&r,timeout:{enter:550,exit:700},classNames:"scroll-animation",unmountOnExit:!0,appear:!0,children:l.jsx($k,{scrollHandler:p})})]})})})}function IS(){return l.jsxs("div",{className:"bg-surface-primary/85 fixed inset-0 z-[9999] flex flex-col items-center justify-center\n        gap-2 text-text-primary\n        backdrop-blur-[4px] transition-all duration-200\n        ease-in-out animate-in fade-in\n        zoom-in-95 hover:backdrop-blur-sm",children:[l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 132 108",fill:"none",width:"132",height:"108",children:[l.jsx("g",{clipPath:"url(#clip0_3605_64419)",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M25.2025 29.3514C10.778 33.2165 8.51524 37.1357 11.8281 49.4995L13.4846 55.6814C16.7975 68.0453 20.7166 70.308 35.1411 66.443L43.3837 64.2344C57.8082 60.3694 60.0709 56.4502 56.758 44.0864L55.1016 37.9044C51.7887 25.5406 47.8695 23.2778 33.445 27.1428L29.3237 28.2471L25.2025 29.3514ZM18.1944 42.7244C18.8572 41.5764 20.325 41.1831 21.4729 41.8459L27.3517 45.24C28.4996 45.9027 28.8929 47.3706 28.2301 48.5185L24.836 54.3972C24.1733 55.5451 22.7054 55.9384 21.5575 55.2757C20.4096 54.613 20.0163 53.1451 20.6791 51.9972L22.8732 48.1969L19.0729 46.0028C17.925 45.3401 17.5317 43.8723 18.1944 42.7244ZM29.4091 56.3843C29.066 55.104 29.8258 53.7879 31.1062 53.4449L40.3791 50.9602C41.6594 50.6172 42.9754 51.377 43.3184 52.6573C43.6615 53.9376 42.9017 55.2536 41.6214 55.5967L32.3485 58.0813C31.0682 58.4244 29.7522 57.6646 29.4091 56.3843Z",fill:"#AFC1FF"})}),l.jsx("g",{clipPath:"url(#clip1_3605_64419)",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M86.8124 13.4036C81.0973 11.8722 78.5673 13.2649 77.0144 19.0603L68.7322 49.97C67.1793 55.7656 68.5935 58.2151 74.4696 59.7895L97.4908 65.958C103.367 67.5326 105.816 66.1184 107.406 60.1848L115.393 30.379C115.536 29.8456 115.217 29.2959 114.681 29.16C113.478 28.8544 112.435 28.6195 111.542 28.4183C106.243 27.2253 106.22 27.2201 109.449 20.7159C109.73 20.1507 109.426 19.4638 108.816 19.3004L86.8124 13.4036ZM87.2582 28.4311C86.234 28.1567 85.1812 28.7645 84.9067 29.7888C84.6323 30.813 85.2401 31.8658 86.2644 32.1403L101.101 36.1158C102.125 36.3902 103.178 35.7824 103.453 34.7581C103.727 33.7339 103.119 32.681 102.095 32.4066L87.2582 28.4311ZM82.9189 37.2074C83.1934 36.1831 84.2462 35.5753 85.2704 35.8497L100.107 39.8252C101.131 40.0996 101.739 41.1524 101.465 42.1767C101.19 43.201 100.137 43.8088 99.1132 43.5343L84.2766 39.5589C83.2523 39.2844 82.6445 38.2316 82.9189 37.2074ZM83.2826 43.2683C82.2584 42.9939 81.2056 43.6017 80.9311 44.626C80.6567 45.6502 81.2645 46.703 82.2888 46.9775L89.7071 48.9652C90.7313 49.2396 91.7841 48.6318 92.0586 47.6076C92.333 46.5833 91.7252 45.5305 90.7009 45.256L83.2826 43.2683Z",fill:"#7989FF"})}),l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M40.4004 71.8426C40.4004 57.2141 44.0575 53.5569 61.1242 53.5569H66.0004H70.8766C87.9432 53.5569 91.6004 57.2141 91.6004 71.8426V79.1569C91.6004 93.7855 87.9432 97.4426 70.8766 97.4426H61.1242C44.0575 97.4426 40.4004 93.7855 40.4004 79.1569V71.8426ZM78.8002 67.4995C78.8002 70.1504 76.6512 72.2995 74.0002 72.2995C71.3492 72.2995 69.2002 70.1504 69.2002 67.4995C69.2002 64.8485 71.3492 62.6995 74.0002 62.6995C76.6512 62.6995 78.8002 64.8485 78.8002 67.4995ZM60.7204 70.8597C60.2672 70.2553 59.5559 69.8997 58.8004 69.8997C58.045 69.8997 57.3337 70.2553 56.8804 70.8597L47.2804 83.6597C46.4851 84.72 46.7 86.2244 47.7604 87.0197C48.8208 87.8149 50.3251 87.6 51.1204 86.5397L58.8004 76.2997L66.4804 86.5397C66.8979 87.0962 67.5363 87.4443 68.2303 87.4936C68.9243 87.5429 69.6055 87.2887 70.0975 86.7967L74.8004 82.0938L79.5034 86.7967C80.4406 87.734 81.9602 87.734 82.8975 86.7967C83.8347 85.8595 83.8347 84.3399 82.8975 83.4026L76.4975 77.0026C75.5602 76.0653 74.0406 76.0653 73.1034 77.0026L68.6601 81.4459L60.7204 70.8597Z",fill:"#3C46FF"}),l.jsxs("defs",{children:[l.jsx("clipPath",{id:"clip0_3605_64419",children:l.jsx("rect",{width:"56",height:"56",fill:"white",transform:"translate(0 26.9939) rotate(-15)"})}),l.jsx("clipPath",{id:"clip1_3605_64419",children:l.jsx("rect",{width:"64",height:"64",fill:"white",transform:"translate(69.5645 0.5) rotate(15)"})})]})]}),l.jsx("h3",{children:"Add anything"}),l.jsx("h4",{children:"Drop any file here to add it to the conversation"})]})}const ES=({onOptionSelect:e,setShowModal:t,files:s,isVisible:a})=>{const r=zf(),{data:o}=kx(),i=n.useMemo(()=>{var e;return(null==(e=null==o?void 0:o[vi.agents])?void 0:e.capabilities)??[]},[o]),c=n.useMemo(()=>{const e=[{label:r("com_ui_upload_image_input"),value:void 0,icon:l.jsx(on,{className:"icon-md"}),condition:s.every(e=>{var t;return null==(t=e.type)?void 0:t.startsWith("image/")})}];for(const t of i)t===oi.file_search?e.push({label:r("com_ui_upload_file_search"),value:oi.file_search,icon:l.jsx(ln,{className:"icon-md"})}):t===oi.execute_code?e.push({label:r("com_ui_upload_code_files"),value:oi.execute_code,icon:l.jsx(V,{className:"icon-md"})}):t===oi.ocr&&e.push({label:r("com_ui_upload_ocr_text"),value:oi.ocr,icon:l.jsx(cn,{className:"icon-md"})});return e},[i,s,r]);return a?l.jsx(A_,{open:a,onOpenChange:t,children:l.jsx(Oj,{title:r("com_ui_upload_type"),className:"w-11/12 sm:w-[440px] md:w-[400px] lg:w-[360px]",main:l.jsx("div",{className:"flex flex-col gap-2",children:c.map((t,n)=>!1!==t.condition&&l.jsxs("button",{onClick:()=>e(t.value),className:"flex items-center gap-2 rounded-lg p-2 hover:bg-surface-active-alt",children:[t.icon,l.jsx("span",{children:t.label})]},n))})})}):null};function MS({children:e,className:t}){const{isOver:s,canDrop:a,drop:r,showModal:o,setShowModal:i,draggedFiles:c,handleOptionSelect:d}=function(){const e=Aa(),[t,s]=n.useState(!1),[a,r]=n.useState([]),o=_(sx.conversationByIndex(0))||void 0,i=y(tx((null==o?void 0:o.conversationId)??Zc.NEW_CONVO)),l=n.useMemo(()=>!ji(null==o?void 0:o.endpoint),[null==o?void 0:o.endpoint]),{handleFiles:c}=Fv({overrideEndpoint:l?vi.agents:void 0}),[{canDrop:d,isOver:u},m]=Sa(()=>({accept:[Ta],drop(t){var n,a;if(console.log("drop",t.files),!l)return void c(t.files);const o=e.getQueryData([Pd.endpoints]),i=null==o?void 0:o[vi.agents],d=!0===(null==(n=null==i?void 0:i.capabilities)?void 0:n.includes(Yl.execute_code)),u=!0===(null==(a=null==i?void 0:i.capabilities)?void 0:a.includes(Yl.file_search));d||u?(r(t.files),s(!0)):c(t.files)},canDrop:()=>!0,collect:e=>({isOver:e.isOver(),canDrop:e.canDrop()})}),[c]);return{canDrop:d,isOver:u,drop:m,showModal:t,setShowModal:s,draggedFiles:a,handleOptionSelect:e=>{e&&e!==oi.file_search&&i(t=>({...t,[e]:!0})),c(a,e),s(!1),r([])}}}(),u=a&&s;return l.jsxs("div",{ref:r,className:Op("relative flex h-full w-full",t),children:[e,u&&l.jsx(IS,{}),l.jsx(ES,{files:c,isVisible:o,setShowModal:i,onOptionSelect:d})]})}const PS=C('import React, { useEffect, useRef, useState } from "react";\nimport {\n  TransformWrapper,\n  TransformComponent,\n  ReactZoomPanPinchRef,\n} from "react-zoom-pan-pinch";\nimport mermaid from "mermaid";\nimport { ZoomIn, ZoomOut, RefreshCw } from "lucide-react";\nimport { Button } from "/components/ui/button";\n\ninterface MermaidDiagramProps {\n  content: string;\n}\n\nconst MermaidDiagram: React.FC<MermaidDiagramProps> = ({ content }) => {\n  const mermaidRef = useRef<HTMLDivElement>(null);\n  const transformRef = useRef<ReactZoomPanPinchRef>(null);\n  const [isRendered, setIsRendered] = useState(false);\n\n  useEffect(() => {\n    mermaid.initialize({\n      startOnLoad: false,\n      theme: "base",\n      themeVariables: {\n        background: "#282C34",\n        primaryColor: "#333842",\n        secondaryColor: "#333842",\n        tertiaryColor: "#333842",\n        primaryTextColor: "#ABB2BF",\n        secondaryTextColor: "#ABB2BF",\n        lineColor: "#636D83",\n        fontSize: "16px",\n        nodeBorder: "#636D83",\n        mainBkg: \'#282C34\',\n        altBackground: \'#282C34\',\n        textColor: \'#ABB2BF\',\n        edgeLabelBackground: \'#282C34\',\n        clusterBkg: \'#282C34\',\n        clusterBorder: "#636D83",\n        labelBoxBkgColor: "#333842",\n        labelBoxBorderColor: "#636D83",\n        labelTextColor: "#ABB2BF",\n      },\n      flowchart: {\n        curve: "basis",\n        nodeSpacing: 50,\n        rankSpacing: 50,\n        diagramPadding: 8,\n        htmlLabels: true,\n        useMaxWidth: true,\n        padding: 15,\n        wrappingWidth: 200,\n      },\n    });\n\n    const renderDiagram = async () => {\n      if (mermaidRef.current) {\n        try {\n          const { svg } = await mermaid.render("mermaid-diagram", content);\n          mermaidRef.current.innerHTML = svg;\n\n          const svgElement = mermaidRef.current.querySelector("svg");\n          if (svgElement) {\n            svgElement.style.width = "100%";\n            svgElement.style.height = "100%";\n\n            const pathElements = svgElement.querySelectorAll("path");\n            pathElements.forEach((path) => {\n              path.style.strokeWidth = "1.5px";\n            });\n\n            const rectElements = svgElement.querySelectorAll("rect");\n            rectElements.forEach((rect) => {\n              const parent = rect.parentElement;\n              if (parent && parent.classList.contains("node")) {\n                rect.style.stroke = "#636D83";\n                rect.style.strokeWidth = "1px";\n              } else {\n                rect.style.stroke = "none";\n              }\n            });\n          }\n          setIsRendered(true);\n        } catch (error) {\n          console.error("Mermaid rendering error:", error);\n          mermaidRef.current.innerHTML = "Error rendering diagram";\n        }\n      }\n    };\n\n    renderDiagram();\n  }, [content]);\n\n  const centerAndFitDiagram = () => {\n    if (transformRef.current && mermaidRef.current) {\n      const { centerView, zoomToElement } = transformRef.current;\n      zoomToElement(mermaidRef.current as HTMLElement);\n      centerView(1, 0);\n    }\n  };\n\n  useEffect(() => {\n    if (isRendered) {\n      centerAndFitDiagram();\n    }\n  }, [isRendered]);\n\n  const handlePanning = () => {\n    if (transformRef.current) {\n      const { state, instance } = transformRef.current;\n      if (!state) {\n        return;\n      }\n      const { scale, positionX, positionY } = state;\n      const { wrapperComponent, contentComponent } = instance;\n\n      if (wrapperComponent && contentComponent) {\n        const wrapperRect = wrapperComponent.getBoundingClientRect();\n        const contentRect = contentComponent.getBoundingClientRect();\n        const maxX = wrapperRect.width - contentRect.width * scale;\n        const maxY = wrapperRect.height - contentRect.height * scale;\n\n        let newX = positionX;\n        let newY = positionY;\n\n        if (newX > 0) {\n          newX = 0;\n        }\n        if (newY > 0) {\n          newY = 0;\n        }\n        if (newX < maxX) {\n          newX = maxX;\n        }\n        if (newY < maxY) {\n          newY = maxY;\n        }\n\n        if (newX !== positionX || newY !== positionY) {\n          instance.setTransformState(scale, newX, newY);\n        }\n      }\n    }\n  };\n\n  return (\n    <div className="relative h-screen w-screen cursor-move bg-[#282C34] p-5">\n      <TransformWrapper\n        ref={transformRef}\n        initialScale={1}\n        minScale={0.1}\n        maxScale={10}\n        limitToBounds={false}\n        centerOnInit={true}\n        initialPositionY={0}\n        wheel={{ step: 0.1 }}\n        panning={{ velocityDisabled: true }}\n        alignmentAnimation={{ disabled: true }}\n        onPanning={handlePanning}\n      >\n        {({ zoomIn, zoomOut }) => (\n          <>\n            <TransformComponent\n              wrapperStyle={{\n                width: "100%",\n                height: "100%",\n                overflow: "hidden",\n              }}\n            >\n              <div\n                ref={mermaidRef}\n                style={{\n                  width: "auto",\n                  height: "auto",\n                  minWidth: "100%",\n                  minHeight: "100%",\n                }}\n              />\n            </TransformComponent>\n            <div className="absolute bottom-2 right-2 flex space-x-2">\n              <Button onClick={() => zoomIn(0.1)} variant="outline" size="icon">\n                <ZoomIn className="h-4 w-4" />\n              </Button>\n              <Button\n                onClick={() => zoomOut(0.1)}\n                variant="outline"\n                size="icon"\n              >\n                <ZoomOut className="h-4 w-4" />\n              </Button>\n              <Button\n                onClick={centerAndFitDiagram}\n                variant="outline"\n                size="icon"\n              >\n                <RefreshCw className="h-4 w-4" />\n              </Button>\n            </div>\n          </>\n        )}\n      </TransformWrapper>\n    </div>\n  );\n};\n\nexport default MermaidDiagram;'),LS=e=>C(`import React from 'react';\nimport MermaidDiagram from '/components/ui/MermaidDiagram';\n\nexport default App = () => (\n  <MermaidDiagram content={\`${e}\`} />\n);\n`);function AS({artifact:e}){const[t,s]=n.useMemo(()=>{if(vg(e.type??"",e.language).includes("mermaid"))return["App.tsx",(t=e.content??"",{"App.tsx":LS(t),"index.tsx":C('import React, { StrictMode } from "react";\nimport { createRoot } from "react-dom/client";\nimport "./styles.css";\n\nimport App from "./App";\n\nconst root = createRoot(document.getElementById("root"));\nroot.render(<App />);\n;'),"/components/ui/MermaidDiagram.tsx":PS})];var t;const n=function(e,t){const n=vg(e,t);return fg[n]??fg.default}(e.type??"",e.language);return[n,ol({[n]:e.content})]},[e.type,e.content,e.language]);return{files:s,fileKey:t,template:n.useMemo(()=>function(e,t){const n=vg(e,t);return gg[n]??gg.default}(e.type??"",e.language),[e.type,e.language]),sharedProps:n.useMemo(()=>({customSetup:{dependencies:_g(e.type??"")}}),[e.type])}}const OS=({artifact:e,className:t=""})=>{const s=zf(),{currentCode:a}=qg(),[r,o]=n.useState(!1),{fileKey:i}=AS({artifact:e});return l.jsx("button",{className:`mr-2 text-text-secondary ${t}`,onClick:()=>{try{const t=a??e.content??"";if(!t)return;const n=new Blob([t],{type:"text/plain"}),s=window.URL.createObjectURL(n),r=document.createElement("a");r.href=s,r.download=i,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(s),o(!0),setTimeout(()=>o(!1),3e3)}catch(t){console.error("Download failed:",t)}},"aria-label":s("com_ui_download_artifact"),children:r?l.jsx(qb,{className:"h-4 w-4"}):l.jsx(dn,{className:"h-4 w-4"})})},DS=({fileKey:e,readOnly:t,artifact:s,editorRef:a})=>{const{sandpack:r}=Lo(),{isMutating:o,setIsMutating:i,setCurrentCode:c}=qg(),d=Vx({onMutate:()=>{i(!0)},onSuccess:()=>{i(!1)},onError:()=>{i(!1)}}),u=n.useCallback(e=>{d.mutate(e)},[d]),m=n.useMemo(()=>Cr(u,500),[u]);return n.useEffect(()=>{var n;if(t)return;if(o)return;if(null==s.index)return;const a=null==(n=r.files["/"+e])?void 0:n.code;return a&&null!=s.content&&a.trim()!==s.content.trim()&&(c(a),m({index:s.index,messageId:s.messageId??"",original:s.content,updated:a})),()=>{m.cancel()}},[e,s.index,s.content,s.messageId,t,o,r.files,i,c,m]),l.jsx(Ao,{ref:a,showTabs:!1,readOnly:t,showRunButton:!1,showLineNumbers:!0,showInlineErrors:!0,className:"hljs language-javascript bg-black"})},zS=n.memo(function({files:e,fileKey:t,template:s,artifact:a,editorRef:r,sharedProps:o,isSubmitting:i}){const{data:c}=Sx(),d=n.useMemo(()=>c?{...jg,bundlerURL:"static"===s?c.staticBundlerURL:c.bundlerURL}:jg,[c,s]);return 0===Object.keys(e).length?null:l.jsx(Po,{theme:"dark",files:{...e,...wg},options:d,...o,template:s,children:l.jsx(DS,{editorRef:r,fileKey:t,readOnly:i,artifact:a})})}),FS=n.memo(function({files:e,fileKey:t,template:s,sharedProps:a,previewRef:r,currentCode:o,startupConfig:i}){const c=n.useMemo(()=>{if(0===Object.keys(e).length)return e;const n=o??"";return n?{...e,[t]:{code:n}}:e},[o,e,t]),d=n.useMemo(()=>{if(!i)return jg;return{...jg,bundlerURL:"static"===s?i.staticBundlerURL:i.bundlerURL}},[i,s]);return 0===Object.keys(c).length?null:l.jsx(Oo,{files:{...c,...wg},options:d,...a,template:s,children:l.jsx(Do,{showOpenInCodeSandbox:!1,showRefreshButton:!1,tabIndex:0,ref:r})})});function VS({artifact:e,isMermaid:t,editorRef:s,previewRef:a,isSubmitting:r}){const{currentCode:o,setCurrentCode:i}=qg(),{data:c}=Sx(),d=n.useRef(null);n.useEffect(()=>{e.id!==d.current&&i(void 0),d.current=e.id},[i,e.id]);const u=e.content??"",m=n.useRef(null);(({ref:e,content:t,isSubmitting:s})=>{const[a,r]=n.useState(!1);n.useEffect(()=>{const t=e.current;if(!t)return;const n=()=>{const{scrollTop:e,scrollHeight:n,clientHeight:s}=t;r(!(n-e-s<50))};return t.addEventListener("scroll",n),()=>{t.removeEventListener("scroll",n)}},[e]),n.useEffect(()=>{const t=e.current;t&&s&&!a&&(t.scrollTop=t.scrollHeight)},[t,s,a,e])})({ref:m,content:u,isSubmitting:r});const{files:p,fileKey:h,template:x,sharedProps:f}=AS({artifact:e});return l.jsxs(l.Fragment,{children:[l.jsx(na,{ref:m,value:"code",id:"artifacts-code",className:Op("flex-grow overflow-auto"),children:l.jsx(zS,{files:p,fileKey:h,template:x,artifact:e,editorRef:s,sharedProps:f,isSubmitting:r})}),l.jsx(na,{value:"preview",className:Op("flex-grow overflow-auto",t?"bg-[#282C34]":"bg-white"),children:l.jsx(FS,{files:p,fileKey:h,template:x,previewRef:a,sharedProps:f,currentCode:o,startupConfig:c})})]})}const $S=n.memo(({inline:e,className:t,children:n})=>{const s=/language-(\w+)/.exec(t??""),a=s&&s[1];return e?l.jsx("code",{onDoubleClick:Qp,className:t,children:n}):l.jsx("code",{className:`hljs language-${a} !whitespace-pre`,children:n})});n.memo(({content:e="",isSubmitting:t})=>{const s=n.useRef(null),[a,r]=n.useState(!1),o=e,i=[[ao],[ro,{detect:!0,ignoreMissing:!0,subset:hp}]];return n.useEffect(()=>{const e=s.current;if(!e)return;const t=()=>{const{scrollTop:t,scrollHeight:n,clientHeight:s}=e;r(!(n-t-s<50))};return e.addEventListener("scroll",t),()=>{e.removeEventListener("scroll",t)}},[]),n.useEffect(()=>{const e=s.current;e&&t&&!a&&(e.scrollTop=e.scrollHeight)},[e,t,a]),l.jsx("div",{ref:s,className:"max-h-full overflow-y-auto",children:l.jsx(so,{rehypePlugins:i,components:{code:$S},children:o})})});const BS=({content:e})=>{const t=zf(),[s,a]=n.useState(!1);return l.jsx("button",{className:"mr-2 text-text-secondary",onClick:()=>{D(e,{format:"text/plain"}),a(!0),setTimeout(()=>a(!1),3e3)},"aria-label":t(s?"com_ui_copied":"com_ui_copy_code"),children:s?l.jsx(qb,{className:"h-[18px] w-[18px]"}):l.jsx(Wb,{})})};function US(){const e=zf(),{isMutating:t}=qg(),s=n.useRef(),a=n.useRef(),[r,o]=n.useState(!1),[i,c]=n.useState(!1),d=y(sx.artifactsVisibility);n.useEffect(()=>{o(!0)},[]);const{activeTab:u,isMermaid:m,setActiveTab:p,currentIndex:h,isSubmitting:x,cycleArtifact:f,currentArtifact:g,orderedArtifactIds:v}=function(){const[e,t]=n.useState("preview"),{isSubmitting:s,latestMessage:a,conversation:r}=rg(),o=_(sx.artifactsState),i=w(sx.artifactsState),l=w(sx.currentArtifactId),[c,d]=b(sx.currentArtifactId),u=n.useMemo(()=>Object.keys(o??{}).sort((e,t)=>{var n,s;return((null==(n=null==o?void 0:o[e])?void 0:n.lastUpdateTime)??0)-((null==(s=null==o?void 0:o[t])?void 0:s.lastUpdateTime)??0)}),[o]),m=n.useRef(null),p=n.useRef(!1),h=n.useRef(!1),x=n.useRef(null),f=n.useRef(null);n.useEffect(()=>{const e=()=>{i(),l(),f.current=(null==r?void 0:r.conversationId)??null,x.current=null,m.current=null,p.current=!1};return((null==r?void 0:r.conversationId)!==f.current&&null!=f.current||(null==r?void 0:r.conversationId)===Zc.NEW_CONVO)&&e(),f.current=(null==r?void 0:r.conversationId)??null,()=>{Dp.log("artifacts_visibility","Unmounting artifacts"),e()}},[null==r?void 0:r.conversationId,i,l]),n.useEffect(()=>{if(u.length>0){const e=u[u.length-1];d(e)}},[d,u]),n.useEffect(()=>{var e;if(!s)return;if(0===u.length)return;if(null==a)return;const n=u[u.length-1],r=null==o?void 0:o[n];if((null==r?void 0:r.content)===m.current)return;d(n),m.current=(null==r?void 0:r.content)??null;const i=mp(a);if(/:::artifact(?:\{[^}]*\})?(?:\s|\n)*(?:```[\s\S]*?```(?:\s|\n)*)?:::/m.test(i.trim())&&!p.current)t("preview"),p.current=!0,h.current=!1;else if(!p.current&&!h.current){const n=(null==(e=null==r?void 0:r.content)?void 0:e.slice(0,50))??"";n.length>0&&i.includes(n)&&(t("code"),h.current=!0)}},[d,s,u,o,a]),n.useEffect(()=>{(null==a?void 0:a.messageId)!==x.current&&(x.current=(null==a?void 0:a.messageId)??null,p.current=!1,h.current=!1)},[a]);const g=null!=c?null==o?void 0:o[c]:null,v=u.indexOf(c??"");return{activeTab:e,isMermaid:n.useMemo(()=>null!=(null==g?void 0:g.type)&&vg(g.type,g.language).includes("mermaid"),[null==g?void 0:g.type,null==g?void 0:g.language]),setActiveTab:t,currentIndex:v,isSubmitting:s,cycleArtifact:e=>{let t;t="next"===e?(v+1)%u.length:(v-1+u.length)%u.length,d(u[t])},currentArtifact:g,orderedArtifactIds:u}}();if(null==g)return null;const j=()=>{o(!1),setTimeout(()=>d(!1),300)};return l.jsx(da,{value:u,onValueChange:p,asChild:!0,children:l.jsx("div",{className:"flex h-full w-full items-center justify-center",children:l.jsxs("div",{className:"flex h-full w-full flex-col overflow-hidden border border-border-medium bg-surface-primary text-xl text-text-primary shadow-xl transition-all duration-500 ease-in-out "+(r?"scale-100 opacity-100 blur-0":"scale-105 opacity-0 blur-sm"),children:[l.jsxs("div",{className:"flex items-center justify-between border-b border-border-medium bg-surface-primary-alt p-2",children:[l.jsxs("div",{className:"flex items-center",children:[l.jsx("button",{className:"mr-2 text-text-secondary",onClick:j,children:l.jsx(Je,{className:"h-4 w-4"})}),l.jsx("h3",{className:"truncate text-sm text-text-primary",children:g.title})]}),l.jsxs("div",{className:"flex items-center",children:["preview"===u&&l.jsx("button",{className:"mr-2 text-text-secondary transition-transform duration-500 ease-in-out "+(i?"rotate-180":""),onClick:()=>{var e;c(!0);const t=null==(e=a.current)?void 0:e.getClient();null!=t&&t.dispatch({type:"refresh"}),setTimeout(()=>c(!1),750)},disabled:i,"aria-label":"Refresh",children:l.jsx(un,{size:16,className:"transform "+(i?"animate-spin":"")})}),"preview"!==u&&t&&l.jsx(un,{size:16,className:"mr-2 animate-spin text-text-secondary"}),l.jsxs(ea,{className:"mr-2 inline-flex h-7 rounded-full border border-border-medium bg-surface-tertiary",children:[l.jsx(ta,{value:"preview",disabled:t,className:"border-0.5 flex items-center gap-1 rounded-full border-transparent py-1 pl-2.5 pr-2.5 text-xs font-medium text-text-secondary data-[state=active]:border-border-light data-[state=active]:bg-surface-primary-alt data-[state=active]:text-text-primary",children:e("com_ui_preview")}),l.jsx(ta,{value:"code",className:"border-0.5 flex items-center gap-1 rounded-full border-transparent py-1 pl-2.5 pr-2.5 text-xs font-medium text-text-secondary data-[state=active]:border-border-light data-[state=active]:bg-surface-primary-alt data-[state=active]:text-text-primary",children:e("com_ui_code")})]}),l.jsx("button",{className:"text-text-secondary",onClick:j,children:l.jsx(re,{className:"h-4 w-4"})})]})]}),l.jsx(VS,{isMermaid:m,artifact:g,isSubmitting:x,editorRef:s,previewRef:a}),l.jsxs("div",{className:"flex items-center justify-between border-t border-border-medium bg-surface-primary-alt p-2 text-sm text-text-secondary",children:[l.jsxs("div",{className:"flex items-center",children:[l.jsx("button",{onClick:()=>f("prev"),className:"mr-2 text-text-secondary",children:l.jsx(zt,{className:"h-4 w-4"})}),l.jsx("span",{className:"text-xs",children:`${h+1} / ${v.length}`}),l.jsx("button",{onClick:()=>f("next"),className:"ml-2 text-text-secondary",children:l.jsx(te,{className:"h-4 w-4"})})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(BS,{content:g.content??""}),l.jsx(OS,{artifact:g})]})]})]})})})}const HS=({className:e="",...t})=>l.jsx(xn,{className:Op("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",e),...t}),KS=mn,GS=({withHandle:e,className:t="",...n})=>l.jsx(pn,{className:Op("bg-border focus-visible:ring-ring group relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",t),...n,children:e&&l.jsx("div",{className:"bg-border invisible z-10 flex h-4 w-3 items-center justify-center rounded-sm border group-hover:visible group-active:visible",children:l.jsx(hn,{className:"h-2.5 w-2.5"})})}),WS=(e,t,n)=>{if(!n||0===n.length)return!1;if(!t){return 0===n.findIndex(t=>t.name===e.name&&t.instructions===e.instructions&&t.artifacts===e.artifacts)}const s=e.name===t.name,a=e.description===t.description,r=e.instructions===t.instructions,o=e.artifacts===t.artifacts;return s&&a&&r&&o&&(()=>{if(!e.tools&&!t.tools)return!0;if(!e.tools||!t.tools)return!1;if(e.tools.length!==t.tools.length)return!1;const n=[...e.tools].sort(),s=[...t.tools].sort();return n.every((e,t)=>e===s[t])})()&&(()=>{if(!e.capabilities&&!t.capabilities)return!0;if(!e.capabilities||!t.capabilities)return!1;if(e.capabilities.length!==t.capabilities.length)return!1;const n=[...e.capabilities].sort(),s=[...t.capabilities].sort();return n.every((e,t)=>e===s[t])})()};function qS({version:e,index:t,isActive:n,versionsLength:s,onRestore:a}){const r=zf();return l.jsxs("div",{className:"rounded-md border border-border-light p-3",children:[l.jsxs("div",{className:"flex items-center justify-between font-medium",children:[l.jsx("span",{children:r("com_ui_agent_version_title",{versionNumber:s-t})}),n&&l.jsx("span",{className:"rounded-full border border-gray-400 bg-white px-2 py-0.5 text-xs font-medium text-black dark:border-gray-500 dark:bg-gray-800 dark:text-white",children:r("com_ui_agent_version_active")})]}),l.jsx("div",{className:"text-sm text-text-secondary",children:(e=>{const t=e.updatedAt||e.createdAt;if(t)try{const e=new Date(t);return isNaN(e.getTime())||"Invalid Date"===e.toString()?r("com_ui_agent_version_unknown_date"):e.toLocaleString()}catch(n){return r("com_ui_agent_version_unknown_date")}return r("com_ui_agent_version_no_date")})(e)}),!n&&l.jsx("button",{className:"mt-2 text-sm text-blue-500 hover:text-blue-600",onClick:()=>{window.confirm(r("com_ui_agent_version_restore_confirm"))&&a(t)},"aria-label":r("com_ui_agent_version_restore"),children:r("com_ui_agent_version_restore")})]})}function QS({selectedAgentId:e,isLoading:t,error:n,versionContext:s,onRestore:a}){const{versions:r,versionIds:o}=s,i=zf();return e?t?l.jsx("div",{className:"flex items-center justify-center py-8",children:l.jsx(Gb,{className:"h-6 w-6"})}):n?l.jsx("div",{className:"py-8 text-center text-red-500",children:i("com_ui_agent_version_error")}):o.length>0?l.jsx("div",{className:"flex flex-col gap-2",children:o.map(({id:e,version:t,isActive:n})=>l.jsx(qS,{version:t,index:e,isActive:n,versionsLength:r.length,onRestore:a},e))}):l.jsx("div",{className:"py-8 text-center text-text-secondary",children:i("com_ui_agent_version_empty")}):l.jsx("div",{className:"py-8 text-center text-text-secondary",children:i("com_ui_agent_version_no_agent")})}function ZS(){const e=zf(),{showToast:t}=Lf(),{agent_id:s,setActivePanel:a}=Fg(),r=s??"",{data:o,isLoading:i,error:c,refetch:d}=vx(r,{enabled:!!r&&""!==r}),u=(e=>{const t=Aa();return Oa(({agent_id:e,version_index:t})=>fu({agent_id:e,version_index:t}),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,s)=>{var a;return null==(a=null==e?void 0:e.onError)?void 0:a.call(e,t,n,s)},onSuccess:(n,s,a)=>{var r;t.setQueryData([Pd.agent,s.agent_id],n);const o=t.getQueryData([Pd.agents,li]);return o&&t.setQueryData([Pd.agents,li],{...o,data:o.data.map(e=>e.id===s.agent_id?n:e)}),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,s,a)}})})({onSuccess:()=>{t({message:e("com_ui_agent_version_restore_success"),status:"success"}),d()},onError:()=>{t({message:e("com_ui_agent_version_restore_error"),status:"error"})}}),m=o,p=n.useMemo(()=>m?{name:m.name,description:m.description,instructions:m.instructions,artifacts:m.artifacts,capabilities:m.capabilities,tools:m.tools}:null,[m]),h=n.useMemo(()=>[...(null==m?void 0:m.versions)||[]].sort((e,t)=>{const n=e.updatedAt?new Date(e.updatedAt).getTime():0;return(t.updatedAt?new Date(t.updatedAt).getTime():0)-n}),[null==m?void 0:m.versions]),x=n.useMemo(()=>h.length>0&&h.find(e=>WS(e,p,h))||null,[h,p]),f=n.useMemo(()=>{if(0===h.length)return[];const e=h.filter(e=>WS(e,p,h)),t=e.length>0?h.findIndex(t=>t===e[0]):-1;return h.map((e,n)=>{var s;return{id:n,originalIndex:(null==(s=null==m?void 0:m.versions)?void 0:s.findIndex(t=>t.updatedAt===e.updatedAt&&t.createdAt===e.createdAt&&t.name===e.name))??n,version:e,isActive:n===t}})},[h,p,null==m?void 0:m.versions]),g=n.useMemo(()=>({versions:h,versionIds:f,currentAgent:p,selectedAgentId:r,activeVersion:x}),[h,f,p,r,x]),v=n.useCallback(e=>{const t=f.find(t=>t.id===e);if(t){const e=t.originalIndex;u.mutate({agent_id:r,version_index:e})}},[u,r,f]);return l.jsxs("div",{className:"scrollbar-gutter-stable h-full min-h-[40vh] overflow-auto pb-12 text-sm",children:[l.jsxs("div",{className:"version-panel relative flex flex-col items-center px-16 py-4 text-center",children:[l.jsx("div",{className:"absolute left-0 top-4",children:l.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{a(Ko.builder)},children:l.jsx("div",{className:"version-panel-content flex w-full items-center justify-center gap-2",children:l.jsx(zt,{})})})}),l.jsx("div",{className:"mb-2 mt-2 text-xl font-medium",children:e("com_ui_agent_version_history")})]}),l.jsx("div",{className:"flex flex-col gap-4 px-2",children:l.jsx(QS,{selectedAgentId:r,isLoading:i,error:c,versionContext:g,onRestore:v})})]})}function JS({disableOAuth:e}){const t=zf(),[s,a]=n.useState(!1),{watch:r,setValue:o,trigger:i}=Pr(),c=r("type");return l.jsxs(A_,{open:s,onOpenChange:a,children:[l.jsx(O_,{asChild:!0,children:l.jsxs("div",{className:"relative mb-4",children:[l.jsx("div",{className:"mb-1.5 flex items-center",children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:t("com_ui_authentication")})}),l.jsxs("div",{className:"border-token-border-medium flex rounded-lg border text-sm hover:cursor-pointer",children:[l.jsx("div",{className:"h-9 grow px-3 py-2",children:t(XS(c))}),l.jsx("div",{className:"bg-token-border-medium w-px"}),l.jsx("button",{type:"button",color:"neutral",className:"flex items-center gap-2 px-3",children:l.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-sm",children:[l.jsx("path",{d:"M11.6439 3C10.9352 3 10.2794 3.37508 9.92002 3.98596L9.49644 4.70605C8.96184 5.61487 7.98938 6.17632 6.93501 6.18489L6.09967 6.19168C5.39096 6.19744 4.73823 6.57783 4.38386 7.19161L4.02776 7.80841C3.67339 8.42219 3.67032 9.17767 4.01969 9.7943L4.43151 10.5212C4.95127 11.4386 4.95127 12.5615 4.43151 13.4788L4.01969 14.2057C3.67032 14.8224 3.67339 15.5778 4.02776 16.1916L4.38386 16.8084C4.73823 17.4222 5.39096 17.8026 6.09966 17.8083L6.93502 17.8151C7.98939 17.8237 8.96185 18.3851 9.49645 19.294L9.92002 20.014C10.2794 20.6249 10.9352 21 11.6439 21H12.3561C13.0648 21 13.7206 20.6249 14.08 20.014L14.5035 19.294C15.0381 18.3851 16.0106 17.8237 17.065 17.8151L17.9004 17.8083C18.6091 17.8026 19.2618 17.4222 19.6162 16.8084L19.9723 16.1916C20.3267 15.5778 20.3298 14.8224 19.9804 14.2057L19.5686 13.4788C19.0488 12.5615 19.0488 11.4386 19.5686 10.5212L19.9804 9.7943C20.3298 9.17767 20.3267 8.42219 19.9723 7.80841L19.6162 7.19161C19.2618 6.57783 18.6091 6.19744 17.9004 6.19168L17.065 6.18489C16.0106 6.17632 15.0382 5.61487 14.5036 4.70605L14.08 3.98596C13.7206 3.37508 13.0648 3 12.3561 3H11.6439Z",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round"}),l.jsx("circle",{cx:"12",cy:"12",r:"2.5",stroke:"currentColor",strokeWidth:"2"})]})})]})]})}),l.jsxs(V_,{className:"w-full max-w-md border-none bg-surface-primary text-text-primary",children:[l.jsx($_,{className:"border-b border-border-light sm:p-3",children:l.jsx(U_,{children:t("com_ui_authentication")})}),l.jsxs("div",{className:"p-4 sm:p-6 sm:pt-0",children:[l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"mb-1 block text-sm font-medium",children:t("com_ui_authentication_type")}),l.jsxs(ua,{defaultValue:Ll.None,onValueChange:e=>o("type",e),value:c,role:"radiogroup","aria-required":"false",dir:"ltr",className:"flex gap-4",style:{outline:"none"},children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:":rf8:",className:"flex cursor-pointer items-center gap-1",children:[l.jsx(ma,{type:"button",role:"radio",value:Ll.None,id:":rf8:",className:Op("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(pa,{className:"h-2 w-2 rounded-full bg-text-primary"})}),t("com_ui_none")]})}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:":rfa:",className:"flex cursor-pointer items-center gap-1",children:[l.jsx(ma,{type:"button",role:"radio",value:Ll.ServiceHttp,id:":rfa:",className:Op("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(pa,{className:"h-2 w-2 rounded-full bg-text-primary"})}),t("com_ui_api_key")]})}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:":rfc:",className:Op("flex items-center gap-1",!0===e?"cursor-not-allowed":"cursor-pointer"),children:[l.jsx(ma,{type:"button",role:"radio",disabled:e,value:Ll.OAuth,id:":rfc:",className:Op("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary",!0===e?"cursor-not-allowed":""),children:l.jsx(pa,{className:"h-2 w-2 rounded-full bg-text-primary"})}),t("com_ui_oauth")]})})]})]}),"none"===c?null:"service_http"===c?l.jsx(YS,{}):l.jsx(eT,{}),l.jsxs("div",{className:"mt-5 flex flex-col gap-3 sm:mt-4 sm:flex-row-reverse",children:[l.jsx("button",{className:"btn relative bg-surface-submit text-primary-foreground hover:bg-surface-submit-hover",onClick:async()=>{const e=await i(void 0,{shouldFocus:!0});o("saved_auth_fields",e),a(!e)},children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2 text-white",children:t("com_ui_save")})}),l.jsx(z_,{className:"btn btn-neutral relative",children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:t("com_ui_cancel")})})]})]})]})]})}const YS=()=>{const e=zf(),{register:t,watch:n,setValue:s}=Pr(),a=n("authorization_type"),r=n("type");return l.jsxs(l.Fragment,{children:[l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_api_key")}),l.jsx("input",{placeholder:"<HIDDEN>",type:"new-password",autoComplete:"new-password",className:Op("mb-2 h-9 w-full resize-none overflow-y-auto rounded-lg border px-3 py-2 text-sm","border-border-medium bg-surface-primary outline-none","focus:ring-2 focus:ring-ring"),...t("api_key",{required:r===Ll.ServiceHttp})}),l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_auth_type")}),l.jsxs(ua,{defaultValue:Al.Basic,onValueChange:e=>s("authorization_type",e),value:a,role:"radiogroup","aria-required":"true",dir:"ltr",className:"mb-2 flex gap-6 overflow-hidden rounded-lg",style:{outline:"none"},children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:":rfu:",className:"flex cursor-pointer items-center gap-1",children:[l.jsx(ma,{type:"button",role:"radio",value:Al.Basic,id:":rfu:",className:Op("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(pa,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_basic")]})}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:":rg0:",className:"flex cursor-pointer items-center gap-1",children:[l.jsx(ma,{type:"button",role:"radio",value:Al.Bearer,id:":rg0:",className:Op("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(pa,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_bearer")]})}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:":rg2:",className:"flex cursor-pointer items-center gap-1",children:[l.jsx(ma,{type:"button",role:"radio",value:Al.Custom,id:":rg2:",className:Op("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(pa,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_custom")]})})]}),a===Al.Custom&&l.jsxs("div",{className:"mt-2",children:[l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_custom_header_name")}),l.jsx("input",{className:Op("mb-2 h-9 w-full resize-none overflow-y-auto rounded-lg border px-3 py-2 text-sm","border-border-medium bg-surface-primary outline-none","focus:ring-2 focus:ring-ring"),placeholder:"X-Api-Key",...t("custom_auth_header",{required:a===Al.Custom})})]})]})};function XS(e){switch(e){case Ll.ServiceHttp:return"com_ui_api_key";case Ll.OAuth:return"com_ui_oauth";default:return"com_ui_none"}}const eT=()=>{const e=zf(),{register:t,watch:n,setValue:s}=Pr(),a=n("token_exchange_method"),r=n("type"),o=Op("mb-2 h-9 w-full resize-none overflow-y-auto rounded-lg border px-3 py-2 text-sm","border-border-medium bg-surface-primary outline-none","focus:ring-2 focus:ring-ring");return l.jsxs(l.Fragment,{children:[l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_client_id")}),l.jsx("input",{placeholder:"<HIDDEN>",type:"password",autoComplete:"new-password",className:o,...t("oauth_client_id",{required:!1})}),l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_client_secret")}),l.jsx("input",{placeholder:"<HIDDEN>",type:"password",autoComplete:"new-password",className:o,...t("oauth_client_secret",{required:!1})}),l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_auth_url")}),l.jsx("input",{className:o,...t("authorization_url",{required:r===Ll.OAuth})}),l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_token_url")}),l.jsx("input",{className:o,...t("client_url",{required:r===Ll.OAuth})}),l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_scope")}),l.jsx("input",{className:o,...t("scope",{required:r===Ll.OAuth})}),l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_token_exchange_method")}),l.jsxs(ua,{defaultValue:Al.Basic,onValueChange:e=>s("token_exchange_method",e),value:a,role:"radiogroup","aria-required":"true",dir:"ltr",style:{outline:"none"},children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:":rj1:",className:"flex cursor-pointer items-center gap-1",children:[l.jsx(ma,{type:"button",role:"radio",value:Ol.DefaultPost,id:":rj1:",className:Op("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(pa,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_default_post_request")]})}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:":rj3:",className:"flex cursor-pointer items-center gap-1",children:[l.jsx(ma,{type:"button",role:"radio",value:Ol.BasicAuthHeader,id:":rj3:",className:Op("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(pa,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_basic_auth_header")]})})]})]})};function tT({action_id:e}){const t=zf(),{watch:s}=Pr(),{showToast:a}=Of(),[r,o]=n.useState(!1),i=`${window.location.protocol}//${window.location.host}/api/actions/${e}/oauth/callback`,c=mb({text:i});if(!e)return null;return s("type")!==Ll.OAuth?null:l.jsxs("div",{className:"mb-1.5 flex flex-col space-y-2",children:[l.jsx("label",{className:"font-semibold",children:t("com_ui_callback_url")}),l.jsx("div",{className:"relative flex items-center",children:l.jsxs("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover flex h-10 w-full rounded-lg border",children:[l.jsx("div",{className:"flex-1 overflow-hidden",children:l.jsx("div",{className:"relative w-full",children:l.jsx("input",{type:"text",readOnly:!0,value:i,className:"w-full border-0 bg-transparent px-3 py-2 pr-12 text-sm text-text-secondary-alt focus:outline-none",style:{direction:"rtl"}})})}),l.jsx("div",{className:"absolute right-0 flex h-full items-center pr-1",children:l.jsx(c_,{size:"sm",variant:"ghost",type:"button",onClick:()=>{r||(a({message:t("com_ui_copied_to_clipboard")}),c(o))},className:Op("h-8 rounded-md px-2",r?"cursor-default":""),"aria-label":t("com_ui_copy_link"),children:r?l.jsx(Zt,{className:"size-4"}):l.jsx(Jt,{className:"size-4"})})})]})})]})}function nT({columns:e,data:t}){const n=$a({columns:e,data:t,getCoreRowModel:Ba()});return l.jsxs("table",{className:"w-full text-sm",children:[l.jsx("thead",{children:n.getHeaderGroups().map((e,t)=>l.jsx("tr",{className:"border-token-border-light text-token-text-tertiary border-b text-left text-xs",children:e.headers.map((e,t)=>l.jsx("th",{className:"py-1 font-normal text-text-secondary-alt",children:e.isPlaceholder?null:Ua(e.column.columnDef.header,e.getContext())},t))},t))}),l.jsx("tbody",{children:n.getRowModel().rows.map((e,t)=>l.jsx("tr",{className:"border-token-border-light border-b",children:e.getVisibleCells().map((e,t)=>l.jsx("td",{className:"py-2",children:Ua(e.column.columnDef.cell,e.getContext())},t))},t))})]})}const sT=[{header:"Name",accessorKey:"name"},{header:"Method",accessorKey:"method"},{header:"Path",accessorKey:"path"}],aT=Cr((e,t)=>{t(Bu(e))},800);function rT({action:e,agent_id:t,setAction:s}){const a=e=>{e.status||(x(null),g(null)),u(e)},r=zf(),{showToast:o}=Of(),{handleSubmit:i,reset:c}=Pr(),[d,u]=n.useState(null),[m,p]=n.useState(""),[h,x]=n.useState(null),[f,g]=n.useState(null);n.useEffect(()=>{const t=(null==e?void 0:e.metadata.raw_spec)??"";t&&(p(t),aT(t,a))},[null==e?void 0:e.metadata.raw_spec]),n.useEffect(()=>{if(!d||!d.status||!d.spec)return;const{functionSignatures:e,requestBuilders:t}=$u(d.spec),n=Object.entries(t).map(([e,t])=>({name:e,method:t.method,path:t.path,domain:t.domain}));x(n),u(null),g(e.map(e=>e.toObjectTool()))},[d]);const v=Nx({onSuccess(e){o({message:r("com_assistants_update_actions_success"),status:"success"}),c(),s(e[1])},onError(e){o({message:e.message||r("com_assistants_update_actions_error"),status:"error"})}}),b=i(n=>{Dp.log("actions","saving action",n);const s=t??"";if(!s)return;if(!f)return;if(!h)return;let{metadata:a={}}=e??{};const r=null==e?void 0:e.action_id;a.raw_spec=m;const o=new URL(h[0].domain).hostname;if(!o)return;a.domain=o;const{type:i,saved_auth_fields:l}=n,c=e=>{delete e.auth,delete e.api_key,delete e.oauth_client_id,delete e.oauth_client_secret};l&&i===Ll.ServiceHttp?a={...a,api_key:n.api_key,auth:{type:i,authorization_type:n.authorization_type,custom_auth_header:n.custom_auth_header}}:l&&i===Ll.OAuth?a={...a,auth:{type:i,authorization_url:n.authorization_url,client_url:n.client_url,scope:n.scope,token_exchange_method:n.token_exchange_method},oauth_client_id:n.oauth_client_id,oauth_client_secret:n.oauth_client_secret}:l?(c(a),a.auth={type:i}):c(a),v.mutate({action_id:r,metadata:a,functions:f,agent_id:s})});return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"",children:[l.jsxs("div",{className:"mb-1 flex flex-wrap items-center justify-between gap-4",children:[l.jsx("label",{htmlFor:"schemaInput",className:"text-token-text-primary whitespace-nowrap font-medium",children:"Schema"}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("select",{onChange:e=>Dp.log("actions","selecting example action",e.target.value),className:"border-token-border-medium h-8 min-w-[100px] rounded-lg border bg-transparent px-2 py-0 text-sm",children:[l.jsx("option",{value:"label",children:r("com_ui_examples")}),l.jsx("option",{value:"0",children:"Weather (JSON)"}),l.jsx("option",{value:"1",children:"Pet Store (YAML)"}),l.jsx("option",{value:"2",children:"Blank Template"})]})})]}),l.jsxs("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover mb-4 w-full overflow-hidden rounded-lg border ring-0",children:[l.jsx("div",{className:"relative",children:l.jsx("textarea",{id:"schemaInput",value:m,onChange:e=>{const t=e.target.value;if(p(t),!t)return x(null),g(null),u(null);aT(t,a)},spellCheck:"false",placeholder:r("com_ui_enter_openapi_schema"),className:"text-token-text-primary block h-96 w-full bg-transparent p-2 font-mono text-xs outline-none focus:ring-1 focus:ring-border-light"})}),d&&"OpenAPI spec is valid."!==d.message&&l.jsx("div",{className:"border-token-border-light border-t p-2 text-red-500",children:d.message.split("\n").map((e,t)=>l.jsx("div",{children:e},t))})]})]}),!!h&&l.jsxs("div",{className:"my-2",children:[l.jsx("div",{className:"flex items-center",children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:r("com_assistants_available_actions")})}),l.jsx(nT,{columns:sT,data:h})]}),l.jsxs("div",{className:"relative my-1",children:[l.jsx(tT,{action_id:null==e?void 0:e.action_id}),l.jsx("div",{className:"mb-1.5 flex items-center",children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:r("com_ui_privacy_policy_url")})}),l.jsx("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover flex h-9 w-full rounded-lg border",children:l.jsx("input",{type:"text",placeholder:"https://api.example-weather-app.com/privacy",className:"flex-1 rounded-lg bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light"})})]}),l.jsx("div",{className:"flex items-center justify-end",children:l.jsx("button",{disabled:!f||!f.length,onClick:b,className:"focus:shadow-outline mt-1 flex min-w-[100px] items-center justify-center rounded bg-white px-4 py-2 font-semibold text-black hover:bg-gray-100 focus:border-black focus:outline-none focus:ring-0 disabled:bg-gray-100 dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 dark:focus:border-white dark:disabled:bg-gray-700 border border-gray-300 dark:border-gray-600",type:"button",children:v.isLoading?l.jsx(Gb,{className:"icon-md"}):null!=(null==e?void 0:e.action_id)&&e.action_id?r("com_ui_update"):r("com_ui_create")})})]})}function oT(){const e=zf(),{showToast:t}=Of(),{setActivePanel:s,action:a,setAction:r,agent_id:o}=Fg(),i=Cx({onSuccess:()=>{t({message:e("com_assistants_delete_actions_success"),status:"success"}),s(Ko.builder),r(void 0)},onError(n){t({message:n.message??e("com_assistants_delete_actions_error"),status:"error"})}}),c=Rr({defaultValues:{type:Ll.None,saved_auth_fields:!1,api_key:"",authorization_type:Al.Basic,custom_auth_header:"",oauth_client_id:"",oauth_client_secret:"",authorization_url:"",client_url:"",scope:"",token_exchange_method:Ol.DefaultPost}}),{reset:d}=c;return n.useEffect(()=>{(null==a?void 0:a.metadata.auth)&&d({type:a.metadata.auth.type||Ll.None,saved_auth_fields:!1,api_key:a.metadata.api_key??"",authorization_type:a.metadata.auth.authorization_type||Al.Basic,oauth_client_id:a.metadata.oauth_client_id??"",oauth_client_secret:a.metadata.oauth_client_secret??"",authorization_url:a.metadata.auth.authorization_url??"",client_url:a.metadata.auth.client_url??"",scope:a.metadata.auth.scope??"",token_exchange_method:a.metadata.auth.token_exchange_method??Ol.DefaultPost})},[a,d]),l.jsx(Ar,{...c,children:l.jsx("form",{className:"h-full grow overflow-hidden",children:l.jsxs("div",{className:"h-full overflow-auto px-2 pb-12 text-sm",children:[l.jsxs("div",{className:"relative flex flex-col items-center px-16 py-6 text-center",children:[l.jsx("div",{className:"absolute left-0 top-6",children:l.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{s(Ko.builder),r(void 0)},children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:l.jsx(zt,{})})})}),!!a&&l.jsxs(A_,{children:[l.jsx(O_,{asChild:!0,children:l.jsx("div",{className:"absolute right-0 top-6",children:l.jsx("button",{type:"button",disabled:!o||!a.action_id,className:"btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",children:l.jsx(py,{className:"text-red-500"})})})}),l.jsx(Oj,{showCloseButton:!1,title:e("com_ui_delete_action"),className:"max-w-[450px]",main:l.jsx(L_,{className:"text-left text-sm font-medium",children:e("com_ui_delete_action_confirm")}),selection:{selectHandler:()=>{if(!o)return t({message:e("com_agents_no_agent_id_error"),status:"error"});i.mutate({action_id:a.action_id,agent_id:o})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:e("com_ui_delete")}})]}),l.jsx("div",{className:"text-xl font-medium",children:(a?"Edit":"Add")+" actions"}),l.jsx("div",{className:"text-xs text-text-secondary",children:e("com_assistants_actions_info")})]}),l.jsx(JS,{}),l.jsx(rT,{action:a,agent_id:o,setAction:r})]})})})}function iT(){return l.jsxs("div",{className:"h-auto bg-white dark:bg-transparent",children:[l.jsxs("div",{className:"mb-4",children:[l.jsx("div",{className:"flex w-full items-center justify-center gap-4",children:l.jsx(q_,{className:"relative h-20 w-20 rounded-full"})}),l.jsx(q_,{className:"mb-2 h-5 w-1/5 rounded-lg"}),l.jsx(q_,{className:"mb-1 h-[40px] w-full rounded-lg"}),l.jsx(q_,{className:"h-3 w-1/4 rounded-lg"})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx(q_,{className:"mb-2 h-5 w-1/4 rounded-lg"}),l.jsx(q_,{className:"h-[40px] w-full rounded-lg"})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx(q_,{className:"mb-2 h-5 w-1/4 rounded-lg"}),l.jsx(q_,{className:"h-[100px] w-full rounded-lg"})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx(q_,{className:"mb-2 h-5 w-1/4 rounded-lg"}),l.jsx(q_,{className:"h-[40px] w-full rounded-lg"})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx(q_,{className:"mb-2 h-5 w-1/4 rounded-lg"}),l.jsx(q_,{className:"mb-2 h-5 w-36 rounded-lg"}),l.jsx(q_,{className:"mb-4 h-[35px] w-full rounded-lg"}),l.jsx(q_,{className:"mb-2 h-5 w-24 rounded-lg"}),l.jsx(q_,{className:"h-[35px] w-full rounded-lg"})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx(q_,{className:"mb-2 h-5 w-1/4 rounded-lg"}),l.jsx(q_,{className:"mb-2 h-[35px] w-full rounded-lg"}),l.jsx(q_,{className:"mb-2 h-[35px] w-full rounded-lg"}),l.jsxs("div",{className:"flex space-x-2",children:[l.jsx(q_,{className:"h-8 w-1/2 rounded-lg"}),l.jsx(q_,{className:"h-8 w-1/2 rounded-lg"})]})]}),l.jsx("div",{className:"mb-6",children:l.jsx(q_,{className:"h-[35px] w-full rounded-lg"})}),l.jsxs("div",{className:"flex items-center justify-end gap-2",children:[l.jsx(q_,{className:"h-[35px] w-16 rounded-lg"}),l.jsx(q_,{className:"h-[35px] w-16 rounded-lg"}),l.jsx(q_,{className:"h-[35px] w-16 rounded-lg"}),l.jsx(q_,{className:"h-[35px] w-full rounded-lg"})]})]})}function lT(){const e=zf(),t=Pr(),{control:n}=t;return l.jsxs(T_,{openDelay:50,children:[l.jsx(Ir,{name:"recursion_limit",control:n,render:({field:t})=>l.jsx(bj,{field:t,containerClass:"w-1/2",inputClass:"w-full",label:e("com_ui_agent_recursion_limit"),placeholder:e("com_nav_theme_system"),type:"number",labelClass:"w-fit",labelAdjacent:l.jsx(R_,{children:l.jsx(Iy,{className:"h-4 w-4 text-text-tertiary"})})})}),l.jsx(I_,{children:l.jsx(E_,{side:Go.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:e("com_ui_agent_recursion_limit_info")})})})})]})}const cT=({field:e,currentAgentId:t})=>{var s;const a=zf(),[r,o]=n.useState(""),i=cg()||{},c=e.value||[],d=n.useMemo(()=>Object.values(i),[i]),u=n.useMemo(()=>d.filter(e=>(null==e?void 0:e.id)!==t).map(e=>({label:(null==e?void 0:e.name)||"",value:null==e?void 0:e.id,icon:l.jsx(sC,{message:{endpoint:vi.agents,isCreatedByUser:!1},agent:e})})),[d,t]),p=n.useCallback(e=>i[e],[i]);n.useEffect(()=>{r&&c.length<10&&(e.onChange([...c,r]),o(""))},[r,c,e]);return l.jsxs(T_,{openDelay:50,children:[l.jsxs("div",{className:"flex items-center justify-between gap-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("label",{className:"font-semibold text-text-primary",children:a("com_ui_agent_chain")}),l.jsx(R_,{children:l.jsx(Iy,{className:"h-4 w-4 text-text-tertiary"})})]}),l.jsxs("div",{className:"text-xs text-text-secondary",children:[c.length," / ",10]})]}),l.jsxs("div",{className:"space-y-1",children:[l.jsx("div",{className:"flex h-10 items-center justify-between rounded-md border border-border-medium bg-surface-primary-contrast px-3 py-2",children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:l.jsx(sC,{message:{endpoint:vi.agents,isCreatedByUser:!1},agent:t?i[t]:void 0})}),l.jsx("div",{className:"font-medium text-text-primary",children:null==(s=p(t))?void 0:s.name})]})}),l.jsx(fn,{className:"mx-auto text-text-secondary",size:14}),c.map((t,n)=>{var s;return l.jsxs(m.Fragment,{children:[l.jsxs("div",{className:"flex h-10 items-center gap-2 rounded-md border border-border-medium bg-surface-tertiary pr-2",children:[l.jsx(eN,{isCollapsed:!1,ariaLabel:a("com_ui_agent_var",{0:a("com_ui_select")}),selectedValue:t,setValue:t=>((t,n)=>{const s=[...c];s[t]=n,e.onChange(s)})(n,t),selectPlaceholder:a("com_ui_agent_var",{0:a("com_ui_select")}),searchPlaceholder:a("com_ui_agent_var",{0:a("com_ui_search")}),items:u,displayValue:(null==(s=p(t))?void 0:s.name)??"",SelectIcon:l.jsx(sC,{message:{endpoint:vi.agents,isCreatedByUser:!1},agent:t?i[t]:void 0}),className:"flex-1 border-border-heavy",containerClassName:"px-0"}),l.jsx("button",{className:"rounded-xl p-1 transition hover:bg-surface-hover",onClick:()=>{return t=n,void e.onChange(c.filter((e,n)=>n!==t));var t},children:l.jsx(re,{size:18,className:"text-text-secondary"})})]}),n<c.length-1&&l.jsx(fn,{className:"mx-auto text-text-secondary",size:14})]},t)}),c.length<10&&l.jsxs(l.Fragment,{children:[c.length>0&&l.jsx(fn,{className:"mx-auto text-text-secondary",size:14}),l.jsx(eN,{isCollapsed:!1,ariaLabel:a("com_ui_agent_var",{0:a("com_ui_add")}),selectedValue:"",setValue:o,selectPlaceholder:a("com_ui_agent_var",{0:a("com_ui_add")}),searchPlaceholder:a("com_ui_agent_var",{0:a("com_ui_search")}),items:u,className:"h-10 w-full border-dashed border-border-heavy text-center text-text-secondary hover:text-text-primary",containerClassName:"px-0",SelectIcon:l.jsx(St,{size:16,className:"text-text-secondary"})})]}),c.length>=10&&l.jsx("p",{className:"pt-1 text-center text-xs italic text-text-tertiary",children:a("com_ui_agent_chain_max",{0:10})})]}),l.jsx(I_,{children:l.jsx(E_,{side:Go.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:a("com_ui_agent_chain_info")})})})})]})};function dT({agentsConfig:e,setActivePanel:t}){const s=zf(),a=Pr(),{control:r,watch:o}=a,i=o("id"),c=n.useMemo(()=>(null==e?void 0:e.capabilities.includes(Yl.chain))??!1,[e]);return l.jsxs("div",{className:"scrollbar-gutter-stable h-full min-h-[40vh] overflow-auto pb-12 text-sm",children:[l.jsxs("div",{className:"advanced-panel relative flex flex-col items-center px-16 py-4 text-center",children:[l.jsx("div",{className:"absolute left-0 top-4",children:l.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{t(Ko.builder)},children:l.jsx("div",{className:"advanced-panel-content flex w-full items-center justify-center gap-2",children:l.jsx(zt,{})})})}),l.jsx("div",{className:"mb-2 mt-2 text-xl font-medium",children:s("com_ui_advanced_settings")})]}),l.jsxs("div",{className:"flex flex-col gap-4 px-2",children:[l.jsx(lT,{}),c&&l.jsx(Ir,{name:"agent_ids",control:r,defaultValue:[],render:({field:e})=>l.jsx(cT,{field:e,currentAgentId:i})})]})]})}function uT({action:e,onClick:t}){const[s,a]=n.useState(!1);return l.jsxs("div",{role:"button",tabIndex:0,onClick:t,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||t()},className:"group flex w-full rounded-lg border border-border-medium text-sm hover:cursor-pointer focus:outline-none focus:ring-2 focus:ring-text-primary",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),"aria-label":`Action for ${e.metadata.domain}`,children:[l.jsx("div",{className:"h-9 grow overflow-hidden text-ellipsis whitespace-nowrap px-3 py-2",style:{wordBreak:"break-all"},children:e.metadata.domain}),l.jsx("div",{className:Op("h-9 w-9 min-w-9 items-center justify-center rounded-lg transition-colors duration-200 hover:bg-surface-tertiary focus:outline-none focus:ring-2 focus:ring-text-primary group-focus:flex",s?"flex":"hidden"),"aria-label":"Settings",children:l.jsx(uy,{className:"icon-sm","aria-hidden":"true"})})]})}function mT({tool:e,onAddTool:t,onRemoveTool:n,isInstalled:s=!1}){var a,r,o;const i=zf(),c=()=>{s?n():t()},d=(null==(a=e.metadata)?void 0:a.name)||e.tool_id,u=(null==(r=e.metadata)?void 0:r.description)||"",m=null==(o=e.metadata)?void 0:o.icon;return l.jsxs("div",{className:"flex flex-col gap-4 rounded border border-border-medium bg-transparent p-6",children:[l.jsxs("div",{className:"flex gap-4",children:[l.jsx("div",{className:"h-[70px] w-[70px] shrink-0",children:l.jsxs("div",{className:"relative h-full w-full",children:[m?l.jsx("img",{src:m,alt:i("com_ui_logo",{0:d}),className:"h-full w-full rounded-[5px] bg-white"}):l.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-[5px] border border-border-medium bg-transparent",children:l.jsx(De,{className:"h-8 w-8 text-text-secondary"})}),l.jsx("div",{className:"absolute inset-0 rounded-[5px] ring-1 ring-inset ring-black/10"})]})}),l.jsxs("div",{className:"flex min-w-0 flex-col items-start justify-between",children:[l.jsx("div",{className:"mb-2 line-clamp-1 max-w-full text-lg leading-5 text-text-primary",children:d}),s?l.jsx("button",{className:"btn relative bg-gray-300 hover:bg-gray-400 dark:bg-gray-50 dark:hover:bg-gray-200",onClick:c,"aria-label":`${i("com_nav_tool_remove")} ${d}`,children:l.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[i("com_nav_tool_remove"),l.jsx(gn,{className:"flex h-4 w-4 items-center stroke-2"})]})}):l.jsx("button",{className:"btn btn-primary relative","aria-label":`${i("com_ui_add")} ${d}`,onClick:c,children:l.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[i("com_ui_add"),l.jsx(St,{className:"flex h-4 w-4 items-center stroke-2"})]})})]})]}),l.jsx("div",{className:"line-clamp-3 h-[60px] text-sm text-text-secondary",children:u})]})}function pT({isOpen:e,endpoint:t,setIsOpen:s}){const a=zf(),{getValues:r,setValue:o}=Pr(),{data:i}=Xx(t),{groupedTools:c}=Fg(),d=wi(t),{maxPage:u,setMaxPage:m,currentPage:p,setCurrentPage:h,itemsPerPage:x,searchChanged:f,setSearchChanged:g,searchValue:v,setSearchValue:b,gridRef:y,handleSearch:_,handleChangePage:j,error:w,setError:N,errorMessage:C,setErrorMessage:k,showPluginAuthForm:S,setShowPluginAuthForm:T,selectedPlugin:R,setSelectedPlugin:I}=function(){const[e,t]=n.useState(1),[s,a]=n.useState(1),[r,o]=n.useState(1),[i,l]=n.useState(!1),[c,d]=n.useState(""),[u,m]=n.useState(!1),[p,h]=n.useState(""),[x,f]=n.useState(!1),[g,v]=n.useState(void 0),b=e=>{const t=e.offsetWidth;let n;t<501?o(8):(n=t<640?2:t<1024?3:4,o(2*n))},y=n.useCallback(e=>{null!==e&&(1===r&&b(e),new ResizeObserver(()=>b(e)).observe(e))},[r]);return{maxPage:e,setMaxPage:t,currentPage:s,setCurrentPage:a,itemsPerPage:r,setItemsPerPage:o,searchChanged:i,setSearchChanged:l,searchValue:c,setSearchValue:d,gridRef:y,handleSearch:e=>{d(e.target.value),l(!0)},handleChangePage:e=>{a(e)},error:u,setError:m,errorMessage:p,setErrorMessage:h,showPluginAuthForm:x,setShowPluginAuthForm:f,selectedPlugin:g,setSelectedPlugin:v}}(),E=Xf(),M=e=>{var t,n;N(!0);const s=(null==(n=null==(t=e.response)?void 0:t.data)?void 0:n.message)??"";s&&k(s),setTimeout(()=>{N(!1),k("")},5e3)},P="tools",L=e=>{const t=()=>{const t=r(P)||[];t.push(e.pluginKey);const n=c[e.pluginKey];if((null==n?void 0:n.tools)&&n.tools.length>0)for(const e of n.tools)t.includes(e.tool_id)||t.push(e.tool_id);o(P,Array.from(new Set(t)))};if(!e.auth)return t();E.mutate(e,{onError:e=>{M(e)},onSuccess:t}),T(!1)},A=Object.values(c||{}).filter(e=>{var t,n;return!!(null==(n=null==(t=e.metadata)?void 0:t.name)?void 0:n.toLowerCase().includes(v.toLowerCase()))||!!e.tools&&e.tools.some(e=>{var t,n;return null==(n=null==(t=e.metadata)?void 0:t.name)?void 0:n.toLowerCase().includes(v.toLowerCase())})});return n.useEffect(()=>{A&&(m(Math.ceil(Object.keys(A||{}).length/x)),f&&(h(1),g(!1)))},[i,x,v,A,f,m,h,g]),l.jsxs(jo,{open:e,onClose:()=>{s(!1),h(1),b("")},className:"relative z-[102]",children:[l.jsx("div",{className:"fixed inset-0 bg-surface-primary opacity-60 transition-opacity dark:opacity-80"}),l.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:l.jsxs(wo,{className:"relative max-h-[90vh] w-full transform overflow-hidden overflow-y-auto rounded-lg bg-surface-secondary text-left shadow-xl transition-all max-sm:h-full sm:mx-7 sm:my-8 sm:max-w-2xl lg:max-w-5xl xl:max-w-7xl",style:{minHeight:"610px"},children:[l.jsxs("div",{className:"flex items-center justify-between border-b-[1px] border-border-medium px-4 pb-4 pt-5 sm:p-6",children:[l.jsx("div",{className:"flex items-center",children:l.jsxs("div",{className:"text-center sm:text-left",children:[l.jsx(No,{className:"text-lg font-medium leading-6 text-text-primary",children:a(d?"com_nav_tool_dialog_agents":"com_nav_tool_dialog")}),l.jsx(Co,{className:"text-sm text-text-secondary",children:a("com_nav_tool_dialog_description")})]})}),l.jsx("div",{children:l.jsx("div",{className:"sm:mt-0",children:l.jsx("button",{onClick:()=>{s(!1),h(1)},className:"inline-block rounded-full text-text-secondary transition-colors hover:text-text-primary","aria-label":"Close dialog",type:"button",children:l.jsx(re,{"aria-hidden":"true"})})})})]}),w&&l.jsxs("div",{className:"relative m-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",role:"alert",children:[a("com_nav_plugin_auth_error")," ",C]}),S&&l.jsx("div",{className:"p-4 sm:p-6 sm:pt-4",children:l.jsx($j,{plugin:R,onSubmit:e=>L(e),isEntityTool:!0})}),l.jsxs("div",{className:"p-4 sm:p-6 sm:pt-4",children:[l.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[l.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[l.jsx(Oe,{className:"h-6 w-6 text-text-tertiary"}),l.jsx("input",{type:"text",value:v,onChange:_,placeholder:a("com_nav_tool_search"),className:"w-64 rounded border border-border-medium bg-transparent px-2 py-1 text-text-primary focus:outline-none"})]}),l.jsx("div",{ref:y,className:"grid grid-cols-1 grid-rows-2 gap-3 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",style:{minHeight:"410px"},children:A&&A.slice((p-1)*x,p*x).map((e,t)=>{var n;return l.jsx(mT,{tool:e,isInstalled:(null==(n=r(P))?void 0:n.includes(e.tool_id))||!1,onAddTool:()=>(e=>{T(!1);const t=null==i?void 0:i.find(t=>t.pluginKey===e);if(I(t),e.includes(Zc.mcp_delimiter))L({pluginKey:e,action:"install",auth:{}});else{const{authConfig:n,authenticated:s=!1}=t??{};n&&n.length>0&&!s?T(!0):L({pluginKey:e,action:"install",auth:{}})}})(e.tool_id),onRemoveTool:()=>(e=>{const t=c[e],n=[e];(null==t?void 0:t.tools)&&t.tools.length>0&&n.push(...t.tools.map(e=>e.tool_id)),E.mutate({pluginKey:e,action:"uninstall",auth:{},isEntityTool:!0},{onError:e=>M(e),onSuccess:()=>{var e;const t=(null==(e=r(P))?void 0:e.filter(e=>!n.includes(e)))||[];o(P,t)}})})(e.tool_id)},t)})})]}),l.jsx("div",{className:"mt-2 flex flex-col items-center gap-2 sm:flex-row sm:justify-between",children:u>0?l.jsx(Fj,{currentPage:p,maxPage:u,onChangePage:j}):l.jsx("div",{style:{height:"21px"}})})]})]})})]})}const hT=Op(Wp,"flex w-full px-3 py-2 border-border-light bg-surface-secondary focus-visible:ring-2 focus-visible:ring-ring-primary",Kp),xT=Object.keys(ed).map(e=>({label:`com_ui_special_var_${e}`,value:`{{${e}}}`}));function fT(){const e=n.useId(),t=zf(),s=Pr(),{control:a,setValue:r,getValues:o}=s,[i,c]=n.useState(!1);return l.jsxs("div",{className:"mb-4",children:[l.jsxs("div",{className:"mb-2 flex items-center",children:[l.jsx("label",{className:"text-token-text-primary flex-grow font-medium",htmlFor:"instructions",children:t("com_ui_instructions")}),l.jsx("div",{className:"ml-auto",title:"Add variables to instructions",children:l.jsx(kj,{portal:!0,mountByState:!0,unmountOnHide:!0,preserveTabOrder:!0,isOpen:i,setIsOpen:c,trigger:l.jsxs(Qe,{id:"variables-menu-button","aria-label":"Add variable to instructions",className:"flex h-7 items-center gap-1 rounded-md border border-border-medium bg-surface-secondary px-2 py-0 text-sm text-text-primary transition-colors duration-200 hover:bg-surface-tertiary",children:[l.jsx(St,{className:"mr-1 h-3 w-3 text-text-secondary","aria-hidden":!0}),t("com_ui_variables")]}),items:xT.map(e=>({label:t(e.label)||e.label,onClick:()=>((e,n)=>{const s=o("instructions")||"",a=s.length>0?"\n":"",i=t(e);r("instructions",s+a+i+": "+n),c(!1)})(e.label,e.value)})),menuId:e,className:"z-30"})})]}),l.jsx(Ir,{name:"instructions",control:a,render:({field:e,fieldState:{error:n}})=>l.jsxs(l.Fragment,{children:[l.jsx("textarea",{...e,value:e.value??"",className:Op(hT,"min-h-[100px] resize-y"),id:"instructions",placeholder:t("com_agents_instructions_placeholder"),rows:3,"aria-label":"Agent instructions","aria-required":"true","aria-invalid":n?"true":"false"}),n&&l.jsx("span",{className:"text-sm text-red-500 transition duration-300 ease-in-out",role:"alert",children:t("com_ui_field_required")})]})})]})}function gT(){return l.jsx("div",{className:"border-token-border-medium flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-black",children:l.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"text-4xl",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[l.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),l.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})}const vT=({url:e,progress:t=1})=>{const n=2*Math.PI*55,s=n-t*n;return l.jsx("div",{children:l.jsxs("div",{className:"relative h-20 w-20 overflow-hidden rounded-full",children:[l.jsx("img",{src:e,className:"bg-token-surface-secondary dark:bg-token-surface-tertiary h-full w-full rounded-full object-cover",alt:"GPT",width:"80",height:"80",style:{opacity:t<1?.4:1}},e||"default-key"),t<1&&l.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:l.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",className:"h-6 w-6",children:[l.jsx("circle",{className:"origin-[50%_50%] -rotate-90 stroke-gray-400",strokeWidth:"10",fill:"transparent",r:"55",cx:"60",cy:"60"}),l.jsx("circle",{className:"origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]",stroke:"currentColor",strokeWidth:"10",strokeDasharray:`${n} ${n}`,strokeDashoffset:s,fill:"transparent",r:"55",cx:"60",cy:"60",style:{transition:"stroke-dashoffset 0.3s linear"}})]})})]})})};function bT({handleFileChange:e}){const t=zf(),s=n.useRef(null);return l.jsx(ha,{children:l.jsxs(xa,{className:"flex min-w-[100px] max-w-xs flex-col rounded-xl border border-gray-400 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-850 dark:text-white",sideOffset:5,children:[l.jsx("div",{role:"menuitem",className:"group m-1.5 flex cursor-pointer gap-2 rounded-lg p-2.5 text-sm hover:bg-gray-100 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 dark:hover:bg-gray-800 dark:hover:bg-white/5",tabIndex:-1,"data-orientation":"vertical",onClick:()=>{var e;s.current&&(s.current.value=""),null==(e=s.current)||e.click()},children:t("com_ui_upload_image")}),l.jsx("input",{accept:"image/png,.png,image/jpeg,.jpg,.jpeg,image/gif,.gif,image/webp,.webp",multiple:!1,type:"file",style:{display:"none"},onChange:e,ref:s,tabIndex:-1})]})})}function yT({agent_id:e="",avatar:t,createMutation:s}){const a=Aa(),[r,o]=n.useState(!1),[i,c]=n.useState(""),[d,u]=n.useState(1),[m,p]=n.useState(null),h=n.useRef(null),{data:x=kl}=Rx({select:e=>El(e)}),f=zf(),{showToast:g}=Of(),{mutate:v}=wx({onMutate:()=>{u(.4)},onSuccess:(t,n)=>{var r,o,i;!1===n.postCreation?g({message:f("com_ui_upload_success")}):h.current!==(null==(r=s.data)?void 0:r.id)&&(h.current=(null==(o=s.data)?void 0:o.id)??""),p(null);const l=(null==(i=t.avatar)?void 0:i.filepath)??"";c(l);const d=a.getQueryData([Pd.agents,li]);if(!(null==d?void 0:d.data))return;const m=d.data.map(n=>n.id===e?{...n,...t}:n);a.setQueryData([Pd.agents,li],{...d,data:m}),u(1)},onError:e=>{console.error("Error:",e),p(null),c(""),g({message:f("com_ui_upload_error"),status:"error"}),u(1)}});n.useEffect(()=>{if(m){const e=new FileReader;e.onloadend=()=>{c(e.result)},e.readAsDataURL(m)}},[m]),n.useEffect(()=>{t&&t.filepath?c(t.filepath):c("")},[t]),n.useEffect(()=>{const e=!!(s.isSuccess&&m&&i&&i.includes("base64"));if((!e||h.current!==s.data.id)&&e&&s.data.id){const e=new FormData;e.append("file",m,m.name),e.append("agent_id",s.data.id),v({agent_id:s.data.id,postCreation:!0,formData:e})}},[s.data,s.isSuccess,m,i,v]);return l.jsxs(fa,{open:r,onOpenChange:o,children:[l.jsx("div",{className:"flex w-full items-center justify-center gap-4",children:l.jsx(ca,{asChild:!0,children:l.jsx("button",{type:"button",className:"h-20 w-20",children:i?l.jsx(vT,{url:i,progress:d}):l.jsx(gT,{})})})}),l.jsx(bT,{handleFileChange:n=>{var s;const a=null==(s=n.target.files)?void 0:s[0],r=x.avatarSizeLimit??0;if(r&&a&&a.size<=r){p(a),o(!1);const n=e??"";if(!n)return;const s=new FormData;s.append("file",a,a.name),s.append("agent_id",n),"object"==typeof t&&s.append("avatar",JSON.stringify(t)),v({agent_id:n,formData:s})}else{const e=r?Pm(r):2;g({message:f("com_ui_upload_invalid_var",{0:e+""}),status:"error"})}o(!1)}})]})}function _T({circumference:e,offset:t,circleCSSProperties:n}){return l.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:l.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",className:"h-6 w-6",children:[l.jsx("circle",{className:"origin-[50%_50%] -rotate-90 stroke-gray-400",strokeWidth:"10",fill:"transparent",r:"55",cx:"60",cy:"60"}),l.jsx("circle",{className:"origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]",stroke:"currentColor",strokeWidth:"10",strokeDasharray:`${e} ${e}`,strokeDashoffset:t,fill:"transparent",r:"55",cx:"60",cy:"60",style:n})]})})}const jT=({imageBase64:e,url:t,progress:s=1,className:a="",source:r,alt:o="Preview image"})=>{const[i,c]=n.useState(!1),[d,u]=n.useState(!1),[m,p]=n.useState(null),h=n.useCallback(()=>{p(document.activeElement),c(!0)},[]),x=n.useCallback(e=>{c(!1),e.stopPropagation(),e.preventDefault(),m instanceof HTMLElement&&!m.closest('[data-skip-refocus="true"]')&&m.focus()},[m]),f=n.useCallback(e=>{"Escape"===e.key&&x(e)},[x]);n.useEffect(()=>{if(i){document.addEventListener("keydown",f),document.body.style.overflow="hidden";const e=document.querySelector('[aria-label="Close full view"]');e&&setTimeout(()=>e.focus(),0)}return()=>{document.removeEventListener("keydown",f),document.body.style.overflow="unset"}},[i,f]);const g={backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},v=e??t??"",b=v?{...g,backgroundImage:`url(${v})`}:g;if("string"!=typeof b.backgroundImage||0===b.backgroundImage.length)return null;const y=2*Math.PI*55,_=y-s*y;return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:Op("relative size-14 rounded-xl",a),onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:[l.jsx("button",{type:"button",className:"size-full overflow-hidden rounded-xl",style:b,"aria-label":`View ${o} in full size`,"aria-haspopup":"dialog",onClick:e=>{e.preventDefault(),e.stopPropagation(),h()}}),s<1?l.jsx(_T,{circumference:y,offset:_,circleCSSProperties:{transition:"stroke-dashoffset 0.3s linear"},"aria-label":`Loading progress: ${Math.round(100*s)}%`}):l.jsx("div",{className:Op("absolute inset-0 flex transform-gpu cursor-pointer items-center justify-center rounded-xl transition-opacity duration-200 ease-in-out",d?"bg-black/20 opacity-100":"opacity-0"),onClick:e=>{e.stopPropagation(),h()},"aria-hidden":"true",children:l.jsx(vn,{className:Op("size-5 transform-gpu text-white drop-shadow-lg transition-all duration-200",d?"scale-110":"")})}),l.jsx(xN,{source:r,"aria-label":r?`Source: ${r}`:void 0})]}),l.jsx(A_,{open:i,onOpenChange:c,children:l.jsx(V_,{showCloseButton:!1,className:"w-11/12 overflow-x-auto bg-transparent p-0 sm:w-auto",disableScroll:!1,children:l.jsx("img",{src:v,alt:o,className:"max-w-screen h-full max-h-screen w-full object-contain"})})})]})},wT=({imageBase64:e,url:t,onDelete:n,progress:s=1,source:a=Ml.local})=>l.jsxs("div",{className:"group relative inline-block text-sm text-black/70 dark:text-white/90",children:[l.jsx("div",{className:"relative overflow-hidden rounded-2xl border border-gray-200 dark:border-gray-600",children:l.jsx(jT,{source:a,imageBase64:e,url:t,progress:s})}),l.jsx(NN,{onRemove:n})]});function NT({files:e,setFiles:t,abortUpload:s,setFilesLoading:a,assistant_id:r,agent_id:o,tool_resource:i,fileFilter:c,isRTL:d=!1,Wrapper:u}){const m=Array.from((null==e?void 0:e.values())??[]).filter(e=>!c||c(e)),{mutateAsync:p}=Px({onMutate:async()=>Dp.log("agents","Deleting files: agent_id, assistant_id, tool_resource",o,r,i),onSuccess:()=>{console.log("Files deleted")},onError:e=>{console.log("Error deleting files:",e)}}),{deleteFile:h}=Mv({mutateAsync:p,agent_id:o,assistant_id:r,tool_resource:i});if(n.useEffect(()=>{0!==m.length&&(m.some(e=>e.progress<1)||m.every(e=>1===e.progress)&&a(!1))},[m]),0===m.length)return null;const x=()=>{const e=d?{display:"flex",flexDirection:"row-reverse",flexWrap:"wrap",gap:"4px",width:"100%",maxWidth:"100%"}:{display:"flex",flexWrap:"wrap",gap:"4px",width:"100%",maxWidth:"100%"};return l.jsx("div",{style:e,children:m.reduce((e,t)=>(e.map.has(t.file_id)||(e.map.set(t.file_id,!0),e.uniqueFiles.push(t)),e),{map:new Map,uniqueFiles:[]}).uniqueFiles.map((e,n)=>{var a;const r=()=>{s&&e.progress<1&&s(),h({file:e,setFiles:t})},o=(null==(a=e.type)?void 0:a.startsWith("image"))??!1;return l.jsx("div",{style:{flexBasis:"70px",flexGrow:0,flexShrink:0},children:o?l.jsx(wT,{url:e.preview??e.filepath,onDelete:r,progress:e.progress,source:e.source}):l.jsx(CN,{file:e,onDelete:r})},n)})})};return u?l.jsx(u,{children:x()}):x()}function CT({agent_id:e,files:t}){const s=zf(),{setFilesLoading:a}=rg(),r=n.useRef(null),[o,i]=n.useState(new Map),{data:c=kl}=Rx({select:e=>El(e)}),{handleFileChange:d}=Fv({overrideEndpoint:vi.agents,additionalMetadata:{agent_id:e,tool_resource:oi.ocr},fileSetter:i});Vv(()=>{t&&i(new Map(t))},[t],750);if(c.endpoints[vi.agents].disabled??!1)return null;return l.jsxs("div",{className:"w-full",children:[l.jsx(T_,{openDelay:50,children:l.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[l.jsx(R_,{asChild:!0,children:l.jsxs("span",{className:"flex items-center gap-2",children:[l.jsx("label",{className:"text-token-text-primary block font-medium",children:s("com_agents_file_context")}),l.jsx(Iy,{className:"h-4 w-4 text-text-tertiary"})]})}),l.jsx(I_,{children:l.jsx(E_,{side:Go.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:s("com_agents_file_context_info")})})})})]})}),l.jsxs("div",{className:"flex flex-col gap-3",children:[l.jsx(NT,{files:o,setFiles:i,setFilesLoading:a,agent_id:e,tool_resource:oi.ocr,Wrapper:({children:e})=>l.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),l.jsx("div",{children:l.jsx("button",{type:"button",disabled:!e,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",onClick:()=>{var e;r.current&&(r.current.value=""),null==(e=r.current)||e.click()},children:l.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[l.jsx(Yb,{className:"text-token-text-primary h-4 w-4"}),l.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:r,disabled:!e,onChange:d}),s("com_ui_upload_file_context")]})})}),e?null:l.jsx("div",{className:"text-xs text-text-secondary",children:s("com_agents_file_context_disabled")})]})]})}function kT({isOpen:e,onSubmit:t,onRevoke:s,onOpenChange:a,authTypes:r,isToolAuthenticated:o,register:i,handleSubmit:c,triggerRef:d,triggerRefs:u}){var m,p,h,x,f,g,v,b;const y=zf(),{data:_}=Sx(),[j,w]=n.useState((null==(m=null==_?void 0:_.webSearch)?void 0:m.rerankerType)===kc.COHERE?kc.COHERE:kc.JINA),[N,C]=n.useState(!1),[k,S]=n.useState(!1),[T,R]=n.useState(!1),I=[{label:y("com_ui_web_search_provider_serper"),onClick:()=>{}}],E=[{label:y("com_ui_web_search_scraper_firecrawl"),onClick:()=>{}}],M=[{label:y("com_ui_web_search_reranker_jina"),onClick:()=>w(kc.JINA)},{label:y("com_ui_web_search_reranker_cohere"),onClick:()=>w(kc.COHERE)}],P=!(null==(p=null==_?void 0:_.webSearch)?void 0:p.searchProvider),L=!(null==(h=null==_?void 0:_.webSearch)?void 0:h.scraperType),A=!(null==(x=null==_?void 0:_.webSearch)?void 0:x.rerankerType),O=null==(f=r.find(([e])=>e===wc.PROVIDERS))?void 0:f[1],D=null==(g=r.find(([e])=>e===wc.SCRAPERS))?void 0:g[1],z=null==(v=r.find(([e])=>e===wc.RERANKERS))?void 0:v[1];return l.jsx(A_,{open:e,onOpenChange:a,triggerRef:d,triggerRefs:u,children:l.jsx(Oj,{className:"w-11/12 sm:w-[500px]",title:"",main:l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"mb-4 text-center font-medium",children:y("com_ui_web_search")}),l.jsx("div",{className:"mb-4 text-center text-sm",children:y("com_ui_web_search_api_subtitle")}),l.jsxs("form",{onSubmit:c(t),children:[O!==fi.SYSTEM_DEFINED&&l.jsxs("div",{className:"mb-6",children:[l.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[l.jsx(L_,{className:"text-md w-fit font-medium",children:y("com_ui_web_search_provider")}),P?l.jsx(kj,{menuId:"search-provider-dropdown",items:I,isOpen:N,setIsOpen:C,trigger:l.jsxs(Qe,{onClick:()=>C(!N),className:"flex items-center rounded-md border border-border-light px-3 py-1 text-sm text-text-secondary",children:[y("com_ui_web_search_provider_serper"),l.jsx(at,{className:"ml-1 h-4 w-4"})]})}):l.jsx("div",{className:"text-sm text-text-secondary",children:y("com_ui_web_search_provider_serper")})]}),l.jsx(M_,{type:"password",placeholder:`${y("com_ui_enter_api_key")}`,autoComplete:"one-time-code",readOnly:!0,onFocus:e=>e.target.readOnly=!1,...i("serperApiKey",{required:!0})}),l.jsx("div",{className:"mt-1 text-xs text-text-secondary",children:l.jsx("a",{href:"https://serper.dev/api-key",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300",children:y("com_ui_web_search_provider_serper_key")})})]}),D!==fi.SYSTEM_DEFINED&&l.jsxs("div",{className:"mb-6",children:[l.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[l.jsx(L_,{className:"text-md w-fit font-medium",children:y("com_ui_web_search_scraper")}),L?l.jsx(kj,{menuId:"scraper-dropdown",items:E,isOpen:k,setIsOpen:S,trigger:l.jsxs(Qe,{onClick:()=>S(!k),className:"flex items-center rounded-md border border-border-light px-3 py-1 text-sm text-text-secondary",children:[y("com_ui_web_search_scraper_firecrawl"),l.jsx(at,{className:"ml-1 h-4 w-4"})]})}):l.jsx("div",{className:"text-sm text-text-secondary",children:y("com_ui_web_search_scraper_firecrawl")})]}),l.jsx(M_,{type:"password",placeholder:`${y("com_ui_enter_api_key")}`,autoComplete:"one-time-code",readOnly:!0,onFocus:e=>e.target.readOnly=!1,className:"mb-2",...i("firecrawlApiKey")}),l.jsx(M_,{type:"text",placeholder:y("com_ui_web_search_firecrawl_url"),className:"mb-1",...i("firecrawlApiUrl")}),l.jsx("div",{className:"mt-1 text-xs text-text-secondary",children:l.jsx("a",{href:"https://docs.firecrawl.dev/introduction#api-key",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300",children:y("com_ui_web_search_scraper_firecrawl_key")})})]}),z!==fi.SYSTEM_DEFINED&&l.jsxs("div",{className:"mb-6",children:[l.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[l.jsx(L_,{className:"text-md w-fit font-medium",children:y("com_ui_web_search_reranker")}),A&&l.jsx(kj,{menuId:"reranker-dropdown",isOpen:T,setIsOpen:R,items:M,trigger:l.jsxs(Qe,{onClick:()=>R(!T),className:"flex items-center rounded-md border border-border-light px-3 py-1 text-sm text-text-secondary",children:[j===kc.JINA?y("com_ui_web_search_reranker_jina"):y("com_ui_web_search_reranker_cohere"),l.jsx(at,{className:"ml-1 h-4 w-4"})]})}),!A&&l.jsx("div",{className:"text-sm text-text-secondary",children:(null==(b=null==_?void 0:_.webSearch)?void 0:b.rerankerType)===kc.COHERE?y("com_ui_web_search_reranker_cohere"):y("com_ui_web_search_reranker_jina")})]}),(null==(F=null==_?void 0:_.webSearch)?void 0:F.rerankerType)===kc.JINA?l.jsxs(l.Fragment,{children:[l.jsx(M_,{type:"password",placeholder:y("com_ui_web_search_jina_key"),autoComplete:"one-time-code",readOnly:!0,onFocus:e=>e.target.readOnly=!1,...i("jinaApiKey")}),l.jsx("div",{className:"mt-1 text-xs text-text-secondary",children:l.jsx("a",{href:"https://jina.ai/api-dashboard/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300",children:y("com_ui_web_search_reranker_jina_key")})})]}):(null==(V=null==_?void 0:_.webSearch)?void 0:V.rerankerType)===kc.COHERE?l.jsxs(l.Fragment,{children:[l.jsx(M_,{type:"password",placeholder:y("com_ui_web_search_cohere_key"),autoComplete:"one-time-code",readOnly:!0,onFocus:e=>e.target.readOnly=!1,...i("cohereApiKey")}),l.jsx("div",{className:"mt-1 text-xs text-text-secondary",children:l.jsx("a",{href:"https://dashboard.cohere.com/welcome/login",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300",children:y("com_ui_web_search_reranker_cohere_key")})})]}):(null==($=null==_?void 0:_.webSearch)?void 0:$.rerankerType)||j!==kc.JINA?(null==(B=null==_?void 0:_.webSearch)?void 0:B.rerankerType)||j!==kc.COHERE?null:l.jsxs(l.Fragment,{children:[l.jsx(M_,{type:"password",placeholder:y("com_ui_web_search_cohere_key"),autoComplete:"one-time-code",readOnly:!0,onFocus:e=>e.target.readOnly=!1,...i("cohereApiKey")}),l.jsx("div",{className:"mt-1 text-xs text-text-secondary",children:l.jsx("a",{href:"https://dashboard.cohere.com/welcome/login",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300",children:y("com_ui_web_search_reranker_cohere_key")})})]}):l.jsxs(l.Fragment,{children:[l.jsx(M_,{type:"password",placeholder:y("com_ui_web_search_jina_key"),autoComplete:"one-time-code",readOnly:!0,onFocus:e=>e.target.readOnly=!1,...i("jinaApiKey")}),l.jsx("div",{className:"mt-1 text-xs text-text-secondary",children:l.jsx("a",{href:"https://jina.ai/api-dashboard/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300",children:y("com_ui_web_search_reranker_jina_key")})})]})]})]})]}),selection:{selectHandler:c(t),selectClasses:"bg-white hover:bg-gray-100 text-black dark:bg-gray-800 dark:hover:bg-gray-700 dark:text-white border border-gray-300 dark:border-gray-600",selectText:y("com_ui_save")},buttons:o&&l.jsx(c_,{onClick:s,className:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",children:y("com_ui_revoke")}),showCancelButton:!0})});var F,V,$,B}function ST({authTypes:e=[],isToolAuthenticated:t=!1}){const n=zf(),s=Pr(),{control:a,setValue:r,getValues:o}=s,{onSubmit:i,isDialogOpen:c,setIsDialogOpen:d,handleRevokeApiKey:u,methods:m}=wb({onSubmit:()=>{r(Yl.web_search,!0,{shouldDirty:!0})},onRevoke:()=>{r(Yl.web_search,!1,{shouldDirty:!0})}}),p=Mr({control:a,name:Yl.web_search}),h=null==e?void 0:e.some(([,e])=>e===fi.USER_PROVIDED),x=e=>{t?r(Yl.web_search,e,{shouldDirty:!0}):p?r(Yl.web_search,!1,{shouldDirty:!0}):d(!0)};return l.jsxs(l.Fragment,{children:[l.jsx(T_,{openDelay:50,children:l.jsxs("div",{className:"flex items-center",children:[l.jsx(Ir,{name:Yl.web_search,control:a,render:({field:e})=>l.jsx(d_,{...e,checked:p||t&&e.value,onCheckedChange:x,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString(),disabled:!p&&!t})}),l.jsx("button",{type:"button",className:"flex items-center space-x-2",onClick:()=>{const e=!o(Yl.web_search);x(e)},children:l.jsx("label",{className:"form-check-label text-token-text-primary w-full cursor-pointer",htmlFor:Yl.web_search,children:n("com_ui_web_search")})}),l.jsxs("div",{className:"ml-2 flex gap-2",children:[h&&(t||p)&&l.jsx("button",{type:"button",onClick:()=>d(!0),children:l.jsx(bn,{className:"h-5 w-5 text-text-primary"})}),l.jsx(R_,{children:l.jsx(Iy,{className:"h-4 w-4 text-text-tertiary"})})]}),l.jsx(I_,{children:l.jsx(E_,{side:Go.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:n("com_agents_search_info")})})})})]})}),l.jsx(kT,{onSubmit:i,authTypes:e,isOpen:c,onRevoke:u,onOpenChange:d,register:m.register,isToolAuthenticated:t,handleSubmit:m.handleSubmit})]})}function TT(){const e=zf(),{data:t}=Hx({toolId:ri.web_search},{retry:1});return l.jsxs("div",{className:"w-full",children:[l.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:l.jsx("div",{className:"flex flex-row items-center gap-1",children:l.jsx("div",{className:"flex items-center gap-1",children:l.jsx("span",{className:"text-token-text-primary block font-medium",children:e("com_ui_web_search")})})})}),l.jsx("div",{className:"flex flex-col items-start gap-2",children:l.jsx(ST,{authTypes:null==t?void 0:t.authTypes,isToolAuthenticated:null==t?void 0:t.authenticated})})]})}const RT=n.memo(function(){const e=zf(),t=Pr(),{control:n,setValue:s,getValues:a}=t;return l.jsx(l.Fragment,{children:l.jsx(T_,{openDelay:50,children:l.jsxs("div",{className:"my-2 flex items-center",children:[l.jsx(Ir,{name:Yl.file_search,control:n,render:({field:e})=>l.jsx(d_,{...e,checked:e.value,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString()})}),l.jsxs("button",{type:"button",className:"flex items-center space-x-2",onClick:()=>s(Yl.file_search,!a(Yl.file_search),{shouldDirty:!0}),children:[l.jsx("label",{className:"form-check-label text-token-text-primary w-full cursor-pointer",htmlFor:Yl.file_search,children:e("com_agents_enable_file_search")}),l.jsx(R_,{children:l.jsx(Iy,{className:"h-4 w-4 text-text-tertiary"})})]}),l.jsx(I_,{children:l.jsx(E_,{side:Go.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:e("com_agents_file_search_info")})})})})]})})})});function IT({agent_id:e,files:t}){const s=zf(),{setFilesLoading:a}=rg(),{watch:r}=Pr(),o=n.useRef(null),[i,c]=n.useState(new Map),{data:d=kl}=Rx({select:e=>El(e)}),{handleFileChange:u}=Fv({overrideEndpoint:vi.agents,additionalMetadata:{agent_id:e,tool_resource:oi.file_search},fileSetter:c});Vv(()=>{t&&c(new Map(t))},[t],750);const m=r(Yl.file_search);if(d.endpoints[vi.agents].disabled??!1)return null;return l.jsxs("div",{className:"w-full",children:[l.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:l.jsx("span",{children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:s("com_assistants_file_search")})})}),l.jsx(RT,{}),l.jsxs("div",{className:"flex flex-col gap-3",children:[l.jsx(NT,{files:i,setFiles:c,setFilesLoading:a,agent_id:e,tool_resource:oi.file_search,Wrapper:({children:e})=>l.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),l.jsx("div",{children:l.jsx("button",{type:"button",disabled:!e||!1===m,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",onClick:()=>{var e;o.current&&(o.current.value=""),null==(e=o.current)||e.click()},children:l.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[l.jsx(Yb,{className:"text-token-text-primary h-4 w-4"}),l.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:o,disabled:!e||!1===m,onChange:u}),s("com_ui_upload_file_search")]})})}),e?null:l.jsx("div",{className:"text-xs text-text-secondary",children:s("com_agents_file_search_disabled")})]})]})}function ET(){const e=zf(),t=Pr(),{setValue:n,watch:s}=t,a=s(Yl.artifacts),r=void 0!==a&&""!==a,o=a===hd.CUSTOM,i=a===hd.SHADCNUI;return l.jsxs("div",{className:"w-full",children:[l.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:l.jsx("span",{children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:e("com_ui_artifacts")})})}),l.jsxs("div",{className:"flex flex-col gap-3",children:[l.jsx(MT,{id:"artifacts",label:e("com_ui_artifacts_toggle_agent"),checked:r,onCheckedChange:e=>{n(Yl.artifacts,e?hd.DEFAULT:"",{shouldDirty:!0})},hoverCardText:e("com_nav_info_code_artifacts_agent")}),l.jsx(MT,{id:"includeShadcnui",label:e("com_ui_include_shadcnui_agent"),checked:i,onCheckedChange:e=>{n(Yl.artifacts,e?hd.SHADCNUI:hd.DEFAULT,{shouldDirty:!0})},hoverCardText:e("com_nav_info_include_shadcnui"),disabled:!r||o}),l.jsx(MT,{id:"customPromptMode",label:e("com_ui_custom_prompt_mode"),checked:o,onCheckedChange:e=>{n(Yl.artifacts,e?hd.CUSTOM:hd.DEFAULT,{shouldDirty:!0})},hoverCardText:e("com_nav_info_custom_prompt_mode"),disabled:!r})]})]})}function MT({id:e,label:t,checked:n,onCheckedChange:s,hoverCardText:a,disabled:r=!1}){return l.jsx(T_,{openDelay:50,children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("div",{className:r?"text-text-tertiary":"",children:t}),l.jsx(R_,{children:l.jsx(Iy,{className:"h-4 w-4 text-text-tertiary"})})]}),l.jsx(I_,{children:l.jsx(E_,{side:Go.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:a})})})}),l.jsx(Q_,{id:e,checked:n,onCheckedChange:s,className:"ml-4","data-testid":e,disabled:r})]})})}const PT=_a,LT=n.forwardRef(({className:e="",...t},n)=>l.jsx(ga,{ref:n,className:Op("border-b",e),...t}));LT.displayName="AccordionItem";n.forwardRef(({className:e="",children:t,...n},s)=>l.jsx(va,{className:"flex",children:l.jsxs(ba,{ref:s,className:Op("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",e),...n,children:[t,l.jsx(ia,{className:"text-muted-foreground h-4 w-4 shrink-0 transition-transform duration-200"})]})})).displayName=ba.displayName;const AT=n.forwardRef(({className:e="",children:t,...n},s)=>l.jsx(ya,{ref:s,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:l.jsx("div",{className:Op("pb-4 pt-0",e),children:t})}));function OT({tool:e,allTools:t}){var s,a;const[r,o]=n.useState(!1),[i,c]=n.useState(!1),[d,u]=n.useState(null),[m,p]=n.useState(""),h=zf(),{showToast:x}=Of(),f=Xf(),{getValues:g,setValue:v}=Pr(),b=t[e],y=e=>{const t=(g("tools")||[]).filter(e=>{var t;return!(null==(t=null==b?void 0:b.tools)?void 0:t.some(t=>t.tool_id===e))});v("tools",[...t,...e])},_=e=>{if(e){const t=j&&b.tools?[e,...b.tools.map(e=>e.tool_id)]:[e];f.mutate({pluginKey:e,action:"uninstall",auth:{},isEntityTool:!0},{onError:e=>{x({message:`Error while deleting the tool: ${e}`,status:"error"})},onSuccess:()=>{var e;const n=null==(e=g("tools"))?void 0:e.filter(e=>!t.includes(e));v("tools",n),x({message:"Tool deleted successfully",status:"success"})}})}};if(!b)return null;const j=b.tools&&b.tools.length>0,w=(()=>{if(!(null==b?void 0:b.tools))return[];const e=g("tools")||[];return b.tools.filter(t=>e.includes(t.tool_id)).map(e=>e.tool_id)})(),N=m===b.tool_id;return j?l.jsxs(A_,{children:[l.jsx(PT,{type:"single",value:m,onValueChange:p,collapsible:!0,children:l.jsxs(LT,{value:b.tool_id,className:"group relative w-full border-none",children:[l.jsx("div",{className:"relative flex w-full items-center gap-1 rounded-lg p-1 hover:bg-gray-50 dark:hover:bg-gray-800/50",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onFocus:()=>c(!0),onBlur:e=>{e.currentTarget.contains(e.relatedTarget)||c(!1)},children:l.jsx(va,{asChild:!0,children:l.jsx(ba,{asChild:!0,children:l.jsxs("button",{type:"button",className:Op("flex grow items-center gap-1 rounded bg-transparent p-0 text-left transition-colors","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1"),children:[b.metadata.icon&&l.jsx("div",{className:"flex h-8 w-8 items-center justify-center overflow-hidden rounded-full",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full bg-center bg-no-repeat dark:bg-white/20",style:{backgroundImage:`url(${b.metadata.icon})`,backgroundSize:"cover"}})}),l.jsx("div",{className:"grow px-2 py-1.5",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:b.metadata.name}),l.jsx("div",{className:"flex items-center",children:l.jsxs("div",{className:"relative flex items-center",children:[l.jsxs("div",{className:Op("flex items-center gap-2 transition-all duration-300",r||i?"-translate-x-8":"translate-x-0"),children:[l.jsx("div",{"data-checkbox-container":!0,onClick:e=>e.stopPropagation(),className:"mt-1",children:l.jsx(d_,{id:`select-all-${b.tool_id}`,checked:w.length===(null==(s=b.tools)?void 0:s.length),onCheckedChange:e=>{if(b.tools){const t=e?b.tools.map(e=>e.tool_id):[];y(t)}},className:Op("h-4 w-4 rounded border border-gray-300 transition-all duration-200 hover:border-gray-400 dark:border-gray-600 dark:hover:border-gray-500",N?"opacity-100":"opacity-0"),onClick:e=>e.stopPropagation(),onKeyDown:e=>{if("Enter"===e.key||" "===e.key){e.preventDefault(),e.stopPropagation();e.currentTarget.click()}},tabIndex:N?0:-1})}),l.jsx("div",{className:Op("pointer-events-none flex h-4 w-4 items-center justify-center transition-transform duration-300",N?"rotate-180":""),"aria-hidden":"true",children:l.jsx(at,{className:"h-4 w-4"})})]}),l.jsx("div",{className:Op("absolute right-0 transition-all duration-300",r||i?"translate-x-0 opacity-100":"translate-x-8 opacity-0"),children:l.jsx(O_,{asChild:!0,children:l.jsx("button",{type:"button",className:Op("flex h-7 w-7 items-center justify-center rounded transition-colors duration-200","hover:bg-gray-200 dark:hover:bg-gray-700","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1","focus:translate-x-0 focus:opacity-100"),onClick:e=>e.stopPropagation(),"aria-label":`Delete ${b.metadata.name}`,tabIndex:0,onFocus:()=>c(!0),children:l.jsx(py,{className:"h-4 w-4"})})})})]})})]})})})}),l.jsx(AT,{className:"relative ml-1 pt-1 before:absolute before:bottom-2 before:left-0 before:top-0 before:w-0.5 before:bg-border-medium",children:l.jsx("div",{className:"space-y-1",children:null==(a=b.tools)?void 0:a.map(e=>l.jsxs("label",{htmlFor:e.tool_id,className:Op("border-token-border-light hover:bg-token-surface-secondary flex cursor-pointer items-center rounded-lg border p-2","ml-2 mr-1 focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2 focus-within:ring-offset-background"),onClick:e=>e.stopPropagation(),onKeyDown:e=>{e.stopPropagation()},onMouseEnter:()=>u(e.tool_id),onMouseLeave:()=>u(null),children:[l.jsx(d_,{id:e.tool_id,checked:w.includes(e.tool_id),onCheckedChange:t=>{const n=w.includes(e.tool_id)?w.filter(t=>t!==e.tool_id):[...w,e.tool_id];y(n)},onKeyDown:e=>{if(e.stopPropagation(),"Enter"===e.key||" "===e.key){e.preventDefault();e.currentTarget.click()}},onClick:e=>e.stopPropagation(),className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer rounded border border-gray-300 transition-[border-color] duration-200 hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background dark:border-gray-600 dark:hover:border-gray-500"}),l.jsx("span",{className:"text-token-text-primary",children:e.metadata.name}),e.metadata.description&&l.jsxs(et,{placement:"left-start",children:[l.jsxs("div",{className:"ml-auto flex h-6 w-6 items-center justify-center",children:[l.jsx(tt,{render:l.jsxs(Gt,{className:Op("flex h-5 w-5 cursor-help items-center rounded-full text-text-secondary transition-opacity duration-200",d===e.tool_id?"opacity-100":"opacity-0"),"aria-label":h("com_ui_tool_info"),children:[l.jsx(Iy,{className:"h-4 w-4"}),l.jsx(st,{children:h("com_ui_tool_info")})]})}),l.jsxs(nt,{className:"rounded-full text-text-secondary focus:outline-none focus:ring-2 focus:ring-ring","aria-label":h("com_ui_tool_more_info"),"aria-expanded":d===e.tool_id,"aria-controls":`tool-description-${e.tool_id}`,children:[l.jsx(st,{children:h("com_ui_tool_more_info")}),l.jsx(at,{className:"h-4 w-4"})]})]}),l.jsx(rt,{id:`tool-description-${e.tool_id}`,gutter:14,shift:40,flip:!1,className:"z-[999] w-80 scale-95 rounded-2xl border border-border-medium bg-surface-secondary p-4 text-text-primary opacity-0 shadow-md transition-all duration-200 data-[enter]:scale-100 data-[leave]:scale-95 data-[enter]:opacity-100 data-[leave]:opacity-0",portal:!0,unmountOnHide:!0,role:"tooltip","aria-label":e.metadata.description,children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:e.metadata.description})})})]})]},e.tool_id))})})]})}),l.jsx(Oj,{showCloseButton:!1,title:h("com_ui_delete_tool"),mainClassName:"px-0",className:"max-w-[450px]",main:l.jsx(L_,{className:"text-left text-sm font-medium",children:h("com_ui_delete_tool_confirm")}),selection:{selectHandler:()=>_(b.tool_id),selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:h("com_ui_delete")}})]}):l.jsxs(A_,{children:[l.jsxs("div",{className:"group relative flex w-full items-center gap-1 rounded-lg p-1 text-sm hover:bg-gray-50 dark:hover:bg-gray-800/50",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onFocus:()=>c(!0),onBlur:e=>{e.currentTarget.contains(e.relatedTarget)||c(!1)},children:[l.jsxs("div",{className:"flex grow items-center",children:[b.metadata.icon&&l.jsx("div",{className:"flex h-8 w-8 items-center justify-center overflow-hidden rounded-full",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full bg-center bg-no-repeat dark:bg-white/20",style:{backgroundImage:`url(${b.metadata.icon})`,backgroundSize:"cover"}})}),l.jsx("div",{className:"grow px-2 py-1.5",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:b.metadata.name})]}),l.jsx(O_,{asChild:!0,children:l.jsx("button",{type:"button",className:Op("flex h-7 w-7 items-center justify-center rounded transition-all duration-200","hover:bg-gray-200 dark:hover:bg-gray-700","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1","focus:opacity-100",r||i?"opacity-100":"pointer-events-none opacity-0"),"aria-label":`Delete ${b.metadata.name}`,tabIndex:0,onFocus:()=>c(!0),children:l.jsx(py,{className:"h-4 w-4"})})})]}),l.jsx(Oj,{showCloseButton:!1,title:h("com_ui_delete_tool"),mainClassName:"px-0",className:"max-w-[450px]",main:l.jsx(L_,{className:"text-left text-sm font-medium",children:h("com_ui_delete_tool_confirm")}),selection:{selectHandler:()=>_(b.tool_id),selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:h("com_ui_delete")}})]})}function DT({authType:e="",isToolAuthenticated:t=!1}){const n=zf(),s=Pr(),{control:a,setValue:r,getValues:o}=s,{onSubmit:i,isDialogOpen:c,setIsDialogOpen:d,handleRevokeApiKey:u,methods:m}=_b({onSubmit:()=>{r(Yl.execute_code,!0,{shouldDirty:!0})},onRevoke:()=>{r(Yl.execute_code,!1,{shouldDirty:!0})}}),p=Mr({control:a,name:Yl.execute_code}),h=e===fi.USER_PROVIDED,x=e=>{t?r(Yl.execute_code,e,{shouldDirty:!0}):p?r(Yl.execute_code,!1,{shouldDirty:!0}):d(!0)};return l.jsxs(l.Fragment,{children:[l.jsx(T_,{openDelay:50,children:l.jsxs("div",{className:"flex items-center",children:[l.jsx(Ir,{name:Yl.execute_code,control:a,render:({field:e})=>l.jsx(d_,{...e,checked:p||t&&e.value,onCheckedChange:x,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString(),disabled:!p&&!t})}),l.jsx("button",{type:"button",className:"flex items-center space-x-2",onClick:()=>{const e=!o(Yl.execute_code);x(e)},children:l.jsx("label",{className:"form-check-label text-token-text-primary w-full cursor-pointer",htmlFor:Yl.execute_code,children:n("com_ui_run_code")})}),l.jsxs("div",{className:"ml-2 flex gap-2",children:[h&&(t||p)&&l.jsx("button",{type:"button",onClick:()=>d(!0),children:l.jsx(bn,{className:"h-5 w-5 text-text-primary"})}),l.jsx(R_,{children:l.jsx(Iy,{className:"h-4 w-4 text-text-tertiary"})})]}),l.jsx(I_,{children:l.jsx(E_,{side:Go.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:n("com_agents_code_interpreter")})})})})]})}),l.jsx(lC,{isOpen:c,onSubmit:i,onRevoke:u,onOpenChange:d,register:m.register,isToolAuthenticated:t,handleSubmit:m.handleSubmit,isUserProvided:e===fi.USER_PROVIDED})]})}AT.displayName=ya.displayName;const zT=oi.execute_code;function FT({agent_id:e,files:t}){const s=zf(),{setFilesLoading:a}=rg(),{watch:r}=Pr(),o=n.useRef(null),[i,c]=n.useState(new Map),{data:d=kl}=Rx({select:e=>El(e)}),{abortUpload:u,handleFileChange:m}=Fv({fileSetter:c,overrideEndpoint:vi.agents,additionalMetadata:{agent_id:e,tool_resource:zT}});Vv(()=>{t&&c(new Map(t))},[t],750);const p=r(Yl.execute_code),h=d.endpoints[vi.agents];if((null==h?void 0:h.disabled)??!1)return null;return l.jsx("div",{className:"mb-2 w-full",children:l.jsxs("div",{className:"flex flex-col gap-3",children:[l.jsx("div",{className:"rounded-lg text-xs text-text-secondary",children:s("com_assistants_code_interpreter_files")}),l.jsx(NT,{files:i,setFiles:c,agent_id:e,abortUpload:u,tool_resource:zT,setFilesLoading:a,Wrapper:({children:e})=>l.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),l.jsx("div",{children:l.jsx("button",{type:"button",disabled:!e||!1===p,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",onClick:()=>{var e;o.current&&(o.current.value=""),null==(e=o.current)||e.click()},children:l.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[l.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:o,disabled:!e||!1===p,onChange:m}),l.jsx(Yb,{className:"text-token-text-primary h-4 w-4"}),s("com_ui_upload_code_files")]})})})]})})}function VT({agent_id:e,files:t}){const n=zf(),{data:s}=Hx({toolId:ri.execute_code});return l.jsxs("div",{className:"w-full",children:[l.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:l.jsx("div",{className:"flex flex-row items-center gap-1",children:l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"text-token-text-primary block font-medium",children:n("com_agents_code_interpreter_title")}),l.jsx("span",{className:"text-xs text-text-secondary",children:n("com_agents_by_chat")})]})})}),l.jsxs("div",{className:"flex flex-col items-start gap-2",children:[l.jsx(DT,{authType:null==s?void 0:s.message,isToolAuthenticated:null==s?void 0:s.authenticated}),l.jsx(FT,{agent_id:e,files:t})]})]})}const $T="mb-2 text-token-text-primary block font-medium",BT=Op(Wp,"flex w-full px-3 py-2 border-border-light bg-surface-secondary focus-visible:ring-2 focus-visible:ring-ring-primary",Kp);function UT({agentsConfig:e,createMutation:t,endpointsConfig:s}){const a=zf(),r=Ug(),{showToast:o}=Of(),i=Pr(),[c,d]=n.useState(!1),{actions:u,setAction:m,groupedTools:p,setActivePanel:h}=Fg(),{control:x}=i,f=Mr({control:x,name:"provider"}),g=Mr({control:x,name:"model"}),v=Mr({control:x,name:"agent"}),b=Mr({control:x,name:"tools"}),y=Mr({control:x,name:"id"}),_=n.useMemo(()=>{var t;return(null==(t=null==e?void 0:e.capabilities)?void 0:t.includes(Yl.tools))??!1},[e]),j=n.useMemo(()=>{var t;return(null==(t=null==e?void 0:e.capabilities)?void 0:t.includes(Yl.actions))??!1},[e]),w=n.useMemo(()=>{var t;return(null==(t=null==e?void 0:e.capabilities)?void 0:t.includes(Yl.artifacts))??!1},[e]),N=n.useMemo(()=>{var t;return(null==(t=null==e?void 0:e.capabilities)?void 0:t.includes(Yl.ocr))??!1},[e]),C=n.useMemo(()=>{var t;return(null==(t=null==e?void 0:e.capabilities)?void 0:t.includes(Yl.file_search))??!1},[e]),k=n.useMemo(()=>{var t;return(null==(t=null==e?void 0:e.capabilities)?void 0:t.includes(Yl.web_search))??!1},[e]),S=n.useMemo(()=>{var t;return(null==(t=null==e?void 0:e.capabilities)?void 0:t.includes(Yl.execute_code))??!1},[e]),T=n.useMemo(()=>{if("string"==typeof v)return[];if((null==v?void 0:v.id)!==y)return[];if(v.context_files)return v.context_files;return qm({agent:v,fileMap:r}).context_files??[]},[v,y,r]),R=n.useMemo(()=>{if("string"==typeof v)return[];if((null==v?void 0:v.id)!==y)return[];if(v.knowledge_files)return v.knowledge_files;return qm({agent:v,fileMap:r}).knowledge_files??[]},[v,y,r]),I=n.useMemo(()=>{if("string"==typeof v)return[];if((null==v?void 0:v.id)!==y)return[];if(v.code_files)return v.code_files;return qm({agent:v,fileMap:r}).code_files??[]},[v,y,r]),E=n.useCallback(()=>{y?h(Ko.actions):o({message:a("com_assistants_actions_disabled"),status:"warning"})},[y,h,o,a]),M="string"==typeof f?f:null==f?void 0:f.value;let P,L,A,O;void 0!==M&&(L=fp(s,M,"type"),A=fp(s,M,"iconURL"),O=Np({endpoint:M,endpointsConfig:s,endpointType:L,endpointIconURL:A}),P=By[O]);const D=b??[],z=new Set(D);return Object.entries(p).forEach(([e,t])=>{var n;(null==(n=t.tools)?void 0:n.length)&&t.tools.some(e=>D.includes(e.tool_id))&&z.add(e)}),l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"h-auto bg-white px-4 pt-3 dark:bg-transparent",children:[l.jsxs("div",{className:"mb-4",children:[l.jsx(yT,{agent_id:y,createMutation:t,avatar:(null==v?void 0:v.avatar)??null}),l.jsx("label",{className:$T,htmlFor:"name",children:a("com_ui_name")}),l.jsx(Ir,{name:"name",control:x,render:({field:e})=>l.jsx("input",{...e,value:e.value??"",maxLength:256,className:BT,id:"name",type:"text",placeholder:a("com_agents_name_placeholder"),"aria-label":"Agent name"})}),l.jsx(Ir,{name:"id",control:x,render:({field:e})=>l.jsx("p",{className:"h-3 text-xs italic text-text-secondary","aria-live":"polite",children:e.value})})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:$T,htmlFor:"description",children:a("com_ui_description")}),l.jsx(Ir,{name:"description",control:x,render:({field:e})=>l.jsx("input",{...e,value:e.value??"",maxLength:512,className:BT,id:"description",type:"text",placeholder:a("com_agents_description_placeholder"),"aria-label":"Agent description"})})]}),l.jsx(fT,{}),l.jsxs("div",{className:"mb-4",children:[l.jsxs("label",{className:$T,htmlFor:"provider",children:[a("com_ui_model")," ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("button",{type:"button",onClick:()=>h(Ko.model),className:"btn btn-neutral border-token-border-light relative h-10 w-full rounded-lg font-medium","aria-haspopup":"true","aria-expanded":"false",children:l.jsxs("div",{className:"flex w-full items-center gap-2",children:[P&&l.jsx("div",{className:"shadow-stroke relative flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-white text-black dark:bg-white",children:l.jsx(P,{className:"h-2/3 w-2/3",endpoint:M,endpointType:L,iconURL:A})}),l.jsx("span",{children:null!=g&&g?g:a("com_ui_select_model")})]})})]}),(S||C||w||N||k)&&l.jsxs("div",{className:"mb-4 flex w-full flex-col items-start gap-3",children:[l.jsx("label",{className:"text-token-text-primary block font-medium",children:a("com_assistants_capabilities")}),S&&l.jsx(VT,{agent_id:y,files:I}),k&&l.jsx(TT,{}),N&&l.jsx(CT,{agent_id:y,files:T}),w&&l.jsx(ET,{}),C&&l.jsx(IT,{agent_id:y,files:R})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:$T,children:`${!0===_?a("com_ui_tools"):""}\n              ${!0===_&&!0===j?" + ":""}\n              ${!0===j?a("com_assistants_actions"):""}`}),l.jsxs("div",{children:[l.jsx("div",{className:"mb-1",children:[...z].map((e,t)=>p[e]?l.jsx(OT,{tool:e,allTools:p,agent_id:y},`${e}-${t}-${y}`):null)}),l.jsx("div",{className:"flex flex-col gap-1",children:(u??[]).filter(e=>e.agent_id===y).map((e,t)=>l.jsx(uT,{action:e,onClick:()=>{m(e),h(Ko.actions)}},t))}),l.jsxs("div",{className:"mt-2 flex space-x-2",children:[(_??!1)&&l.jsx("button",{type:"button",onClick:()=>d(!0),className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium","aria-haspopup":"dialog",children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:a("com_assistants_add_tools")})}),(j??!1)&&l.jsx("button",{type:"button",disabled:!y,onClick:E,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium","aria-haspopup":"dialog",children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:a("com_assistants_add_actions")})})]})]})]})]}),l.jsx(pT,{isOpen:c,setIsOpen:d,endpoint:vi.agents})]})}const HT=new Set(Object.keys(Ii));function KT({agentQuery:e,selectedAgentId:t=null,setCurrentAgentId:s,createMutation:a}){const r=zf(),o=n.useRef(null),{control:i,reset:d}=Pr(),{data:u}=Sx(),{data:m=null}=gx(void 0,{select:e=>e.data.map(e=>qm({agent:{...e,name:e.name||e.id},instanceProjectId:null==u?void 0:u.instanceProjectId}))}),p=n.useCallback(e=>{var t;const{instanceProjectId:n}=u??{},s=(null!=n&&(null==(t=e.projectIds)?void 0:t.includes(n)))??!1,a={...e,provider:Gm(e.provider),label:e.name??"",value:e.id||"",icon:s?l.jsx(c,{className:"icon-lg text-black dark:text-white"}):null},r={[Yl.web_search]:!1,[Yl.file_search]:!1,[Yl.execute_code]:!1,[Yl.end_after_tools]:!1,[Yl.hide_sequential_outputs]:!1},o=[];(e.tools??[]).forEach(e=>{void 0===r[e]?o.push(e):r[e]=!0});const i={...r,agent:a,model:a.model,tools:o};Object.entries(e).forEach(([e,t])=>{"model_parameters"!==e&&void 0===r[e]?"agent_ids"===e&&Array.isArray(t)&&t.every(e=>"string"==typeof e)?i[e]=t:HT.has(e)&&("recursion_limit"!==e||"number"!=typeof t?"number"!=typeof t&&"object"!=typeof t&&(i[e]=t):i[e]=t):i[e]=t}),d(i)},[d,u]),h=n.useCallback(t=>{const n=!!(t?(m??[]).find(e=>e.id===t):void 0);if(a.reset(),!n)return s(void 0),d(Wm());s(t);const r=e.data;r?p(r):console.warn("Agent not found")},[m,a,s,e.data,p,d]);n.useEffect(()=>{e.data&&e.isSuccess&&p(e.data)},[e.data,e.isSuccess,p]),n.useEffect(()=>{let e=null;if(t!==o.current)return null!=t&&""!==t&&m&&(e=setTimeout(()=>{o.current=t,h(t)},5)),()=>{e&&clearTimeout(e)}},[t,m,h]);const x=r("com_ui_create")+" "+r("com_ui_agent");return l.jsx(Ir,{name:"agent",control:i,render:({field:e})=>{var t,n,s,a;return l.jsx(eN,{containerClassName:"px-0",selectedValue:((null==(t=null==e?void 0:e.value)?void 0:t.value)??"")+"",displayValue:(null==(n=null==e?void 0:e.value)?void 0:n.label)??"",selectPlaceholder:(null==(s=null==e?void 0:e.value)?void 0:s.value)??x,iconSide:"right",searchPlaceholder:r("com_agents_search_name"),SelectIcon:null==(a=null==e?void 0:e.value)?void 0:a.icon,setValue:h,items:(null==m?void 0:m.map(e=>({label:e.name??"",value:e.id??"",icon:e.icon})))??[{label:"Loading...",value:""}],className:Op("z-50 flex h-[40px] w-full flex-none items-center justify-center truncate rounded-md bg-transparent font-bold"),ariaLabel:r("com_ui_agent"),isCollapsed:!1,showCarat:!0})}})}const GT=({setActivePanel:e})=>{const t=zf();return l.jsxs(c_,{size:"sm",variant:"outline",className:"btn btn-neutral border-token-border-light relative h-9 w-full gap-1 rounded-lg font-medium",onClick:()=>e(Ko.advanced),children:[l.jsx(yn,{className:"h-4 w-4 cursor-pointer","aria-hidden":"true"}),t("com_ui_advanced")]})};function WT({agent_id:e}){const t=zf(),{showToast:n}=Of(),s=jx({onSuccess:()=>{n({message:t("com_ui_agent_duplicated"),status:"success"})},onError:e=>{console.error(e),n({message:t("com_ui_agent_duplicate_error"),status:"error"})}});if(!e)return null;return l.jsx("button",{className:Op("btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",Kp),"aria-label":t("com_ui_duplicate")+" "+t("com_ui_agent"),type:"button",onClick:()=>{s.mutate({agent_id:e})},children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2 text-primary",children:l.jsx(Jt,{className:"size-4"})})})}const qT=({control:e,agentPerm:t,label:n,getValues:s,setValue:a})=>l.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[l.jsx("button",{className:"cursor-pointer select-none",type:"button",onClick:()=>a(t,!s(t),{shouldDirty:!0}),tabIndex:0,children:n}),l.jsx(Ir,{name:t,control:e,render:({field:e})=>l.jsx(Q_,{...e,checked:e.value,onCheckedChange:e.onChange,value:e.value.toString()})})]}),QT=()=>{const e=zf(),{user:t,roles:s}=Rg(),{showToast:a}=Of(),{mutate:r,isLoading:o}=(e=>{const t=Aa(),{onMutate:n,onSuccess:s,onError:a}=e??{};return Oa(e=>(_d.partial().parse(e.updates),Ru(e)),{onSuccess:(e,n,a)=>{t.invalidateQueries([Pd.roles,n.roleName]),null!=s&&s(e,n,a)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update prompt permissions:",t),null!=a&&a(...e)},onMutate:n})})({onSuccess:()=>{a({status:"success",message:e("com_ui_saved")})},onError:()=>{a({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[i,c]=n.useState(!1),[d,u]=n.useState(Id.USER),m=n.useMemo(()=>{var e;return(null==(e=null==s?void 0:s[d])?void 0:e.permissions)?s[d].permissions[bd.AGENTS]:Md[d].permissions[bd.AGENTS]},[s,d]),{reset:p,control:h,setValue:x,getValues:f,handleSubmit:g,formState:{isSubmitting:v}}=Rr({mode:"onChange",defaultValues:m});if(n.useEffect(()=>{var e,t;(null==(t=null==(e=null==s?void 0:s[d])?void 0:e.permissions)?void 0:t[bd.AGENTS])?p(s[d].permissions[bd.AGENTS]):p(Md[d].permissions[bd.AGENTS])},[s,d,p]),(null==t?void 0:t.role)!==Id.ADMIN)return null;const b=[{agentPerm:yd.SHARED_GLOBAL,label:e("com_ui_agents_allow_share_global")},{agentPerm:yd.CREATE,label:e("com_ui_agents_allow_create")},{agentPerm:yd.USE,label:e("com_ui_agents_allow_use")}],y=[{label:Id.USER,onClick:()=>{u(Id.USER)}},{label:Id.ADMIN,onClick:()=>{u(Id.ADMIN)}}];return l.jsxs(A_,{children:[l.jsx(O_,{asChild:!0,children:l.jsxs(c_,{size:"sm",variant:"outline",className:"btn btn-neutral border-token-border-light relative h-9 w-full gap-1 rounded-lg font-medium",children:[l.jsx(qe,{className:"cursor-pointer","aria-hidden":"true"}),e("com_ui_admin_settings")]})}),l.jsxs(V_,{className:"w-1/4 border-border-light bg-surface-primary text-text-primary",children:[l.jsx(U_,{children:`${e("com_ui_admin_settings")} - ${e("com_ui_agents")}`}),l.jsxs("div",{className:"p-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),l.jsx(kj,{unmountOnHide:!0,menuId:"role-dropdown",isOpen:i,setIsOpen:c,trigger:l.jsx(Qe,{className:"inline-flex w-1/4 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:d}),items:y,itemClassName:"items-center justify-center",sameWidth:!0})]}),l.jsxs("form",{onSubmit:g(e=>{r({roleName:d,updates:e})}),children:[l.jsx("div",{className:"py-5",children:b.map(({agentPerm:t,label:n})=>l.jsxs("div",{children:[l.jsx(qT,{control:h,agentPerm:t,label:n,getValues:f,setValue:x}),d===Id.ADMIN&&t===yd.USE&&l.jsx(l.Fragment,{children:l.jsxs("div",{className:"mb-2 max-w-full whitespace-normal break-words text-sm text-red-600",children:[l.jsx("span",{children:e("com_ui_admin_access_warning")}),"\n",l.jsx("a",{href:"https://www.hanzo.ai/docs/configuration/chat_yaml/object_structure/interface",target:"_blank",rel:"noreferrer",className:"text-blue-500 underline",children:e("com_ui_more_info")})]})})]},t))}),l.jsx("div",{className:"flex justify-end",children:l.jsx("button",{type:"submit",disabled:v||o,className:"btn rounded bg-white font-bold text-black transition-all hover:bg-gray-100 dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 border border-gray-300 dark:border-gray-600",children:e("com_ui_save")})})]})]})]})]})};function ZT({agent_id:e,setCurrentAgentId:t,createMutation:n}){const s=zf(),{reset:a}=Pr(),{showToast:r}=Of(),{conversation:o}=rg(),{setOption:i}=yv(),c=_x({onSuccess:(e,l,c)=>{var d;const u=c;if(!u)return;r({message:s("com_ui_agent_deleted"),status:"success"}),(null==(d=n.data)?void 0:d.id)&&(Dp.log("agents","resetting createMutation"),n.reset());const m=u[0];if(!m)return t(void 0),a(Wm()),i("agent_id")("");if(l.agent_id===(null==o?void 0:o.agent_id))return i("model")(""),i("agent_id")(m.id);const p=u.find(e=>e.id===(null==o?void 0:o.agent_id));p&&t(p.id),t(m.id)},onError:e=>{console.error(e),r({message:s("com_ui_agent_delete_error"),status:"error"})}});return e?l.jsxs(A_,{children:[l.jsx(O_,{asChild:!0,children:l.jsx("button",{className:Op("btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",Kp),"aria-label":s("com_ui_delete")+" "+s("com_ui_agent"),type:"button",children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2 text-red-500",children:l.jsx(py,{})})})}),l.jsx(Oj,{title:s("com_ui_delete")+" "+s("com_ui_agent"),className:"max-w-[450px]",main:l.jsx(l.Fragment,{children:l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(L_,{htmlFor:"delete-agent",className:"text-left text-sm font-medium",children:s("com_ui_delete_agent_confirm")})})})}),selection:{selectHandler:()=>c.mutate({agent_id:e}),selectClasses:"bg-red-600 hover:bg-red-700 dark:hover:bg-red-800 text-white",selectText:s("com_ui_delete")}})]}):null}function JT({agent_id:e="",agentName:t,projectIds:s=[],isCollaborative:a=!1}){const r=zf(),{showToast:o}=Of(),{data:i={},isFetching:c}=Sx(),{instanceProjectId:d}=i,u=n.useMemo(()=>!!s.includes(d),[s,d]),{watch:m,control:p,setValue:h,getValues:x,handleSubmit:f,formState:{isSubmitting:g}}=Rr({mode:"onChange",defaultValues:{[yd.SHARED_GLOBAL]:u,[yd.UPDATE]:a}}),v=m(yd.SHARED_GLOBAL);n.useEffect(()=>{v||h(yd.UPDATE,!1)},[v,h]),n.useEffect(()=>{h(yd.SHARED_GLOBAL,u),h(yd.UPDATE,a)},[u,a,h]);const b=yx({onSuccess:e=>{o({message:`${r("com_assistants_update_success")} ${e.name??r("com_ui_agent")}`,status:"success"})},onError:e=>{const t=e;o({message:`${r("com_agents_update_error")}${t.message?` ${r("com_ui_error")}: ${t.message}`:""}`,status:"error"})}});if(!e||!d)return null;const y=t=>{if(!e||!d)return;const n={};t[yd.UPDATE]!==a&&(n.isCollaborative=t[yd.UPDATE]),t[yd.SHARED_GLOBAL]!==u&&(t[yd.SHARED_GLOBAL]?n.projectIds=[i.instanceProjectId]:(n.removeProjectIds=[i.instanceProjectId],n.isCollaborative=!1)),Object.keys(n).length>0?b.mutate({agent_id:e,data:n}):o({message:r("com_ui_no_changes"),status:"info"})};return l.jsxs(A_,{children:[l.jsx(O_,{asChild:!0,children:l.jsx("button",{className:Op("btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",Kp),"aria-label":r("com_ui_share_var",{0:null!=t&&""!==t?`"${t}"`:r("com_ui_agent")}),type:"button",children:l.jsx("div",{className:"flex items-center justify-center gap-2 text-blue-500",children:l.jsx(We,{className:"icon-md h-4 w-4"})})})}),l.jsxs(V_,{className:"w-11/12 md:max-w-xl",children:[l.jsx(U_,{children:r("com_ui_share_var",{0:null!=t&&""!==t?`"${t}"`:r("com_ui_agent")})}),l.jsxs("form",{className:"p-2",onSubmit:e=>{e.preventDefault(),e.stopPropagation(),f(y)(e)},children:[l.jsxs("div",{className:"flex items-center justify-between gap-2 py-2",children:[l.jsxs("div",{className:"flex items-center",children:[l.jsx("button",{type:"button",className:"mr-2 cursor-pointer",disabled:c||b.isLoading||!d,onClick:()=>h(yd.SHARED_GLOBAL,!x(yd.SHARED_GLOBAL),{shouldDirty:!0}),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),h(yd.SHARED_GLOBAL,!x(yd.SHARED_GLOBAL),{shouldDirty:!0}))},"aria-checked":x(yd.SHARED_GLOBAL),role:"checkbox",children:r("com_ui_share_to_all_users")}),l.jsx("label",{htmlFor:yd.SHARED_GLOBAL,className:"select-none",children:u&&l.jsx("span",{className:"ml-2 text-xs",children:r("com_ui_agent_shared_to_all")})})]}),l.jsx(Ir,{name:yd.SHARED_GLOBAL,control:p,disabled:c||b.isLoading||!d,render:({field:e})=>l.jsx(Q_,{...e,checked:e.value,onCheckedChange:e.onChange,value:e.value.toString()})})]}),l.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2 py-2",children:[l.jsx("div",{className:"flex items-center",children:l.jsx("button",{type:"button",className:"mr-2 cursor-pointer",disabled:c||b.isLoading||!d||!v,onClick:()=>h(yd.UPDATE,!x(yd.UPDATE),{shouldDirty:!0}),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),h(yd.UPDATE,!x(yd.UPDATE),{shouldDirty:!0}))},"aria-checked":x(yd.UPDATE),role:"checkbox",children:r("com_agents_allow_editing")})}),l.jsx(Ir,{name:yd.UPDATE,control:p,disabled:c||b.isLoading||!d||!v,render:({field:e})=>l.jsx(Q_,{...e,checked:e.value,onCheckedChange:e.onChange,value:e.value.toString()})})]}),l.jsx("div",{className:"flex justify-end",children:l.jsx(z_,{asChild:!0,children:l.jsx(c_,{variant:"submit",size:"sm",type:"submit",disabled:g||c,children:r("com_ui_save")})})})]})]})]})}const YT=({setActivePanel:e})=>{const t=zf();return l.jsxs(c_,{size:"sm",variant:"outline",className:"btn btn-neutral border-token-border-light relative h-9 w-full gap-1 rounded-lg font-medium",onClick:()=>e(Ko.version),children:[l.jsx(_n,{className:"h-4 w-4 cursor-pointer","aria-hidden":"true"}),t("com_ui_agent_version")]})};function XT({activePanel:e,createMutation:t,updateMutation:n,setActivePanel:s,setCurrentAgentId:a}){const r=zf(),{user:o}=Rg(),i=Pr(),{control:c}=i,d=Mr({control:c,name:"agent"}),u=Mr({control:c,name:"id"}),m=Zv({permissionType:bd.AGENTS,permission:yd.SHARED_GLOBAL}),p=e===Ko.builder;return l.jsxs("div",{className:"mb-1 flex w-full flex-col gap-2",children:[p&&l.jsx(GT,{setActivePanel:s}),p&&u&&l.jsx(YT,{setActivePanel:s}),(null==o?void 0:o.role)===Id.ADMIN&&p&&l.jsx(QT,{}),l.jsxs("div",{className:"flex items-center justify-end gap-2",children:[l.jsx(ZT,{agent_id:u,setCurrentAgentId:a,createMutation:t}),((null==d?void 0:d.author)===(null==o?void 0:o.id)||(null==o?void 0:o.role)===Id.ADMIN)&&m&&l.jsx(JT,{agent_id:u,agentName:(null==d?void 0:d.name)??"",projectIds:(null==d?void 0:d.projectIds)??[],isCollaborative:null==d?void 0:d.isCollaborative}),d&&d.author===(null==o?void 0:o.id)&&l.jsx(WT,{agent_id:u}),l.jsx("button",{className:"btn btn-primary focus:shadow-outline flex h-9 w-full items-center justify-center px-4 py-2 font-semibold text-black bg-white hover:bg-gray-100 focus:border-black dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 dark:focus:border-white border border-gray-300 dark:border-gray-600",type:"submit",disabled:t.isLoading||n.isLoading,"aria-busy":t.isLoading||n.isLoading,children:t.isLoading||n.isLoading?l.jsx(Gb,{className:"icon-md","aria-hidden":"true"}):r(u?"com_ui_save":"com_ui_create")})]})]})}function eR({providers:e,setActivePanel:t,models:s}){const a=zf(),{control:r,setValue:o}=Pr(),i=Mr({control:r,name:"model"}),c=Mr({control:r,name:"provider"}),d=Mr({control:r,name:"model_parameters"}),u=n.useMemo(()=>("string"==typeof c?c:null==c?void 0:c.value)??"",[c]),m=n.useMemo(()=>u?s[u]??[]:[],[s,u]);n.useEffect(()=>{const e=i??"";if(u&&e){if(!m.includes(e)){const e=s[u]??[];o("model",e[0]??"")}localStorage.setItem(Jc.LAST_AGENT_MODEL,e),localStorage.setItem(Jc.LAST_AGENT_PROVIDER,u)}u&&!e&&o("model",m[0]??"")},[u,m,s,o,i]);const{data:p={}}=kx(),h=n.useMemo(()=>{var e;return(null==(e=null==p?void 0:p[u])?void 0:e.availableRegions)??[]},[p,u]),x=n.useMemo(()=>fp(p,u,"type"),[u,p]),f=n.useMemo(()=>{var e,t,n;const s=(null==(e=p[u])?void 0:e.customParams)??{},[a,r]=_i(x??u,i??""),o=s.defaultParamsEndpoint??r,l=Nm[a]??Nm[o]??[],c=(null==(n=null==(t=p[u])?void 0:t.customParams)?void 0:n.paramDefinitions)??[],d=Sr(c,"key");return l.map(e=>d[e.key]??e)},[x,p,i,u]),g=e=>t=>{o(`model_parameters.${e}`,t)};return l.jsxs("div",{className:"mx-1 mb-1 flex h-full min-h-[50vh] w-full flex-col gap-2 text-sm",children:[l.jsxs("div",{className:"model-panel relative flex flex-col items-center px-16 py-4 text-center",children:[l.jsx("div",{className:"absolute left-0 top-4",children:l.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{t(Ko.builder)},children:l.jsx("div",{className:"model-panel-content flex w-full items-center justify-center gap-2",children:l.jsx(zt,{})})})}),l.jsx("div",{className:"mb-2 mt-2 text-xl font-medium",children:a("com_ui_model_parameters")})]}),l.jsxs("div",{className:"p-2",children:[l.jsxs("div",{className:"mb-4",children:[l.jsxs("label",{id:"provider-label",className:"text-token-text-primary model-panel-label mb-2 block font-medium",htmlFor:"provider",children:[a("com_ui_provider")," ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx(Ir,{name:"provider",control:r,rules:{required:!0,minLength:1},render:({field:t,fieldState:{error:n}})=>{var s,r;const o="string"==typeof t.value?t.value:(null==(s=t.value)?void 0:s.value)??"",i="string"==typeof t.value?t.value:(null==(r=t.value)?void 0:r.label)??"";return l.jsxs(l.Fragment,{children:[l.jsx(eN,{selectedValue:o,displayValue:Oc[i]??i,selectPlaceholder:a("com_ui_select_provider"),searchPlaceholder:a("com_ui_select_search_provider"),setValue:t.onChange,items:e.map(e=>({label:"string"==typeof e?e:e.label,value:"string"==typeof e?e:e.value})),className:Op(n?"border-2 border-red-500":""),ariaLabel:a("com_ui_provider"),isCollapsed:!1,showCarat:!0}),n&&l.jsx("span",{className:"model-panel-error text-sm text-red-500 transition duration-300 ease-in-out",children:a("com_ui_field_required")})]})}})]}),l.jsxs("div",{className:"model-panel-section mb-4",children:[l.jsxs("label",{id:"model-label",className:Op("text-token-text-primary model-panel-label mb-2 block font-medium",!u&&"text-gray-500 dark:text-gray-400"),htmlFor:"model",children:[a("com_ui_model")," ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx(Ir,{name:"model",control:r,rules:{required:!0,minLength:1},render:({field:e,fieldState:{error:t}})=>l.jsxs(l.Fragment,{children:[l.jsx(eN,{selectedValue:e.value||"",selectPlaceholder:a(u?"com_ui_select_model":"com_ui_select_provider_first"),searchPlaceholder:a("com_ui_select_model"),setValue:e.onChange,items:m.map(e=>({label:e,value:e})),disabled:!u,className:Op("disabled:opacity-50",t?"border-2 border-red-500":""),ariaLabel:a("com_ui_model"),isCollapsed:!1,showCarat:!0}),u&&t&&l.jsx("span",{className:"text-sm text-red-500 transition duration-300 ease-in-out",children:a("com_ui_field_required")})]})})]})]}),f&&l.jsx("div",{className:"h-auto max-w-full overflow-x-hidden p-2",children:l.jsx("div",{className:"grid grid-cols-2 gap-4",children:f.map(e=>{const t=nN[e.component];if(!t)return null;const{key:n,default:s,...a}=e;return"region"===n&&h.length&&(a.options=h),l.jsx(t,{settingKey:n,defaultValue:s,...a,setOption:g,conversation:d},n)})})}),l.jsxs("button",{type:"button",onClick:()=>{o("model_parameters",{})},className:"btn btn-neutral my-1 flex w-full items-center justify-center gap-2 px-4 py-2 text-sm",children:[l.jsx(jn,{className:"h-4 w-4","aria-hidden":"true"}),a("com_ui_reset_var",{0:a("com_ui_model_parameters")})]})]})}function tR({agentsConfig:e,endpointsConfig:t}){var s,a,r;const o=zf(),{user:i}=Rg(),{showToast:c}=Of(),{activePanel:d,setActivePanel:u,setCurrentAgentId:m,agent_id:p}=Fg(),{onSelect:h}=function(){const e=Aa(),t=sg(),{conversation:s,newConversation:a}=rg(),r=cg(),[o,i]=n.useState((null==s?void 0:s.agent_id)??null),l=vx(o??"",{enabled:!!o&&o!==Zc.EPHEMERAL_AGENT_ID}),c=n.useCallback((e,n)=>{if(Dp.log("conversation","Updating conversation with agent",e),wi(null==s?void 0:s.endpoint)){const r=t({conversation:{...s??{},agent_id:e.id},preset:n});a({template:r,preset:n,keepLatestMessage:!0})}else a({template:{...n},preset:n})},[s,t,a]);return{onSelect:n.useCallback(async t=>{const n=null==r?void 0:r[t];if(!n)return;i(n.id);const s={endpoint:vi.agents,agent_id:n.id,conversationId:Zc.NEW_CONVO};c({id:n.id},s);try{await e.invalidateQueries({queryKey:[Pd.agent,n.id],exact:!0,refetchType:"active"},{throwOnError:!0});const{data:t}=await l.refetch();t&&c(t,{...s,agent_id:t.id})}catch(a){if(null==a?void 0:a.silent)return void console.warn("Current fetch was cancelled");console.error("Error fetching full agent data:",a),c({},{...s,agent_id:void 0})}},[r,c,e,l])}}(),x=Gf(),f=vx(p??"",{enabled:!!p&&p!==Zc.EPHEMERAL_AGENT_ID}),g=n.useMemo(()=>x.data??{},[x.data]),v=Rr({defaultValues:Wm()}),{control:b,handleSubmit:y,reset:_}=v,j=Mr({control:b,name:"id"}),w=n.useMemo(()=>new Set(null==e?void 0:e.allowedProviders),[null==e?void 0:e.allowedProviders]),N=n.useMemo(()=>Object.keys(t??{}).filter(e=>!ji(e)&&(!(w.size>0)||w.has(e))&&e!==vi.agents&&e!==vi.chatGPTBrowser&&e!==vi.gptPlugins).map(e=>Gm(e)),[t,w]),C=yx({onSuccess:e=>{c({message:`${o("com_assistants_update_success")} ${e.name??o("com_ui_agent")}`})},onError:e=>{var t,n,s,a,r,i,l,d,u;const m=e;if(409===m.statusCode&&(null==(t=m.details)?void 0:t.duplicateVersion)||409===(null==(n=m.response)?void 0:n.status)&&(null==(r=null==(a=null==(s=m.response)?void 0:s.data)?void 0:a.details)?void 0:r.duplicateVersion)){let e;return void 0!==(null==(i=m.details)?void 0:i.versionIndex)?e=m.details.versionIndex:void 0!==(null==(u=null==(d=null==(l=m.response)?void 0:l.data)?void 0:d.details)?void 0:u.versionIndex)&&(e=m.response.data.details.versionIndex),void c(void 0===e||e<0?{message:o("com_agents_update_error"),status:"error",duration:5e3}:{message:o("com_ui_agent_version_duplicate",{versionIndex:e+1}),status:"error",duration:1e4})}c({message:`${o("com_agents_update_error")}${m.message?` ${o("com_ui_error")}: ${m.message}`:""}`,status:"error"})}}),k=bx({onSuccess:e=>{m(e.id),c({message:`${o("com_assistants_create_success")} ${e.name??o("com_ui_agent")}`})},onError:e=>{const t=e;c({message:`${o("com_agents_create_error")}${t.message?` ${o("com_ui_error")}: ${t.message}`:""}`,status:"error"})}}),S=n.useCallback(e=>{const t=e.tools??[];!0===e.execute_code&&t.push(ri.execute_code),!0===e.file_search&&t.push(ri.file_search),!0===e.web_search&&t.push(ri.web_search);const{name:n,artifacts:s,description:a,instructions:r,model:i,model_parameters:l,provider:d,agent_ids:u,end_after_tools:m,hide_sequential_outputs:p,recursion_limit:h}=e,x=i??"",f=("string"==typeof d?d:d.value)??"";if(!j)return f&&x?void k.mutate({name:n,artifacts:s,description:a,instructions:r,model:x,tools:t,provider:f,model_parameters:l,agent_ids:u,end_after_tools:m,hide_sequential_outputs:p,recursion_limit:h}):c({message:o("com_agents_missing_provider_model"),status:"error"});C.mutate({agent_id:j,data:{name:n,artifacts:s,description:a,instructions:r,model:x,tools:t,provider:f,model_parameters:l,agent_ids:u,end_after_tools:m,hide_sequential_outputs:p,recursion_limit:h}})},[j,k,C,c,o]),T=n.useCallback(()=>{j&&h(j)},[j,h]),R=n.useMemo(()=>{var e,t,n;const s=!!(null==(e=f.data)?void 0:e.isCollaborative)||((null==(t=f.data)?void 0:t.author)===(null==i?void 0:i.id)||(null==i?void 0:i.role)===Id.ADMIN);return null==(null==(n=f.data)?void 0:n.id)||!f.data.id||s},[null==(s=f.data)?void 0:s.isCollaborative,null==(a=f.data)?void 0:a.author,null==(r=f.data)?void 0:r.id,null==i?void 0:i.id,null==i?void 0:i.role]);return l.jsx(Ar,{...v,children:l.jsxs("form",{onSubmit:y(S),className:"scrollbar-gutter-stable h-auto w-full flex-shrink-0 overflow-x-hidden","aria-label":"Agent configuration form",children:[l.jsxs("div",{className:"mt-2 flex w-full flex-wrap gap-2",children:[l.jsx("div",{className:"w-full",children:l.jsx(KT,{createMutation:k,agentQuery:f,setCurrentAgentId:m,selectedAgentId:f.isInitialLoading?null:p??null})}),j&&l.jsxs("div",{className:"flex w-full gap-2",children:[l.jsxs(c_,{type:"button",variant:"outline",className:"w-full justify-center",onClick:()=>{_(Wm()),m(void 0)},disabled:f.isInitialLoading,children:[l.jsx(_e,{className:"mr-1 h-4 w-4"}),o("com_ui_create")+" "+o("com_ui_new")+" "+o("com_ui_agent")]}),l.jsx(c_,{variant:"submit",disabled:!j||f.isInitialLoading,onClick:e=>{e.preventDefault(),T()},"aria-label":o("com_ui_select")+" "+o("com_ui_agent"),children:o("com_ui_select")})]})]}),f.isInitialLoading&&l.jsx(iT,{}),!R&&!f.isInitialLoading&&l.jsx("div",{className:"flex h-[30vh] w-full items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h2",{className:"text-token-text-primary m-2 text-xl font-semibold",children:o("com_agents_not_available")}),l.jsx("p",{className:"text-token-text-secondary",children:o("com_agents_no_access")})]})}),R&&!f.isInitialLoading&&d===Ko.model&&l.jsx(eR,{models:g,providers:N,setActivePanel:u}),R&&!f.isInitialLoading&&d===Ko.builder&&l.jsx(UT,{createMutation:k,agentsConfig:e,endpointsConfig:t}),R&&!f.isInitialLoading&&d===Ko.advanced&&l.jsx(dT,{setActivePanel:u,agentsConfig:e}),R&&!f.isInitialLoading&&l.jsx(XT,{createMutation:k,updateMutation:C,activePanel:d,setActivePanel:u,setCurrentAgentId:m})]})})}const nR={type:Ll.None,saved_auth_fields:!1,api_key:"",authorization_type:Al.Basic,custom_auth_header:"",oauth_client_id:"",oauth_client_secret:"",authorization_url:"",client_url:"",scope:"",token_exchange_method:Ol.DefaultPost,name:"",description:"",url:"",tools:[],icon:"",trust:!1};function sR(){const e=Rr({defaultValues:{type:Ll.None,saved_auth_fields:!1,api_key:"",authorization_type:Al.Basic,custom_auth_header:"",oauth_client_id:"",oauth_client_secret:"",authorization_url:"",client_url:"",scope:"",token_exchange_method:Ol.DefaultPost}}),{watch:t,setValue:s}=e,a=t("type");return n.useEffect(()=>{"none"===a&&(s("api_key",""),s("authorization_type",Al.Basic),s("custom_auth_header",""),s("oauth_client_id",""),s("oauth_client_secret",""),s("authorization_url",""),s("client_url",""),s("scope",""),s("token_exchange_method",Ol.DefaultPost))},[a,s]),l.jsx(Ar,{...e,children:l.jsx(JS,{})})}function aR(){return l.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"text-3xl",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[l.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),l.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}function rR({icon:e,onIconChange:t}){const[s,a]=n.useState(""),r=n.useRef(null),o=zf();n.useEffect(()=>{a(e||"")},[e]);return l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{onClick:()=>{r.current&&(r.current.value="",r.current.click())},className:"bg-token-surface-secondary dark:bg-token-surface-tertiary border-token-border-medium flex h-16 w-16 shrink-0 cursor-pointer items-center justify-center rounded-[1.5rem] border-2 border-dashed",children:s?l.jsx("img",{src:s,className:"h-full w-full rounded-[1.5rem] object-cover",alt:"MCP Icon",width:"64",height:"64"}):l.jsx(aR,{})}),l.jsxs("div",{className:"flex flex-col gap-1",children:[l.jsxs("span",{className:"token-text-secondary text-sm",children:[o("com_ui_icon")," ",o("com_ui_optional")]}),l.jsx("span",{className:"token-text-tertiary text-xs",children:o("com_agents_mcp_icon_size")})]}),l.jsx("input",{accept:"image/png,.png,image/jpeg,.jpg,.jpeg,image/gif,.gif,image/webp,.webp",multiple:!1,type:"file",style:{display:"none"},onChange:t,ref:r})]})}function oR({mcp:e,agent_id:t,setMCP:s}){const a=zf(),{showToast:r}=Of(),{handleSubmit:o,register:i,formState:{errors:c},control:d}=Pr(),[u,m]=n.useState(!1),[p,h]=n.useState(!1),[x,f]=n.useState([]);n.useEffect(()=>{(null==e?void 0:e.mcp_id)&&e.metadata.tools&&(h(!0),f(e.metadata.tools))},[e]);const g=function({onSuccess:e,onError:t}){return{mutate:async({mcp_id:n,metadata:s,agent_id:a})=>{try{e(["success",{mcp_id:n,metadata:s,agent_id:a}])}catch(r){t(r)}},isLoading:!1}}({onSuccess(e){r({message:a("com_ui_update_mcp_success"),status:"success"}),s(e[1]),h(!0),f(e[1].metadata.tools??[]),m(!1)},onError(e){r({message:e.message||a("com_ui_update_mcp_error"),status:"error"}),m(!1)}}),v=o(async n=>{m(!0);try{const o=await g.mutate({agent_id:t??"",mcp_id:null==e?void 0:e.mcp_id,metadata:{...n,tools:x}});s(o[1]),r({message:a("com_ui_update_mcp_success"),status:"success"})}catch{r({message:a("com_ui_update_mcp_error"),status:"error"})}finally{m(!1)}});return l.jsxs("div",{className:"flex flex-col gap-4",children:[l.jsx("div",{className:"mb-4",children:l.jsx(rR,{icon:null==e?void 0:e.metadata.icon,onIconChange:n=>{var a;const r=null==(a=n.target.files)?void 0:a[0];if(r){const n=new FileReader;n.onloadend=()=>{const a=n.result;s({mcp_id:(null==e?void 0:e.mcp_id)??"",agent_id:t??"",metadata:{...null==e?void 0:e.metadata,icon:a}})},n.readAsDataURL(r)}}})}),l.jsxs("div",{className:"flex flex-col gap-4",children:[l.jsxs("div",{className:"flex flex-col gap-2",children:[l.jsx(L_,{htmlFor:"name",children:a("com_ui_name")}),l.jsx("input",{id:"name",...i("name",{required:!0}),className:"border-token-border-medium flex h-9 w-full rounded-lg border bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light",placeholder:a("com_agents_mcp_name_placeholder")}),c.name&&l.jsx("span",{className:"text-xs text-red-500",children:a("com_ui_field_required")})]}),l.jsxs("div",{className:"flex flex-col gap-2",children:[l.jsxs(L_,{htmlFor:"description",children:[a("com_ui_description"),l.jsx("span",{className:"ml-1 text-xs text-text-secondary-alt",children:a("com_ui_optional")})]}),l.jsx("input",{id:"description",...i("description"),className:"border-token-border-medium flex h-9 w-full rounded-lg border bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light",placeholder:a("com_agents_mcp_description_placeholder")})]}),l.jsxs("div",{className:"flex flex-col gap-2",children:[l.jsx(L_,{htmlFor:"url",children:a("com_ui_mcp_url")}),l.jsx("input",{id:"url",...i("url",{required:!0}),className:"border-token-border-medium flex h-9 w-full rounded-lg border bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light",placeholder:"https://mcp.example.com"}),c.url&&l.jsx("span",{className:"text-xs text-red-500",children:"required"===c.url.type?a("com_ui_field_required"):c.url.message})]}),l.jsx(sR,{}),l.jsxs("div",{className:"my-2 flex items-center gap-2",children:[l.jsx(Ir,{name:"trust",control:d,rules:{required:!0},render:({field:e})=>l.jsx(d_,{id:"trust",checked:e.value,onCheckedChange:e.onChange})}),l.jsxs(L_,{htmlFor:"trust",className:"flex flex-col",children:[a("com_ui_trust_app"),l.jsx("span",{className:"text-xs text-text-secondary",children:a("com_agents_mcp_trust_subtext")})]})]}),c.trust&&l.jsx("span",{className:"text-xs text-red-500",children:a("com_ui_field_required")})]}),l.jsx("div",{className:"flex items-center justify-end",children:l.jsx("button",{onClick:v,disabled:u,className:"focus:shadow-outline mt-1 flex min-w-[100px] items-center justify-center rounded bg-white px-4 py-2 font-semibold text-black hover:bg-gray-100 focus:border-black focus:outline-none focus:ring-0 disabled:bg-gray-100 dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 dark:focus:border-white dark:disabled:bg-gray-700 border border-gray-300 dark:border-gray-600",type:"button",children:u?l.jsx(Gb,{className:"icon-md"}):(null==e?void 0:e.mcp_id)?a("com_ui_update"):a("com_ui_create")})}),p&&(null==e?void 0:e.metadata.tools)&&l.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("h3",{className:"text-token-text-primary block font-medium",children:a("com_ui_available_tools")}),l.jsx("button",{onClick:()=>{var t;x.length===(null==(t=null==e?void 0:e.metadata.tools)?void 0:t.length)?f([]):(null==e?void 0:e.metadata.tools)&&f(e.metadata.tools)},type:"button",className:"btn btn-neutral border-token-border-light relative h-8 rounded-full px-4 font-medium",children:x.length===e.metadata.tools.length?a("com_ui_deselect_all"):a("com_ui_select_all")})]}),l.jsx("div",{className:"flex flex-col gap-2",children:e.metadata.tools.map(e=>l.jsxs("label",{htmlFor:e,className:"border-token-border-light hover:bg-token-surface-secondary flex cursor-pointer items-center rounded-lg border p-2",children:[l.jsx(d_,{id:e,checked:x.includes(e),onCheckedChange:()=>(e=>{f(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer"}),l.jsx("span",{className:"text-token-text-primary",children:e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")})]},e))})]})]})}function iR(){const e=zf(),{showToast:t}=Of(),{mcp:s,setMcp:a,agent_id:r,setActivePanel:o}=Fg(),i=function({onSuccess:e,onError:t}){return{mutate:async({mcp_id:n,agent_id:s})=>{try{console.log("Mock delete MCP:",{mcp_id:n,agent_id:s}),e()}catch(a){t(a)}}}}({onSuccess:()=>{t({message:e("com_ui_delete_mcp_success"),status:"success"}),o(Ko.builder),a(void 0)},onError(n){t({message:n.message??e("com_ui_delete_mcp_error"),status:"error"})}}),c=Rr({defaultValues:nR}),{reset:d}=c;return n.useEffect(()=>{if(s){const e={icon:s.metadata.icon??"",name:s.metadata.name??"",description:s.metadata.description??"",url:s.metadata.url??"",tools:s.metadata.tools??[],trust:s.metadata.trust??!1};s.metadata.auth&&Object.assign(e,{type:s.metadata.auth.type||Ll.None,saved_auth_fields:!1,api_key:s.metadata.api_key??"",authorization_type:s.metadata.auth.authorization_type||Al.Basic,oauth_client_id:s.metadata.oauth_client_id??"",oauth_client_secret:s.metadata.oauth_client_secret??"",authorization_url:s.metadata.auth.authorization_url??"",client_url:s.metadata.auth.client_url??"",scope:s.metadata.auth.scope??"",token_exchange_method:s.metadata.auth.token_exchange_method??Ol.DefaultPost}),d(e)}},[s,d]),l.jsx(Ar,{...c,children:l.jsx("form",{className:"h-full grow overflow-hidden",children:l.jsxs("div",{className:"h-full overflow-auto px-2 pb-12 text-sm",children:[l.jsxs("div",{className:"relative flex flex-col items-center px-16 py-6 text-center",children:[l.jsx("div",{className:"absolute left-0 top-6",children:l.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{o(Ko.builder),a(void 0)},children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:l.jsx(zt,{})})})}),!!s&&l.jsxs(A_,{children:[l.jsx(O_,{asChild:!0,children:l.jsx("div",{className:"absolute right-0 top-6",children:l.jsx("button",{type:"button",disabled:!r||!s.mcp_id,className:"btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",children:l.jsx(py,{className:"text-red-500"})})})}),l.jsx(Oj,{showCloseButton:!1,title:e("com_ui_delete_mcp"),className:"max-w-[450px]",main:l.jsx(L_,{className:"text-left text-sm font-medium",children:e("com_ui_delete_mcp_confirm")}),selection:{selectHandler:()=>{if(!r)return t({message:e("com_agents_no_agent_id_error"),status:"error"});i.mutate({mcp_id:s.mcp_id,agent_id:r})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:e("com_ui_delete")}})]}),l.jsx("div",{className:"text-xl font-medium",children:e(s?"com_ui_edit_mcp_server":"com_ui_add_mcp_server")}),l.jsx("div",{className:"text-xs text-text-secondary",children:e("com_agents_mcp_info")})]}),l.jsx(oR,{mcp:s,agent_id:r,setMCP:a})]})})})}function lR(){return l.jsx(Vg,{children:l.jsx(cR,{})})}function cR(){const{conversation:e}=rg(),{activePanel:t,setCurrentAgentId:s}=Fg(),{data:a={}}=kx(),r=n.useMemo(()=>{const e=(null==a?void 0:a[vi.agents])??null;return e?{...e,capabilities:Array.isArray(e.capabilities)?e.capabilities.map(e=>e):[]}:null},[a]);return n.useEffect(()=>{const t=(null==e?void 0:e.agent_id)??"";t&&s(t)},[s,null==e?void 0:e.agent_id]),(null==e?void 0:e.endpoint)?t===Ko.actions?l.jsx(oT,{}):t===Ko.version?l.jsx(ZS,{}):t===Ko.mcp?l.jsx(iR,{}):l.jsx(tR,{agentsConfig:r,endpointsConfig:a}):null}const dR=({bookmark:e,tabIndex:t=0,onFocus:s,onBlur:a})=>{const r=zf(),{showToast:o}=Of(),[i,c]=n.useState(!1),d=pf({onSuccess:()=>{o({message:r("com_ui_bookmarks_delete_success")})},onError:()=>{o({message:r("com_ui_bookmarks_delete_error"),severity:Wo.ERROR})}}),u=n.useCallback(async()=>{await d.mutateAsync(e)},[e,d]);return l.jsx(l.Fragment,{children:l.jsxs(A_,{open:i,onOpenChange:c,children:[l.jsx(O_,{asChild:!0,children:l.jsx(rj,{description:r("com_ui_delete"),render:l.jsx(c_,{variant:"ghost","aria-label":r("com_ui_bookmarks_delete"),tabIndex:t,onFocus:s,onBlur:a,onClick:()=>c(!i),className:"h-8 w-8 p-0",children:l.jsx(py,{})})})}),l.jsx(Oj,{showCloseButton:!1,title:r("com_ui_bookmarks_delete"),className:"w-11/12 max-w-lg",main:l.jsxs(L_,{className:"text-left text-sm font-medium",children:[r("com_ui_bookmark_delete_confirm")," ",e]}),selection:{selectHandler:u,selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 text-white",selectText:r("com_ui_delete")}})]})})},uR=({tags:e,bookmark:t,mutation:s,conversationId:a,setOpen:r,formRef:o})=>{const i=zf(),c=Aa(),{showToast:d}=Of(),{bookmarks:u}=Yg(),{register:m,handleSubmit:p,setValue:h,getValues:x,control:f,formState:{errors:g}}=Rr({defaultValues:{tag:(null==t?void 0:t.tag)??"",description:(null==t?void 0:t.description)??"",conversationId:a??"",addToConversation:!(null==a||!a)}});n.useEffect(()=>{t&&t.tag&&(h("tag",t.tag),h("description",t.description??""))},[t,h]);return l.jsx("form",{ref:o,className:"mt-6","aria-label":"Bookmark form",method:"POST",onSubmit:p(n=>{if(Dp.log("tag_mutation","BookmarkForm - onSubmit: data",n),s.isLoading)return;if(n.tag===(null==t?void 0:t.tag)&&n.description===(null==t?void 0:t.description))return;if(null!=n.tag&&(e??[]).includes(n.tag))return void d({message:i("com_ui_bookmarks_create_exists"),status:"warning"});(c.getQueryData([Pd.conversationTags])??[]).some(e=>e.tag===n.tag)?d({message:i("com_ui_bookmarks_create_exists"),status:"warning"}):(s.mutate(n),r(!1))}),children:l.jsxs("div",{className:"flex w-full flex-col items-center gap-2",children:[l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsx(L_,{htmlFor:"bookmark-tag",className:"text-left text-sm font-medium",children:i("com_ui_bookmarks_title")}),l.jsx(M_,{type:"text",id:"bookmark-tag","aria-label":"Bookmark",...m("tag",{required:"tag is required",maxLength:{value:128,message:i("com_auth_password_max_length")},validate:e=>e===(null==t?void 0:t.tag)||u.every(t=>t.tag!==e)||"tag must be unique"}),"aria-invalid":!!g.tag,placeholder:"Bookmark"}),g.tag&&l.jsx("span",{className:"text-sm text-red-500",children:g.tag.message})]}),l.jsxs("div",{className:"mt-4 grid w-full items-center gap-2",children:[l.jsx(L_,{htmlFor:"bookmark-description",className:"text-left text-sm font-medium",children:i("com_ui_bookmarks_description")}),l.jsx(aj,{...m("description",{maxLength:{value:1048,message:"Maximum 1048 characters"}}),id:"bookmark-description",disabled:!1,className:Op("flex h-10 max-h-[250px] min-h-[100px] w-full resize-none rounded-lg border border-input bg-transparent px-3 py-2 text-sm ring-offset-background focus-visible:outline-none")})]}),null!=a&&a&&l.jsxs("div",{className:"mt-2 flex w-full items-center",children:[l.jsx(Ir,{name:"addToConversation",control:f,render:({field:e})=>{var t;return l.jsx(d_,{...e,checked:e.value,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:null==(t=e.value)?void 0:t.toString()})}}),l.jsx("button",{type:"button","aria-label":i("com_ui_bookmarks_add_to_conversation"),className:"form-check-label w-full cursor-pointer text-text-primary",onClick:()=>h("addToConversation",!x("addToConversation"),{shouldDirty:!0}),children:l.jsx("div",{className:"flex select-none items-center",children:i("com_ui_bookmarks_add_to_conversation")})})]})]})})},mR=({open:e,setOpen:t,tags:s,setTags:a,context:r,bookmark:o,children:i,triggerRef:c,conversationId:d})=>{const u=zf(),m=n.useRef(null),{showToast:p}=Of(),h=mf({context:r,tag:null==o?void 0:o.tag,options:{onSuccess:(e,n)=>{if(p({message:u(o?"com_ui_bookmarks_update_success":"com_ui_bookmarks_create_success")}),t(!1),Dp.log("tag_mutation","tags before setting",s),a&&!0===n.addToConversation){const e=[...s||[],n.tag].filter(e=>void 0!==e);if(a(e),Dp.log("tag_mutation","tags after",e),null==n.tag||""===n.tag)return;setTimeout(()=>{const e=document.getElementById(n.tag??"");console.log("tagElement",e),e&&e.focus()},5)}},onError:()=>{p({message:u(o?"com_ui_bookmarks_update_error":"com_ui_bookmarks_create_error"),severity:Wo.ERROR})}}});return l.jsxs(A_,{open:e,onOpenChange:t,triggerRef:c,children:[i,l.jsx(Oj,{title:"Bookmark",showCloseButton:!1,className:"w-11/12 md:max-w-2xl",main:l.jsx(uR,{tags:s,setOpen:t,mutation:h,conversationId:d,bookmark:o,formRef:m}),buttons:l.jsx(c_,{variant:"submit",type:"submit",disabled:h.isLoading,onClick:()=>{m.current&&m.current.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))},className:"text-white",children:h.isLoading?l.jsx(Gb,{}):u("com_ui_save")})})]})},pR=({bookmark:e,tabIndex:t=0,onFocus:s,onBlur:a})=>{const r=zf(),[o,i]=n.useState(!1);return l.jsx(mR,{context:"EditBookmarkButton",bookmark:e,open:o,setOpen:i,children:l.jsx(O_,{asChild:!0,children:l.jsx(rj,{description:r("com_ui_edit"),render:l.jsx(c_,{variant:"ghost","aria-label":r("com_ui_bookmarks_edit"),tabIndex:t,onFocus:s,onBlur:a,onClick:()=>i(!o),className:"h-8 w-8 p-0",children:l.jsx(Bb,{})})})})})},hR=({row:e,moveRow:t,position:s})=>{const a=n.useRef(null),r=mf({context:"BookmarkTableRow",tag:e.tag}),o=zf(),{showToast:i}=Of(),[,c]=Sa({accept:"bookmark",drop:t=>{r.mutate({...e,position:t.index},{onSuccess:()=>{i({message:o("com_ui_bookmarks_update_success"),severity:Wo.SUCCESS})},onError:()=>{i({message:o("com_ui_bookmarks_update_error"),severity:Wo.ERROR})}})},hover(e){a.current&&e.index!==s&&(t(e.index,s),e.index=s)}}),[{isDragging:d},u]=Ra({type:"bookmark",item:{index:s},collect:e=>({isDragging:e.isDragging()})});return u(c(a)),l.jsxs(X_,{ref:a,className:"cursor-move hover:bg-surface-secondary",style:{opacity:d?.5:1},children:[l.jsx(tj,{className:"w-[70%] px-4 py-4",children:l.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:e.tag})}),l.jsx(tj,{className:"w-[10%] px-12 py-4",children:e.count}),l.jsx(tj,{className:"w-[20%] px-4 py-4",children:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(pR,{bookmark:e,tabIndex:0}),l.jsx(dR,{bookmark:e.tag,tabIndex:0})]})})]})},xR=()=>{const e=zf(),[t,s]=n.useState([]),[a,r]=n.useState(0),[o,i]=n.useState(""),[c,d]=n.useState(!1),{bookmarks:u=[]}=Yg();n.useEffect(()=>{const e=(e=>{const t=new Set;return e.filter(e=>{const n=t.has(e._id);return t.add(e._id),!n})})(u).sort((e,t)=>e.position-t.position);s(e)},[u]);const m=n.useCallback((e,t)=>{s(n=>{const s=[...n],[a]=s.splice(e,1);return s.splice(t,0,a),s.map((e,t)=>({...e,position:t}))})},[]),p=n.useCallback(e=>l.jsx(hR,{moveRow:m,row:e,position:e.position},e._id),[m]),h=t.filter(e=>e.tag&&e.tag.toLowerCase().includes(o.toLowerCase())),x=h.slice(10*a,10*(a+1));return l.jsx(Jg.Provider,{value:{bookmarks:u},children:l.jsxs("div",{role:"region","aria-label":e("com_ui_bookmarks"),className:"mt-2 space-y-2",children:[l.jsx("div",{className:"flex items-center gap-4",children:l.jsx(M_,{placeholder:e("com_ui_bookmarks_filter"),value:o,onChange:e=>i(e.target.value),"aria-label":e("com_ui_bookmarks_filter")})}),l.jsx("div",{className:"rounded-lg border border-border-light bg-transparent shadow-sm transition-colors",children:l.jsxs(Z_,{className:"w-full table-fixed",children:[l.jsx(J_,{children:l.jsxs(X_,{className:"border-b border-border-light",children:[l.jsx(ej,{className:"w-[70%] bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:l.jsx("div",{children:e("com_ui_bookmarks_title")})}),l.jsx(ej,{className:"w-[30%] bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:l.jsx("div",{children:e("com_ui_bookmarks_count")})}),l.jsx(ej,{className:"w-[40%] bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:l.jsx("div",{children:e("com_assistants_actions")})})]})}),l.jsx(Y_,{children:x.length?x.map(p):l.jsx(X_,{children:l.jsx(tj,{colSpan:3,className:"h-24 text-center text-sm text-text-secondary",children:e("com_ui_no_bookmarks")})})})]})}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{className:"flex justify-between gap-2",children:l.jsx(mR,{context:"BookmarkPanel",open:c,setOpen:d,children:l.jsx(O_,{asChild:!0,children:l.jsxs(c_,{variant:"outline",size:"sm",className:"w-full gap-2 text-sm",onClick:()=>d(!c),children:[l.jsx(wn,{className:"size-4"}),l.jsx("div",{className:"break-all",children:e("com_ui_bookmarks_new")})]})})})}),l.jsxs("div",{className:"flex items-center gap-2",role:"navigation","aria-label":"Pagination",children:[l.jsx(c_,{variant:"outline",size:"sm",onClick:()=>r(e=>Math.max(e-1,0)),disabled:0===a,"aria-label":e("com_ui_prev"),children:e("com_ui_prev")}),l.jsx("div",{"aria-live":"polite",className:"text-sm",children:`${a+1} / ${Math.ceil(h.length/10)}`}),l.jsx(c_,{variant:"outline",size:"sm",onClick:()=>r(e=>10*(e+1)<h.length?e+1:e),disabled:10*(a+1)>=h.length,"aria-label":e("com_ui_next"),children:e("com_ui_next")})]})]})]})})},fR=()=>{const{data:e}=Yx();return l.jsx("div",{className:"h-auto max-w-full overflow-x-hidden",children:l.jsx(Jg.Provider,{value:{bookmarks:e||[]},children:l.jsx(xR,{})})})};function gR({open:e,onOpenChange:t,children:s,triggerRef:a}){const r=zf(),{showToast:o}=Of(),i=Zv({permissionType:bd.MEMORIES,permission:yd.CREATE}),{mutate:c,isLoading:d}=zx({onSuccess:()=>{o({message:r("com_ui_memory_created"),status:"success"}),t(!1),m(""),h(""),setTimeout(()=>{var e;null==(e=null==a?void 0:a.current)||e.focus()},0)},onError:e=>{var t,n,s;let a=r("com_ui_error");if(e&&"object"==typeof e&&"response"in e){const o=e;(null==(n=null==(t=o.response)?void 0:t.data)?void 0:n.error)&&(a=o.response.data.error,(409===(null==(s=o.response)?void 0:s.status)||a.includes("already exists"))&&(a=r("com_ui_memory_key_exists")))}else e.message&&(a=e.message);o({message:a,status:"error"})}}),[u,m]=n.useState(""),[p,h]=n.useState(""),x=()=>{i&&(u.trim()&&p.trim()?c({key:u.trim(),value:p.trim()}):o({message:r("com_ui_field_required"),status:"error"}))},f=e=>{"Enter"===e.key&&e.ctrlKey&&i&&x()};return l.jsxs(A_,{open:e,onOpenChange:t,triggerRef:a,children:[s,l.jsx(Oj,{title:r("com_ui_create_memory"),showCloseButton:!1,className:"w-11/12 md:max-w-lg",main:l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(L_,{htmlFor:"memory-key",className:"text-sm font-medium",children:r("com_ui_key")}),l.jsx(M_,{id:"memory-key",value:u,onChange:e=>m(e.target.value),onKeyDown:f,placeholder:r("com_ui_enter_key"),className:"w-full"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(L_,{htmlFor:"memory-value",className:"text-sm font-medium",children:r("com_ui_value")}),l.jsx("textarea",{id:"memory-value",value:p,onChange:e=>h(e.target.value),onKeyDown:f,placeholder:r("com_ui_enter_value"),className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",rows:3})]})]}),buttons:l.jsx(c_,{type:"button",variant:"submit",onClick:x,disabled:d||!u.trim()||!p.trim(),className:"text-white",children:d?l.jsx(Gb,{className:"size-4"}):r("com_ui_create")})})]})}function vR({memory:e,open:t,onOpenChange:s,children:a,triggerRef:r}){const o=zf(),{showToast:i}=Of(),{data:c}=Lx(),d=Zv({permissionType:bd.MEMORIES,permission:yd.UPDATE}),{mutate:u,isLoading:m}=Ox({onMutate:()=>{s(!1),setTimeout(()=>{var e;null==(e=null==r?void 0:r.current)||e.focus()},0)},onSuccess:()=>{i({message:o("com_ui_saved"),status:"success"})},onError:()=>{i({message:o("com_ui_error"),status:"error"})}}),[p,h]=n.useState(""),[x,f]=n.useState(""),[g,v]=n.useState("");n.useEffect(()=>{e&&(h(e.key),f(e.value),v(e.key))},[e]);const b=()=>{d&&e&&(p.trim()&&x.trim()?u({key:p.trim(),value:x.trim(),...g!==p.trim()&&{originalKey:g}}):i({message:o("com_ui_field_required"),status:"error"}))},y=e=>{"Enter"===e.key&&e.ctrlKey&&d&&b()};return l.jsxs(A_,{open:t,onOpenChange:s,triggerRef:r,children:[a,l.jsx(Oj,{title:o(d?"com_ui_edit_memory":"com_ui_view_memory"),showCloseButton:!1,className:"w-11/12 md:max-w-lg",main:l.jsxs("div",{className:"space-y-4",children:[e&&l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex items-center justify-between text-xs text-text-secondary",children:[l.jsxs("div",{children:[o("com_ui_date"),":"," ",new Date(e.updated_at).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),void 0!==e.tokenCount&&l.jsxs("div",{children:[e.tokenCount.toLocaleString(),(null==c?void 0:c.tokenLimit)&&` / ${c.tokenLimit.toLocaleString()}`," ",o(1===e.tokenCount?"com_ui_token":"com_ui_tokens")]})]}),(null==c?void 0:c.tokenLimit)&&null!==(null==c?void 0:c.usagePercentage)&&l.jsxs("div",{className:"text-xs text-text-secondary",children:[o("com_ui_usage"),": ",c.usagePercentage,"%"," "]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(L_,{htmlFor:"memory-key",className:"text-sm font-medium",children:o("com_ui_key")}),l.jsx(M_,{id:"memory-key",value:p,onChange:e=>d&&h(e.target.value),onKeyDown:y,placeholder:o("com_ui_enter_key"),className:"w-full",disabled:!d})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(L_,{htmlFor:"memory-value",className:"text-sm font-medium",children:o("com_ui_value")}),l.jsx("textarea",{id:"memory-value",value:x,onChange:e=>d&&f(e.target.value),onKeyDown:y,placeholder:o("com_ui_enter_value"),className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",rows:3,disabled:!d})]})]}),buttons:d?l.jsx(c_,{type:"button",variant:"submit",onClick:b,disabled:m||!p.trim()||!x.trim(),className:"text-white",children:m?l.jsx(Gb,{className:"size-4"}):o("com_ui_save")}):null})]})}const bR=({control:e,memoryPerm:t,label:n})=>l.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[n,l.jsx(Ir,{name:t,control:e,render:({field:e})=>l.jsx(Q_,{...e,checked:e.value,onCheckedChange:e.onChange,value:e.value.toString()})})]}),yR=()=>{const e=zf(),{user:t,roles:s}=Rg(),{showToast:a}=Of(),{mutate:r,isLoading:o}=(e=>{const t=Aa(),{onMutate:n,onSuccess:s,onError:a}=e??{};return Oa(e=>(wd.partial().parse(e.updates),Iu(e)),{onSuccess:(e,n,a)=>{t.invalidateQueries([Pd.roles,n.roleName]),s&&s(e,n,a)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update memory permissions:",t),a&&a(...e)},onMutate:n})})({onSuccess:()=>{a({status:"success",message:e("com_ui_saved")})},onError:()=>{a({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[i,c]=n.useState(!1),[d,u]=n.useState(Id.USER),m=n.useMemo(()=>{var e,t,n;return(null==(e=null==s?void 0:s[d])?void 0:e.permissions)?null==(n=null==(t=null==s?void 0:s[d])?void 0:t.permissions)?void 0:n[bd.MEMORIES]:Md[d].permissions[bd.MEMORIES]},[s,d]),{reset:p,control:h,setValue:x,getValues:f,handleSubmit:g,formState:{isSubmitting:v}}=Rr({mode:"onChange",defaultValues:m});if(n.useEffect(()=>{var e,t,n,a;(null==(t=null==(e=null==s?void 0:s[d])?void 0:e.permissions)?void 0:t[bd.MEMORIES])?p(null==(a=null==(n=null==s?void 0:s[d])?void 0:n.permissions)?void 0:a[bd.MEMORIES]):p(Md[d].permissions[bd.MEMORIES])},[s,d,p]),(null==t?void 0:t.role)!==Id.ADMIN)return null;const b=[{memoryPerm:yd.USE,label:e("com_ui_memories_allow_use")},{memoryPerm:yd.CREATE,label:e("com_ui_memories_allow_create")},{memoryPerm:yd.UPDATE,label:e("com_ui_memories_allow_update")},{memoryPerm:yd.READ,label:e("com_ui_memories_allow_read")},{memoryPerm:yd.OPT_OUT,label:e("com_ui_memories_allow_opt_out")}],y=[{label:Id.USER,onClick:()=>{u(Id.USER)}},{label:Id.ADMIN,onClick:()=>{u(Id.ADMIN)}}];return l.jsxs(A_,{children:[l.jsx(O_,{asChild:!0,children:l.jsxs(c_,{size:"sm",variant:"outline",className:"btn btn-neutral border-token-border-light relative h-9 w-full gap-1 rounded-lg font-medium",children:[l.jsx(qe,{className:"cursor-pointer","aria-hidden":"true"}),e("com_ui_admin_settings")]})}),l.jsxs(V_,{className:"w-1/4 border-border-light bg-surface-primary text-text-primary",children:[l.jsx(U_,{children:`${e("com_ui_admin_settings")} - ${e("com_ui_memories")}`}),l.jsxs("div",{className:"p-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),l.jsx(kj,{unmountOnHide:!0,menuId:"memory-role-dropdown",isOpen:i,setIsOpen:c,trigger:l.jsx(Qe,{className:"inline-flex w-1/4 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:d}),items:y,itemClassName:"items-center justify-center",sameWidth:!0})]}),l.jsxs("form",{onSubmit:g(e=>{r({roleName:d,updates:e})}),children:[l.jsx("div",{className:"py-5",children:b.map(({memoryPerm:t,label:n})=>l.jsxs("div",{children:[l.jsx(bR,{control:h,memoryPerm:t,label:n,getValues:f,setValue:x}),d===Id.ADMIN&&t===yd.USE&&l.jsx(l.Fragment,{children:l.jsxs("div",{className:"mb-2 max-w-full whitespace-normal break-words text-sm text-red-600",children:[l.jsx("span",{children:e("com_ui_admin_access_warning")}),"\n",l.jsx("a",{href:"https://www.hanzo.ai/docs/configuration/chat_yaml/object_structure/interface",target:"_blank",rel:"noreferrer",className:"text-blue-500 underline",children:e("com_ui_more_info")})]})})]},t))}),l.jsx("div",{className:"flex justify-end",children:l.jsx("button",{type:"submit",disabled:v||o,className:"btn rounded bg-white font-bold text-black transition-all hover:bg-gray-100 dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 border border-gray-300 dark:border-gray-600",children:e("com_ui_save")})})]})]})]})]})};function _R(){var e;const t=zf(),{user:s}=Rg(),{data:a}=rx(),{data:r,isLoading:o}=Lx(),{mutate:i}=Ax(),{showToast:c}=Of(),[d,u]=n.useState(0),[m,p]=n.useState(""),h=10,[x,f]=n.useState(!1),[g,v]=n.useState(null),[b,y]=n.useState(!0),_=Dx({onSuccess:()=>{c({message:t("com_ui_preferences_updated"),status:"success"})},onError:()=>{c({message:t("com_ui_error_updating_preferences"),status:"error"}),y(e=>!e)}});n.useEffect(()=>{var e;void 0!==(null==(e=null==a?void 0:a.personalization)?void 0:e.memories)&&y(a.personalization.memories)},[null==(e=null==a?void 0:a.personalization)?void 0:e.memories]);const j=Zv({permissionType:bd.MEMORIES,permission:yd.READ}),w=Zv({permissionType:bd.MEMORIES,permission:yd.UPDATE}),N=Zv({permissionType:bd.MEMORIES,permission:yd.CREATE}),C=Zv({permissionType:bd.MEMORIES,permission:yd.OPT_OUT}),k=n.useMemo(()=>(null==r?void 0:r.memories)??[],[r]),S=n.useMemo(()=>L(k,m,{keys:["key","value"]}),[k,m]),T=n.useMemo(()=>S.slice(d*h,(d+1)*h),[S,d]),R=({memory:e})=>{const[s,a]=n.useState(!1),r=n.useRef(null);return w?l.jsx(vR,{open:s,memory:e,onOpenChange:a,triggerRef:r,children:l.jsx(O_,{asChild:!0,children:l.jsx(rj,{description:t("com_ui_edit_memory"),render:l.jsx(c_,{variant:"ghost","aria-label":t("com_ui_bookmarks_edit"),onClick:()=>a(!s),className:"h-8 w-8 p-0",children:l.jsx(Bb,{})})})})}):null},I=({memory:e})=>{const[s,a]=n.useState(!1);if(!w)return null;return l.jsxs(A_,{open:s,onOpenChange:a,children:[l.jsx(O_,{asChild:!0,children:l.jsx(rj,{description:t("com_ui_delete_memory"),render:l.jsx(c_,{variant:"ghost","aria-label":t("com_ui_delete"),onClick:()=>a(!s),className:"h-8 w-8 p-0",children:g===e.key?l.jsx(Gb,{className:"size-4 animate-spin"}):l.jsx(py,{className:"size-4"})})})}),l.jsx(Oj,{showCloseButton:!1,title:t("com_ui_delete_memory"),className:"w-11/12 max-w-lg",main:l.jsxs(L_,{className:"text-left text-sm font-medium",children:[t("com_ui_delete_confirm"),' "',e.key,'"?']}),selection:{selectHandler:async()=>{v(e.key),i(e.key,{onSuccess:()=>{c({message:t("com_ui_deleted"),status:"success"}),a(!1)},onError:()=>c({message:t("com_ui_error"),status:"error"}),onSettled:()=>v(null)})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 text-white",selectText:t("com_ui_delete")}})]})};return o?l.jsx("div",{className:"flex h-full w-full items-center justify-center p-4",children:l.jsx(Gb,{})}):j?l.jsx("div",{className:"flex h-full w-full flex-col overflow-hidden",children:l.jsxs("div",{role:"region","aria-label":t("com_ui_memories"),className:"mt-2 space-y-2",children:[l.jsx("div",{className:"flex items-center gap-4",children:l.jsx(M_,{placeholder:t("com_ui_memories_filter"),value:m,onChange:e=>p(e.target.value),"aria-label":t("com_ui_memories_filter")})}),((null==r?void 0:r.tokenLimit)||C)&&l.jsxs("div",{className:Op("flex items-center rounded-lg",null!=(null==r?void 0:r.tokenLimit)&&C?"justify-between":"justify-end"),children:[(null==r?void 0:r.tokenLimit)&&l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("div",{className:"relative size-10",children:[l.jsxs("svg",{className:"size-10 -rotate-90 transform",children:[l.jsx("circle",{cx:"20",cy:"20",r:"16",stroke:"currentColor",strokeWidth:"3",fill:"none",className:"text-gray-200 dark:text-gray-700"}),l.jsx("circle",{cx:"20",cy:"20",r:"16",strokeWidth:"3",fill:"none",strokeDasharray:""+2*Math.PI*16,strokeDashoffset:""+2*Math.PI*16*(1-(r.usagePercentage??0)/100),className:"transition-all "+(E=r.usagePercentage??0,E>90?"stroke-red-500":E>75?"stroke-yellow-500":"stroke-gray-500"),strokeLinecap:"round"})]}),l.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:l.jsxs("span",{className:"text-xs font-medium",children:[r.usagePercentage,"%"]})})]}),l.jsx("div",{className:"text-sm text-text-secondary",children:t("com_ui_usage")})]}),C&&l.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[l.jsx("span",{children:t("com_ui_use_memory")}),l.jsx(Q_,{checked:b,onCheckedChange:e=>{y(e),_.mutate({memories:e})},"aria-label":t("com_ui_reference_saved_memories"),disabled:_.isLoading})]})]}),N&&l.jsx("div",{className:"flex w-full justify-end",children:l.jsx(gR,{open:x,onOpenChange:f,children:l.jsx(O_,{asChild:!0,children:l.jsxs(c_,{variant:"outline",className:"w-full bg-transparent",children:[l.jsx(_e,{className:"size-4","aria-hidden":!0}),t("com_ui_create_memory")]})})})}),l.jsx("div",{className:"rounded-lg border border-border-light bg-transparent shadow-sm transition-colors",children:l.jsxs(Z_,{className:"w-full table-fixed",children:[l.jsx(J_,{children:l.jsxs(X_,{className:"border-b border-border-light hover:bg-surface-secondary",children:[l.jsx(ej,{className:(w?"w-[75%]":"w-[100%]")+" bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:l.jsx("div",{children:t("com_ui_memory")})}),w&&l.jsx(ej,{className:"w-[25%] bg-surface-secondary py-3 text-center text-sm font-medium text-text-secondary",children:l.jsx("div",{children:t("com_assistants_actions")})})]})}),l.jsx(Y_,{children:T.length?T.map((e,t)=>l.jsxs(X_,{className:"border-b border-border-light hover:bg-surface-secondary",children:[l.jsx(tj,{className:(w?"w-[75%]":"w-[100%]")+" px-4 py-4",children:l.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap text-sm text-text-primary",title:e.value,children:e.value})}),w&&l.jsx(tj,{className:"w-[25%] px-4 py-4",children:l.jsxs("div",{className:"flex justify-center gap-2",children:[l.jsx(R,{memory:e}),l.jsx(I,{memory:e})]})})]},t)):l.jsx(X_,{children:l.jsx(tj,{colSpan:w?2:1,className:"h-24 text-center text-sm text-text-secondary",children:t("com_ui_no_data")})})})]})}),S.length>h&&l.jsxs("div",{className:"flex items-center justify-end gap-2",role:"navigation","aria-label":"Pagination",children:[l.jsx(c_,{variant:"outline",size:"sm",onClick:()=>u(e=>Math.max(e-1,0)),disabled:0===d,"aria-label":t("com_ui_prev"),children:t("com_ui_prev")}),l.jsx("div",{className:"text-sm","aria-live":"polite",children:`${d+1} / ${Math.ceil(S.length/h)}`}),l.jsx(c_,{variant:"outline",size:"sm",onClick:()=>u(e=>(e+1)*h<S.length?e+1:e),disabled:(d+1)*h>=S.length,"aria-label":t("com_ui_next"),children:t("com_ui_next")})]}),(null==s?void 0:s.role)===Id.ADMIN&&l.jsx("div",{className:"mt-4",children:l.jsx(yR,{})})]})}):l.jsx("div",{className:"flex h-full w-full items-center justify-center p-4",children:l.jsx("div",{className:"text-center",children:l.jsx("p",{className:"text-sm text-text-secondary",children:t("com_ui_no_read_access")})})});var E}const jR=({field:e,inputClass:t,labelClass:s})=>{const a=zf(),r=n.useRef([]),o=n.useRef(null),[i,c]=n.useState(""),d=()=>{if(i.trim()&&e.value.length<Zc.MAX_CONVO_STARTERS){const t=[i,...e.value];e.onChange(t),c("")}},u={transition:"opacity 200ms ease-in-out",opacity:0},m={entering:{opacity:1},entered:{opacity:1},exiting:{opacity:0},exited:{opacity:0}},p=e.value.length>=Zc.MAX_CONVO_STARTERS;return l.jsxs("div",{className:"relative",children:[l.jsx("label",{className:s,htmlFor:"conversation_starters",children:a("com_assistants_conversation_starters")}),l.jsxs("div",{className:"mt-4 space-y-2",children:[l.jsxs("div",{className:"relative",children:[l.jsx("input",{ref:e=>r.current[0]=e,value:i,maxLength:64,className:`${t} pr-10`,type:"text",placeholder:a(p?"com_assistants_max_starters_reached":"com_assistants_conversation_starters_placeholder"),onChange:e=>c(e.target.value),onKeyDown:e=>{var t;"Enter"===e.key&&(e.preventDefault(),p?((t=e.currentTarget).classList.remove("shake"),t.offsetWidth,t.classList.add("shake"),setTimeout(()=>{t.classList.remove("shake")},200)):d())}}),l.jsx(Xr,{nodeRef:o,in:e.value.length<Zc.MAX_CONVO_STARTERS,timeout:200,unmountOnExit:!0,children:e=>l.jsx("div",{ref:o,style:{...u,...m[e],transition:"entering"===e?"none":u.transition},className:"absolute right-1 top-1",children:l.jsx(rj,{side:"top",description:a(p?"com_assistants_max_starters_reached":"com_ui_add"),className:"flex size-7 items-center justify-center rounded-lg transition-colors duration-200 hover:bg-surface-hover",onClick:d,disabled:p,children:l.jsx(_e,{className:"size-4"})})})})]}),e.value.map((n,s)=>l.jsxs("div",{className:"relative",children:[l.jsx("input",{ref:e=>r.current[s+1]=e,value:n,onChange:t=>{const n=[...e.value];n[s]=t.target.value,e.onChange(n)},className:`${t} pr-10`,type:"text",maxLength:64}),l.jsx(rj,{side:"top",description:a("com_ui_delete"),className:"absolute right-1 top-1 flex size-7 items-center justify-center rounded-lg transition-colors duration-200 hover:bg-surface-hover",onClick:()=>(t=>{const n=e.value.filter((e,n)=>n!==t);e.onChange(n)})(s),children:l.jsx(re,{className:"size-4"})})]},s))]})]})};function wR({control:e,setValue:t}){const n=zf(),s=e=>{t("append_current_datetime",e,{shouldDirty:!0})};return l.jsx("div",{className:"mb-6",children:l.jsx(T_,{openDelay:50,children:l.jsxs("div",{className:"flex items-center",children:[l.jsx(Ir,{name:"append_current_datetime",control:e,render:({field:e})=>l.jsx(d_,{...e,id:"append_current_datetime",checked:e.value,onCheckedChange:s,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString(),"aria-labelledby":"append-date-label"})}),l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("label",{id:"append-date-label",htmlFor:"append_current_datetime",className:"form-check-label text-token-text-primary w-full cursor-pointer",children:n("com_assistants_append_date")}),l.jsx(R_,{children:l.jsx(Iy,{className:"h-5 w-5 text-gray-500","aria-label":n("com_assistants_append_date_tooltip")})})]}),l.jsx(I_,{children:l.jsx(E_,{side:Go.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:n("com_assistants_append_date_tooltip")})})})})]})})})}function NR(){const e=zf(),t=Pr(),{control:n,setValue:s,getValues:a}=t;return l.jsxs("div",{className:"flex items-center",children:[l.jsx(Ir,{name:Jl.image_vision,control:n,render:({field:e})=>l.jsx(d_,{...e,checked:e.value,onCheckedChange:e.onChange,className:"relative float-left  mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString()})}),l.jsx("label",{className:"form-check-label text-token-text-primary w-full cursor-pointer",htmlFor:Jl.image_vision,onClick:()=>s(Jl.image_vision,!a(Jl.image_vision),{shouldDirty:!0}),children:l.jsx("div",{className:"flex items-center",children:e("com_assistants_image_vision")})})]})}function CR({version:e,retrievalModels:t}){const s=zf(),a=Pr(),{control:r,setValue:o,getValues:i}=a,c=Mr({control:r,name:"model"}),d=Mr({control:r,name:"assistant"});n.useMemo(()=>{var e;return"string"==typeof d?[]:null==(e=d.tool_resources)?void 0:e.file_search},[d]);const u=n.useMemo(()=>!t.has(c),[c,t]);return n.useEffect(()=>{c&&u&&o(Jl.retrieval,!1)},[c,o,u]),l.jsx(l.Fragment,{children:l.jsx(T_,{openDelay:50,children:l.jsxs("div",{className:"flex items-center",children:[l.jsx(Ir,{name:Jl.retrieval,control:r,render:({field:e})=>l.jsx(d_,{...e,checked:e.value,disabled:u,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString()})}),l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("label",{className:Op("form-check-label text-token-text-primary w-full select-none",u?"cursor-no-drop opacity-50":"cursor-pointer"),htmlFor:Jl.retrieval,onClick:()=>t.has(c)&&o(Jl.retrieval,!i(Jl.retrieval),{shouldDirty:!0}),children:s(1==e?"com_assistants_retrieval":"com_assistants_file_search")}),l.jsx(R_,{children:l.jsx(Iy,{className:"h-5 w-5 text-gray-500"})})]}),l.jsx(I_,{children:l.jsx(E_,{side:Go.Top,disabled:u,className:"ml-16 w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:2==e&&s("com_assistants_file_search_info")})})})}),l.jsx(tN,{side:Go.Top,disabled:!u,description:"com_assistants_non_retrieval_model",langCode:!0,sideOffset:20,className:"ml-16"})]})})})}const kR=oi.code_interpreter;function SR({endpoint:e,assistant_id:t,files:s}){const a=zf(),{setFilesLoading:r}=rg(),o=n.useRef(null),[i,c]=n.useState(new Map),{data:d=kl}=Rx({select:e=>El(e)}),{handleFileChange:u}=Fv({overrideEndpoint:e,additionalMetadata:{assistant_id:t,tool_resource:kR},fileSetter:c});n.useEffect(()=>{s&&c(new Map(s))},[s]);const m=d.endpoints[e];if((null==m?void 0:m.disabled)??!1)return null;return l.jsx("div",{className:"mb-2 w-full",children:l.jsxs("div",{className:"flex flex-col gap-4",children:[l.jsx("div",{className:"rounded-lg text-xs text-text-secondary",children:a("com_assistants_code_interpreter_files")}),l.jsx(NT,{files:i,setFiles:c,assistant_id:t,tool_resource:kR,setFilesLoading:r,Wrapper:({children:e})=>l.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),l.jsx("div",{children:l.jsx("button",{type:"button",disabled:!t,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",onClick:()=>{var e;o.current&&(o.current.value=""),null==(e=o.current)||e.click()},children:l.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[l.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:o,disabled:!t,onChange:u}),a("com_ui_upload_files")]})})})]})})}function TR({version:e}){const t=zf(),n=Pr(),{control:s,setValue:a,getValues:r}=n;return l.jsx(l.Fragment,{children:l.jsx(T_,{openDelay:50,children:l.jsxs("div",{className:"flex items-center",children:[l.jsx(Ir,{name:Jl.code_interpreter,control:s,render:({field:e})=>l.jsx(d_,{...e,checked:e.value,onCheckedChange:e.onChange,className:"relative float-left  mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString()})}),l.jsxs("button",{type:"button",className:"flex items-center space-x-2",onClick:()=>a(Jl.code_interpreter,!r(Jl.code_interpreter),{shouldDirty:!0}),children:[l.jsx("label",{className:"form-check-label text-token-text-primary w-full cursor-pointer",htmlFor:Jl.code_interpreter,children:t("com_assistants_code_interpreter")}),l.jsx(R_,{children:l.jsx(Iy,{className:"h-5 w-5 text-gray-500"})})]}),l.jsx(I_,{children:l.jsx(E_,{side:Go.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:2==e&&t("com_assistants_code_interpreter_info")})})})})]})})})}function RR({version:e,endpoint:t,codeEnabled:s,retrievalEnabled:a,assistantsConfig:r}){const o=zf(),i=Pr(),{control:c}=i,d=Mr({control:c,name:"assistant"}),u=Mr({control:c,name:"id"}),m=n.useMemo(()=>"string"==typeof d?[]:d.code_files,[d]),p=n.useMemo(()=>new Set((null==r?void 0:r.retrievalModels)??[]),[r]),h=n.useMemo(()=>{var e;return null==(e=null==r?void 0:r.capabilities)?void 0:e.includes(Jl.image_vision)},[r]);return l.jsxs("div",{className:"mb-4",children:[l.jsx("div",{className:"mb-1.5 flex items-center",children:l.jsx("span",{children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:o("com_assistants_capabilities")})})}),l.jsxs("div",{className:"flex flex-col items-start gap-2",children:[s&&l.jsx(TR,{version:e}),a&&l.jsx(CR,{endpoint:t,version:e,retrievalModels:p}),h&&1==e&&l.jsx(NR,{}),s&&e&&l.jsx(SR,{assistant_id:u,version:e,endpoint:t,files:m})]})]})}function IR(){return l.jsx("div",{className:"border-token-border-medium flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-black",children:l.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"text-4xl",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[l.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),l.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})}const ER=({url:e,progress:t=1})=>{const n=2*Math.PI*55,s=n-t*n;return l.jsx("div",{children:l.jsxs("div",{className:"relative h-20 w-20 overflow-hidden rounded-full",children:[l.jsx("img",{src:e,className:"bg-token-surface-secondary dark:bg-token-surface-tertiary h-full w-full rounded-full object-cover",alt:"GPT",width:"80",height:"80",style:{opacity:t<1?.4:1}}),t<1&&l.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:l.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",className:"h-6 w-6",children:[l.jsx("circle",{className:"origin-[50%_50%] -rotate-90 stroke-gray-400",strokeWidth:"10",fill:"transparent",r:"55",cx:"60",cy:"60"}),l.jsx("circle",{className:"origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]",stroke:"currentColor",strokeWidth:"10",strokeDasharray:`${n} ${n}`,strokeDashoffset:s,fill:"transparent",r:"55",cx:"60",cy:"60",style:{transition:"stroke-dashoffset 0.3s linear"}})]})})]})})};function MR({handleFileChange:e}){const t=n.useRef(null);return l.jsx(ha,{children:l.jsxs(xa,{className:"flex min-w-[100px] max-w-xs flex-col rounded-xl border border-gray-400 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-850 dark:text-white",sideOffset:5,children:[l.jsx("div",{role:"menuitem",className:"group m-1.5 flex cursor-pointer gap-2 rounded p-2.5 text-sm hover:bg-gray-100 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 dark:hover:bg-gray-800 dark:hover:bg-white/5",tabIndex:-1,"data-orientation":"vertical",onClick:()=>{var e;t.current&&(t.current.value=""),null==(e=t.current)||e.click()},children:"Upload Photo"}),l.jsx("input",{accept:"image/png,.png,image/jpeg,.jpg,.jpeg,image/gif,.gif,image/webp,.webp",multiple:!1,type:"file",style:{display:"none"},onChange:e,ref:t,tabIndex:-1})]})})}function PR({endpoint:e,version:t,assistant_id:s,metadata:a,createMutation:r}){const o=Aa(),i=sv(),[c,d]=n.useState(!1),[u,m]=n.useState(1),[p,h]=n.useState(null),[x,f]=n.useState(null),g=n.useRef(null),{data:v=kl}=Rx({select:e=>El(e)}),b=zf(),{showToast:y}=Of(),_=n.useMemo(()=>{var t;return(null==(t=null==i?void 0:i[e][s??""])?void 0:t.model)??""},[i,e,s]),{mutate:j}=jf({onMutate:()=>{m(.4)},onSuccess:(t,n)=>{var a,i,l;!0!==n.postCreation?y({message:b("com_ui_upload_success")}):g.current!==(null==(a=r.data)?void 0:a.id)&&(g.current=(null==(i=r.data)?void 0:i.id)??""),h(null),f(null==(l=t.metadata)?void 0:l.avatar);const c=o.getQueryData([Pd.assistants,e,li]);if(!(null==c?void 0:c.data)||!c)return;const d=c.data.map(e=>e.id===s?{...e,...t}:e);o.setQueryData([Pd.assistants,e,li],{...c,data:d}),m(1)},onError:e=>{console.error("Error:",e),h(null),f(null),y({message:b("com_ui_upload_error"),status:"error"}),m(1)}});n.useEffect(()=>{if(p){const e=new FileReader;e.onloadend=()=>{f(e.result)},e.readAsDataURL(p)}},[p]),n.useEffect(()=>{f((null==a?void 0:a.avatar)??null)},[a]),n.useEffect(()=>{const n=!!(r.isSuccess&&p&&x&&x.includes("base64"));if((!n||g.current!==r.data.id)&&n&&r.data.id){console.log("[AssistantAvatar] Uploading Avatar after Assistant Creation");const n=new FormData;n.append("file",p,p.name),n.append("assistant_id",r.data.id),j({assistant_id:r.data.id,model:_,postCreation:!0,formData:n,endpoint:e,version:t})}},[r.data,r.isSuccess,p,x,j,_,e,t]);return l.jsxs(fa,{open:c,onOpenChange:d,children:[l.jsx("div",{className:"flex w-full items-center justify-center gap-4",children:l.jsx(ca,{asChild:!0,children:l.jsx("button",{type:"button",className:"h-20 w-20",children:x?l.jsx(ER,{url:x,progress:u}):l.jsx(IR,{})})})}),l.jsx(MR,{handleFileChange:n=>{var a;const r=null==(a=n.target.files)?void 0:a[0];if(v.avatarSizeLimit&&r&&r.size<=v.avatarSizeLimit){if(!r)return void console.error("No file selected");if(h(r),d(!1),!s)return void console.log("[AssistantAvatar] No assistant_id, will wait until form submission + upload");const n=new FormData;n.append("file",r,r.name),n.append("assistant_id",s),j({assistant_id:s,model:_,formData:n,endpoint:e,version:t})}else{const e=v.avatarSizeLimit?Pm(v.avatarSizeLimit):2;y({message:b("com_ui_upload_invalid_var",{0:e+""}),status:"error"})}d(!1)}})]})}const LR=new Set(["name","id","description","instructions","conversation_starters","model","append_current_datetime"]);function AR({reset:e,value:t,endpoint:s,documentsMap:a,selectedAssistant:r,setCurrentAssistantId:o,createMutation:i,allTools:c}){const d=zf(),u=Ug(),m=n.useRef(null),[p]=Ky(Jc.LAST_MODEL,{}),h=n.useMemo(()=>new Set(null==c?void 0:c.filter(e=>!0===e.toolkit).map(e=>e.pluginKey)),[c]),x=ef(s,void 0,{select:e=>e.data.map(e=>{var t,n,r,o;const i=s===vi.assistants?Ml.openai:Ml.azure,l={...e,label:e.name??"",value:e.id,files:e.file_ids?[]:void 0,code_files:(null==(n=null==(t=e.tool_resources)?void 0:t.code_interpreter)?void 0:n.file_ids)?[]:void 0},c=(e,t)=>{const n=null==u?void 0:u[e];n?null==t||t.push([e,{file_id:n.file_id,type:n.type,filepath:n.filepath,filename:n.filename,width:n.width,height:n.height,size:n.bytes,preview:n.filepath,progress:1,source:i}]):null==t||t.push([e,{file_id:e,type:"",filename:"",size:1,progress:1,filepath:s,source:i}])};l.files&&e.file_ids&&e.file_ids.forEach(e=>c(e,l.files)),l.code_files&&(null==(o=null==(r=e.tool_resources)?void 0:r.code_interpreter)?void 0:o.file_ids)&&e.tool_resources.code_interpreter.file_ids.forEach(e=>c(e,l.code_files));const d=null==a?void 0:a.get(e.id);return d&&(l.conversation_starters||(l.conversation_starters=d.conversation_starters),l.append_current_datetime=d.append_current_datetime??!1),l})}),f=n.useCallback(t=>{var n;const a=null==(n=x.data)?void 0:n.find(e=>e.id===t);if(i.reset(),!a)return o(void 0),e({...Ri,model:(null==p?void 0:p[s])??""});const r={...a,label:a.name??"",value:a.id||""},l={[Jl.code_interpreter]:!1,[Jl.image_vision]:!1,[Jl.retrieval]:!1};(a.tools??[]).filter(e=>"function"!==e.type||Mi(e)).map(e=>{var t;return((null==(t=e.function)?void 0:t.name)??"")||e.type}).forEach(e=>{e===ri.file_search&&(l[Jl.retrieval]=!0),l[e]=!0});const c=new Set,d=(a.tools??[]).filter(e=>"function"===e.type&&!Mi(e)).map(e=>{var t;return(null==(t=e.function)?void 0:t.name)??""}).filter(e=>{const t=e.split("_")[0],n=h.has(t);return n&&c.add(t),!n});c.size>0&&d.push(...Array.from(c));const u={functions:d,...l,assistant:r,model:r.model};Object.entries(a).forEach(([e,t])=>{LR.has(e)&&("append_current_datetime"!==e?("conversation_starters"===e&&Array.isArray(t)&&t.every(e=>"string"==typeof e)||"number"!=typeof t&&"object"!=typeof t)&&(u[e]=t):u[e]=!!t)}),e(u),o(a.id)},[x.data,e,o,i,s,p,h]);n.useEffect(()=>{let e=null;if(r!==m.current)return""!==r&&null!=r&&x.data&&(e=setTimeout(()=>{m.current=r,f(r)},5)),()=>{e&&clearTimeout(e)}},[r,x.data,f]);const g=d("com_ui_create")+" "+d("com_ui_assistant");return l.jsx(Lj,{value:t||g,setValue:Km(f),availableValues:x.data??[{label:"Loading...",value:""}],iconSide:"left",showAbove:!1,showLabel:!1,emptyTitle:!0,containerClassName:"flex-grow",searchClassName:"dark:from-gray-850",searchPlaceholder:d("com_assistants_search_name"),optionsClass:"hover:bg-gray-20/50 dark:border-gray-700",optionsListClass:"rounded-lg shadow-lg dark:bg-gray-850 dark:border-gray-700 dark:last:border",currentValueClass:Op("text-md font-semibold text-gray-900 dark:text-white",""===t?"text-gray-500":""),className:Op("mt-1 rounded-md dark:border-gray-700 dark:bg-gray-850","z-50 flex h-[40px] w-full flex-none items-center justify-center px-4 hover:cursor-pointer hover:border-black dark:hover:border-white focus:border-gray-400"),renderOption:()=>l.jsxs("span",{className:"flex items-center gap-1.5 truncate",children:[l.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-2 text-gray-800 dark:text-gray-100",children:l.jsx(_e,{className:"w-[16px]"})}),l.jsx("span",{className:Op("ml-4 flex h-6 items-center gap-1 text-gray-800 dark:text-gray-100"),children:g})]})})}const OR=n.forwardRef((e,t)=>{const n=zf(),{title:s,description:a,main:r,buttons:o,leftButtons:i,selection:c,className:d,headerClassName:u,footerClassName:m,showCloseButton:p,showCancelButton:h=!0}=e,{selectHandler:x,selectClasses:f,selectText:g}=c||{},v=n("com_ui_cancel");return l.jsxs(j_,{showCloseButton:p,ref:t,className:Op("shadow-2xl dark:bg-gray-700",d||""),onClick:e=>e.stopPropagation(),children:[l.jsxs(w_,{className:Op(u??""),children:[l.jsx(C_,{className:"text-lg font-medium leading-6 text-gray-800 dark:text-gray-200",children:s}),a&&l.jsx(k_,{className:"text-gray-600 dark:text-gray-300",children:a})]}),l.jsx("div",{className:"px-6",children:r||null}),l.jsxs(N_,{className:m,children:[l.jsx("div",{children:i||null}),l.jsxs("div",{className:"flex h-auto gap-3",children:[h&&l.jsx(S_,{className:"border-gray-100 hover:bg-gray-100 dark:border-gray-600 dark:hover:bg-gray-600",children:v}),o||null,c?l.jsx(S_,{onClick:x,className:`${f||"bg-gray-800 text-white transition-colors hover:bg-gray-700 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-gray-200 dark:text-gray-800 dark:hover:bg-gray-200"} inline-flex h-10 items-center justify-center rounded-lg border-none px-4 py-2 text-sm`,children:g}):null]})]})]})});function DR({activeModel:e,assistant_id:t,setCurrentAssistantId:n,createMutation:s,endpoint:a}){const r=zf(),{showToast:o}=Of(),{conversation:i}=rg(),{setOption:c}=yv(),d=_f({onSuccess:(e,t,a)=>{var l;const d=a;if(!d)return;o({message:r("com_ui_assistant_deleted"),status:"success"}),void 0!==(null==(l=s.data)?void 0:l.id)&&(console.log("[deleteAssistant] resetting createMutation"),s.reset());const u=d[0];if(!u)return c("assistant_id")("");if(t.assistant_id===(null==i?void 0:i.assistant_id))return c("assistant_id")(u.id);const m=d.find(e=>e.id===(null==i?void 0:i.assistant_id));m&&n(m.id),n(u.id)},onError:e=>{console.error(e),o({message:r("com_ui_assistant_delete_error"),status:"error"})}});return t?0===(null==e?void 0:e.length)||void 0===e?null:l.jsxs(v_,{children:[l.jsx(b_,{asChild:!0,children:l.jsx("button",{className:Op("btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",Kp),type:"button",children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2 text-red-500",children:l.jsx(py,{})})})}),l.jsx(OR,{title:r("com_ui_delete")+" "+r("com_ui_assistant"),className:"max-w-[450px]",main:l.jsx(l.Fragment,{children:l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(L_,{htmlFor:"delete-assistant",className:"text-left text-sm font-medium",children:r("com_ui_delete_assistant_confirm")})})})}),selection:{selectHandler:()=>d.mutate({assistant_id:t,model:e,endpoint:a}),selectClasses:"bg-red-600 hover:bg-red-700 dark:hover:bg-red-800 text-white",selectText:r("com_ui_delete")}})]}):null}function zR({tool:e,allTools:t,assistant_id:s=""}){const[a,r]=n.useState(!1),o=zf(),{showToast:i}=Of(),c=Xf(),{getValues:d,setValue:u}=Pr(),m=t.find(t=>t.pluginKey===e);return m?l.jsxs(A_,{children:[l.jsxs("div",{className:Op("flex w-full items-center rounded-lg text-sm",s?"":"opacity-40"),onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[l.jsxs("div",{className:"flex grow items-center",children:[m.icon&&l.jsx("div",{className:"flex h-9 w-9 items-center justify-center overflow-hidden rounded-full",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full bg-center bg-no-repeat dark:bg-white/20",style:{backgroundImage:`url(${m.icon})`,backgroundSize:"cover"}})}),l.jsx("div",{className:"h-9 grow px-3 py-2",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:m.name})]}),a&&l.jsx(O_,{asChild:!0,children:l.jsx("button",{type:"button",className:"flex h-9 w-9 min-w-9 items-center justify-center rounded-lg transition-colors duration-200 hover:bg-gray-200 dark:hover:bg-gray-700",children:l.jsx(py,{})})})]}),l.jsx(Oj,{showCloseButton:!1,title:o("com_ui_delete_tool"),className:"max-w-[450px]",main:l.jsx(L_,{className:"text-left text-sm font-medium",children:o("com_ui_delete_tool_confirm")}),selection:{selectHandler:()=>{var e;(e=m.pluginKey)&&c.mutate({pluginKey:e,action:"uninstall",auth:null,isEntityTool:!0},{onError:e=>{i({message:`Error while deleting the tool: ${e}`,status:"error"})},onSuccess:()=>{const t=d("functions").filter(t=>t!==e);u("functions",t),i({message:"Tool deleted successfully",status:"success"})}})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-colors duration-200 text-white",selectText:o("com_ui_delete")}})]}):null}const FR=({children:e})=>{const t=zf();return l.jsxs("div",{children:[l.jsx("div",{className:"text-token-text-tertiary mb-2 text-xs",children:t("com_assistants_code_interpreter_files")}),l.jsx("div",{className:"flex flex-wrap gap-2",children:e})]})};function VR({endpoint:e,assistant_id:t,files:s}){const a=zf(),{setFilesLoading:r}=rg(),o=n.useRef(null),[i,c]=n.useState(new Map),{data:d=kl}=Rx({select:e=>El(e)}),{handleFileChange:u}=Fv({overrideEndpoint:e,additionalMetadata:{assistant_id:t},fileSetter:c});n.useEffect(()=>{s&&c(new Map(s))},[s]);const m=d.endpoints[e];if((null==m?void 0:m.disabled)??!1)return null;return l.jsxs("div",{className:"mb-6",children:[l.jsx("div",{className:"mb-1.5 flex items-center",children:l.jsx("span",{children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:a(t?"com_assistants_knowledge":"com_assistants_knowledge_disabled")})})}),l.jsxs("div",{className:"flex flex-col gap-4",children:[l.jsx("div",{className:"text-token-text-tertiary rounded-lg",children:t?a("com_assistants_knowledge_info"):""}),l.jsx(NT,{files:i,setFiles:c,setFilesLoading:r,assistant_id:t,fileFilter:e=>_l.some(t=>t.test(e.type??"")),Wrapper:({children:e})=>l.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),l.jsx(NT,{files:i,setFiles:c,setFilesLoading:r,assistant_id:t,fileFilter:e=>!_l.some(t=>t.test(e.type??"")),Wrapper:FR}),l.jsx("div",{children:l.jsx("button",{type:"button",disabled:!t,className:"btn btn-neutral border-token-border-light relative h-8 rounded-lg font-medium",onClick:()=>{var e;o.current&&(o.current.value=""),null==(e=o.current)||e.click()},children:l.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[l.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:o,disabled:!t,onChange:u}),a("com_ui_upload_files")]})})})]})]})}const $R="mb-2 text-token-text-primary block font-medium",BR=Op(Wp,"flex w-full px-3 py-2 dark:border-gray-800 dark:bg-gray-800 rounded-xl mb-2",Kp);function UR({setAction:e,endpoint:t,actions:s=[],setActivePanel:a,documentsMap:r,assistant_id:o,setCurrentAssistantId:i,assistantsConfig:c,version:d}){const u=Gf(),m=sv(),{data:p=[]}=fx(),{onSelect:h}=function(e){const t=sg(),{conversation:s,newConversation:a}=rg(),r=ig(e=>Zo(e.data));return{onSelect:n.useCallback(n=>{var o;const i=null==(o=r[e])?void 0:o[n];if(!i)return;const l={endpoint:e,assistant_id:i.id,model:i.model,conversationId:"new"};if(Dp.log("conversation","Updating conversation with assistant",i),ji(null==s?void 0:s.endpoint)){const e=t({conversation:{...s??{}},preset:l});return void a({template:e,preset:l,keepLatestMessage:!0})}a({template:{...l},preset:l})},[e,r,s,t,a])}}(t),{showToast:x}=Of(),f=zf(),g=Rr({defaultValues:Ri}),[v,b]=n.useState(!1),{control:y,handleSubmit:_,reset:j,setValue:w,getValues:N}=g,C=Mr({control:y,name:"assistant"}),k=Mr({control:y,name:"functions"}),S=Mr({control:y,name:"id"}),T=n.useMemo(()=>{var e,n;return null==(n=null==(e=null==m?void 0:m[t])?void 0:e[S])?void 0:n.model},[m,t,S]),R=n.useMemo(()=>{var e;return null==(e=null==c?void 0:c.capabilities)?void 0:e.includes(Jl.tools)},[c]),I=n.useMemo(()=>{var e;return null==(e=null==c?void 0:c.capabilities)?void 0:e.includes(Jl.actions)},[c]),E=n.useMemo(()=>{var e;return null==(e=null==c?void 0:c.capabilities)?void 0:e.includes(Jl.retrieval)},[c]),M=n.useMemo(()=>{var e;return null==(e=null==c?void 0:c.capabilities)?void 0:e.includes(Jl.code_interpreter)},[c]),P=yf({onSuccess:e=>{x({message:`${f("com_assistants_update_success")} ${e.name??f("com_ui_assistant")}`})},onError:e=>{const t=e;x({message:`${f("com_assistants_update_error")}${t.message?` ${f("com_ui_error")}: ${t.message}`:""}`,status:"error"})}}),L=bf({onSuccess:e=>{i(e.id),x({message:`${f("com_assistants_create_success")} ${e.name??f("com_ui_assistant")}`})},onError:e=>{const t=e;x({message:`${f("com_assistants_create_error")}${t.message?` ${f("com_ui_error")}: ${t.message}`:""}`,status:"error"})}}),A=n.useMemo(()=>"string"==typeof C?[]:C.files,[C]);let O;return O=L.isLoading||P.isLoading?l.jsx(Gb,{className:"icon-md"}):f(S?"com_ui_save":"com_ui_create"),l.jsx(Ar,{...g,children:l.jsxs("form",{onSubmit:_(e=>{const n=[...k].map(e=>{var n,s;if(!e.includes(ii))return e;{const a=null==(n=null==m?void 0:m[t])?void 0:n[S],r=null==(s=null==a?void 0:a.tools)?void 0:s.find(t=>{var n;return(null==(n=t.function)?void 0:n.name)===e});if(a&&r)return r}return e});e.code_interpreter&&n.push({type:ri.code_interpreter}),e.retrieval&&n.push({type:2==d?ri.file_search:ri.retrieval}),e.image_vision&&n.push(Ei);const{name:s,description:a,instructions:r,conversation_starters:o,model:i,append_current_datetime:l}=e;S?P.mutate({assistant_id:S,data:{name:s,description:a,instructions:r,conversation_starters:o.filter(e=>""!==e.trim()),model:i,tools:n,endpoint:t,append_current_datetime:l}}):L.mutate({name:s,description:a,instructions:r,conversation_starters:o.filter(e=>""!==e.trim()),model:i,tools:n,endpoint:t,version:d,append_current_datetime:l})}),className:"h-auto w-full flex-shrink-0 overflow-x-hidden",children:[l.jsxs("div",{className:"flex w-full flex-wrap",children:[l.jsx(Ir,{name:"assistant",control:y,render:({field:e})=>l.jsx(AR,{reset:j,value:e.value,endpoint:t,documentsMap:r,allTools:p,setCurrentAssistantId:i,selectedAssistant:o??null,createMutation:L})}),S&&l.jsx("button",{className:"btn btn-primary focus:shadow-outline mx-2 mt-1 h-[40px] rounded bg-white px-4 py-2 font-semibold text-black hover:bg-gray-100 focus:border-black focus:outline-none focus:ring-0 dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 dark:focus:border-white border border-gray-300 dark:border-gray-600",type:"button",disabled:!S,onClick:e=>{e.preventDefault(),h(S)},children:f("com_ui_select")})]}),l.jsxs("div",{className:"bg-surface-50 h-auto px-4 pb-8 pt-3 dark:bg-transparent",children:[l.jsxs("div",{className:"mb-4",children:[l.jsx(PR,{createMutation:L,assistant_id:S,metadata:C.metadata??null,endpoint:t,version:d}),l.jsx("label",{className:$R,htmlFor:"name",children:f("com_ui_name")}),l.jsx(Ir,{name:"name",control:y,render:({field:e})=>l.jsx("input",{...e,value:e.value??"",max:256,className:BR,id:"name",type:"text",placeholder:f("com_assistants_name_placeholder")})}),l.jsx(Ir,{name:"id",control:y,render:({field:e})=>l.jsx("p",{className:"h-3 text-xs italic text-text-secondary",children:e.value})})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:$R,htmlFor:"description",children:f("com_ui_description")}),l.jsx(Ir,{name:"description",control:y,render:({field:e})=>l.jsx("input",{...e,value:e.value??"",max:512,className:BR,id:"description",type:"text",placeholder:f("com_assistants_description_placeholder")})})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx("label",{className:$R,htmlFor:"instructions",children:f("com_ui_instructions")}),l.jsx(Ir,{name:"instructions",control:y,render:({field:e})=>l.jsx("textarea",{...e,value:e.value??"",max:32768,className:Op(BR,"min-h-[100px] resize-y"),id:"instructions",placeholder:f("com_assistants_instructions_placeholder"),rows:3})})]}),l.jsx(wR,{control:y,setValue:w,getValues:N}),l.jsx("div",{className:"relative mb-6",children:l.jsx(Ir,{name:"conversation_starters",control:y,defaultValue:[],render:({field:e})=>l.jsx(jR,{field:e,inputClass:BR,labelClass:$R})})}),l.jsxs("div",{className:"mb-6",children:[l.jsx("label",{className:$R,htmlFor:"model",children:f("com_ui_model")}),l.jsx(Ir,{name:"model",control:y,rules:{required:!0,minLength:1},render:({field:e,fieldState:{error:n}})=>{var s;return l.jsxs(l.Fragment,{children:[l.jsx(Lj,{emptyTitle:!0,value:e.value,setValue:e.onChange,availableValues:(null==(s=u.data)?void 0:s[t])??[],showAbove:!1,showLabel:!1,className:Op("transition-colors rounded-md min-w-[75px] border font-normal bg-white hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-700 dark:bg-gray-800 text-black dark:text-gray-600 focus:outline-none data-[state=open]:bg-gray-50 dark:data-[state=open]:bg-gray-700","flex h-[40px] w-full flex-none items-center justify-center px-4 hover:cursor-pointer"),containerClassName:Op("rounded-md",n?"border-red-500 border-2":"")}),n&&l.jsx("span",{className:"text-sm text-red-500 transition duration-300 ease-in-out",children:f("com_ui_field_required")})]})}})]}),(!0===M||!0===E)&&1==d&&l.jsx(VR,{assistant_id:S,files:A,endpoint:t}),l.jsx(RR,{version:d,endpoint:t,codeEnabled:M,assistantsConfig:c,retrievalEnabled:E}),l.jsxs("div",{className:"mb-6",children:[l.jsx("label",{className:$R,children:`${!0===R?f("com_ui_tools"):""}\n              ${!0===R&&!0===I?" + ":""}\n              ${!0===I?f("com_assistants_actions"):""}`}),l.jsxs("div",{className:"space-y-2",children:[k.map((e,t)=>l.jsx(zR,{tool:e,allTools:p,assistant_id:S},`${e}-${t}-${S}`)),s.filter(e=>e.assistant_id===S).map((t,n)=>l.jsx(uT,{action:t,onClick:()=>e(t)},n)),l.jsxs("div",{className:"flex space-x-2",children:[!0===R&&l.jsx("button",{type:"button",onClick:()=>b(!0),className:"btn btn-neutral border-token-border-light relative h-8 w-full rounded-lg font-medium",children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:f("com_assistants_add_tools")})}),!0===I&&l.jsx("button",{type:"button",disabled:!S,onClick:()=>{if(!S)return x({message:f("com_assistants_actions_disabled"),status:"warning"});a(Ko.actions)},className:"btn btn-neutral border-token-border-light relative h-8 w-full rounded-lg font-medium",children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:f("com_assistants_add_actions")})})]})]})]}),l.jsxs("div",{className:"flex items-center justify-end gap-2",children:[l.jsx(DR,{assistant_id:S,activeModel:T,setCurrentAssistantId:i,createMutation:L,endpoint:t}),l.jsx("button",{className:"btn btn-primary focus:shadow-outline flex w-full items-center justify-center px-4 py-2 font-semibold text-black bg-white hover:bg-gray-100 focus:border-black dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 dark:focus:border-white border border-gray-300 dark:border-gray-600",type:"submit",children:O})]})]}),l.jsx(pT,{isOpen:v,setIsOpen:b,toolsFormKey:"functions",endpoint:t})]})})}function HR({columns:e,data:t}){const n=$a({columns:e,data:t,getCoreRowModel:Ba()});return l.jsxs("table",{className:"w-full text-sm",children:[l.jsx("thead",{children:n.getHeaderGroups().map((e,t)=>l.jsx("tr",{className:"border-token-border-light text-token-text-tertiary border-b text-left text-xs",children:e.headers.map((e,t)=>l.jsx("th",{className:"py-1 font-normal",children:e.isPlaceholder?null:Ua(e.column.columnDef.header,e.getContext())},t))},t))}),l.jsx("tbody",{children:n.getRowModel().rows.map((e,t)=>l.jsx("tr",{className:"border-token-border-light border-b",children:e.getVisibleCells().map((e,t)=>l.jsx("td",{className:"py-2",children:Ua(e.column.columnDef.cell,e.getContext())},t))},t))})]})}const KR=[{header:"Name",accessorKey:"name"},{header:"Method",accessorKey:"method"},{header:"Path",accessorKey:"path"}],GR=Cr((e,t)=>{t(Bu(e))},800);function WR({action:e,assistant_id:t,endpoint:s,version:a,setAction:r}){var o;const i=e=>{e.status||(b(null),_(null)),x(e)},c=zf(),{showToast:d}=Of(),u=sv(),{handleSubmit:m,reset:p}=Pr(),[h,x]=n.useState(null),[f,g]=n.useState(""),[v,b]=n.useState(null),[y,_]=n.useState(null);n.useEffect(()=>{var t;const n=(null==(t=null==e?void 0:e.metadata)?void 0:t.raw_spec)??"";n&&(g(n),GR(n,i))},[null==(o=null==e?void 0:e.metadata)?void 0:o.raw_spec]),n.useEffect(()=>{if(!h||!h.status||!h.spec)return;const{functionSignatures:e,requestBuilders:t}=$u(h.spec),n=Object.entries(t).map(([e,t])=>({name:e,method:t.method,path:t.path,domain:t.domain}));b(n),x(null),_(e.map(e=>e.toObjectTool()))},[h]);const j=wf({onSuccess(e){d({message:c("com_assistants_update_actions_success"),status:"success"}),p(),r(e[2])},onError(e){d({message:(null==e?void 0:e.message)??c("com_assistants_update_actions_error"),status:"error"})}}),w=m(n=>{console.log("authFormData",n);const r=t??"";if(!r)return;if(!y)return;if(!v)return;let{metadata:o}=e??{};o||(o={});const i=null==e?void 0:e.action_id;o.raw_spec=f;const l=new URL(v[0].domain).hostname;if(!l)return;o.domain=l;const{type:c,saved_auth_fields:d}=n,m=e=>{delete e.auth,delete e.api_key,delete e.oauth_client_id,delete e.oauth_client_secret};d&&c===Ll.ServiceHttp?o={...o,api_key:n.api_key,auth:{type:c,authorization_type:n.authorization_type,custom_auth_header:n.custom_auth_header}}:d&&c===Ll.OAuth?o={...o,auth:{type:c,authorization_url:n.authorization_url,client_url:n.client_url,scope:n.scope,token_exchange_method:n.token_exchange_method},oauth_client_id:n.oauth_client_id,oauth_client_secret:n.oauth_client_secret}:d?(m(o),o.auth={type:c}):m(o),j.mutate({action_id:i,metadata:o,functions:y,assistant_id:r,endpoint:s,version:a,model:(null==u?void 0:u[s][r].model)??""})});return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"",children:[l.jsxs("div",{className:"mb-1 flex flex-wrap items-center justify-between gap-4",children:[l.jsx("label",{htmlFor:"example-schema",className:"text-token-text-primary whitespace-nowrap font-medium",children:c("com_ui_schema")}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("select",{id:"example-schema",onChange:e=>console.log(e.target.value),className:"border-token-border-medium h-8 min-w-[100px] rounded-lg border bg-transparent px-2 py-0 text-sm",children:[l.jsx("option",{value:"label",children:c("com_ui_examples")}),l.jsx("option",{value:"0",children:"Weather (JSON)"}),l.jsx("option",{value:"1",children:"Pet Store (YAML)"}),l.jsx("option",{value:"2",children:"Blank Template"})]})})]}),l.jsxs("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover mb-4 w-full overflow-hidden rounded-lg border ring-0",children:[l.jsx("div",{className:"relative",children:l.jsx("textarea",{id:"schemaInput",value:f,onChange:e=>{const t=e.target.value;if(g(t),!t)return b(null),_(null),x(null);GR(t,i)},spellCheck:"false",placeholder:c("com_ui_enter_openapi_schema"),className:"text-token-text-primary block h-96 w-full bg-transparent p-2 font-mono text-xs outline-none focus:ring-1 focus:ring-border-light"})}),h&&"OpenAPI spec is valid."!==h.message&&l.jsx("div",{className:"border-token-border-light border-t p-2 text-red-500",children:h.message.split("\n").map((e,t)=>l.jsx("div",{children:e},t))})]})]}),!!v&&l.jsxs("div",{className:"my-2",children:[l.jsx("div",{className:"flex items-center",children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:c("com_assistants_available_actions")})}),l.jsx(HR,{columns:KR,data:v})]}),l.jsxs("div",{className:"relative my-1",children:[l.jsx(tT,{action_id:null==e?void 0:e.action_id}),l.jsx("div",{className:"mb-1.5 flex items-center",children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:c("com_ui_privacy_policy_url")})}),l.jsx("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover flex h-9 w-full rounded-lg border",children:l.jsx("input",{type:"text",placeholder:"https://api.example-weather-app.com/privacy",className:"flex-1 rounded-lg bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light"})})]}),l.jsx("div",{className:"flex items-center justify-end",children:l.jsx("button",{disabled:!y||!y.length,onClick:w,className:"focus:shadow-outline mt-1 flex min-w-[100px] items-center justify-center rounded bg-white px-4 py-2 font-semibold text-black hover:bg-gray-100 focus:border-black focus:outline-none focus:ring-0 disabled:bg-gray-100 dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 dark:focus:border-white dark:disabled:bg-gray-700 border border-gray-300 dark:border-gray-600",type:"button",children:j.isLoading?l.jsx(Gb,{className:"icon-md"}):(null==e?void 0:e.action_id.length)?c("com_ui_update"):c("com_ui_create")})})]})}function qR({action:e,endpoint:t,version:s,setAction:a,assistant_id:r,setActivePanel:o}){const i=zf(),{showToast:c}=Of(),d=sv(),u=Nf({onSuccess:()=>{c({message:i("com_assistants_delete_actions_success"),status:"success"}),o(Ko.builder),a(void 0)},onError(e){c({message:(null==e?void 0:e.message)??i("com_assistants_delete_actions_error"),status:"error"})}}),m=Rr({defaultValues:{type:Ll.None,saved_auth_fields:!1,api_key:"",authorization_type:Al.Basic,custom_auth_header:"",oauth_client_id:"",oauth_client_secret:"",authorization_url:"",client_url:"",scope:"",token_exchange_method:Ol.DefaultPost}}),{reset:p,watch:h}=m;return n.useEffect(()=>{var t;(null==(t=null==e?void 0:e.metadata)?void 0:t.auth)&&p({type:e.metadata.auth.type||Ll.None,saved_auth_fields:!1,api_key:e.metadata.api_key??"",authorization_type:e.metadata.auth.authorization_type||Al.Basic,oauth_client_id:e.metadata.oauth_client_id??"",oauth_client_secret:e.metadata.oauth_client_secret??"",authorization_url:e.metadata.auth.authorization_url??"",client_url:e.metadata.auth.client_url??"",scope:e.metadata.auth.scope??"",token_exchange_method:e.metadata.auth.token_exchange_method??Ol.DefaultPost})},[e,p]),l.jsx(Ar,{...m,children:l.jsx("form",{className:"h-full grow overflow-hidden",children:l.jsxs("div",{className:"h-full overflow-auto px-2 pb-12 text-sm",children:[l.jsxs("div",{className:"relative flex flex-col items-center px-16 py-6 text-center",children:[l.jsx("div",{className:"absolute left-0 top-6",children:l.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{o(Ko.builder),a(void 0)},children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:l.jsx(zt,{})})})}),!!e&&l.jsxs(A_,{children:[l.jsx(O_,{asChild:!0,children:l.jsx("div",{className:"absolute right-0 top-6",children:l.jsx("button",{type:"button",disabled:!r||!e.action_id,className:"btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",children:l.jsx(py,{className:"text-red-500"})})})}),l.jsx(Oj,{showCloseButton:!1,title:i("com_ui_delete_action"),className:"max-w-[450px]",main:l.jsx(L_,{className:"text-left text-sm font-medium",children:i("com_ui_delete_action_confirm")}),selection:{selectHandler:()=>{const n=r??"";if(!n)return c({message:"No assistant_id found, is the assistant created?",status:"error"});u.mutate({model:(null==d?void 0:d[t][n].model)??"",action_id:e.action_id,assistant_id:n,endpoint:t})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:i("com_ui_delete")}})]}),l.jsx("div",{className:"text-xl font-medium",children:(e?"Edit":"Add")+" actions"}),l.jsx("div",{className:"text-xs text-text-secondary",children:i("com_assistants_actions_info")})]}),l.jsx(JS,{disableOAuth:!0}),l.jsx(WR,{action:e,assistant_id:r,setAction:a,endpoint:t,version:s})]})})})}function QR(){const{conversation:e,index:t}=rg(),[s,a]=n.useState(Ko.builder),[r,o]=n.useState(void 0),[i,c]=n.useState(null==e?void 0:e.assistant_id),{data:d={}}=kx(),{data:u=[]}=tf(null==e?void 0:e.endpoint),{data:m=null}=nf((null==e?void 0:e.endpoint)??"",{select:e=>new Map(e.map(e=>[e.assistant_id,e]))}),p=n.useMemo(()=>null==d?void 0:d[(null==e?void 0:e.endpoint)??""],[null==e?void 0:e.endpoint,d]);if(n.useEffect(()=>{const t=(null==e?void 0:e.assistant_id)??"";t&&c(t)},[null==e?void 0:e.assistant_id]),!(null==e?void 0:e.endpoint))return null;const h=(null==p?void 0:p.version)??Xl[e.endpoint];return s===Ko.actions||r?l.jsx(qR,{index:t,action:r,actions:u,setAction:o,activePanel:s,documentsMap:m,setActivePanel:a,assistant_id:i,setCurrentAssistantId:c,endpoint:e.endpoint,version:h}):s===Ko.builder?l.jsx(UR,{index:t,activePanel:s,action:r,actions:u,setAction:o,documentsMap:m,setActivePanel:a,assistant_id:i,setCurrentAssistantId:c,endpoint:e.endpoint,assistantsConfig:p,version:h}):void 0}function ZR({onCheckedChange:e,className:t=""}){const[n,s]=b(sx.autoSendPrompts),a=zf();return l.jsxs("div",{className:Op("flex select-none items-center justify-end gap-2 text-right text-sm",t),children:[l.jsxs("div",{children:[" ",a("com_nav_auto_send_prompts")," "]}),l.jsx(Q_,{"aria-label":"toggle-auto-send-prompts",id:"autoSendPrompts",checked:n,onCheckedChange:t=>{s(t),e&&e(t)},"data-testid":"autoSendPrompts"})]})}function JR(){const e=Ib();return l.jsx("div",{className:"flex h-full w-full flex-col",children:l.jsxs(LC,{className:"mt-2 space-y-2 lg:w-full xl:w-full",...e,children:[l.jsx(mw,{setName:e.setName,className:"items-center justify-center"}),l.jsx("div",{className:"flex w-full flex-row items-center justify-end",children:l.jsx(ZR,{className:"text-xs dark:text-white"})})]})})}function YR(){const e=zf(),{conversation:t,setConversation:s}=rg(),{setOption:a}=yv(),[r,o]=n.useState(!1),[i,c]=n.useState(null),{data:d={}}=kx(),u=(null==t?void 0:t.endpoint)??"",m=(null==t?void 0:t.model)??"",p=n.useMemo(()=>{var e;return(null==(e=null==d?void 0:d[(null==t?void 0:t.endpoint)??""])?void 0:e.availableRegions)??[]},[d,null==t?void 0:t.endpoint]),h=n.useMemo(()=>fp(d,null==t?void 0:t.endpoint,"type"),[null==t?void 0:t.endpoint,d]),x=n.useMemo(()=>{var e,t,n;const s=(null==(e=d[u])?void 0:e.customParams)??{},[a,r]=_i(h??u,m),o=s.defaultParamsEndpoint??r,i=ym[a]??ym[o]??[],l=(null==(n=null==(t=d[u])?void 0:t.customParams)?void 0:n.paramDefinitions)??[],c=Sr(l,"key");return i.map(e=>c[e.key]??e)},[h,d,m,u]);n.useEffect(()=>{if(!x)return;const e=new Set(x.map(e=>e.key));s(t=>{if(!t)return t;const n={...t},s=Object.keys(n),a=[];return s.forEach(s=>{e.has(s)||Hl.has(s)||null!=t[s]&&(a.push(s),delete n[s])}),Dp.log("parameters","parameters effect, updated keys:",a),n})},[x,s]);const f=n.useCallback(()=>{s(e=>{if(!e)return e;const t={...e},n=[];return Object.keys(t).forEach(e=>{Hl.has(e)||void 0!==t[e]&&(n.push(e),delete t[e])}),Dp.log("parameters","parameters reset, affected keys:",n),t})},[s]),g=n.useCallback(()=>{const e=el.parse({...t});c(e),o(!0)},[t]);return x?l.jsxs("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[" ",x.map(e=>{const n=nN[e.component];if(!n)return null;const{key:s,default:r,...o}=e;return"region"===s&&p.length&&(o.options=p),l.jsx(n,{settingKey:s,defaultValue:r,...o,setOption:a,conversation:t},s)})]}),l.jsx("div",{className:"mt-4 flex justify-center",children:l.jsxs("button",{type:"button",onClick:f,className:"btn btn-neutral flex w-full items-center justify-center gap-2 px-4 py-2 text-sm",children:[l.jsx(jn,{className:"h-4 w-4","aria-hidden":"true"}),e("com_ui_reset_var",{0:e("com_ui_model_parameters")})]})}),l.jsx("div",{className:"mt-2 flex justify-center",children:l.jsx("button",{onClick:g,className:"btn btn-primary focus:shadow-outline flex w-full items-center justify-center px-4 py-2 font-semibold text-black bg-white hover:bg-gray-100 focus:border-black dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 dark:focus:border-white border border-gray-300 dark:border-gray-600",type:"button",children:e("com_endpoint_save_as_preset")})}),i&&l.jsx(mN,{open:r,onOpenChange:o,preset:i})]}):null}function XR({row:e}){var t;const n=e.original;return l.jsxs("div",{className:"flex w-full items-center gap-2",children:[!0===(null==(t=null==n?void 0:n.type)?void 0:t.startsWith("image"))?l.jsx(jT,{url:n.filepath,className:"h-10 w-10 flex-shrink-0",source:n.source,alt:n.filename}):l.jsx(fN,{fileType:Im(null==n?void 0:n.type),file:n}),l.jsx("div",{className:"min-w-0 flex-1 overflow-hidden",children:l.jsx("span",{className:"block w-full overflow-hidden truncate text-ellipsis whitespace-nowrap text-xs",children:null==n?void 0:n.filename})})]})}const eI=[{accessorKey:"filename",header:({column:e})=>{const t=zf();return l.jsxs(c_,{variant:"ghost",className:"hover:bg-surface-hover",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),children:[t("com_ui_name"),l.jsx(Nn,{className:"ml-2 h-4 w-4"})]})},meta:{size:"150px"},cell:({row:e})=>l.jsx(XR,{row:e})},{accessorKey:"updatedAt",meta:{size:"10%"},header:({column:e})=>{const t=zf();return l.jsxs(c_,{variant:"ghost",className:"hover:bg-surface-hover",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),children:[t("com_ui_date"),l.jsx(Nn,{className:"ml-2 h-4 w-4"})]})},cell:({row:e})=>{var t,n;return l.jsx("span",{className:"flex justify-end text-xs",children:Em((null==(n=null==(t=e.original)?void 0:t.updatedAt)?void 0:n.toString())??"")})}}];function tI({columns:e,data:t}){var s;const a=zf(),[r,o]=n.useState([]),[i,c]=n.useState([]),[d,u]=n.useState({}),[{pageIndex:m,pageSize:p},h]=n.useState({pageIndex:0,pageSize:10}),x=y(sx.showFiles),f=n.useMemo(()=>({pageIndex:m,pageSize:p}),[m,p]),g=$a({data:t,columns:e,state:{sorting:r,columnFilters:i,columnVisibility:d,pagination:f},onSortingChange:o,onPaginationChange:h,getCoreRowModel:Ba(),getSortedRowModel:Ga(),onColumnFiltersChange:c,getFilteredRowModel:Ka(),onColumnVisibilityChange:u,getPaginationRowModel:Ha(),defaultColumn:{minSize:0,size:10,maxSize:10,enableResizing:!0}}),v=Ug(),{showToast:b}=Of(),{setFiles:_,conversation:j}=rg(),{data:w=kl}=Rx({select:e=>El(e)}),{addFile:N}=zv(_),C=n.useCallback(e=>{if(!(null==v?void 0:v[e.file_id])||!(null==j?void 0:j.endpoint))return void b({message:a("com_ui_attach_error"),status:"error"});const t=v[e.file_id],n=j.endpoint;if(!t.source)return;const s="openai"===(r=t.source)||"azure"===r;var r;const o=ji(n);if(s&&!o)return void b({message:a("com_ui_attach_error_openai"),status:"error"});!s&&o&&b({message:a("com_ui_attach_warn_endpoint"),status:"warning"});const{fileSizeLimit:i,supportedMimeTypes:l}=w.endpoints[n]??w.endpoints.default;t.bytes>i?b({message:`${a("com_ui_attach_error_size")} ${i/jl} MB (${n})`,status:"error"}):kl.checkType(e.type,l)?N({progress:1,attached:!0,file_id:t.file_id,filepath:t.filepath,preview:t.filepath,type:t.type,height:t.height,width:t.width,filename:t.filename,source:t.source,size:t.bytes,metadata:t.metadata}):b({message:`${a("com_ui_attach_error_type")} ${e.type} (${n})`,status:"error"})},[N,v,j,a,b,w.endpoints]),k=null==(s=g.getColumn("filename"))?void 0:s.getFilterValue();return l.jsxs("div",{role:"region","aria-label":a("com_files_table"),className:"mt-2 space-y-2",children:[l.jsx("div",{className:"flex items-center gap-4",children:l.jsx(M_,{placeholder:a("com_files_filter"),value:k??"",onChange:e=>{var t;return null==(t=g.getColumn("filename"))?void 0:t.setFilterValue(e.target.value)},"aria-label":a("com_files_filter")})}),l.jsx("div",{className:"rounded-lg border border-border-light bg-transparent shadow-sm transition-colors",children:l.jsx("div",{className:"overflow-x-auto",children:l.jsxs(Z_,{children:[l.jsx(J_,{children:g.getHeaderGroups().map(e=>l.jsx(X_,{className:"border-b border-border-light",children:e.headers.map((e,t)=>l.jsx(ej,{style:{width:0===t?"75%":"25%"},className:"bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:l.jsx("div",{className:"px-4",children:e.isPlaceholder?null:Ua(e.column.columnDef.header,e.getContext())})},e.id))},e.id))}),l.jsx(Y_,{children:g.getRowModel().rows.length?g.getRowModel().rows.map(e=>l.jsx(X_,{"data-state":e.getIsSelected()&&"selected",className:"border-b border-border-light transition-colors hover:bg-surface-secondary [&:last-child]:border-0",children:e.getVisibleCells().map(t=>{const n="filename"===t.column.id;return l.jsx(tj,{style:{width:"150px",maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},"data-skip-refocus":"true",role:n?"button":void 0,tabIndex:n?0:void 0,onClick:t=>{if(n){const n=t.target;n.closest("td")&&!n.closest("button, a")&&(t.preventDefault(),t.stopPropagation(),C(e.original))}},onKeyDown:t=>{if(n&&("Enter"===t.key||" "===t.key)){const n=t.target;n.closest("td")&&!n.closest("button, a")&&(t.preventDefault(),t.stopPropagation(),C(e.original))}},children:Ua(t.column.columnDef.cell,t.getContext())},t.id)})},e.id)):l.jsx(X_,{children:l.jsx(tj,{colSpan:e.length,className:"h-24 text-center text-sm text-text-secondary",children:a("com_files_no_results")})})})]})})}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs(c_,{variant:"outline",size:"sm",onClick:()=>x(!0),"aria-label":a("com_sidepanel_manage_files"),children:[l.jsx(Cn,{className:"h-4 w-4","aria-hidden":"true"}),l.jsx("span",{className:"ml-2",children:a("com_sidepanel_manage_files")})]}),l.jsxs("div",{className:"flex items-center gap-2",role:"navigation","aria-label":"Pagination",children:[l.jsx(c_,{variant:"outline",size:"sm",onClick:()=>g.previousPage(),disabled:!g.getCanPreviousPage(),"aria-label":a("com_ui_prev"),children:a("com_ui_prev")}),l.jsx("div",{"aria-live":"polite",className:"text-sm",children:`${m+1} / ${g.getPageCount()}`}),l.jsx(c_,{variant:"outline",size:"sm",onClick:()=>g.nextPage(),disabled:!g.getCanNextPage(),"aria-label":a("com_ui_next"),children:a("com_ui_next")})]})]})]})}function nI(){const{data:e=[]}=Tx();return l.jsx("div",{className:"h-auto max-w-full overflow-x-hidden",children:l.jsx(tI,{columns:eI,data:e})})}function sI(){return l.jsx("div",{className:"space-y-6 p-2",children:[1,2].map(e=>l.jsxs("div",{className:"space-y-4",children:[l.jsx(q_,{className:"h-6 w-1/3 rounded-lg"})," ",[1,2].map(e=>l.jsxs("div",{className:"space-y-2",children:[l.jsx(q_,{className:"h-5 w-1/4 rounded-lg"})," ",l.jsx(q_,{className:"h-8 w-full rounded-lg"})," ",l.jsx(q_,{className:"h-4 w-2/3 rounded-lg"})," "]},e))]},e))})}function aI(){const e=zf(),{showToast:t}=Of(),{data:s,isLoading:a}=Sx(),[r,o]=n.useState(null),i=n.useMemo(()=>(null==s?void 0:s.mcpServers)?Object.entries(s.mcpServers).filter(([,e])=>e.customUserVars&&Object.keys(e.customUserVars).length>0).map(([e,t])=>({serverName:e,iconPath:null,config:{...t,customUserVars:t.customUserVars??{}}})):[],[null==s?void 0:s.mcpServers]),c=Xf({onSuccess:()=>{t({message:e("com_nav_mcp_vars_updated"),status:"success"})},onError:n=>{console.error("Error updating MCP custom user variables:",n),t({message:e("com_nav_mcp_vars_update_error"),status:"error"})}}),d=n.useCallback((e,t)=>{const n={pluginKey:`${Zc.mcp_prefix}${e}`,action:"install",auth:t};c.mutate(n)},[c]),u=n.useCallback(e=>{const t={pluginKey:`${Zc.mcp_prefix}${e}`,action:"uninstall",auth:{}};c.mutate(t)},[c]),m=()=>{o(null)};if(a)return l.jsx(sI,{});if(0===i.length)return l.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:e("com_sidepanel_mcp_no_servers_with_vars")});if(r){const t=i.find(e=>e.serverName===r);return t?l.jsxs("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:[l.jsxs(c_,{variant:"outline",onClick:m,className:"mb-3 flex items-center px-3 py-2 text-sm",children:[l.jsx(zt,{className:"mr-1 h-4 w-4"}),e("com_ui_back")]}),l.jsx("h3",{className:"mb-3 text-lg font-medium",children:e("com_sidepanel_mcp_variables_for",{0:t.serverName})}),l.jsx(rI,{server:t,onSave:d,onRevoke:u,isSubmitting:c.isLoading})]}):(o(null),l.jsxs("div",{className:"p-4 text-center text-sm text-gray-500",children:[e("com_ui_error"),": ",e("com_ui_mcp_server_not_found")]}))}return l.jsx("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:l.jsx("div",{className:"space-y-2",children:i.map(e=>l.jsx(c_,{variant:"outline",className:"w-full justify-start dark:hover:bg-gray-700",onClick:()=>{return t=e.serverName,void o(t);var t},children:e.serverName},e.serverName))})})}function rI({server:e,onSave:t,onRevoke:s,isSubmitting:a}){const r=zf(),{control:o,handleSubmit:i,reset:c,formState:{errors:d,isDirty:u}}=Rr({defaultValues:{}});n.useEffect(()=>{const t=Object.keys(e.config.customUserVars).reduce((e,t)=>(e[t]="",e),{});c(t)},[c,e.config.customUserVars]);return l.jsxs("form",{onSubmit:i(n=>{t(e.serverName,n)}),className:"mb-4 mt-2 space-y-4",children:[Object.entries(e.config.customUserVars).map(([t,n])=>{var s;return l.jsxs("div",{className:"space-y-2",children:[l.jsx(L_,{htmlFor:`${e.serverName}-${t}`,className:"text-sm font-medium",children:n.title}),l.jsx(Ir,{name:t,control:o,defaultValue:"",render:({field:s})=>l.jsx(M_,{id:`${e.serverName}-${t}`,type:"text",...s,placeholder:r("com_sidepanel_mcp_enter_value",{0:n.title}),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm"})}),n.description&&l.jsx("p",{className:"text-xs text-text-secondary [&_a]:text-blue-500 [&_a]:hover:text-blue-600 dark:[&_a]:text-blue-400 dark:[&_a]:hover:text-blue-300",dangerouslySetInnerHTML:{__html:n.description}}),d[t]&&l.jsx("p",{className:"text-xs text-red-500",children:null==(s=d[t])?void 0:s.message})]},t)}),l.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[Object.keys(e.config.customUserVars).length>0&&l.jsx(c_,{type:"button",onClick:()=>{s(e.serverName)},className:"bg-red-600 text-white hover:bg-red-700 dark:hover:bg-red-800",disabled:a,children:r("com_ui_revoke")}),l.jsx(c_,{type:"submit",className:"bg-white text-black hover:bg-gray-100 dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 border border-gray-300 dark:border-gray-600",disabled:a||!u,children:r(a?"com_ui_saving":"com_ui_save")})]})]})}function oI({onToggle:e,navVisible:t,isHovering:n,setIsHovering:s,side:a="left",className:r="",translateX:o=!0}){const i=zf(),c={transition:"transform 0.3s ease, opacity 0.2s ease"},d=n||!t?"15deg":"0deg",u="right"===a?`-${d}`:d,m="right"===a?d:`-${d}`;return l.jsx("div",{className:Op(r,"-translate-y-1/2 transition-transform",t?"rotate-0":"rotate-180",t&&o?"translate-x-[260px]":"translate-x-0 "),onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:l.jsx(rj,{side:"right"===a?"left":"right","aria-label":i("left"===a?"com_ui_chat_history":"com_ui_controls"),"aria-expanded":t,"aria-controls":"left"===a?"chat-history-nav":"controls-nav",id:`toggle-${a}-nav`,onClick:e,role:"button",description:i(t?"com_nav_close_sidebar":"com_nav_open_sidebar"),className:"flex items-center justify-center",tabIndex:0,children:l.jsx("span",{className:"","data-state":"closed",children:l.jsx("div",{className:"flex h-[72px] w-8 items-center justify-center",style:{...c,opacity:n?1:.25},children:l.jsxs("div",{className:"flex h-6 w-6 flex-col items-center",children:[l.jsx("div",{className:"h-3 w-1 rounded-full bg-black dark:bg-white",style:{...c,transform:`translateY(0.15rem) rotate(${u}) translateZ(0px)`}}),l.jsx("div",{className:"h-3 w-1 rounded-full bg-black dark:bg-white",style:{...c,transform:`translateY(-0.15rem) rotate(${m}) translateZ(0px)`}})]})})})})})}function iI({links:e,isCollapsed:t,resize:s,defaultActive:a}){const r=zf(),[o,i]=n.useState(a),c=e=>{localStorage.setItem("side:active-panel",e+""),i(e)};return l.jsx("div",{"data-collapsed":t,className:"bg-token-sidebar-surface-primary hide-scrollbar group flex-shrink-0 overflow-x-hidden",children:l.jsx("div",{className:"h-full",children:l.jsx("div",{className:"flex h-full min-h-0 flex-col",children:l.jsx("div",{className:"flex h-full min-h-0 flex-col opacity-100 transition-opacity",children:l.jsx("div",{className:"scrollbar-trigger relative h-full w-full flex-1 items-start border-white/20",children:l.jsx("div",{className:"flex h-full w-full flex-col gap-1 px-3 py-2.5 group-[[data-collapsed=true]]:items-center group-[[data-collapsed=true]]:justify-center group-[[data-collapsed=true]]:px-2",children:e.map((e,n)=>{const a=(e=>e.id===o?"default":"ghost")(e);return t?l.jsx(rj,{description:r(e.title),side:"left",render:l.jsxs(c_,{variant:"ghost",size:"icon",onClick:t=>{if(e.onClick)return e.onClick(t),void c("");c(e.id),s&&s(25)},children:[l.jsx(e.icon,{className:"h-4 w-4 text-text-secondary"}),l.jsx("span",{className:"sr-only",children:r(e.title)})]})},`nav-link-${n}`):l.jsx(PT,{type:"single",value:o,onValueChange:c,collapsible:!0,children:l.jsxs(LT,{value:e.id,className:"w-full border-none",children:[l.jsx(va,{asChild:!0,children:l.jsx(ba,{asChild:!0,children:l.jsxs(c_,{variant:"outline",size:"sm",className:"w-full justify-start bg-transparent text-text-secondary data-[state=open]:bg-surface-secondary data-[state=open]:text-text-primary",onClick:t=>{e.onClick&&(e.onClick(t),c(""))},children:[l.jsx(e.icon,{className:"mr-2 h-4 w-4"}),r(e.title),null!=e.label&&e.label&&l.jsx("span",{className:Op("ml-auto opacity-100 transition-all duration-300 ease-in-out","default"===a?"text-text-primary":""),children:e.label})]})})}),l.jsx(AT,{className:"w-full text-text-primary",children:e.Component&&l.jsx(e.Component,{})})]})},n)})})})})})})})}const lI=n.memo(({defaultSize:e,panelRef:t,navCollapsedSize:s=3,hasArtifacts:a,minSize:r,setMinSize:o,collapsedSize:i,setCollapsedSize:c,isCollapsed:d,setIsCollapsed:u,fullCollapse:m,setFullCollapse:p,interfaceConfig:h})=>{var x;const f=zf(),[g,v]=n.useState(!1),[b,y]=Ky("newUser",!0),{data:_={}}=kx(),j=Uy("(max-width: 767px)"),{conversation:w}=rg(),{endpoint:N}=w??{},{data:C={expiresAt:void 0}}=Qf(N??""),k=n.useMemo(()=>{const e=localStorage.getItem("side:active-panel");return"string"==typeof e?e:void 0},[]),S=n.useMemo(()=>fp(_,N,"type"),[N,_]),T=n.useMemo(()=>{var e;return!!(null==(e=null==_?void 0:_[N??""])?void 0:e.userProvide)},[_,N]),R=n.useMemo(()=>!T||!!C.expiresAt,[C.expiresAt,T]),I=n.useCallback(()=>{var e;u(!0),c(0),o(20),p(!0),localStorage.setItem("fullPanelCollapse","true"),null==(e=t.current)||e.collapse()},[t,o,u,p,c]),E=function({hidePanel:e,keyProvided:t,endpoint:s,endpointType:a,interfaceConfig:r,endpointsConfig:o}){const i=Zv({permissionType:bd.PROMPTS,permission:yd.USE}),l=Zv({permissionType:bd.BOOKMARKS,permission:yd.USE}),c=Zv({permissionType:bd.MEMORIES,permission:yd.USE}),d=Zv({permissionType:bd.MEMORIES,permission:yd.READ}),u=Zv({permissionType:bd.AGENTS,permission:yd.USE}),m=Zv({permissionType:bd.AGENTS,permission:yd.CREATE}),{data:p}=Sx();return n.useMemo(()=>{const n=[];return ji(s)&&(s===vi.assistants&&(null==o?void 0:o[vi.assistants])&&!0!==o[vi.assistants].disableBuilder||s===vi.azureAssistants&&(null==o?void 0:o[vi.azureAssistants])&&!0!==o[vi.azureAssistants].disableBuilder)&&t&&n.push({title:"com_sidepanel_assistant_builder",label:"",icon:Fb,id:"assistants",Component:QR}),(null==o?void 0:o[vi.agents])&&u&&m&&!0!==o[vi.agents].disableBuilder&&n.push({title:"com_sidepanel_agent_builder",label:"",icon:Fb,id:"agents",Component:lR}),i&&n.push({title:"com_ui_prompts",label:"",icon:Ye,id:"prompts",Component:JR}),c&&d&&n.push({title:"com_ui_memories",label:"",icon:pt,id:"memories",Component:_R}),!0===r.parameters&&!0===Ni(s??"",a??"")&&!wi(s)&&t&&n.push({title:"com_sidepanel_parameters",label:"",icon:yn,id:"parameters",Component:YR}),n.push({title:"com_sidepanel_attach_files",label:"",icon:Yb,id:"files",Component:nI}),l&&n.push({title:"com_sidepanel_conversation_tags",label:"",icon:kn,id:"bookmarks",Component:fR}),(null==p?void 0:p.mcpServers)&&Object.values(p.mcpServers).some(e=>e.customUserVars&&Object.keys(e.customUserVars).length>0)&&n.push({title:"com_nav_setting_mcp",label:"",icon:Ay,id:"mcp-settings",Component:aI}),n.push({title:"com_sidepanel_hide_panel",label:"",icon:Sn,onClick:e,id:"hide-panel"}),n},[o,r.parameters,t,a,s,u,i,c,d,l,m,e,p])}({endpoint:N,hidePanel:I,keyProvided:R,endpointType:S,interfaceConfig:h,endpointsConfig:_}),M=n.useCallback(()=>{var e,n;b&&y(!1),u(e=>(e&&(o(20),c(s),p(!1),localStorage.setItem("fullPanelCollapse","false")),!e)),d?null==(n=t.current)||n.expand():null==(e=t.current)||e.collapse()},[b,t,y,o,d,u,p,c,s]);return l.jsxs(l.Fragment,{children:[l.jsx("div",{onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),className:"relative flex w-px items-center justify-center",children:l.jsx(oI,{navVisible:!d,isHovering:g,onToggle:M,setIsHovering:v,className:Op("fixed top-1/2",d&&(0===r||0===i)||m?"mr-9":"mr-16"),translateX:!1,side:"right"})}),(!d||r>0)&&!j&&!m&&l.jsx(GS,{withHandle:!0,className:"bg-transparent text-text-primary"}),l.jsx(KS,{tagName:"nav",id:"controls-nav",order:a?3:2,"aria-label":f("com_ui_controls"),role:"navigation",collapsedSize:i,defaultSize:e,collapsible:!0,minSize:r,maxSize:40,ref:t,style:{overflowY:"auto",transition:"width 0.2s ease, visibility 0s linear 0.2s"},onExpand:()=>{u(!1),localStorage.setItem("react-resizable-panels:collapsed","false")},onCollapse:()=>{u(!0),localStorage.setItem("react-resizable-panels:collapsed","true")},className:Op("sidenav hide-scrollbar border-l border-border-light bg-background py-1 transition-opacity",d?"min-w-[50px]":"min-w-[340px] sm:min-w-[352px]",j&&d&&(0===r||0===i)||m?"hidden min-w-0":"opacity-100"),children:l.jsx(iI,{resize:null==(x=t.current)?void 0:x.resize,isCollapsed:d,defaultActive:k,links:E})})]})}),cI=Pc().interface,dI=n.memo(({defaultLayout:e=[97,3],defaultCollapsed:t=!1,fullPanelCollapse:s=!1,navCollapsedSize:a=3,artifacts:r,children:o})=>{const{data:i}=Sx(),c=n.useMemo(()=>(null==i?void 0:i.interface)??cI,[i]),d=n.useRef(null),[u,m]=n.useState(20),[p,h]=n.useState(t),[x,f]=n.useState(s),[g,v]=n.useState(a),b=Uy("(max-width: 767px)"),y=_(sx.hideSidePanel),j=n.useCallback(()=>{if(null==r){const t=2===e.length?e[1]:e[2];return[100-t,t]}{const e=0,t=100-e,n=Math.floor(t/2);return[n,t-n,e]}},[r,e]),w=n.useMemo(()=>Jp(j()),[j]),N=n.useMemo(()=>kr(e=>{const t=Jp(e);localStorage.setItem("react-resizable-panels:layout",JSON.stringify(t))},350),[]);n.useEffect(()=>{var e;if(b)return h(!0),v(0),m(20),f(!0),localStorage.setItem("fullPanelCollapse","true"),void(null==(e=d.current)||e.collapse());h(t),v(a),m(20)},[b,t,a,s]);const C=n.useMemo(()=>null!=r?15:30,[r]);return l.jsxs(l.Fragment,{children:[l.jsxs(HS,{direction:"horizontal",onLayout:e=>N(e),className:"transition-width relative h-full w-full flex-1 overflow-auto bg-presentation",children:[l.jsx(KS,{defaultSize:w[0],minSize:C,order:1,id:"messages-view",children:o}),null!=r&&l.jsxs(l.Fragment,{children:[l.jsx(GS,{withHandle:!0,className:"ml-3 bg-border-medium text-text-primary"}),l.jsx(KS,{defaultSize:w[1],minSize:C,order:2,id:"artifacts-panel",children:r})]}),!y&&!0===c.sidePanel&&l.jsx(lI,{panelRef:d,minSize:u,setMinSize:m,isCollapsed:p,setIsCollapsed:h,collapsedSize:g,setCollapsedSize:v,fullCollapse:x,setFullCollapse:f,defaultSize:w[w.length-1],hasArtifacts:null!=r,interfaceConfig:c})]}),l.jsx("button",{"aria-label":"Close right side panel",className:"nav-mask "+(p?"":"active"),onClick:()=>{var e;h(()=>(localStorage.setItem("fullPanelCollapse","true"),f(!0),v(0),m(0),!1)),null==(e=d.current)||e.collapse()}})]})});function uI({children:e}){const t=_(sx.artifactsState),s=_(sx.artifactsVisibility),a=dg(),{mutateAsync:r}=Px({onSuccess:()=>{console.log("Temporary Files deleted"),a({})},onError:e=>{console.log("Error deleting temporary files:",e)}});n.useEffect(()=>{const e=localStorage.getItem(Jc.FILES_TO_DELETE),t=JSON.parse(e??"{}"),n=Object.values(t).filter(e=>null!=e.filepath&&e.source&&!e.embedded&&e.temp_file_id).map(e=>({file_id:e.file_id,filepath:e.filepath,source:e.source,embedded:!!e.embedded}));0!==n.length&&r({files:n})},[r]);const o=n.useMemo(()=>{const e=localStorage.getItem("react-resizable-panels:layout");return"string"==typeof e?JSON.parse(e):void 0},[]),i=n.useMemo(()=>{const e=localStorage.getItem("react-resizable-panels:collapsed");return"string"!=typeof e||JSON.parse(e)},[]),c=n.useMemo(()=>"true"===localStorage.getItem("fullPanelCollapse"),[]);return l.jsx(MS,{className:"relative flex w-full grow overflow-hidden bg-presentation",children:l.jsx(dI,{defaultLayout:o,fullPanelCollapse:c,defaultCollapsed:i,artifacts:!0===s&&Object.keys(t??{}).length>0?l.jsx(Wg,{children:l.jsx(US,{})}):null,children:l.jsx("main",{className:"flex h-full flex-col overflow-y-auto",role:"main",children:e})})})}const mI=m.memo(({disabled:e,conversationId:t})=>{const s=zf(),a=e??!1,r=n.useRef(null),[o,i]=n.useState(!1),c=y(tx(t)),[d,u]=n.useState(),{data:m}=kx(),{handleFileChange:p}=Fv({overrideEndpoint:vi.agents}),h=n.useMemo(()=>{var e;return(null==(e=null==m?void 0:m[vi.agents])?void 0:e.capabilities)??[]},[m]),x=e=>{r.current&&(r.current.value="",r.current.accept=!0===e?"image/*":"",r.current.click(),r.current.accept="")},f=n.useMemo(()=>{const e=[{label:s("com_ui_upload_image_input"),onClick:()=>{u(void 0),x(!0)},icon:l.jsx(on,{className:"icon-md"})}];return h.includes(oi.ocr)&&e.push({label:s("com_ui_upload_ocr_text"),onClick:()=>{u(oi.ocr),x()},icon:l.jsx(cn,{className:"icon-md"})}),h.includes(oi.file_search)&&e.push({label:s("com_ui_upload_file_search"),onClick:()=>{u(oi.file_search),x()},icon:l.jsx(ln,{className:"icon-md"})}),h.includes(oi.execute_code)&&e.push({label:s("com_ui_upload_code_files"),onClick:()=>{u(oi.execute_code),c(e=>({...e,[oi.execute_code]:!0})),x()},icon:l.jsx(V,{className:"icon-md"})}),e},[h,s,u,c]),g=l.jsx(rj,{render:l.jsx(Qe,{disabled:a,id:"attach-file-menu-button","aria-label":"Attach File Options",className:Op("flex size-9 items-center justify-center rounded-full p-1 transition-colors hover:bg-surface-hover focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50"),children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:l.jsx(Yb,{})})}),id:"attach-file-menu-button",description:s("com_sidepanel_attach_files"),disabled:a});return l.jsx(Cj,{ref:r,handleFileChange:e=>{p(e,d)},children:l.jsx(kj,{menuId:"attach-file-menu",isOpen:o,setIsOpen:i,modal:!0,unmountOnHide:!0,trigger:g,items:f,iconClassName:"mr-0"})})});const pI=n.memo(function({disableInputs:e}){const{conversation:t}=rg(),s=(null==t?void 0:t.conversationId)??Zc.NEW_CONVO,{endpoint:a,endpointType:r}=t??{endpoint:null},o=n.useMemo(()=>wi(a),[a]),{data:i=kl}=Rx({select:e=>El(e)}),c=i.endpoints[a??""],d=fl[r??a??""]??!1,u=(e||(null==c?void 0:c.disabled))??!1;return o||d&&!u?l.jsx(mI,{disabled:e,conversationId:s}):null});const hI=n.memo(function({disableInputs:e}){const t=_(sx.chatDirection).toLowerCase(),{files:n,setFiles:s,conversation:a,setFilesLoading:r}=rg(),{endpoint:o}=a??{endpoint:null},{abortUpload:i}=Fv(),c="rtl"===t;return l.jsx(l.Fragment,{children:l.jsx(NT,{files:n,setFiles:s,abortUpload:i,setFilesLoading:r,isRTL:c,Wrapper:({children:e})=>l.jsx("div",{className:"mx-2 mt-2 flex flex-wrap gap-2",children:e})})})});function xI({addedConvo:e,setAddedConvo:t}){const s=ug(),{data:a}=kx(),r=n.useMemo(()=>`+ ${s(e)}: ${ap(e)}`,[e,s]);return e?l.jsxs("div",{className:"flex items-start gap-4 py-2.5 pl-3 pr-1.5 text-sm",children:[l.jsx("span",{className:"mt-0 flex h-6 w-6 flex-shrink-0 items-center justify-center",children:l.jsx("div",{className:"icon-md",children:l.jsx(Qw,{conversation:e,endpointsConfig:a,containerClassName:"shadow-stroke overflow-hidden rounded-full",context:"menu-item",size:20})})}),l.jsx("span",{className:"text-token-text-secondary line-clamp-3 flex-1 py-0.5 font-semibold",children:r}),l.jsx("button",{className:"text-token-text-secondary flex-shrink-0",type:"button","aria-label":"Close added conversation",onClick:()=>t(null),children:l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",className:"icon-lg","aria-hidden":"true",children:l.jsx("path",{fill:"currentColor",fillRule:"evenodd",d:"M7.293 7.293a1 1 0 0 1 1.414 0L12 10.586l3.293-3.293a1 1 0 1 1 1.414 1.414L13.414 12l3.293 3.293a1 1 0 0 1-1.414 1.414L12 13.414l-3.293 3.293a1 1 0 0 1-1.414-1.414L10.586 12 7.293 8.707a1 1 0 0 1 0-1.414",clipRule:"evenodd"})})})]}):null}function fI({addedConvo:e,setAddedConvo:t}){return e?l.jsx("div",{className:"m-1.5 flex flex-col divide-y overflow-hidden rounded-b-lg rounded-t-2xl bg-surface-secondary-alt",children:l.jsx(xI,{addedConvo:e,setAddedConvo:t})}):null}function gI({name:e,onClick:t,index:n,icon:s,isActive:a,description:r,style:o,type:i="mention"}){return l.jsx("button",{tabIndex:n,onClick:t,id:`${i}-item-${n}`,className:"w-full",style:o,children:l.jsxs("div",{className:Op("text-token-text-primary bg-token-main-surface-secondary group flex h-10 items-center gap-2 rounded-lg px-2 text-sm font-medium hover:bg-surface-secondary",!0===a?"bg-surface-active":"bg-transparent"),children:[l.jsx("div",{className:"flex h-5 w-5 flex-shrink-0 items-center justify-center",children:s}),l.jsxs("div",{className:"flex min-w-0 flex-grow items-center justify-between",children:[l.jsxs("div",{className:"truncate",children:[l.jsx("span",{className:"font-medium",children:e}),null!=r&&r?l.jsx("span",{className:"text-token-text-tertiary ml-2 text-sm font-light",children:r}):null]}),l.jsx(Tn,{size:16,className:"ml-2 flex-shrink-0"})]})]})})}const vI=n.memo(({index:e,children:t,isVariableDialogOpen:n,variableGroup:s,setVariableDialogOpen:a})=>{const r=_(sx.showPromptsPopoverFamily(e));return l.jsxs(l.Fragment,{children:[r?t:null,l.jsx(NC,{open:n,onClose:()=>a(!1),group:s})]})});const bI=n.memo(function({index:e,textAreaRef:t,submitPrompt:s}){const a=zf(),r=Zv({permissionType:bd.PROMPTS,permission:yd.USE}),{data:o,isLoading:i}=rf(0,{enabled:r,select:e=>{const t=e.map(e=>{var t,n;return{id:e._id,value:e.command??e.name,label:`${null!=e.command&&e.command?`/${e.command} - `:""}${e.name}: ${((null==(t=e.oneliner)?void 0:t.length)??0)>0?e.oneliner:(null==(n=e.productionPrompt)?void 0:n.prompt)??""}`,icon:l.jsx(kb,{category:e.category??"",className:"h-5 w-5"})}});return{promptsMap:e.reduce((e,t)=>t._id?(e[t._id]=t,e):e,{}),promptGroups:t}}}),[c,d]=n.useState(0),u=n.useRef(null),m=n.useRef(null),[p,h]=n.useState(!1),[x,f]=n.useState(null),g=y(sx.showPromptsPopoverFamily(e)),v=n.useMemo(()=>null==o?void 0:o.promptGroups,[o]),b=n.useMemo(()=>null==o?void 0:o.promptsMap,[o]),{open:_,setOpen:j,searchValue:w,setSearchValue:N,matches:C}=Kv({value:"",options:v??[]}),k=n.useCallback((e,n)=>{var a,r;if(!e)return;N(""),j(!1),g(!1),t.current&&dp(t.current,"/");const o=null==b?void 0:b[e.id];if(!o)return;if(op((null==(a=o.productionPrompt)?void 0:a.prompt)??""))return n&&"Tab"===n.key&&n.preventDefault(),f(o),void h(!0);s((null==(r=o.productionPrompt)?void 0:r.prompt)??"")},[N,j,g,t,b,s]);if(n.useEffect(()=>{_?f(null):d(0)},[_]),n.useEffect(()=>()=>{u.current&&clearTimeout(u.current)},[]),n.useEffect(()=>{const e=document.getElementById(`prompt-item-${c}`);null==e||e.scrollIntoView({behavior:"instant",block:"nearest"})},[c]),!r)return null;const S=({index:e,key:t,style:n})=>{const s=C[e];return l.jsx(gI,{index:e,type:"prompt",style:n,onClick:()=>{u.current&&clearTimeout(u.current),u.current=null,k(s)},name:s.label??"",icon:s.icon,description:s.description,isActive:e===c},t)};return l.jsx(vI,{index:e,isVariableDialogOpen:p,variableGroup:x,setVariableDialogOpen:h,children:l.jsx("div",{className:"absolute bottom-28 z-10 w-full space-y-2",children:l.jsxs("div",{className:"popover border-token-border-light rounded-2xl border bg-surface-tertiary-alt p-2 shadow-lg",children:[l.jsx("input",{autoFocus:!0,ref:m,placeholder:a("com_ui_command_usage_placeholder"),className:"mb-1 w-full border-0 bg-surface-tertiary-alt p-2 text-sm focus:outline-none dark:text-gray-200",autoComplete:"off",value:w,onKeyDown:e=>{var n,s;"Escape"===e.key&&(j(!1),g(!1),null==(n=t.current)||n.focus()),"ArrowDown"===e.key?d(e=>(e+1)%C.length):"ArrowUp"===e.key?d(e=>(e-1+C.length)%C.length):"Enter"===e.key||"Tab"===e.key?("Enter"===e.key&&e.preventDefault(),k(C[c],e)):"Backspace"===e.key&&""===w&&(j(!1),g(!1),null==(s=t.current)||s.focus())},onChange:e=>N(e.target.value),onFocus:()=>j(!0),onBlur:()=>{u.current=setTimeout(()=>{j(!1),g(!1)},150)}}),l.jsx("div",{className:"max-h-40 overflow-y-auto",children:i&&_?l.jsx("div",{className:"flex h-32 items-center justify-center text-text-primary",children:l.jsx(Gb,{})}):!i&&_?l.jsx("div",{className:"max-h-40",children:l.jsx(To,{disableHeight:!0,children:({width:e})=>l.jsx(Ro,{width:e,overscanRowCount:5,rowHeight:40,rowCount:C.length,rowRenderer:S,scrollToIndex:c,height:Math.min(40*C.length,160)})})}):null})]})})})});function yI({disabled:e,ask:t,methods:s,textAreaRef:a,isSubmitting:r}){const{setValue:o,reset:i}=s,c=zf(),{showToast:d}=Of(),u=n.useCallback(e=>{if(r)d({message:c("com_ui_speech_while_submitting"),status:"error"});else if(e){const n=document.getElementById(Uo);n&&(console.log("Unmuting global audio"),n.muted=!1),t({text:e}),i({text:""})}},[t,i,d,c,r]),m=n.useCallback(e=>{o("text",e,{shouldValidate:!0})},[o]),{isListening:p,isLoading:h,startRecording:x,stopRecording:f}=tb(m,u);if(!a.current)return null;return l.jsx(rj,{description:c("com_ui_use_micrphone"),render:l.jsx("button",{id:"audio-recorder",type:"button","aria-label":c("com_ui_use_micrphone"),onClick:!0===p?async()=>f():async()=>x(),disabled:e,className:Op("flex size-9 items-center justify-center rounded-full p-1 transition-colors hover:bg-surface-hover"),title:c("com_ui_use_micrphone"),"aria-pressed":p,children:!0===p?l.jsx(_y,{className:"stroke-red-500"}):!0===h?l.jsx(Gb,{className:"stroke-gray-700 dark:stroke-gray-300"}):l.jsx(_y,{className:"stroke-gray-700 dark:stroke-gray-300"})})})}const _I=({isScrollable:e,isCollapsed:t,setIsCollapsed:n})=>{const s=zf();if(!e)return null;const a=s(t?"com_ui_expand_chat":"com_ui_collapse_chat");return l.jsx("div",{className:"relative ml-auto items-end justify-end",children:l.jsx(rj,{description:a,render:l.jsx("button",{"aria-label":a,onClick:e=>{e.preventDefault(),e.stopPropagation(),n(e=>!e)},className:Op("z-10 size-5 rounded-full transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-opacity-50"),children:t?l.jsx(yt,{className:"h-full w-full"}):l.jsx(at,{className:"h-full w-full"})})})})};function jI(e,t){return new Promise((n,s)=>setTimeout(()=>s(new Error(t)),e))}const wI="Reader promise timed out";function NI({index:e=0}){const{token:t}=Rg(),s=_(sx.cacheTTS),a=_(sx.playbackRate),r=_(sx.voice),o=_(sx.activeRunFamily(e)),i=_(sx.automaticPlayback),c=_(sx.isSubmittingFamily(e)),d=_(sx.latestMessageFamily(e)),u=y(sx.globalAudioPlayingFamily(e)),[m,p]=b(sx.audioRunFamily(e)),[h,x]=b(sx.globalAudioFetchingFamily(e)),[f,g]=b(sx.globalAudioURLFamily(e)),{audioRef:v}=function({setIsPlaying:e}){const t=n.useRef(null);return n.useEffect(()=>{let n=null,s=0;const a=()=>{e(!1),console.log("global audio ended"),t.current&&(t.current.customEnded=!0,URL.revokeObjectURL(t.current.src))},r=()=>{e(!0),console.log("global audio started"),t.current&&(t.current.customStarted=!0)},o=()=>{console.log("global audio paused"),t.current&&(t.current.customPaused=!0)},i=()=>{if(t.current){const e=t.current.currentTime;e===n?s+=1:s=0,n=e,s>=1&&(console.log("Detected end of audio based on time update"),t.current.pause(),a())}},l=t.current;return t.current&&(t.current.addEventListener("ended",a),t.current.addEventListener("play",r),t.current.addEventListener("pause",o),t.current.addEventListener("timeupdate",i),t.current.customProps={customStarted:!1,customEnded:!1,customPaused:!1}),()=>{l&&(l.removeEventListener("ended",a),l.removeEventListener("play",r),l.removeEventListener("pause",o),l.removeEventListener("timeupdate",i),URL.revokeObjectURL(l.src))}},[e]),{audioRef:t}}({setIsPlaying:u}),{pauseGlobalAudio:j}=ax(),{conversationId:w}=M(),N="new"===w?w:(null==d?void 0:d.conversationId)??w??"",C=Aa(),k=n.useCallback(()=>C.getQueryData([Pd.messages,N]),[N,C]);return n.useEffect(()=>{const e=mp(d);!(null==t||!i||c||!d||d.isCreatedByUser||!e||!d.messageId||d.messageId.includes("_")||h||null==o||o===m)&&async function(){x(!0);try{v.current&&(v.current.pause(),URL.revokeObjectURL(v.current.src),g(null));let e=(null==d?void 0:d.text)??"";const n=await caches.open("tts-responses"),a=await n.match(e);if(p(o),a){Dp.log("Audio found in cache");const e=await a.blob(),t=URL.createObjectURL(e);return g(t),void x(!1)}Dp.log("Fetching audio...",navigator.userAgent);const i=await fetch("/api/files/speech/tts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({messageId:null==d?void 0:d.messageId,runId:o,voice:r})});if(!i.ok)throw new Error("Failed to fetch audio");if(!i.body)throw new Error("Null Response body");const l=i.body.getReader(),c="audio/mpeg",u="undefined"!=typeof MediaSource&&MediaSource.isTypeSupported(c);let m;u&&(m=new Fo(c),g(m.mediaSourceUrl));let h=!1;const f=[];for(;!h;){const e=l.read(),{value:t,done:n}=await Promise.race([e,jI(15e3,wI)]);s&&t&&f.push(t),t&&m&&m.addData(t),h=n}if(f.length){Dp.log("Adding audio to cache");const t=(k()??[]).find(e=>e.messageId===(null==d?void 0:d.messageId));if(e=(null==t?void 0:t.text)??"",!e)throw new Error("Cache key not found");const s=new Blob(f,{type:c}),a=new Response(s);if(await n.put(e,a),!u){const t=await n.match(e);if(!t)throw new Error("Failed to fetch audio from cache");const s=await t.blob(),a=URL.createObjectURL(s);g(a)}x(!1)}Dp.log("Audio stream reading ended")}catch(e){if((null==e?void 0:e.message)!==wI)return void Dp.log(wI);Dp.error("Error fetching audio:",e),x(!1),g(null)}finally{x(!1)}}()},[i,g,p,x,d,c,o,k,h,m,s,v,r,t]),n.useEffect(()=>{null!=a&&null!=f&&a>0&&v.current&&v.current.playbackRate!==a&&(v.current.playbackRate=a)},[v,f,a]),n.useEffect(()=>{j()},[w]),Dp.log("StreamAudio.tsx - globalAudioURL:",f),l.jsx("audio",{ref:v,controls:!0,controlsList:"nodownload nofullscreen noremoteplayback",style:{position:"absolute",overflow:"hidden",display:"none",height:"0px",width:"0px"},src:f??void 0,id:Uo,autoPlay:!0})}function CI({stop:e,setShowStopButton:t}){const n=zf();return l.jsx(rj,{description:n("com_nav_stop_generating"),render:l.jsx("button",{type:"button",className:Op("rounded-full bg-text-primary p-1.5 text-text-primary outline-offset-4 transition-all duration-200 disabled:cursor-not-allowed disabled:text-text-secondary disabled:opacity-10"),"aria-label":n("com_nav_stop_generating"),onClick:n=>{t(!1),e(n)},children:l.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-lg text-surface-primary",children:l.jsx("rect",{x:"7",y:"7",width:"10",height:"10",rx:"1.25",fill:"currentColor"})})})})}const kI=m.memo(n.forwardRef((e,t)=>{const n=zf();return l.jsx(rj,{description:n("com_nav_send_message"),render:l.jsx("button",{ref:t,"aria-label":n("com_nav_send_message"),id:"send-button",disabled:e.disabled,className:Op("rounded-full bg-text-primary p-1.5 text-text-primary outline-offset-4 transition-all duration-200 disabled:cursor-not-allowed disabled:text-text-secondary disabled:opacity-10"),"data-testid":"send-button",type:"submit",children:l.jsx("span",{className:"","data-state":"closed",children:l.jsx(dy,{size:24})})})})})),SI=m.memo(n.forwardRef((e,t)=>{const n=Mr({control:e.control});return l.jsx(kI,{ref:t,disabled:e.disabled||!n.text})})),TI=m.memo(({isEditingChatBadges:e,handleCancelBadges:t,handleSaveBadges:s,setBadges:a})=>{const r=zf(),o=(Eg()||[]).filter(e=>!e.isAvailable),i=n.useCallback(e=>{a(t=>[...t,{id:e}])},[a]);return e?l.jsxs("div",{className:"m-1.5 flex flex-col overflow-hidden rounded-b-lg rounded-t-2xl bg-surface-secondary-alt",children:[l.jsxs("div",{className:"flex items-center gap-4 py-2 pl-3 pr-1.5 text-sm",children:[l.jsx("span",{className:"mt-0 flex size-6 flex-shrink-0 items-center justify-center",children:l.jsx("div",{className:"icon-md",children:l.jsx(H,{className:"icon-md","aria-hidden":"true"})})}),l.jsx("span",{className:"text-token-text-secondary line-clamp-3 flex-1 py-0.5 font-semibold",children:r("com_ui_save_badge_changes")}),l.jsxs("div",{className:"flex h-8 gap-2",children:[l.jsx(c_,{size:"sm",variant:"destructive","aria-label":"Cancel",onClick:t,className:"h-8",children:l.jsx(re,{className:"icon-md","aria-hidden":"true"})}),l.jsx(c_,{size:"sm",variant:"submit","aria-label":"Save changes",onClick:s,className:"h-8 rounded-b-lg rounded-tr-xl",children:l.jsx(se,{className:"icon-md","aria-hidden":"true"})})]})]}),o&&o.length>0&&l.jsx("div",{className:"flex flex-wrap items-center gap-2 p-2",children:o.map(e=>l.jsx("div",{className:"badge-icon",children:l.jsx(uj,{icon:e.icon,label:e.label,isAvailable:!1,isEditing:!0,onBadgeAction:()=>i(e.id)})},e.id))})]}):null}),RI=n.forwardRef(({icon:e,label:t,setValue:s,className:a,checked:r,defaultChecked:o,isCheckedClassName:i},c)=>{const d=Rn(),u=J(d,e=>null==e?void 0:e.value);return n.useEffect(()=>{void 0!==r&&d.setValue(r)},[r,d]),n.useEffect(()=>{void 0!==o&&void 0===r&&d.setValue(o)},[o,r,d]),l.jsxs(Wt,{ref:c,store:d,onChange:e=>{e.stopPropagation(),"boolean"==typeof u&&(null==s||s({e:e,isChecked:!u}))},className:Op("group relative inline-flex items-center justify-center gap-1.5","rounded-full border border-border-medium text-sm font-medium","size-9 p-2 transition-all md:w-full md:p-3","bg-transparent shadow-sm hover:bg-surface-hover hover:shadow-md active:shadow-inner",u&&i&&i,a),render:l.jsx("button",{type:"button","aria-label":t}),children:[e&&l.jsx("span",{className:"icon-md text-text-primary",children:e}),l.jsx("span",{className:"hidden truncate md:block",children:t})]})});RI.displayName="CheckboxButton";const II=n.memo(function(){const e=zf(),{codeInterpreter:t,codeApiKeyForm:n}=xv(),{toggleState:s,debouncedChange:a,isPinned:r}=t,{badgeTriggerRef:o}=n;return Zv({permissionType:bd.RUN_CODE,permission:yd.USE})?(s||r)&&l.jsx(RI,{ref:o,className:"max-w-fit",checked:s,setValue:a,label:e("com_assistants_code_interpreter"),isCheckedClassName:"border-purple-600/40 bg-purple-500/10 hover:bg-purple-700/10",icon:l.jsx(V,{className:"icon-md"})}):null}),EI=m.memo(({mcpValues:e,isMCPPinned:t,mcpServerNames:n,setIsMCPPinned:s,handleMCPToggle:a,placeholder:r,...o})=>{const i=zf(),c=Se({focusLoop:!0,showTimeout:100,placement:"right"});return l.jsxs(Te,{store:c,children:[l.jsxs(Me,{...o,render:l.jsx(Qe,{onClick:e=>{e.stopPropagation(),c.toggle()},className:"flex w-full cursor-pointer items-center justify-between rounded-lg p-2 hover:bg-surface-hover"}),children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Ay,{className:"icon-md"}),l.jsx("span",{children:r||i("com_ui_mcp_servers")}),l.jsx(te,{className:"ml-auto h-3 w-3"})]}),l.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),s(!t)},className:Op("rounded p-1 transition-all duration-200","hover:bg-surface-tertiary hover:shadow-sm",!t&&"text-text-secondary hover:text-text-primary"),"aria-label":t?"Unpin":"Pin",children:l.jsx("div",{className:"h-4 w-4",children:l.jsx(my,{unpin:t})})})]}),l.jsx(Ie,{portal:!0,unmountOnHide:!0,className:Op("animate-popover-left z-50 ml-3 flex min-w-[200px] flex-col rounded-xl","border border-border-light bg-surface-secondary p-1 shadow-lg"),children:n.map(t=>l.jsxs(Me,{onClick:e=>{e.preventDefault(),a(t)},className:Op("flex items-center gap-2 rounded-lg px-2 py-1.5 text-text-primary hover:cursor-pointer","scroll-m-1 outline-none transition-colors","hover:bg-black/[0.075] dark:hover:bg-white/10","data-[active-item]:bg-black/[0.075] dark:data-[active-item]:bg-white/10","w-full min-w-0 text-sm"),children:[l.jsx(In,{checked:(null==e?void 0:e.includes(t))??!1}),l.jsx("span",{children:t})]},t))})]})}),MI=m.memo(({disabled:e})=>{var t,s;const a=zf(),r=e??!1,[o,i]=n.useState(!1),{webSearch:c,mcpSelect:d,fileSearch:u,startupConfig:m,codeApiKeyForm:p,codeInterpreter:h,searchApiKeyForm:x}=xv(),{setIsDialogOpen:f,menuTriggerRef:g}=p,{setIsDialogOpen:v,menuTriggerRef:b}=x,{isPinned:y,setIsPinned:_,authData:j}=c,{isPinned:w,setIsPinned:N,authData:C}=h,{isPinned:k,setIsPinned:S}=u,{mcpValues:T,mcpServerNames:R,isPinned:I,setIsPinned:E}=d,M=Zv({permissionType:bd.WEB_SEARCH,permission:yd.USE}),P=Zv({permissionType:bd.RUN_CODE,permission:yd.USE}),L=n.useMemo(()=>{const e=(null==j?void 0:j.authTypes)??[];return 0===e.length||!e.every(([,e])=>e===fi.SYSTEM_DEFINED)},[null==j?void 0:j.authTypes]),A=n.useMemo(()=>(null==C?void 0:C.message)!==fi.SYSTEM_DEFINED,[null==C?void 0:C.message]),O=n.useCallback(()=>{const e=!c.toggleState;c.debouncedChange({isChecked:e})},[c]),D=n.useCallback(()=>{const e=!h.toggleState;h.debouncedChange({isChecked:e})},[h]),z=n.useCallback(()=>{const e=!u.toggleState;u.debouncedChange({isChecked:e})},[u]),F=n.useCallback(e=>{const t=d.mcpValues??[],n=t.includes(e)?t.filter(t=>t!==e):[...t,e];d.setMCPValues(n)},[d]),$=null==(s=null==(t=null==m?void 0:m.interface)?void 0:t.mcpServers)?void 0:s.placeholder,B=n.useMemo(()=>{const e=[];return e.push({onClick:z,hideOnClick:!1,render:e=>l.jsxs("div",{...e,children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Oy,{className:"icon-md"}),l.jsx("span",{children:a("com_assistants_file_search")})]}),l.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),S(!k)},className:Op("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm",!k&&"text-text-secondary hover:text-text-primary"),"aria-label":k?"Unpin":"Pin",children:l.jsx("div",{className:"h-4 w-4",children:l.jsx(my,{unpin:k})})})]})}),M&&e.push({onClick:O,hideOnClick:!1,render:e=>l.jsxs("div",{...e,children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Lt,{className:"icon-md"}),l.jsx("span",{children:a("com_ui_web_search")})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[L&&l.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),v(!0)},className:Op("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm","text-text-secondary hover:text-text-primary"),"aria-label":"Configure web search",ref:b,children:l.jsx("div",{className:"h-4 w-4",children:l.jsx(En,{className:"h-4 w-4"})})}),l.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),_(!y)},className:Op("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm",!y&&"text-text-secondary hover:text-text-primary"),"aria-label":y?"Unpin":"Pin",children:l.jsx("div",{className:"h-4 w-4",children:l.jsx(my,{unpin:y})})})]})]})}),P&&e.push({onClick:D,hideOnClick:!1,render:e=>l.jsxs("div",{...e,children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(V,{className:"icon-md"}),l.jsx("span",{children:a("com_assistants_code_interpreter")})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[A&&l.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),f(!0)},ref:g,className:Op("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm","text-text-secondary hover:text-text-primary"),"aria-label":"Configure code interpreter",children:l.jsx("div",{className:"h-4 w-4",children:l.jsx(En,{className:"h-4 w-4"})})}),l.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),N(!w)},className:Op("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm",!w&&"text-text-primary hover:text-text-primary"),"aria-label":w?"Unpin":"Pin",children:l.jsx("div",{className:"h-4 w-4",children:l.jsx(my,{unpin:w})})})]})]})}),R&&R.length>0&&e.push({hideOnClick:!1,render:e=>l.jsx(EI,{...e,mcpValues:T,isMCPPinned:I,placeholder:$,mcpServerNames:R,setIsMCPPinned:E,handleMCPToggle:F})}),e},[a,T,P,I,w,$,R,y,E,M,N,F,A,_,k,g,f,b,L,S,O,v,z,D]),U=l.jsx(rj,{render:l.jsx(Qe,{disabled:r,id:"tools-dropdown-button","aria-label":"Tools Options",className:Op("flex size-9 items-center justify-center rounded-full p-1 transition-colors hover:bg-surface-hover focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50"),children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:l.jsx(yn,{className:"icon-md"})})}),id:"tools-dropdown-button",description:a("com_ui_tools"),disabled:r});return l.jsx(kj,{itemClassName:"flex w-full cursor-pointer items-center justify-between hover:bg-surface-hover gap-5",menuId:"tools-dropdown-menu",isOpen:o,setIsOpen:i,modal:!0,unmountOnHide:!0,trigger:U,items:B,iconClassName:"mr-0"})});function PI(){const{webSearch:e,codeInterpreter:t,searchApiKeyForm:s,codeApiKeyForm:a}=xv(),{authData:r}=e,{authData:o}=t,{methods:i,onSubmit:c,isDialogOpen:d,setIsDialogOpen:u,handleRevokeApiKey:m,badgeTriggerRef:p,menuTriggerRef:h}=s,{methods:x,onSubmit:f,isDialogOpen:g,setIsDialogOpen:v,handleRevokeApiKey:b,badgeTriggerRef:y,menuTriggerRef:_}=a,j=n.useMemo(()=>(null==r?void 0:r.authTypes)??[],[null==r?void 0:r.authTypes]),w=n.useMemo(()=>(null==o?void 0:o.message)??!1,[null==o?void 0:o.message]);return l.jsxs(l.Fragment,{children:[l.jsx(kT,{onSubmit:c,authTypes:j,isOpen:d,onRevoke:m,register:i.register,onOpenChange:u,handleSubmit:i.handleSubmit,triggerRefs:[h,p],isToolAuthenticated:(null==r?void 0:r.authenticated)??!1}),l.jsx(lC,{onSubmit:f,isOpen:g,onRevoke:b,register:x.register,onOpenChange:v,handleSubmit:x.handleSubmit,triggerRefs:[_,y],isUserProvided:w===fi.USER_PROVIDED,isToolAuthenticated:(null==o?void 0:o.authenticated)??!1})]})}const LI=n.memo(function(){const e=zf(),{fileSearch:t}=xv(),{toggleState:n,debouncedChange:s,isPinned:a}=t;return l.jsx(l.Fragment,{children:(n||a)&&l.jsx(RI,{className:"max-w-fit",checked:n,setValue:s,label:e("com_assistants_file_search"),isCheckedClassName:"border-gray-600/40 bg-gray-500/10 hover:bg-gray-700/10",icon:l.jsx(Oy,{className:"icon-md"})})})});function AI({isOpen:e,onOpenChange:t,fieldsSchema:s,initialValues:a,onSave:r,isSubmitting:o=!1,onRevoke:i,serverName:c}){const d=zf(),{control:u,handleSubmit:m,reset:p,formState:{errors:h,_:x}}=Rr({defaultValues:a});n.useEffect(()=>{e&&p(a)},[e,a,p]);const f=e=>{r(e)},g=d("com_ui_configure_mcp_variables_for",{0:c}),v=d("com_ui_mcp_dialog_desc");return l.jsx(A_,{open:e,onOpenChange:t,children:l.jsx(Oj,{className:"sm:max-w-lg",title:g,description:v,headerClassName:"px-6 pt-6 pb-4",main:l.jsx("form",{onSubmit:m(f),className:"space-y-4 px-6 pb-2",children:Object.entries(s).map(([e,t])=>{var n;return l.jsxs("div",{className:"space-y-2",children:[l.jsx(L_,{htmlFor:e,className:"text-sm font-medium",children:t.title}),l.jsx(Ir,{name:e,control:u,defaultValue:a[e]||"",render:({field:n})=>l.jsx(M_,{id:e,type:"text",...n,placeholder:d("com_ui_mcp_enter_var",{0:t.title}),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white sm:text-sm"})}),t.description&&l.jsx("p",{className:"text-xs text-text-secondary [&_a]:text-gray-600 [&_a]:hover:text-gray-700 dark:[&_a]:text-gray-400 dark:[&_a]:hover:text-gray-300",dangerouslySetInnerHTML:{__html:t.description}}),h[e]&&l.jsx("p",{className:"text-xs text-gray-600",children:null==(n=h[e])?void 0:n.message})]},e)})}),selection:{selectHandler:m(f),selectClasses:"bg-white hover:bg-gray-100 text-black dark:bg-gray-800 dark:hover:bg-gray-700 dark:text-white border border-gray-300 dark:border-gray-600",selectText:d(o?"com_ui_saving":"com_ui_save")},buttons:i&&l.jsx(c_,{onClick:()=>{i&&i()},className:"bg-gray-700 text-white hover:bg-gray-800 dark:hover:bg-gray-900",disabled:o,children:d("com_ui_revoke")}),footerClassName:"flex justify-end gap-2 px-6 pb-6 pt-2",showCancelButton:!0})})}function OI(e,t){return 0===e.length?t||"Select...":1===e.length?e[0]:`${e.length} items selected`}function DI({items:e,label:t,placeholder:s="Select...",defaultSelectedValues:a=[],onSelectedValuesChange:r,renderSelectedValues:o=OI,className:i,selectIcon:c,itemClassName:d,labelClassName:u,selectClassName:m,popoverClassName:p,selectItemsClassName:h,selectedValues:x=[],setSelectedValues:f,renderItemContent:g}){const v=n.useRef(null);return l.jsx("div",{className:i,children:l.jsxs(Mn,{value:x,setValue:e=>{f(e),r&&r(e)},children:[t&&l.jsx(lt,{className:Op("mb-1 block text-sm text-text-primary",u),children:t}),l.jsxs(we,{ref:v,className:Op("flex items-center justify-between gap-2 rounded-xl px-3 py-2 text-sm","bg-surface-tertiary text-text-primary shadow-sm hover:cursor-pointer hover:bg-surface-hover","outline-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75",m,x.length>0&&null!=h&&h),onChange:e=>e.stopPropagation(),children:[c&&c,l.jsx("span",{className:"mr-auto hidden truncate md:block",children:o(x,s)}),l.jsx(Ne,{className:"ml-1 hidden stroke-1 text-base opacity-75 md:block"})]}),l.jsx(Ce,{gutter:4,sameWidth:!0,modal:!0,unmountOnHide:!0,finalFocus:v,className:Op("animate-popover z-50 flex max-h-[300px]","flex-col overflow-auto overscroll-contain rounded-xl","bg-surface-secondary px-1.5 py-1 text-text-primary shadow-lg","border border-border-light","outline-none",p),children:e.map(e=>{const t=l.jsxs(l.Fragment,{children:[l.jsx(Pn,{className:"text-primary"}),l.jsx("span",{className:"truncate",children:e})]}),n=x.includes(e);return l.jsx(ke,{value:e,className:Op("flex items-center gap-2 rounded-lg px-2 py-1.5 hover:cursor-pointer","scroll-m-1 outline-none transition-colors","hover:bg-black/[0.075] dark:hover:bg-white/10","data-[active-item]:bg-black/[0.075] dark:data-[active-item]:bg-white/10","w-full min-w-0 text-sm",d),children:g?g(e,t,n):t},e)})})]})})}const zI=e=>{const t=e.split(Zc.mcp_delimiter);return Zc.mcp_prefix+t[t.length-1]},FI=(e,t)=>{if(t)try{if(((null==t?void 0:t.trim())??"").length>2)return!0}catch(n){console.error(n)}return Array.isArray(e)&&e.length>0};const VI=n.memo(function({conversationId:e}){const t=zf(),{showToast:s}=Of(),a=e??Zc.NEW_CONVO,r=n.useRef(null),[o,i]=n.useState(!1),[c,d]=n.useState(null),{data:u,isFetched:m}=Xx(vi.agents,{select:e=>{const t=new Map;return e.forEach(e=>{if(e.pluginKey.includes(Zc.mcp_delimiter)&&!1!==e.chatMenu){const n=e.pluginKey.split(Zc.mcp_delimiter),s=n[n.length-1];t.has(s)||t.set(s,{name:s,pluginKey:e.pluginKey,authConfig:e.authConfig,authenticated:e.authenticated})}}),Array.from(t.values())}}),p=Xf({onSuccess:()=>{i(!1),s({message:t("com_nav_mcp_vars_updated"),status:"success"})},onError:e=>{console.error("Error updating MCP auth:",e),s({message:t("com_nav_mcp_vars_update_error"),status:"error"})}}),[h,x]=b(tx(a)),f=n.useMemo(()=>(null==h?void 0:h.mcp)??[],[null==h?void 0:h.mcp]),g=n.useCallback(e=>{e&&Array.isArray(e)&&x(t=>({...t,mcp:e}))},[x]),[v,y]=fb(`${Jc.LAST_MCP_}${a}`,f,g,FI);n.useEffect(()=>{r.current!==a&&m&&(r.current=a,((null==u?void 0:u.length)??0)>0?y(v.filter(e=>null==u?void 0:u.some(t=>t.name===e))):y([]))},[m,y,u,a,v]);const _=n.useCallback((e,n)=>0===e.length?n||t("com_ui_select")+"...":1===e.length?e[0]:t("com_ui_x_selected",{0:e.length}),[t]),j=n.useMemo(()=>(u??[]).map(e=>e.name),[u]),w=n.useCallback((e,t)=>{if(c&&c.name===e){const e={pluginKey:zI(c.pluginKey),action:"install",auth:t};p.mutate(e)}},[c,p]),N=n.useCallback(e=>{if(c&&c.name===e){const e={pluginKey:zI(c.pluginKey),action:"uninstall",auth:{}};p.mutate(e)}},[c,p]),C=n.useCallback((e,t)=>{const n=null==u?void 0:u.find(t=>t.name===e),s=(null==n?void 0:n.authConfig)&&n.authConfig.length>0,a=l.jsx("div",{className:"flex flex-grow items-center",children:t});return n&&s?l.jsxs("div",{className:"flex w-full items-center justify-between",children:[a,l.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),e.preventDefault(),d(n),i(!0)},className:"ml-2 flex h-6 w-6 items-center justify-center rounded p-1 hover:bg-black/10 dark:hover:bg-white/10","aria-label":`Configure ${e}`,children:l.jsx(yn,{className:"h-4 w-4 "+(n.authenticated?"text-black dark:text-white":"")})})]}):a},[u,d,i]);return u&&0!==u.length?l.jsxs(l.Fragment,{children:[l.jsx(DI,{items:j,selectedValues:v??[],setSelectedValues:y,defaultSelectedValues:v??[],renderSelectedValues:_,renderItemContent:C,placeholder:t("com_ui_mcp_servers"),popoverClassName:"min-w-fit",className:"badge-icon min-w-fit",selectIcon:l.jsx(Ay,{className:"icon-md text-text-primary"}),selectItemsClassName:"border border-blue-600/50 bg-blue-500/10 hover:bg-blue-700/10",selectClassName:"group relative inline-flex items-center justify-center md:justify-start gap-1.5 rounded-full border border-border-medium text-sm font-medium transition-all md:w-full size-9 p-2 md:p-3 bg-transparent shadow-sm hover:bg-surface-hover hover:shadow-md active:shadow-inner"}),c&&l.jsx(AI,{isOpen:o,onOpenChange:i,serverName:c.name,fieldsSchema:(()=>{const e={};return(null==c?void 0:c.authConfig)&&c.authConfig.forEach(t=>{e[t.authField]={title:t.label,description:t.description}}),e})(),initialValues:(()=>{const e={};return(null==c?void 0:c.authConfig)&&c.authConfig.forEach(t=>{e[t.authField]=""}),e})(),onSave:e=>{c&&w(c.name,e)},onRevoke:()=>{c&&N(c.name)},isSubmitting:p.isLoading})]}):null});const $I=n.memo(function(){const e=zf(),{webSearch:t,searchApiKeyForm:n}=xv(),{toggleState:s,debouncedChange:a,isPinned:r}=t,{badgeTriggerRef:o}=n;return Zv({permissionType:bd.WEB_SEARCH,permission:yd.USE})?(s||r)&&l.jsx(RI,{ref:o,className:"max-w-fit",checked:s,setValue:a,label:e("com_ui_search"),isCheckedClassName:"border-blue-600/40 bg-blue-500/10 hover:bg-blue-700/10",icon:l.jsx(Lt,{className:"icon-md"})}):null}),BI=m.memo(n.forwardRef(({badge:e,isEditing:t,isInChat:n,onToggle:s,onDelete:a,onMouseDown:r,badgeRefs:o},i)=>{const c=_(e.atom),d=!!e.atom&&c;return l.jsx("div",{ref:t=>{t&&(o.current[e.id]=t),"function"==typeof i?i(t):i&&(i.current=t)},onMouseDown:t=>r(t,e,d),className:t?"ios-wiggle badge-icon h-full":"badge-icon h-full",children:l.jsx(uj,{id:e.id,icon:e.icon,label:e.label,isActive:d,isEditing:t,isAvailable:e.isAvailable,isInChat:n,onToggle:()=>s(e),onBadgeAction:()=>a(e.id)})})}),(e,t)=>e.badge.id===t.badge.id&&e.isEditing===t.isEditing&&e.isInChat===t.isInChat&&e.onToggle===t.onToggle&&e.onDelete===t.onDelete&&e.onMouseDown===t.onMouseDown&&e.badgeRefs===t.badgeRefs);BI.displayName="BadgeWrapper";const UI=(e,t)=>{switch(t.type){case"START_DRAG":return{draggedBadge:t.badge,mouseX:t.mouseX,offsetX:t.offsetX,insertIndex:t.insertIndex,draggedBadgeActive:t.isActive};case"UPDATE_POSITION":return{...e,mouseX:t.mouseX,insertIndex:t.insertIndex};case"END_DRAG":return{draggedBadge:null,mouseX:0,offsetX:0,insertIndex:null,draggedBadgeActive:!1};default:return e}};const HI=n.memo(function({showEphemeralBadges:e,conversationId:t,onChange:s,onToggle:a,isInChat:r}){var o;const[i,c]=n.useState([]),[d,u]=n.useReducer(UI,{draggedBadge:null,mouseX:0,offsetX:0,insertIndex:null,draggedBadgeActive:!1}),p=n.useRef({}),h=n.useRef(null),x=n.useRef(null),f=n.useRef(null),g=Eg(),b=_(sx.isEditingBadges),y=n.useMemo(()=>g.filter(e=>!1!==e.isAvailable),[g]),j=v(({snapshot:e,set:t})=>async n=>{const s=await e.getPromise(n);t(n,!s)},[]);n.useEffect(()=>{c(e=>{const t=new Set(e.map(e=>e.id)),n=y.filter(e=>!t.has(e.id));return n.length>0?[...e,...n]:e})},[y]);const w=d.draggedBadge?i.filter(e=>{var t;return e.id!==(null==(t=d.draggedBadge)?void 0:t.id)}):i,N=d.draggedBadge||null,C=n.useCallback(e=>{if(!d.draggedBadge||!h.current||!f.current)return 0;const t=e-f.current.left,n=w.map(e=>p.current[e.id]).filter(Boolean);if(0===n.length)return 0;let s=0;for(let a=0;a<n.length;a++){const e=n[a].getBoundingClientRect();if(t<e.left-f.current.left+e.width/2)break;s=a+1}return s},[d.draggedBadge,w]),k=n.useCallback((e,t,n)=>{if(!b||!h.current)return;const s=p.current[t.id];if(!s)return;const a=s.getBoundingClientRect(),r=e.clientX-a.left,o=e.clientX,l=i.findIndex(e=>e.id===t.id);f.current=h.current.getBoundingClientRect(),u({type:"START_DRAG",badge:t,mouseX:o,offsetX:r,insertIndex:l,isActive:n})},[b,i]),S=n.useCallback(e=>{d.draggedBadge&&(x.current&&cancelAnimationFrame(x.current),x.current=requestAnimationFrame(()=>{const t=e.clientX,n=C(t);n!==d.insertIndex?u({type:"UPDATE_POSITION",mouseX:t,insertIndex:n}):u({type:"UPDATE_POSITION",mouseX:t,insertIndex:d.insertIndex})}))},[d.draggedBadge,d.insertIndex,C]),T=n.useCallback(()=>{if(d.draggedBadge&&null!==d.insertIndex){const e=i.filter(e=>{var t;return e.id!==(null==(t=d.draggedBadge)?void 0:t.id)}),t=[...e.slice(0,d.insertIndex),d.draggedBadge,...e.slice(d.insertIndex)];c(t),s(t.map(e=>({id:e.id})))}u({type:"END_DRAG"}),f.current=null},[d.draggedBadge,d.insertIndex,i,s]),R=n.useCallback(e=>{const t=i.filter(t=>t.id!==e);c(t),s(t.map(e=>({id:e.id})))},[i,s]),I=n.useCallback(e=>{e.atom&&j(e.atom),a&&a(e.id,!!e.atom)},[j,a]);return n.useEffect(()=>{if(d.draggedBadge)return document.addEventListener("mousemove",S),document.addEventListener("mouseup",T),()=>{document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",T),x.current&&(cancelAnimationFrame(x.current),x.current=null)}},[d.draggedBadge,S,T]),l.jsxs(fv,{conversationId:t,children:[l.jsxs("div",{ref:h,className:"relative flex flex-wrap items-center gap-2",children:[!0===e&&l.jsx(MI,{}),w.map((e,t)=>l.jsxs(m.Fragment,{children:[d.draggedBadge&&d.insertIndex===t&&N&&l.jsx("div",{className:"badge-icon h-full",children:l.jsx(uj,{id:N.id,icon:N.icon,label:N.label,isActive:d.draggedBadgeActive,isEditing:b,isAvailable:N.isAvailable,isInChat:r})}),l.jsx(BI,{badge:e,isEditing:b,isInChat:r,onToggle:I,onDelete:R,onMouseDown:k,badgeRefs:p})]},e.id)),d.draggedBadge&&d.insertIndex===w.length&&N&&l.jsx("div",{className:"badge-icon h-full",children:l.jsx(uj,{id:N.id,icon:N.icon,label:N.label,isActive:d.draggedBadgeActive,isEditing:b,isAvailable:N.isAvailable,isInChat:r})}),!0===e&&l.jsxs(l.Fragment,{children:[l.jsx($I,{}),l.jsx(II,{}),l.jsx(LI,{}),l.jsx(VI,{})]}),N&&l.jsx("div",{className:"ghost-badge h-full",style:{position:"absolute",top:0,left:0,transform:`translateX(${d.mouseX-d.offsetX-((null==(o=f.current)?void 0:o.left)||0)}px)`,zIndex:10,pointerEvents:"none"},children:l.jsx(uj,{id:N.id,icon:N.icon,label:N.label,isActive:d.draggedBadgeActive,isAvailable:N.isAvailable,isInChat:r,isEditing:!0,isDragging:!0})})]}),l.jsx(PI,{})]})});function KI({presets:e,modelSpecs:t,assistantsMap:s,endpointsConfig:a,newConversation:r,returnHandlers:o}){const{conversation:i}=rg(),l=sg(),c=_(sx.modularChat),d=_(sx.availableTools),u=n.useCallback(e=>{var t,n;if(!e)return;const{preset:o}=e;o.iconURL=jp(e),o.spec=e.name;const{endpoint:d}=o,u=d??"";if(!u)return;const{template:m,shouldSwitch:p,isNewModular:h,newEndpointType:x,isCurrentModular:f,isExistingConversation:g}=bp({newEndpoint:u,modularChat:c,conversation:i,endpointsConfig:a});x&&(o.endpointType=x),ji(u)&&null!=o.assistant_id&&!o.model&&(o.model=null==(n=null==(t=null==s?void 0:s[u])?void 0:t[o.assistant_id])?void 0:n.model);const v=f&&h&&p;if(g&&v){m.endpointType=x;const e=l({conversation:{...i??{},endpointType:m.endpointType},preset:m,cleanOutput:!0});return Dp.info("conversation","Switching conversation to new spec (modular)",i),void r({template:e,preset:o,keepLatestMessage:!0,keepAddedConvos:!0})}Dp.info("conversation","Switching conversation to new spec",i),r({template:{...m},preset:o,keepAddedConvos:v})},[i,l,c,r,a,s]),m=n.useCallback((e,t={})=>{const n=e??"";if(!n)return;const{shouldSwitch:s,isNewModular:o,isCurrentModular:d,isExistingConversation:u,newEndpointType:m,template:p}=bp({newEndpoint:n,modularChat:c,conversation:i,endpointsConfig:a}),h=t.model??"";h&&(p.model=h);const x=t.assistant_id??"";x&&(p.assistant_id=x);const f=t.agent_id??"";if(f&&(p.agent_id=f),p.spec=null,p.iconURL=null,p.modelLabel=null,u&&d&&o&&s){p.endpointType=m;const e=l({conversation:{...i??{},spec:null,iconURL:null,modelLabel:null,endpointType:p.endpointType},preset:p});return Dp.info("conversation","Switching conversation to new endpoint/model (modular)",e),void r({template:e,preset:e,keepLatestMessage:!0,keepAddedConvos:!0})}Dp.info("conversation","Switching conversation to new endpoint/model",p),r({template:{...p},preset:{...t,spec:null,iconURL:null,modelLabel:null,endpoint:n},keepAddedConvos:o})},[i,l,c,r,a]),p=n.useCallback(e=>{if(!e)return;const t=rp(e,d),n=t.endpoint??"",{template:s,shouldSwitch:o,isNewModular:u,newEndpointType:m,isCurrentModular:p,isExistingConversation:h}=bp({newEndpoint:n,modularChat:c,conversation:i,endpointsConfig:a});t.spec=null,t.iconURL=t.iconURL??null,t.modelLabel=t.modelLabel??null;const x=p&&u&&o,f=!0===t.defaultPreset;if(h&&x){s.endpointType=m,s.spec=null,s.iconURL=null,s.modelLabel=null;const e=l({conversation:{...i??{},endpointType:s.endpointType},preset:s,cleanInput:!0});return Dp.info("conversation","Switching conversation to new preset (modular)",e),void r({template:e,preset:t,keepLatestMessage:!0,keepAddedConvos:!0,disableParams:f})}Dp.info("conversation","Switching conversation to new preset",s),r({preset:t,keepAddedConvos:x,disableParams:f})},[c,i,d,r,a,l]),h=n.useCallback(n=>{var a,r;const o=n.value;if("preset"===n.type){const t=null==e?void 0:e.find(e=>e.presetId===o);p(t)}else if("modelSpec"===n.type){const e=t.find(e=>e.name===o);u(e)}else"model"===n.type?m(o,{model:n.label}):"endpoint"===n.type?m(o):ji(n.type)?m(n.type,{assistant_id:o,model:(null==(r=null==(a=null==s?void 0:s[n.type])?void 0:a[o])?void 0:r.model)??""}):wi(n.type)&&m(n.type,{agent_id:o})},[t,m,p,u,e,s]);return o?{onSelectSpec:u,onSelectEndpoint:m}:{onSelectMention:h}}const GI=Pc().interface,WI=({endpoint:e,assistantMap:t,endpointsConfig:n})=>({id:s,name:a,description:r})=>({type:e,label:a??"",value:s,description:r??"",icon:Qw({conversation:{assistant_id:s,endpoint:e},endpointsConfig:n,context:"menu-item",assistantMap:t})});function qI({setShowMentionPopover:e,newConversation:t,textAreaRef:s,commandChar:a="@",placeholder:r="com_ui_mention",includeAssistants:o=!0}){const i=zf(),c=sv(),{options:d,presets:u,modelSpecs:m,agentsList:p,modelsConfig:h,endpointsConfig:x,assistantListMap:f}=function({assistantMap:e,includeAssistants:t}){const s=Zv({permissionType:bd.AGENTS,permission:yd.USE}),{data:a}=Qx(),{data:r}=Gf(),{data:o}=Sx(),{data:i}=kx(),{data:l=[]}=kx({select:gp}),c=ig(e=>e.data.map(({id:e,name:t,description:n})=>({id:e,name:t,description:n}))),d=n.useMemo(()=>(null==o?void 0:o.interface)??GI,[null==o?void 0:o.interface]),{data:u=null}=gx(void 0,{enabled:s&&!0===d.modelSelect,select:e=>{const{data:t}=e;return t.map(({id:e,name:t,avatar:n})=>({value:e,label:t??"",type:vi.agents,icon:Qw({conversation:{endpoint:vi.agents,iconURL:null==n?void 0:n.filepath},endpointsConfig:i,context:"menu-item"})}))}}),m=n.useMemo(()=>{var t,n;return{[vi.assistants]:null==(t=c[vi.assistants])?void 0:t.map(WI({endpoint:vi.assistants,assistantMap:e,endpointsConfig:i})).filter(Boolean),[vi.azureAssistants]:null==(n=c[vi.azureAssistants])?void 0:n.map(WI({endpoint:vi.azureAssistants,assistantMap:e,endpointsConfig:i})).filter(Boolean)}},[c,e,i]),p=n.useMemo(()=>{var e;return(null==(e=null==o?void 0:o.modelSpecs)?void 0:e.list)??[]},[o]);return{options:n.useMemo(()=>{var n;let s=l;t||(s=l.filter(e=>!ji(e)));const o=s.flatMap(e=>ji(e)||wi(e)||!0!==d.modelSelect?[]:((null==r?void 0:r[e])??[]).map(t=>({value:e,label:t,type:"model",icon:Qw({conversation:{endpoint:e,model:t},endpointsConfig:i,context:"menu-item"})})));return[...(p.length>0?p:[]).map(e=>({value:e.name,label:e.label,description:e.description,icon:Qw({conversation:{...e.preset,iconURL:e.iconURL},endpointsConfig:i,context:"menu-item"}),type:"modelSpec"})),...(!0===d.modelSelect?s:[]).map(e=>({value:e,label:Oc[e]??e??"",type:"endpoint",icon:Qw({conversation:{endpoint:e},endpointsConfig:i,context:"menu-item"})})),...!0===d.modelSelect?u??[]:[],...(null==i?void 0:i[vi.assistants])&&t&&!0===d.modelSelect&&m[vi.assistants]||[],...(null==i?void 0:i[vi.azureAssistants])&&t&&!0===d.modelSelect&&m[vi.azureAssistants]||[],...(null==(n=!0===d.modelSelect&&!0===d.presets?a:[])?void 0:n.map((t,n)=>({value:t.presetId??`preset-${n}`,label:t.title??t.modelLabel??t.chatGptLabel??"",description:ap(t,!0),icon:Qw({conversation:t,endpointsConfig:i,context:"menu-item",assistantMap:e}),type:"preset"})))??[],...o]},[a,l,p,u,e,r,i,m,t,d.presets,d.modelSelect]),presets:a,modelSpecs:p,agentsList:u,modelsConfig:r,endpointsConfig:i,assistantListMap:m}}({assistantMap:c||{},includeAssistants:o}),{onSelectMention:g}=KI({presets:u,modelSpecs:m,assistantsMap:c,endpointsConfig:x,newConversation:t}),[v,b]=n.useState(0),y=n.useRef(null),_=n.useRef(null),[j,w]=n.useState(d),{open:N,setOpen:C,searchValue:k,setSearchValue:S,matches:T}=Kv({value:"",options:j}),R=t=>{var n,r,o,i;if(!t)return;if("endpoint"===t.type&&t.value===vi.agents)S(""),w(p??[]),b(0),null==(n=_.current)||n.focus();else if("endpoint"===t.type&&t.value===vi.assistants)S(""),w(f[vi.assistants]??[]),b(0),null==(r=_.current)||r.focus();else if("endpoint"===t.type&&t.value===vi.azureAssistants)S(""),w(f[vi.azureAssistants]??[]),b(0),null==(o=_.current)||o.focus();else if("endpoint"===t.type){const e=((null==h?void 0:h[t.value||""])??[]).map(e=>({value:t.value,label:e,type:"model"}));b(0),S(""),w(e),null==(i=_.current)||i.focus()}else S(""),C(!1),e(!1),null==g||g(t),s.current&&dp(s.current,a)};n.useEffect(()=>{N||(w(d),b(0))},[N,d]),n.useEffect(()=>()=>{y.current&&clearTimeout(y.current)},[]);const I="@"!==a?"add-convo":"mention";n.useEffect(()=>{const e=document.getElementById(`${I}-item-${v}`);null==e||e.scrollIntoView({behavior:"instant",block:"nearest"})},[I,v]);const E=({index:e,key:t,style:n})=>{const s=T[e];return l.jsx(gI,{type:I,index:e,style:n,onClick:e=>{e.preventDefault(),e.stopPropagation(),y.current&&clearTimeout(y.current),y.current=null,R(s)},name:s.label??"",icon:s.icon,description:s.description,isActive:e===v},t)};return l.jsx("div",{className:"absolute bottom-28 z-10 w-full space-y-2",children:l.jsxs("div",{className:"popover border-token-border-light rounded-2xl border bg-white p-2 shadow-lg dark:bg-gray-700",children:[l.jsx("input",{autoFocus:!0,ref:_,placeholder:i(r),className:"mb-1 w-full border-0 bg-white p-2 text-sm focus:outline-none dark:bg-gray-700 dark:text-gray-200",autoComplete:"off",value:k,onKeyDown:t=>{var n,a;if("Escape"===t.key&&(C(!1),e(!1),null==(n=s.current)||n.focus()),"ArrowDown"===t.key)b(e=>(e+1)%T.length);else if("ArrowUp"===t.key)b(e=>(e-1+T.length)%T.length);else if("Enter"===t.key||"Tab"===t.key){const e=T[v];("endpoint"===(null==e?void 0:e.type)||"Enter"===t.key)&&t.preventDefault(),R(T[v])}else"Backspace"===t.key&&""===k&&(C(!1),e(!1),null==(a=s.current)||a.focus())},onChange:e=>S(e.target.value),onFocus:()=>C(!0),onBlur:()=>{y.current=setTimeout(()=>{C(!1),e(!1)},150)}}),N&&l.jsx("div",{className:"max-h-40",children:l.jsx(To,{disableHeight:!0,children:({width:e})=>l.jsx(Ro,{width:e,overscanRowCount:5,rowHeight:40,rowCount:T.length,rowRenderer:E,scrollToIndex:v,height:Math.min(40*T.length,160)})})})]})})}const QI=n.memo(({index:e=0})=>{var t;const s=n.useRef(null),a=n.useRef(null);!function(e){var t;const s=N(),a=k();n.useEffect(()=>{var t,n,r;(null==e?void 0:e.current)&&(null==(t=s.state)?void 0:t.focusChat)&&(Dp.log("conversation",`Focusing textarea on location state change: ${s.pathname}`),(null==(n=window.matchMedia)?void 0:n.call(window,"(pointer: coarse)").matches)||null==(r=e.current)||r.focus(),a(`${s.pathname}${window.location.search??""}`,{replace:!0,state:{}}))},[a,e,s.pathname,null==(t=s.state)?void 0:t.focusChat])}(a);const[r,o]=n.useState(!1),[,i]=n.useState(!1),[c,d]=n.useState(1),[u,m]=n.useState(!1),[p,h]=n.useState([]),x=_(sx.speechToText),f=_(sx.textToSpeech),g=_(sx.chatDirection),v=_(sx.automaticPlayback),j=_(sx.maximizeChatSpace),w=_(sx.centerFormOnLanding),C=_(sx.isTemporary),[S,T]=b(sx.chatBadges),[R,I]=b(sx.isEditingBadges),[E,M]=b(sx.showStopButtonByIndex(e)),[P,L]=b(sx.showPlusPopoverFamily(e)),[A,O]=b(sx.showMentionPopoverFamily(e)),{requiresKey:D}=function(){const{conversation:e}=rg(),{data:t}=kx(),{endpoint:n}=e||{},s=fp(t,n,"userProvide"),{getExpiry:a}=Cg(n??"");return{requiresKey:!a()&&s}}(),z=Zg(),{files:F,setFiles:V,conversation:$,isSubmitting:B,filesLoading:U,newConversation:H,handleStopGenerating:K}=rg(),{addedIndex:G,generateConversation:W,conversation:q,setConversation:Q,isSubmitting:Z}=Kg(),J=sv(),Y=_(sx.showStopButtonByIndex(G)),X=n.useMemo(()=>(null==$?void 0:$.endpointType)??(null==$?void 0:$.endpoint),[null==$?void 0:$.endpointType,null==$?void 0:$.endpoint]),ee=n.useMemo(()=>(null==$?void 0:$.conversationId)??Zc.NEW_CONVO,[null==$?void 0:$.conversationId]),te=n.useMemo(()=>null!=g&&"rtl"===(null==g?void 0:g.toLowerCase()),[g]),ne=n.useMemo(()=>{var e;return ji(X)&&(!(null==$?void 0:$.assistant_id)||!(null==(e=null==J?void 0:J[X??""])?void 0:e[(null==$?void 0:$.assistant_id)??""]))},[null==$?void 0:$.assistant_id,X,J]),se=n.useMemo(()=>D||ne,[D,ne]),ae=n.useCallback(()=>{var e,t;(null==(e=window.matchMedia)?void 0:e.call(window,"(pointer: coarse)").matches)||null==(t=a.current)||t.focus()},[]),re=n.useCallback(()=>{r&&o(!1)},[r]);Uv({files:F,setFiles:V,textAreaRef:a,conversationId:ee,isSubmitting:B||Z});const{submitMessage:oe,submitPrompt:ie}=Wv(),le=(({index:e,textAreaRef:t,setShowPlusPopover:s,setShowMentionPopover:a})=>{const r=Zv({permissionType:bd.PROMPTS,permission:yd.USE}),o=Zv({permissionType:bd.MULTI_CONVO,permission:yd.USE}),i=_(sx.latestMessageFamily(e)),l=y(sx.showPromptsPopoverFamily(e)),c=_(sx.atCommand),d=_(sx.plusCommand),u=_(sx.slashCommand),m=n.useCallback(()=>{c&&Yv(t,"@")&&a(!0)},[t,a,c]),p=n.useCallback(()=>{o&&d&&Yv(t,"+")&&s(!0)},[t,s,d,o]),h=n.useCallback(()=>{r&&u&&Yv(t,"/")&&l(!0)},[t,r,l,u]),x=n.useMemo(()=>({"@":m,"+":p,"/":h}),[m,p,h]),f=n.useCallback(e=>{if(!i)return;const t=document.getElementById(`edit-${i.parentMessageId}`);t&&(e.preventDefault(),t.click())},[i]);return n.useCallback(e=>{var n;const s=null==(n=t.current)?void 0:n.value;if("ArrowUp"===e.key&&0===(null==s?void 0:s.length))return void f(e);if("string"!=typeof s||0===s.length)return;if(Jv[e.key])return;const a=s[0],r=x[a];"function"==typeof r&&r()},[t,x,f])})({index:e,textAreaRef:a,setShowPlusPopover:L,setShowMentionPopover:O}),{isNotAppendable:ce,handlePaste:de,handleKeyDown:ue,handleCompositionStart:me,handleCompositionEnd:pe}=Hv({textAreaRef:a,submitButtonRef:s,setIsScrollable:i,disabled:se});Qv({textAreaRef:a});const{ref:he,...xe}=z.register("text",{required:!0,onChange:n.useCallback(e=>z.setValue("text",e.target.value,{shouldValidate:!0}),[z])}),fe=Mr({control:z.control,name:"text"});n.useEffect(()=>{if(a.current){const e=window.getComputedStyle(a.current),t=parseFloat(e.lineHeight);d(Math.floor(a.current.scrollHeight/t))}},[fe]),n.useEffect(()=>{R&&0===p.length&&h([...S])},[R,S,p.length]);const ge=n.useCallback(()=>{I(!1),h([])},[I,h]),ve=n.useCallback(()=>{p.length>0&&T([...p]),I(!1),h([])},[p,T,I]),be=c>3,ye=n.useMemo(()=>Op("md:py-3.5 m-0 w-full resize-none py-[13px] placeholder-black/50 bg-transparent dark:placeholder-white/50 [&:has(textarea:focus)]:shadow-[0_2px_6px_rgba(0,0,0,.05)]",r?"max-h-[52px]":"max-h-[45vh] md:max-h-[55vh]",be?"pl-5":"px-5"),[r,be]);return l.jsx("form",{onSubmit:z.handleSubmit(oe),className:Op("mx-auto flex w-full flex-row gap-3 transition-[max-width] duration-300 sm:px-2",j?"max-w-full":"md:max-w-3xl xl:max-w-4xl",!w||null!=ee&&ee!==Zc.NEW_CONVO||B||0!==(null==(t=null==$?void 0:$.messages)?void 0:t.length)?"sm:mb-10":"transition-all duration-200 sm:mb-28"),children:l.jsx("div",{className:"relative flex h-full flex-1 items-stretch md:flex-col",children:l.jsxs("div",{className:Op("flex w-full items-center",te&&"flex-row-reverse"),children:[P&&!ji(X)&&l.jsx(qI,{setShowMentionPopover:L,newConversation:W,textAreaRef:a,commandChar:"+",placeholder:"com_ui_add_model_preset",includeAssistants:!1}),A&&l.jsx(qI,{setShowMentionPopover:O,newConversation:H,textAreaRef:a}),l.jsx(bI,{index:e,textAreaRef:a,submitPrompt:ie}),l.jsxs("div",{onClick:ae,className:Op("relative flex w-full flex-grow flex-col overflow-hidden rounded-t-3xl border pb-4 text-text-primary transition-all duration-200 sm:rounded-3xl sm:pb-0",u?"shadow-lg":"shadow-md",C?"border-violet-800/60 bg-violet-950/10":"border-border-light bg-surface-chat"),children:[l.jsx(fI,{addedConvo:q,setAddedConvo:Q}),l.jsx(TI,{isEditingChatBadges:R,handleCancelBadges:ve,handleSaveBadges:ge,setBadges:T}),l.jsx(hI,{disableInputs:se}),X&&l.jsxs("div",{className:Op("flex",te?"flex-row-reverse":"flex-row"),children:[l.jsx(aj,{...xe,ref:e=>{he(e),a.current=e},disabled:se||ce,onPaste:de,onKeyDown:ue,onKeyUp:le,onCompositionStart:me,onCompositionEnd:pe,id:Bo,tabIndex:0,"data-testid":"text-input",rows:1,onFocus:()=>{re(),m(!0)},onBlur:m.bind(null,!1),onClick:re,style:{height:44,overflowY:"auto"},className:Op(ye,Gp,"transition-[max-height] duration-200 disabled:cursor-not-allowed")}),l.jsx("div",{className:"flex flex-col items-start justify-start pt-1.5",children:l.jsx(_I,{isCollapsed:r,isScrollable:be,setIsCollapsed:o})})]}),l.jsxs("div",{className:Op("items-between flex gap-2 pb-2",te?"flex-row-reverse":"flex-row"),children:[l.jsx("div",{className:""+(te?"mr-2":"ml-2"),children:l.jsx(pI,{disableInputs:se})}),l.jsx(HI,{showEphemeralBadges:!wi(X)&&!ji(X),conversationId:ee,onChange:T,isInChat:Array.isArray(null==$?void 0:$.messages)&&$.messages.length>=1}),l.jsx("div",{className:"mx-auto flex"}),x&&l.jsx(yI,{methods:z,ask:oe,textAreaRef:a,disabled:se||ce,isSubmitting:B}),l.jsx("div",{className:""+(te?"ml-2":"mr-2"),children:(B||Z)&&(E||Y)?l.jsx(CI,{stop:K,setShowStopButton:M}):X&&l.jsx(SI,{ref:s,control:z.control,disabled:U||B||se||ce})})]}),f&&v&&l.jsx(NI,{index:e})]})]})})})});function ZI(e){return e?e.length<40?"text-2xl sm:text-4xl":e.length<70?"text-xl sm:text-2xl":"text-lg sm:text-md":"text-xl sm:text-2xl"}function JI({centerFormOnLanding:e}){var t,s;const{conversation:a}=rg(),r=cg(),o=sv(),{data:i}=Sx(),{data:c}=kx(),{user:d}=Rg(),u=zf(),[m,p]=n.useState(!1),[h,x]=n.useState(1),[f,g]=n.useState(0),v=n.useRef(null),b=n.useMemo(()=>{let e=(null==a?void 0:a.endpoint)??"";return[vi.chatGPTBrowser,vi.azureOpenAI,vi.gptPlugins].includes(e)&&(e=vi.openAI),wp({endpointsConfig:c,iconURL:null==a?void 0:a.iconURL,endpoint:e})},[null==a?void 0:a.endpoint,null==a?void 0:a.iconURL,c]),{entity:y,isAgent:_,isAssistant:j}=Cp({endpoint:b,agentsMap:r,assistantMap:o,agent_id:null==a?void 0:a.agent_id,assistant_id:null==a?void 0:a.assistant_id}),w=(null==y?void 0:y.name)??"",N=((null==y?void 0:y.description)||(null==a?void 0:a.greeting))??"",C=n.useCallback(()=>{var e;if("string"==typeof(null==(e=null==i?void 0:i.interface)?void 0:e.customWelcome)){const e=i.interface.customWelcome;return(null==d?void 0:d.name)&&e.includes("{{user.name}}")?e.replace(/{{user.name}}/g,d.name):e}const t=new Date,n=t.getHours(),s=t.getDay();return u(n>=0&&n<5?"com_ui_late_night":n<12?0===s||6===s?"com_ui_weekend_morning":"com_ui_good_morning":n<17?"com_ui_good_afternoon":"com_ui_good_evening")},[u,null==(t=null==i?void 0:i.interface)?void 0:t.customWelcome,null==d?void 0:d.name]),k=n.useCallback(e=>{p(e>1),x(e)},[]);n.useEffect(()=>{v.current&&g(v.current.offsetHeight)},[h,N]);const S=n.useMemo(()=>{let e="mb-0";return h>2||N&&N.length>100?e="mb-10":h>1||N&&N.length>0?e="mb-6":m&&(e="mb-4"),f>200?e="mb-16":f>150&&(e="mb-12"),e},[h,N,m,f]),T="string"==typeof(null==(s=null==i?void 0:i.interface)?void 0:s.customWelcome)?C():C()+((null==d?void 0:d.name)?", "+d.name:"");return l.jsx("div",{className:`flex h-full transform-gpu flex-col items-center justify-center pb-16 transition-all duration-200 ${e?"max-h-full sm:max-h-0":"max-h-full"} ${S}`,children:l.jsxs("div",{ref:v,className:"flex flex-col items-center gap-0 p-2",children:[l.jsxs("div",{className:`flex ${m?"flex-col":"flex-col md:flex-row"} items-center justify-center gap-2`,children:[l.jsxs("div",{className:"relative size-10 justify-center "+(m?"mb-2":""),children:[l.jsx(qw,{agentsMap:r,assistantMap:o,conversation:a,endpointsConfig:c,containerClassName:"shadow-stroke relative flex h-full items-center justify-center rounded-full bg-white dark:bg-presentation dark:text-white text-black dark:after:shadow-none ",context:"landing",className:"h-2/3 w-2/3 text-black dark:text-white",size:41}),(null==i?void 0:i.showBirthdayIcon)&&l.jsx(rj,{className:"absolute bottom-[27px] right-2",description:u("com_ui_happy_birthday"),children:l.jsx(ky,{})})]}),(_||j)&&w||w?l.jsx("div",{className:"flex flex-col items-center gap-0 p-2",children:l.jsx(vj,{text:w,className:`${ZI(w)} font-medium text-text-primary`,delay:50,textAlign:"center",animationFrom:{opacity:0,transform:"translate3d(0,50px,0)"},animationTo:{opacity:1,transform:"translate3d(0,0,0)"},easing:eo.easeOutCubic,threshold:0,rootMargin:"0px",onLineCountChange:k},`split-text-${w}`)}):l.jsx(vj,{text:T,className:`${ZI(T)} font-medium text-text-primary`,delay:50,textAlign:"center",animationFrom:{opacity:0,transform:"translate3d(0,50px,0)"},animationTo:{opacity:1,transform:"translate3d(0,0,0)"},easing:eo.easeOutCubic,threshold:0,rootMargin:"0px",onLineCountChange:k},`split-text-${T}${(null==d?void 0:d.name)?"-user":""}`)]}),N&&l.jsx("div",{className:"animate-fadeIn mt-4 max-w-md text-center text-sm font-normal text-text-primary",children:N})]})})}const YI=n.memo(({currentSpec:e,endpointsConfig:t})=>{const n=jp(e),{endpoint:s}=e.preset,a=fp(t,s,"iconURL"),r=Np({endpoint:s,endpointsConfig:t,endpointIconURL:a});let o;if(n.includes("http")){if(n)return l.jsx(Uw,{iconURL:n,altName:e.name,containerStyle:{width:20,height:20},className:"icon-md shrink-0 overflow-hidden rounded-full",endpoint:s||void 0});o=By[s??""]??By[r]??By.unknown}else o=By[n]??By[r]??By.unknown;return l.jsx(o,{size:20,endpoint:s,context:"menu-item",iconURL:a,className:"icon-md shrink-0 text-text-primary"})});const XI=n.createContext(void 0);function eE(){const e=n.useContext(XI);if(void 0===e)throw new Error("useModelSelectorContext must be used within a ModelSelectorProvider");return e}function tE({children:e,startupConfig:t}){const s=cg(),a=sv(),{data:r}=kx(),{conversation:o,newConversation:i}=rg(),c=n.useMemo(()=>{var e;return(null==(e=null==t?void 0:t.modelSpecs)?void 0:e.list)??[]},[t]),{mappedEndpoints:d,endpointRequiresUserKey:u}=(({agentsMap:e,assistantsMap:t,endpointsConfig:s,startupConfig:a})=>{var r;const o=Gf(),{conversation:i}=rg(),{data:l=[]}=kx({select:gp}),{instanceProjectId:c}=a??{},d=(null==a?void 0:a.interface)??{},u=n.useMemo(()=>{var e;return new Set((null==(e=null==a?void 0:a.modelSpecs)?void 0:e.addedEndpoints)??[])},[null==(r=null==a?void 0:a.modelSpecs)?void 0:r.addedEndpoints]),{endpoint:p}=i??{},h=Zv({permissionType:bd.AGENTS,permission:yd.USE}),x=n.useMemo(()=>Object.values(e??{}).filter(e=>void 0!==e&&"id"in e&&"name"in e&&null!==e.name),[e]),f=n.useMemo(()=>Object.values((null==t?void 0:t[vi.assistants])??{}),[p,t]),g=n.useMemo(()=>Object.values((null==t?void 0:t[vi.azureAssistants])??{}),[p,t]),v=n.useMemo(()=>{if(!d.modelSelect)return[];const e=[];for(let t=0;t<l.length;t++)(l[t]!==vi.agents||h)&&(u.size>0&&!u.has(l[t])||e.push(l[t]));return e},[l,h,u]),b=n.useCallback(e=>!!fp(s,e,"userProvide"),[s]);return{mappedEndpoints:n.useMemo(()=>v.map(e=>{var t,n,a,r,i,l;const d=fp(s,e,"type"),u=Np({endpoint:e,endpointsConfig:s,endpointType:d}),p=By[u],h=fp(s,e,"iconURL"),v=e===vi.agents&&(null==x?void 0:x.length)>0||e===vi.assistants&&(null==f?void 0:f.length)>0||e!==vi.assistants&&e!==vi.agents&&((null==(n=null==(t=o.data)?void 0:t[e])?void 0:n.length)??0)>0,b={value:e,label:Oc[e]||e,hasModels:v,icon:p?m.createElement(p,{size:20,className:"text-text-primary shrink-0 icon-md",iconURL:h,endpoint:e}):null};return e===vi.agents&&x.length>0?(b.models=x.map(e=>{var t;return{name:e.id,isGlobal:(null!=c&&(null==(t=e.projectIds)?void 0:t.includes(c)))??!1}}),b.agentNames=x.reduce((e,t)=>(e[t.id]=t.name||"",e),{}),b.modelIcons=x.reduce((e,t)=>{var n;return e[t.id]=null==(n=null==t?void 0:t.avatar)?void 0:n.filepath,e},{})):e===vi.assistants&&f.length>0?(b.models=f.map(e=>({name:e.id,isGlobal:!1})),b.assistantNames=f.reduce((e,t)=>(e[t.id]=t.name||"",e),{}),b.modelIcons=f.reduce((e,t)=>{var n;return e[t.id]=null==(n=t.metadata)?void 0:n.avatar,e},{})):e===vi.azureAssistants&&g.length>0?(b.models=g.map(e=>({name:e.id,isGlobal:!1})),b.assistantNames=g.reduce((e,t)=>(e[t.id]=t.name||"",e),{}),b.modelIcons=g.reduce((e,t)=>{var n;return e[t.id]=null==(n=t.metadata)?void 0:n.avatar,e},{})):e!==vi.agents&&e!==vi.assistants&&((null==(r=null==(a=o.data)?void 0:a[e])?void 0:r.length)??0)>0&&(b.models=null==(l=null==(i=o.data)?void 0:i[e])?void 0:l.map(e=>({name:e,isGlobal:!1}))),b}),[v,s,o.data,x,f]),endpointRequiresUserKey:b}})({agentsMap:s,assistantsMap:a,startupConfig:t,endpointsConfig:r}),{onSelectEndpoint:p,onSelectSpec:h}=KI({modelSpecs:c,assistantsMap:a,endpointsConfig:r,newConversation:i,returnHandlers:!0}),[x,f]=n.useState({endpoint:(null==o?void 0:o.endpoint)||"",model:(null==o?void 0:o.model)||"",modelSpec:(null==o?void 0:o.spec)||""});!function({index:e=0,agentsMap:t,conversation:s,assistantsMap:a,setSelectedValues:r}){const{setOption:o}=yv(),i=n.useMemo(()=>Object.values(t??{}),[t]),{agent_id:l=null,assistant_id:c=null,endpoint:d}=s??{},u=n.useMemo(()=>ji(d)?Object.values((null==a?void 0:a[d??""])??{}):[],[a,d]);n.useEffect(()=>{var n;if(wi(d)&&null==l&&i.length>0){let s=localStorage.getItem(`${Jc.AGENT_ID_PREFIX}${e}`);null==s&&(s=null==(n=i[0])?void 0:n.id),void 0!==(null==t?void 0:t[s])&&(o("model")(""),o("agent_id")(s))}},[e,i,l,t,d,o]),n.useEffect(()=>{var t,n;if(ji(d)&&null==c&&u.length>0){let s=localStorage.getItem(`${Jc.ASST_ID_PREFIX}${e}`);null==s&&(s=null==(t=u[0])?void 0:t.id);const r=null==(n=null==a?void 0:a[d??""])?void 0:n[s];void 0!==r&&(o("model")(r.model),o("assistant_id")(s))}},[e,u,c,a,d,o]);const m=n.useRef(null),p=e=>{m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{r(e)},150)};n.useEffect(()=>{if(null==s?void 0:s.endpoint){if((null==s?void 0:s.assistant_id)||(null==s?void 0:s.agent_id)||(null==s?void 0:s.model)||(null==s?void 0:s.spec)){if(wi(null==s?void 0:s.endpoint))return void p({endpoint:s.endpoint||"",model:s.agent_id??"",modelSpec:s.spec||""});if(ji(null==s?void 0:s.endpoint))return void p({endpoint:s.endpoint||"",model:s.assistant_id||"",modelSpec:s.spec||""});p({endpoint:s.endpoint||"",model:s.model||"",modelSpec:s.spec||""})}return()=>{m.current&&clearTimeout(m.current)}}},[null==s?void 0:s.spec,null==s?void 0:s.model,null==s?void 0:s.endpoint,null==s?void 0:s.agent_id,null==s?void 0:s.assistant_id])}({agentsMap:s,conversation:o,assistantsMap:a,setSelectedValues:f});const[g,v]=n.useState(""),[b,y]=n.useState({}),_=(()=>{const[e,t]=n.useState(!1),[s,a]=n.useState(null),r=n.useCallback((e,n)=>{n.preventDefault(),n.stopPropagation(),a(e),t(!0)},[]);return{keyDialogOpen:e,keyDialogEndpoint:s,onOpenChange:e=>{if(!e&&s){const e=document.getElementById(`endpoint-${s}-settings`);e&&setTimeout(()=>{e.focus()},5)}t(e)},handleOpenKeyDialog:r}})(),j=n.useMemo(()=>{if(!g)return null;return function(e,t,n,s){const a=t.trim().toLowerCase();return a?e.filter(e=>!!(e.label.toLowerCase().includes(a)||e.name&&e.name.toLowerCase().includes(a)||e.value&&e.value.toLowerCase().includes(a))||!!(e.models&&e.models.length>0)&&e.models.some(t=>{var r;if(t.name.toLowerCase().includes(a))return!0;if(wi(e.value)&&n&&t.name in n){const e=null==(r=n[t.name])?void 0:r.name;return"string"==typeof e&&e.toLowerCase().includes(a)}if(ji(e.value)&&s){const n=e.value??"",r=s[n][t.name];return!(!r||"string"!=typeof r.name)&&r.name.toLowerCase().includes(a)}return!1})):null}([...c,...d],g,s,a||{})},[g,c,d,s,a]),w=n.useMemo(()=>Cr(e=>{v(e)},200),[]),N={searchValue:g,searchResults:j,selectedValues:x,endpointSearchValues:b,agentsMap:s,modelSpecs:c,assistantsMap:a,mappedEndpoints:d,endpointsConfig:r,handleSelectSpec:e=>{let t=e.preset.model??null;null==h||h(e),wi(e.preset.endpoint)?t=e.preset.agent_id??"":ji(e.preset.endpoint)&&(t=e.preset.assistant_id??""),f({endpoint:e.preset.endpoint,model:t,modelSpec:e.name})},handleSelectModel:(e,t)=>{var n,r,o;wi(e.value)?null==p||p(e.value,{agent_id:t,model:(null==(n=null==s?void 0:s[t])?void 0:n.model)??""}):ji(e.value)?null==p||p(e.value,{assistant_id:t,model:(null==(o=null==(r=null==a?void 0:a[e.value])?void 0:r[t])?void 0:o.model)??""}):e.value&&(null==p||p(e.value,{model:t})),f({endpoint:e.value,model:t,modelSpec:""})},setSelectedValues:f,handleSelectEndpoint:e=>{e.hasModels||(e.value&&(null==p||p(e.value)),f({endpoint:e.value,model:"",modelSpec:""}))},setEndpointSearchValue:(e,t)=>{y(n=>({...n,[e]:t}))},endpointRequiresUserKey:u,setSearchValue:w,..._};return l.jsx(XI.Provider,{value:N,children:e})}const nE=n.forwardRef(function({label:e,children:t,values:n,onValuesChange:s,searchValue:a,onSearch:r,combobox:o,trigger:i,defaultOpen:c,...d},u){const m=Re(),p=null!=a||!!r||!!o,h=Se({showTimeout:100,placement:m?"right":"left",defaultOpen:c}),x=l.jsxs(Te,{store:h,values:n,setValues:s,children:[l.jsxs(Qe,{ref:u,...d,className:Op(!m&&"flex h-10 w-full items-center justify-center gap-2 rounded-xl border border-border-light px-3 py-2 text-sm text-text-primary",h.useState("open")?"bg-surface-tertiary hover:bg-surface-tertiary":"bg-surface-secondary hover:bg-surface-tertiary",d.className),render:m?l.jsx(aE,{render:i}):i,children:[l.jsx("span",{className:"flex-1",children:e}),l.jsx(An,{className:"stroke-1 text-base opacity-75"})]}),l.jsx(Ie,{open:h.useState("open"),portal:!0,overlap:!0,unmountOnHide:!0,gutter:m?-4:4,className:Op((m?"animate-popover-left ml-3":"animate-popover")+" outline-none! z-50 flex max-h-[min(450px,var(--popover-available-height))] w-full","w-[var(--menu-width,auto)] min-w-[300px] flex-col overflow-auto rounded-xl border border-border-light","bg-surface-secondary px-3 py-2 text-sm text-text-primary shadow-lg","max-w-[calc(100vw-4rem)] sm:max-h-[calc(65vh)] sm:max-w-[400px]",p&&"p-0"),children:l.jsx(sE.Provider,{value:p,children:p?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"sticky top-0 z-10 bg-inherit p-1",children:l.jsx(ce,{autoSelect:!0,render:o,className:Op("h-10 w-full rounded-lg border-none bg-transparent px-2 text-base","sm:h-8 sm:text-sm","focus:outline-none focus:ring-0 focus-visible:ring-2 focus-visible:ring-white")})}),l.jsx(ct,{className:"p-0.5 pt-0",children:t})]}):t})})]});return p?l.jsx(ie,{resetValueOnHide:!0,includesBaseElement:!1,value:a,setValue:r,children:x}):x});n.forwardRef(function(e,t){return l.jsx(Ee,{ref:t,...e,className:Op("my-0.5 h-0 w-full border-t border-slate-200 dark:border-slate-700",e.className)})}),n.forwardRef(function({label:e,...t},n){return l.jsxs(On,{ref:n,...t,className:Op("",t.className),children:[e&&l.jsx(Dn,{className:"cursor-default p-2 text-sm font-medium opacity-60 sm:py-1 sm:text-xs",children:e}),t.children]})});const sE=n.createContext(!1),aE=n.forwardRef(function({name:e,value:t,...s},a){const r=Re(),o=n.useContext(sE),i={ref:a,focusOnHover:!0,blurOnHoverEnd:!1,...s,className:Op("relative flex cursor-default items-center gap-2 rounded-lg p-2 outline-none! scroll-m-1 scroll-mt-[calc(var(--combobox-height,0px)+var(--label-height,4px))] aria-disabled:opacity-25 data-[active-item]:bg-black/[0.075] data-[active-item]:text-black dark:data-[active-item]:bg-white/10 dark:data-[active-item]:text-white sm:py-1 sm:text-sm min-w-0 w-full before:absolute before:left-0 before:top-1 before:bottom-1 before:w-0.5 before:bg-transparent before:rounded-full data-[active-item]:before:bg-black dark:data-[active-item]:before:bg-white",s.className)},c=J(r,n=>!!e&&(null!=t&&null!=(null==n?void 0:n.values[e]))),d=J(r,n=>!!e&&(null==n?void 0:n.values[e])===t);if(c&&(i.children=l.jsxs(n.Fragment,{children:[l.jsx("span",{className:"flex-1",children:i.children}),l.jsx(In,{checked:d}),o&&l.jsx(st,{children:d?"checked":"not checked"})]})),!o){if(null!=e&&null!=t){const n={...i,name:e,value:t,hideOnClick:!0};return l.jsx(zn,{...n})}return l.jsx(Me,{...i})}return l.jsx(ue,{...i,setValueOnClick:!1,value:c?t:void 0,selectValueOnClick:()=>null!=e&&null!=t&&(null==r||r.setValue(e,t),!0),hideOnClick:e=>!e.currentTarget.hasAttribute("aria-expanded")&&(null==r||r.hideAll(),!0)})});function rE({spec:e,isSelected:t}){const{handleSelectSpec:n,endpointsConfig:s}=eE(),{showIconInMenu:a=!0}=e;return l.jsxs(aE,{onClick:()=>n(e),className:Op("flex w-full cursor-pointer items-center justify-between rounded-lg px-2 text-sm"),children:[l.jsxs("div",{className:Op("flex w-full min-w-0 gap-2 px-1 py-1",e.description?"items-start":"items-center"),children:[a&&l.jsx("div",{className:"flex-shrink-0",children:l.jsx(YI,{currentSpec:e,endpointsConfig:s})}),l.jsxs("div",{className:"flex min-w-0 flex-col gap-1",children:[l.jsx("span",{className:"truncate text-left",children:e.label}),e.description&&l.jsx("span",{className:"break-words text-xs font-normal",children:e.description})]})]}),t&&l.jsx("div",{className:"flex-shrink-0 self-center",children:l.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})})]},e.name)}function oE({modelId:e,endpoint:t,isSelected:n}){var s,a,r,o;const{handleSelectModel:i}=eE();let d=!1,u=e;const m=(null==(s=null==t?void 0:t.modelIcons)?void 0:s[e??""])||null;if(t&&e&&wi(t.value)&&(null==(a=t.agentNames)?void 0:a[e])){u=t.agentNames[e];const n=null==(r=null==t?void 0:t.models)?void 0:r.find(t=>t.name===e);d=(null==n?void 0:n.isGlobal)??!1}else t&&e&&ji(t.value)&&(null==(o=t.assistantNames)?void 0:o[e])&&(u=t.assistantNames[e]);return l.jsxs(aE,{onClick:()=>i(t,e??""),className:"flex h-8 w-full cursor-pointer items-center justify-start rounded-lg px-3 py-2 text-sm",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[m?l.jsx("div",{className:"flex h-5 w-5 items-center justify-center overflow-hidden rounded-full",children:l.jsx("img",{src:m,alt:u??"",className:"h-full w-full object-cover"})}):(wi(t.value)||ji(t.value))&&t.icon?l.jsx("div",{className:"flex h-5 w-5 items-center justify-center overflow-hidden rounded-full",children:t.icon}):null,l.jsx("span",{children:u})]}),d&&l.jsx(c,{className:"ml-auto size-4 text-black dark:text-white"}),n&&l.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]},e)}function iE(e,t,n,s){return(s||t.map(e=>e.name)).map(t=>e&&l.jsx(oE,{modelId:t,endpoint:e,isSelected:n===t},t))}const lE=({endpoint:e,className:t,handleOpenKeyDialog:n})=>{const s=zf()("com_endpoint_config_key");return l.jsx("button",{id:`endpoint-${e.value}-settings`,onClick:t=>{e.value&&(t.stopPropagation(),n(e.value,t))},className:Op("flex items-center overflow-visible text-text-primary transition-all duration-300 ease-in-out","group/button rounded-md px-1 hover:bg-surface-secondary focus:bg-surface-secondary",t),"aria-label":`${s} ${e.label}`,children:l.jsxs("div",{className:"flex w-[28px] items-center gap-1 whitespace-nowrap transition-all duration-300 ease-in-out group-hover:w-auto group-focus/button:w-auto",children:[l.jsx(En,{className:"h-4 w-4 flex-shrink-0"}),l.jsx("span",{className:"max-w-0 overflow-hidden whitespace-nowrap opacity-0 transition-all duration-300 ease-in-out group-hover:max-w-[100px] group-hover:opacity-100 group-focus/button:max-w-[100px] group-focus/button:opacity-100",children:s})]})})};function cE({endpoint:e}){const t=zf(),{agentsMap:s,assistantsMap:a,selectedValues:r,handleOpenKeyDialog:o,handleSelectEndpoint:i,endpointSearchValues:c,setEndpointSearchValue:d,endpointRequiresUserKey:u}=eE(),{model:m,endpoint:p}=r,h=c[e.value]||"",x=n.useMemo(()=>u(e.value),[e.value]),f=()=>l.jsxs("div",{className:"flex items-center gap-2",children:[e.icon&&l.jsx("div",{className:"flex flex-shrink-0 items-center justify-center overflow-hidden",children:e.icon}),l.jsx("span",{className:Op("truncate text-left",x?"group-hover:w-24 group-focus:w-24":""),children:e.label}),"gptPlugins"===e.value&&l.jsx(rj,{description:t("com_endpoint_deprecated_info"),"aria-label":t("com_endpoint_deprecated_info_a11y"),render:l.jsx("span",{className:"ml-2 rounded bg-amber-600/70 px-2 py-0.5 text-xs font-semibold text-white",children:t("com_endpoint_deprecated")})})]});if(e.hasModels){const n=h?function(e,t,n,s,a){const r=n.trim().toLowerCase();return r?t.filter(t=>{var n;let o=t;if(wi(e.value)&&s&&s[t])o=(null==(n=s[t])?void 0:n.name)||t;else if(ji(e.value)&&a&&a[e.value]){const n=a[e.value][t];o="string"==typeof n.name&&n.name?n.name:t}return o.toLowerCase().includes(r)}):t}(e,(e.models||[]).map(e=>e.name),h,s,a):null,r=wi(e.value)||ji(e.value)?t("com_endpoint_search_var",{0:e.label}):t("com_endpoint_search_endpoint_models",{0:e.label});return l.jsx(nE,{id:`endpoint-${e.value}-menu`,className:"transition-opacity duration-200 ease-in-out",defaultOpen:e.value===p,searchValue:h,onSearch:t=>d(e.value,t),combobox:l.jsx("input",{placeholder:r}),label:l.jsxs("div",{onClick:()=>i(e),className:"group flex w-full flex-shrink cursor-pointer items-center justify-between rounded-xl px-1 py-1 text-sm",children:[f(),x&&l.jsx(lE,{endpoint:e,handleOpenKeyDialog:o})]}),children:ji(e.value)&&void 0===e.models?l.jsx("div",{className:"flex items-center justify-center p-2",children:l.jsx(Gb,{})}):n?iE(e,e.models||[],m,n):e.models&&iE(e,e.models,m)},`endpoint-${e.value}-item`)}return l.jsx(aE,{id:`endpoint-${e.value}-menu`,onClick:()=>i(e),className:"flex h-8 w-full cursor-pointer items-center justify-between rounded-xl px-3 py-2 text-sm",children:l.jsxs("div",{className:"group flex w-full min-w-0 items-center justify-between",children:[f(),l.jsxs("div",{className:"flex items-center gap-2",children:[u(e.value)&&l.jsx(lE,{endpoint:e,handleOpenKeyDialog:o}),p===e.value&&l.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]})]})},`endpoint-${e.value}-item`)}function dE(e){return e.filter(e=>"gptPlugins"!==e.value&&"assistants"!==e.value&&"azureAssistants"!==e.value).map(e=>l.jsx(cE,{endpoint:e},`endpoint-${e.value}-item`))}function uE({results:e,localize:t,searchValue:s}){const{selectedValues:a,handleSelectSpec:r,handleSelectModel:o,handleSelectEndpoint:i,endpointsConfig:d}=eE(),{modelSpec:u,endpoint:m,model:p}=a;return e?e.length?l.jsx(l.Fragment,{children:e.map((e,t)=>{if("name"in e&&"label"in e){const t=e;return l.jsxs(aE,{onClick:()=>r(t),className:Op("flex w-full cursor-pointer justify-between rounded-lg px-2 text-sm",t.description?"items-start":"items-center"),children:[l.jsxs("div",{className:Op("flex w-full min-w-0 gap-2 px-1 py-1",t.description?"items-start":"items-center"),children:[(t.showIconInMenu??!0)&&l.jsx("div",{className:"flex-shrink-0",children:l.jsx(YI,{currentSpec:t,endpointsConfig:d})}),l.jsxs("div",{className:"flex min-w-0 flex-col gap-1",children:[l.jsx("span",{className:"truncate text-left",children:t.label}),t.description&&l.jsx("span",{className:"break-words text-xs font-normal",children:t.description})]})]}),u===t.name&&l.jsx("div",{className:Op("flex-shrink-0",t.description?"pt-1":""),children:l.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})})]},t.name)}{const a=e;if(a.hasModels&&a.models&&a.models.length>0){const e=s.toLowerCase(),r=a.label.toLowerCase().includes(e)?a.models:a.models.filter(t=>{let n=t.name;return wi(a.value)&&a.agentNames&&a.agentNames[t.name]?n=a.agentNames[t.name]:ji(a.value)&&a.assistantNames&&a.assistantNames[t.name]&&(n=a.assistantNames[t.name]),n.toLowerCase().includes(e)});return r.length?l.jsxs(n.Fragment,{children:[l.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 text-sm font-medium",children:[a.icon&&l.jsx("div",{className:"flex items-center justify-center overflow-hidden rounded-full p-1",children:a.icon}),a.label]}),r.map(e=>{var n,s;const r=e.name;let i=!1,d=r;if(wi(a.value)&&a.agentNames&&a.agentNames[r]){d=a.agentNames[r];const e=null==(n=null==a?void 0:a.models)?void 0:n.find(e=>e.name===r);i=(null==e?void 0:e.isGlobal)??!1}else ji(a.value)&&a.assistantNames&&a.assistantNames[r]&&(d=a.assistantNames[r]);return l.jsxs(aE,{onClick:()=>o(a,r),className:"flex w-full cursor-pointer items-center justify-start rounded-lg px-3 py-2 pl-6 text-sm",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[(null==(s=a.modelIcons)?void 0:s[r])&&l.jsx("div",{className:"flex h-5 w-5 items-center justify-center overflow-hidden rounded-full",children:l.jsx("img",{src:a.modelIcons[r],alt:d,className:"h-full w-full object-cover"})}),l.jsx("span",{children:d})]}),i&&l.jsx(c,{className:"ml-auto size-4 text-black dark:text-white"}),m===a.value&&p===r&&l.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]},`${a.value}-${r}-search-${t}`)})]},`endpoint-${a.value}-search-${t}`):null}return l.jsxs(aE,{onClick:()=>i(a),className:"flex w-full cursor-pointer items-center justify-between rounded-xl px-3 py-2 text-sm",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[a.icon&&l.jsx("div",{className:"flex items-center justify-center overflow-hidden rounded-full border border-gray-200 p-1 dark:border-gray-700",style:{borderRadius:"50%"},children:a.icon}),l.jsx("span",{children:a.label})]}),m===a.value&&l.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]},`endpoint-${a.value}-search-item`)}})}):l.jsx("div",{className:"cursor-default p-2 sm:py-1 sm:text-sm",children:t("com_files_no_results")}):null}function mE(e,t,n){return l.jsx(uE,{results:e,localize:t,searchValue:n},`search-results-${n}`)}const pE=[{value:"screenshot",label:"screenshot (.png)"},{value:"text",label:"text (.txt)"},{value:"markdown",label:"markdown (.md)"},{value:"json",label:"json (.json)"},{value:"csv",label:"csv (.csv)"}];function hE({open:e,onOpenChange:t,conversation:s,triggerRef:a,children:r}){const o=zf(),[i,c]=n.useState(""),[d,u]=n.useState("screenshot"),[m,p]=n.useState(!0),[h,x]=n.useState(!1),[f,g]=n.useState(!0);n.useEffect(()=>{!e&&a&&a.current&&a.current.focus()},[e,a]),n.useEffect(()=>{c(R(String((null==s?void 0:s.title)??"file"))),u("screenshot"),p(!0),x(!1),g(!0)},[null==s?void 0:s.title,e]);const v=n.useCallback(e=>{const t="csv"!==e&&"screenshot"!==e;x("json"===e||"csv"===e||"webpage"===e),p(t),u(e)},[]),b=n.useMemo(()=>"json"===d||"csv"===d||"webpage"===d,[d]),y=n.useMemo(()=>"csv"!==d&&"screenshot"!==d,[d]),{exportConversation:_}=Rv({conversation:s,filename:i,type:d,includeOptions:m,exportBranches:h,recursive:f});return l.jsxs(A_,{open:e,onOpenChange:t,triggerRef:a,children:[r,l.jsx(Oj,{title:o("com_nav_export_conversation"),className:"max-w-full sm:max-w-2xl",main:l.jsxs("div",{className:"flex w-full flex-col items-center gap-6",children:[l.jsxs("div",{className:"grid w-full gap-6 sm:grid-cols-2",children:[l.jsxs("div",{className:"col-span-1 flex flex-col items-start justify-start gap-2",children:[l.jsx(L_,{htmlFor:"filename",className:"text-left text-sm font-medium",children:o("com_nav_export_filename")}),l.jsx(M_,{id:"filename",value:i,onChange:e=>c(R(e.target.value||"")),placeholder:o("com_nav_export_filename_placeholder")})]}),l.jsxs("div",{className:"col-span-1 flex w-full flex-col items-start justify-start gap-2",children:[l.jsx(L_,{htmlFor:"type",className:"text-left text-sm font-medium",children:o("com_nav_export_type")}),l.jsx(fj,{value:d,onChange:v,options:pE,className:"z-50",portal:!1})]})]}),l.jsxs("div",{className:"grid w-full gap-6 sm:grid-cols-2",children:[l.jsx("div",{className:"col-span-1 flex flex-col items-start justify-start gap-2",children:l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsx(L_,{htmlFor:"includeOptions",className:"text-left text-sm font-medium",children:o("com_nav_export_include_endpoint_options")}),l.jsxs("div",{className:"flex h-[40px] w-full items-center space-x-3",children:[l.jsx(d_,{id:"includeOptions",disabled:!y,checked:m,onCheckedChange:p}),l.jsx("label",{htmlFor:"includeOptions",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:o(y?"com_nav_enabled":"com_nav_not_supported")})]})]})}),l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsx(L_,{htmlFor:"exportBranches",className:"text-left text-sm font-medium",children:o("com_nav_export_all_message_branches")}),l.jsxs("div",{className:"flex h-[40px] w-full items-center space-x-3",children:[l.jsx(d_,{id:"exportBranches",disabled:!b,checked:h,onCheckedChange:x}),l.jsx("label",{htmlFor:"exportBranches",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:o(b?"com_nav_enabled":"com_nav_not_supported")})]})]}),"json"===d?l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsx(L_,{htmlFor:"recursive",className:"text-left text-sm font-medium",children:o("com_nav_export_recursive_or_sequential")}),l.jsxs("div",{className:"flex h-[40px] w-full items-center space-x-3",children:[l.jsx(d_,{id:"recursive",checked:f,onCheckedChange:g}),l.jsx("label",{htmlFor:"recursive",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:o("com_nav_export_recursive")})]})]}):null]})]}),buttons:l.jsx(l.Fragment,{children:l.jsx(c_,{onClick:_,variant:"submit",children:o("com_endpoint_export")})}),selection:void 0})]})}const xE=n.memo(({checked:e,onChange:t,ariaLabel:n})=>l.jsx("div",{role:"button",tabIndex:0,onKeyDown:e=>e.stopPropagation(),className:"flex h-full w-[30px] items-center justify-center",onClick:e=>e.stopPropagation(),children:l.jsx(d_,{checked:e,onCheckedChange:t,"aria-label":n})}));xE.displayName="SelectionCheckbox";const fE=n.memo(({row:e,isSmallScreen:t,onSelectionChange:s,index:a,isSearching:r})=>{const o=n.useCallback(t=>{e.toggleSelected(t),null==s||s(e.id,t)},[e,s]);return l.jsx(X_,{"data-state":e.getIsSelected()?"selected":void 0,className:"motion-safe:animate-fadeIn border-b border-border-light transition-all duration-300 ease-out hover:bg-surface-secondary",style:{animationDelay:20*a+"ms",transform:`translateY(${r?"4px":"0"})`,opacity:r?.5:1},children:e.getVisibleCells().map(n=>"select"===n.column.id?l.jsx(tj,{className:"px-2 py-1 transition-all duration-300",children:l.jsx(xE,{checked:e.getIsSelected(),onChange:o,ariaLabel:"Select row"})},n.id):l.jsx(tj,{className:"w-0 max-w-0 px-2 py-1 align-middle text-xs transition-all duration-300 sm:px-4 sm:py-2 sm:text-sm",style:gE(n.column.columnDef,t),children:l.jsx("div",{className:"overflow-hidden text-ellipsis",children:Ua(n.column.columnDef.cell,n.getContext())})},n.id))})});function gE(e,t){var n,s,a,r;return{width:t?null==(n=e.meta)?void 0:n.mobileSize:null==(s=e.meta)?void 0:s.size,minWidth:null==(a=e.meta)?void 0:a.minWidth,maxWidth:null==(r=e.meta)?void 0:r.size}}const vE=n.memo(({onDelete:e,isDeleting:t,disabled:n,isSmallScreen:s,localize:a})=>e?l.jsx(c_,{variant:"outline",onClick:e,disabled:n,className:Op("min-w-[40px] transition-all duration-200",s&&"px-2 py-1"),children:t?l.jsx(Gb,{className:"size-4"}):l.jsxs(l.Fragment,{children:[l.jsx(py,{className:"size-3.5 text-gray-600 sm:size-4"}),!s&&l.jsx("span",{className:"ml-2",children:a("com_ui_delete")})]})}):null);function bE({columns:e,data:t,onDelete:s,filterColumn:a,defaultSort:r=[],className:o="",isFetchingNextPage:i=!1,hasNextPage:c=!1,fetchNextPage:d,enableRowSelection:u=!0,showCheckboxes:m=!0,onFilterChange:p,filterValue:h,isLoading:x}){const f=zf(),g=Uy("(max-width: 768px)"),v=n.useRef(null),b=_(sx.search),[y,j]=n.useState(!1),[w,N]=n.useState({}),[C,k]=n.useState(r),[S,T]=n.useState([]),[R,I]=n.useState({}),[E,M]=n.useState(h??""),[P,L]=n.useState(!1),A=n.useMemo(()=>{if(!u||!m)return e;return[{id:"select",header:({table:e})=>l.jsx("div",{className:"flex h-full w-[30px] items-center justify-center",children:l.jsx(d_,{checked:e.getIsAllPageRowsSelected(),onCheckedChange:t=>e.toggleAllPageRowsSelected(Boolean(t)),"aria-label":"Select all"})}),cell:({row:e})=>l.jsx(xE,{checked:e.getIsSelected(),onChange:t=>e.toggleSelected(t),ariaLabel:"Select row"}),meta:{size:"50px"}},...e]},[e,u,m]),O=$a({data:t,columns:A,getCoreRowModel:Ba(),getSortedRowModel:Ga(),getFilteredRowModel:Ka(),enableRowSelection:u,enableMultiRowSelection:!0,state:{sorting:C,columnFilters:S,columnVisibility:R,rowSelection:w},onSortingChange:k,onColumnFiltersChange:T,onColumnVisibilityChange:I,onRowSelectionChange:N}),{rows:D}=O.getRowModel(),z=Io({count:D.length,getScrollElement:()=>v.current,estimateSize:n.useCallback(()=>48,[]),overscan:10}),F=z.getVirtualItems(),V=z.getTotalSize(),$=F.length>0?F[0].start:0,B=F.length>0?V-F[F.length-1].end:0;n.useEffect(()=>{const e=v.current;if(!e)return;const t=async()=>{if(!c||i)return;const{scrollTop:t,scrollHeight:n,clientHeight:s}=e;if(n-t<=1.5*s)try{await(null==d?void 0:d())}catch(a){console.error("Unable to fetch next page:",a)}};return e.addEventListener("scroll",t,{passive:!0}),()=>e.removeEventListener("scroll",t)},[c,i,d]),n.useEffect(()=>{L(!0);const e=setTimeout(()=>{null==p||p(E),L(!1)},300);return()=>clearTimeout(e)},[E,p]);const U=n.useCallback(async()=>{if(s){j(!0);try{const e=O.getFilteredSelectedRowModel().rows.map(e=>e.original);await s(e),N({})}finally{j(!1)}}},[s,O]),H=Array.from({length:13},(e,t)=>{var n;const s=Math.floor(241*Math.random())+170,a="select"===(null==(n=A[0])?void 0:n.id)?1:0;return l.jsx(X_,{className:"motion-safe:animate-fadeIn border-b border-border-light",children:A.map((e,t)=>{const n=gE(e,g),r=t===a;return l.jsx(tj,{className:"px-2 py-1 sm:px-4 sm:py-2",style:n,children:l.jsx(q_,{className:"h-6",style:r?{width:`${s}px`}:{width:"100%"}})},e.id)})},t)});return l.jsxs("div",{className:Op("flex h-full flex-col gap-4",o),children:[l.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4",children:[u&&m&&l.jsx(vE,{onDelete:U,isDeleting:y,disabled:!O.getFilteredSelectedRowModel().rows.length||y,isSmallScreen:g,localize:f}),void 0!==a&&O.getColumn(a)&&b.enabled&&l.jsx("div",{className:"relative flex-1",children:l.jsx(Dj,{value:E,onChange:e=>M(e.target.value),isSearching:P,placeholder:`${f("com_ui_search")}...`})})]}),l.jsx("div",{ref:v,className:Op("relative h-[calc(100vh-20rem)] max-w-full overflow-x-auto overflow-y-auto rounded-md border border-black/10 dark:border-white/10","transition-all duration-300 ease-out",P&&"bg-surface-secondary/50",o),children:l.jsxs(Z_,{className:"w-full min-w-[300px] table-fixed border-separate border-spacing-0",children:[l.jsx(J_,{className:"sticky top-0 z-50 bg-surface-secondary",children:O.getHeaderGroups().map(e=>l.jsx(X_,{className:"border-b border-border-light",children:e.headers.map(e=>l.jsx(ej,{className:"whitespace-nowrap bg-surface-secondary px-2 py-2 text-left text-sm font-medium text-text-secondary sm:px-4",style:gE(e.column.columnDef,g),onClick:e.column.getCanSort()?e.column.getToggleSortingHandler():void 0,children:e.isPlaceholder?null:Ua(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),l.jsxs(Y_,{children:[$>0&&l.jsx("tr",{children:l.jsx("td",{style:{height:`${$}px`}})}),x&&H,F.map(e=>{const t=D[e.index];return l.jsx(fE,{row:t,isSmallScreen:g,index:e.index,isSearching:P},t.id)}),!F.length&&l.jsx(X_,{className:"hover:bg-transparent",children:l.jsx(tj,{colSpan:e.length,className:"p-4 text-center",children:f("com_ui_no_data")})}),B>0&&l.jsx("tr",{children:l.jsx("td",{style:{height:`${B}px`}})}),(i||c)&&l.jsx(X_,{className:"hover:bg-transparent",children:l.jsx(tj,{colSpan:e.length,className:"p-4",children:l.jsx("div",{className:"flex h-full items-center justify-center",children:i?l.jsx(Gb,{className:"size-4"}):c&&l.jsx("div",{className:"h-6"})})})})]})]})})]})}const yE={isArchived:!0,sortBy:"createdAt",sortDirection:"desc",search:""};function _E({onOpenChange:e}){const t=zf(),s=Uy("(max-width: 768px)"),{showToast:a}=Of(),[r,o]=n.useState(!1),[i,c]=n.useState(yE),[d,u]=n.useState(null),{data:m,fetchNextPage:p,hasNextPage:h,isFetchingNextPage:x,refetch:f,isLoading:g}=Zx(i,{staleTime:0,cacheTime:3e5,refetchOnWindowFocus:!1,refetchOnMount:!1}),v=n.useCallback((e,t)=>{c(n=>({...n,sortBy:e,sortDirection:t}))},[]),b=n.useCallback(e=>{const t=encodeURIComponent(e.trim());c(e=>({...e,search:t}))},[]),y=n.useMemo(()=>Cr(b,300),[b]);n.useEffect(()=>()=>{y.cancel()},[y]);const _=n.useMemo(()=>(null==m?void 0:m.pages)?m.pages.flatMap(e=>{var t;return(null==(t=null==e?void 0:e.conversations)?void 0:t.filter(Boolean))??[]}):[],[null==m?void 0:m.pages]),j=hf({onSuccess:async()=>{o(!1),await f()},onError:e=>{a({message:t("com_ui_archive_delete_error"),severity:Wo.ERROR})}}),w=df({onSuccess:async()=>{await f()},onError:e=>{a({message:t("com_ui_unarchive_error"),severity:Wo.ERROR})}}),N=n.useCallback(async()=>{h&&!x&&await p()},[p,h,x]),C=n.useMemo(()=>[{accessorKey:"title",header:()=>{const e="title"===i.sortBy,n=i.sortDirection;return l.jsxs(c_,{variant:"ghost",className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",onClick:()=>v("title",e&&"asc"===n?"desc":"asc"),children:[t("com_nav_archive_name"),e&&"asc"===n&&l.jsx(Fn,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),e&&"desc"===n&&l.jsx(Vn,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),!e&&l.jsx(Nn,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})},cell:({row:e})=>{const{conversationId:t,title:n}=e.original;return l.jsxs("button",{type:"button",className:"flex items-center gap-2 truncate",onClick:()=>window.open(`/c/${t}`,"_blank"),children:[l.jsx(Bw,{endpoint:e.original.endpoint,size:28,isCreatedByUser:!1,iconClassName:"size-4"}),l.jsx("span",{className:"underline",children:n})]})},meta:{size:s?"70%":"50%",mobileSize:"70%"}},{accessorKey:"createdAt",header:()=>{const e="createdAt"===i.sortBy,n=i.sortDirection;return l.jsxs(c_,{variant:"ghost",className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",onClick:()=>v("createdAt",e&&"asc"===n?"desc":"asc"),children:[t("com_nav_archive_created_at"),e&&"asc"===n&&l.jsx(Fn,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),e&&"desc"===n&&l.jsx(Vn,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),!e&&l.jsx(Nn,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})},cell:({row:e})=>{var t;return Em((null==(t=e.original.createdAt)?void 0:t.toString())??"",s)},meta:{size:s?"30%":"35%",mobileSize:"30%"}},{accessorKey:"actions",header:()=>l.jsx(L_,{className:"px-2 py-0 text-xs sm:px-2 sm:py-2 sm:text-sm",children:t("com_assistants_actions")}),cell:({row:e})=>{const n=e.original;return l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(rj,{description:t("com_ui_unarchive"),render:l.jsx(c_,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:()=>w.mutate({conversationId:n.conversationId,isArchived:!1}),title:t("com_ui_unarchive"),disabled:w.isLoading,children:w.isLoading?l.jsx(Gb,{}):l.jsx($n,{className:"size-4"})})}),l.jsx(rj,{description:t("com_ui_delete"),render:l.jsx(c_,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:()=>{u(e.original),o(!0)},title:t("com_ui_delete"),children:l.jsx(Xt,{className:"size-4"})})})]})},meta:{size:"15%",mobileSize:"25%"}}],[v,s,t,i,w]);return l.jsxs(l.Fragment,{children:[l.jsx(bE,{columns:C,data:_,filterColumn:"title",onFilterChange:y,filterValue:i.search,fetchNextPage:N,hasNextPage:h,isFetchingNextPage:x,isLoading:g,showCheckboxes:!1}),l.jsx(A_,{open:r,onOpenChange:e,children:l.jsxs(V_,{title:t("com_ui_delete_confirm")+" "+((null==d?void 0:d.title)??""),className:"w-11/12 max-w-md",children:[l.jsx($_,{children:l.jsxs(U_,{children:[t("com_ui_delete_confirm")," ",l.jsx("strong",{children:null==d?void 0:d.title})]})}),l.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[l.jsx(c_,{"aria-label":"cancel",variant:"outline",onClick:()=>o(!1),children:t("com_ui_cancel")}),l.jsx(c_,{variant:"destructive",onClick:()=>j.mutate({conversationId:(null==d?void 0:d.conversationId)??""}),disabled:j.isLoading,children:j.isLoading?l.jsx(Gb,{}):t("com_ui_delete")})]})]})})]})}function jE(){const e=zf(),[t,s]=n.useState(!1);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:e("com_nav_archived_chats")}),l.jsxs(A_,{open:t,onOpenChange:s,children:[l.jsx(O_,{asChild:!0,children:l.jsx(c_,{variant:"outline","aria-label":"Archived chats",children:e("com_ui_manage")})}),l.jsx(Oj,{title:e("com_nav_archived_chats"),className:"max-w-[1000px]",showCancelButton:!1,main:l.jsx(_E,{isOpen:t,onOpenChange:s})})]})]})}const wE=({side:e,text:t})=>{const n=zf();return l.jsxs(T_,{openDelay:500,children:[l.jsxs(R_,{children:[l.jsx(Iy,{className:"h-5 w-5 text-text-tertiary"})," "]}),l.jsx(I_,{children:l.jsx(E_,{side:e,className:"z-[999] w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:n(t)})})})})]})},NE=({stateAtom:e,localizationKey:t,hoverCardText:n,switchId:s,onCheckedChange:a})=>{const[r,o]=b(e),i=zf();return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("div",{children:i(t)}),n&&l.jsx(wE,{side:"bottom",text:n})]}),l.jsx(Q_,{id:s,checked:r,onCheckedChange:e=>{o(e),a&&a(e)},className:"ml-4","data-testid":s})]})},CE=[{stateAtom:sx.enableUserMsgMarkdown,localizationKey:"com_nav_user_msg_markdown",switchId:"enableUserMsgMarkdown",hoverCardText:void 0,key:"enableUserMsgMarkdown"},{stateAtom:sx.autoScroll,localizationKey:"com_nav_auto_scroll",switchId:"autoScroll",hoverCardText:void 0,key:"autoScroll"},{stateAtom:sx.hideSidePanel,localizationKey:"com_nav_hide_panel",switchId:"hideSidePanel",hoverCardText:void 0,key:"hideSidePanel"}],kE=({theme:e,onChange:t})=>{const n=zf(),s=[{value:"system",label:n("com_nav_theme_system")},{value:"dark",label:n("com_nav_theme_dark")},{value:"light",label:n("com_nav_theme_light")}];return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:n("com_nav_theme")}),l.jsx(fj,{value:e,onChange:t,options:s,sizeClasses:"w-[180px]",testId:"theme-selector",className:"z-50"})]})},SE=({langcode:e,onChange:t})=>{const n=zf(),s=[{value:"auto",label:n("com_nav_lang_auto")},{value:"en-US",label:n("com_nav_lang_english")},{value:"zh-Hans",label:n("com_nav_lang_chinese")},{value:"zh-Hant",label:n("com_nav_lang_traditional_chinese")},{value:"ar-EG",label:n("com_nav_lang_arabic")},{value:"da-DK",label:n("com_nav_lang_danish")},{value:"de-DE",label:n("com_nav_lang_german")},{value:"es-ES",label:n("com_nav_lang_spanish")},{value:"ca-ES",label:n("com_nav_lang_catalan")},{value:"et-EE",label:n("com_nav_lang_estonian")},{value:"fa-IR",label:n("com_nav_lang_persian")},{value:"fr-FR",label:n("com_nav_lang_french")},{value:"he-HE",label:n("com_nav_lang_hebrew")},{value:"hu-HU",label:n("com_nav_lang_hungarian")},{value:"it-IT",label:n("com_nav_lang_italian")},{value:"pl-PL",label:n("com_nav_lang_polish")},{value:"pt-BR",label:n("com_nav_lang_brazilian_portuguese")},{value:"pt-PT",label:n("com_nav_lang_portuguese")},{value:"ru-RU",label:n("com_nav_lang_russian")},{value:"ja-JP",label:n("com_nav_lang_japanese")},{value:"ka-GE",label:n("com_nav_lang_georgian")},{value:"cs-CZ",label:n("com_nav_lang_czech")},{value:"sv-SE",label:n("com_nav_lang_swedish")},{value:"ko-KR",label:n("com_nav_lang_korean")},{value:"vi-VN",label:n("com_nav_lang_vietnamese")},{value:"th-TH",label:n("com_nav_lang_thai")},{value:"tr-TR",label:n("com_nav_lang_turkish")},{value:"nl-NL",label:n("com_nav_lang_dutch")},{value:"id-ID",label:n("com_nav_lang_indonesia")},{value:"fi-FI",label:n("com_nav_lang_finnish")}];return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:n("com_nav_language")}),l.jsx(fj,{value:e,onChange:t,sizeClasses:"[--anchor-max-height:256px]",options:s,className:"z-50"})]})};const TE=m.memo(function(){const{theme:e,setTheme:t}=n.useContext(Nv),[s,a]=b(sx.lang),r=n.useCallback(e=>{t(e)},[t]),o=n.useCallback(e=>{let t=e;"auto"===e&&(t=navigator.language||navigator.languages[0]),requestAnimationFrame(()=>{document.documentElement.lang=t}),a(t),j.set("lang",t,{expires:365})},[a]);return l.jsxs("div",{className:"flex flex-col gap-3 p-1 text-sm text-text-primary",children:[l.jsx("div",{className:"pb-3",children:l.jsx(kE,{theme:e,onChange:r})}),l.jsx("div",{className:"pb-3",children:l.jsx(SE,{langcode:s,onChange:o})}),CE.map(e=>l.jsx("div",{className:"pb-3",children:l.jsx(NE,{stateAtom:e.stateAtom,localizationKey:e.localizationKey,hoverCardText:e.hoverCardText,switchId:e.switchId})},e.key)),l.jsx("div",{className:"pb-3",children:l.jsx(jE,{})})]})});function RE(){const[e,t]=b(sx.fontSize),n=zf(),s=[{value:"text-xs",label:n("com_nav_font_size_xs")},{value:"text-sm",label:n("com_nav_font_size_sm")},{value:"text-base",label:n("com_nav_font_size_base")},{value:"text-lg",label:n("com_nav_font_size_lg")},{value:"text-xl",label:n("com_nav_font_size_xl")}];return l.jsxs("div",{className:"flex w-full items-center justify-between",children:[l.jsx("div",{children:n("com_nav_font_size")}),l.jsx(fj,{value:e,options:s,onChange:e=>{t(e),Um(e)},testId:"font-size-selector",sizeClasses:"w-[150px]",className:"z-50"})]})}const IE=()=>{const e=zf(),[t,n]=b(sx.forkSetting),[s,a]=b(sx.splitAtTarget),[r,o]=b(sx.rememberDefaultFork),i=[{value:Yc.DIRECT_PATH,label:e("com_ui_fork_visible")},{value:Yc.INCLUDE_BRANCHES,label:e("com_ui_fork_branches")},{value:Yc.TARGET_LEVEL,label:e("com_ui_fork_all_target")}];return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"pb-3",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[" ",e("com_ui_fork_default")," "]}),l.jsx(Q_,{id:"rememberDefaultFork",checked:r,onCheckedChange:o,className:"ml-4","data-testid":"rememberDefaultFork"})]})}),r&&l.jsx("div",{className:"pb-3",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("div",{children:e("com_ui_fork_change_default")}),l.jsx(wE,{side:"bottom",text:"com_nav_info_fork_change_default"})]}),l.jsx(fj,{value:t,onChange:n,options:i,sizeClasses:"w-[200px]",testId:"fork-setting-dropdown",className:"z-[50]"})]})}),l.jsx("div",{className:"pb-3",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("div",{children:e("com_ui_fork_split_target_setting")}),l.jsx(wE,{side:"bottom",text:"com_nav_info_fork_split_target_setting"})]}),l.jsx(Q_,{id:"splitAtTarget",checked:s,onCheckedChange:a,className:"ml-4","data-testid":"splitAtTarget"})]})})]})},EE=()=>{const[e,t]=b(sx.chatDirection),n=zf();return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{className:"flex items-center space-x-2",children:l.jsx("span",{id:"chat-direction-label",children:n("com_nav_chat_direction")})}),l.jsxs(c_,{variant:"outline","aria-label":"Toggle chat direction",onClick:()=>{t(e=>"LTR"===e?"RTL":"LTR")},"data-testid":"chatDirection",children:[l.jsx("span",{"aria-hidden":"true",children:e.toLowerCase()}),l.jsx("span",{id:"chat-direction-status",className:"sr-only",children:n("LTR"===e?"chat_direction_left_to_right":"chat_direction_right_to_left")})]})]})},ME=[{stateAtom:sx.enterToSend,localizationKey:"com_nav_enter_to_send",switchId:"enterToSend",hoverCardText:"com_nav_info_enter_to_send",key:"enterToSend"},{stateAtom:sx.maximizeChatSpace,localizationKey:"com_nav_maximize_chat_space",switchId:"maximizeChatSpace",hoverCardText:void 0,key:"maximizeChatSpace"},{stateAtom:sx.centerFormOnLanding,localizationKey:"com_nav_center_chat_input",switchId:"centerFormOnLanding",hoverCardText:void 0,key:"centerFormOnLanding"},{stateAtom:sx.showThinking,localizationKey:"com_nav_show_thinking",switchId:"showThinking",hoverCardText:void 0,key:"showThinking"},{stateAtom:sx.showCode,localizationKey:"com_nav_show_code",switchId:"showCode",hoverCardText:void 0,key:"showCode"},{stateAtom:sx.LaTeXParsing,localizationKey:"com_nav_latex_parsing",switchId:"latexParsing",hoverCardText:"com_nav_info_latex_parsing",key:"latexParsing"},{stateAtom:sx.saveDrafts,localizationKey:"com_nav_save_drafts",switchId:"saveDrafts",hoverCardText:"com_nav_info_save_draft",key:"saveDrafts"},{stateAtom:sx.showScrollButton,localizationKey:"com_nav_scroll_button",switchId:"showScrollButton",hoverCardText:void 0,key:"showScrollButton"},{stateAtom:sx.saveBadgesState,localizationKey:"com_nav_save_badges_state",switchId:"showBadges",hoverCardText:"com_nav_info_save_badges_state",key:"showBadges"},{stateAtom:sx.modularChat,localizationKey:"com_nav_modular_chat",switchId:"modularChat",hoverCardText:void 0,key:"modularChat"}];const PE=n.memo(function(){return l.jsxs("div",{className:"flex flex-col gap-3 p-1 text-sm text-text-primary",children:[l.jsx("div",{className:"pb-3",children:l.jsx(RE,{})}),l.jsx("div",{className:"pb-3",children:l.jsx(EE,{})}),ME.map(e=>l.jsx("div",{className:"pb-3",children:l.jsx(NE,{stateAtom:e.stateAtom,localizationKey:e.localizationKey,hoverCardText:e.hoverCardText,switchId:e.switchId})},e.key)),l.jsx(IE,{})]})});function LE(){const e=zf(),t=n.useRef(null),{showToast:s}=Of(),[,a]=n.useState([]),[r,o]=n.useState(!0),i=e=>a(t=>[...t,e]),c=(e=>{const t=Aa(),{onSuccess:n,onError:s,onMutate:a}=e||{};return Oa({mutationFn:e=>gu(e),onSuccess:(e,s,a)=>{t.invalidateQueries([Pd.allConversations]),n&&n(e,s,a)},onError:(e,t,n)=>{s&&s(e,t,n)},onMutate:a})})({onSuccess:()=>{s({message:e("com_ui_import_conversation_success")}),o(!0)},onError:t=>{var n,a;console.error("Error: ",t),o(!0),i((null==(a=null==(n=t.response)?void 0:n.data)?void 0:a.message)??"An error occurred while uploading the file."),!0===(null==t?void 0:t.toString().includes("Unsupported import type"))?s({message:e("com_ui_import_conversation_file_type_error"),status:"error"}):s({message:e("com_ui_import_conversation_error"),status:"error"})},onMutate:()=>{o(!1)}}),d=async e=>{try{await(async e=>{const t=new FormData;t.append("file",e,encodeURIComponent(e.name||"File")),c.mutate(t)})(e)}catch(t){console.log("file handling error",t),i("An error occurred while processing the file.")}},u=()=>{var e;null==(e=t.current)||e.click()};return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:e("com_ui_import_conversation_info")}),l.jsxs("button",{onClick:u,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),u())},disabled:!r,"aria-label":e("com_ui_import"),className:"btn btn-neutral relative",children:[r?l.jsx(Bn,{className:"mr-1 flex h-4 w-4 items-center stroke-1"}):l.jsx(Gb,{className:"mr-1 w-4"}),l.jsx("span",{children:e("com_ui_import")})]}),l.jsx("input",{ref:t,type:"file",className:Op("hidden"),accept:".json",onChange:e=>{var t;const n=null==(t=e.target.files)?void 0:t[0];n&&d(n)},"aria-hidden":"true"})]})}const AE=({endpoint:e="",all:t=!1,disabled:s=!1,setDialogOpen:a})=>{const r=zf(),[o,i]=n.useState(!1),c=(e=>{const t=za();return Fa(()=>iu(e),{onSuccess:()=>{t.invalidateQueries([Pd.name,e]),ji(e)&&(t.invalidateQueries([Pd.assistants,e,li]),t.invalidateQueries([Pd.assistantDocs]),t.invalidateQueries([Pd.assistants]),t.invalidateQueries([Pd.assistant]),t.invalidateQueries([Pd.actions]),t.invalidateQueries([Pd.tools]))}})})(e),d=(()=>{const e=za();return Fa(()=>lu(),{onSuccess:()=>{e.invalidateQueries([Pd.name]),e.invalidateQueries([Pd.assistants,vi.assistants,li]),e.invalidateQueries([Pd.assistants,vi.azureAssistants,li]),e.invalidateQueries([Pd.assistantDocs]),e.invalidateQueries([Pd.assistants]),e.invalidateQueries([Pd.assistant]),e.invalidateQueries([Pd.actions]),e.invalidateQueries([Pd.tools])}})})(),u=()=>{a&&a(!1)},m=t?r("com_ui_revoke_keys"):r("com_ui_revoke_key_endpoint",{0:e}),p=r(t?"com_ui_revoke_keys_confirm":"com_ui_revoke_key_confirm"),h=c.isLoading||d.isLoading;return l.jsxs(A_,{open:o,onOpenChange:i,children:[l.jsx(O_,{asChild:!0,children:l.jsx(c_,{variant:"destructive",className:"flex items-center justify-center rounded-lg transition-colors duration-200",onClick:()=>i(!0),disabled:s,children:r("com_ui_revoke")})}),l.jsx(Oj,{showCloseButton:!1,title:m,className:"max-w-[450px]",main:l.jsx(L_,{className:"text-left text-sm font-medium",children:p}),selection:{selectHandler:()=>{t?d.mutate({}):c.mutate({},{onSuccess:u})},selectClasses:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",selectText:h?l.jsx(Gb,{}):r("com_ui_revoke")}})]})},OE=()=>{const e=zf();return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(L_,{className:"font-light",children:e("com_ui_revoke_info")}),l.jsx(AE,{all:!0})]})},DE=({disabled:e=!1})=>{const t=zf(),[s,a]=n.useState(!1),[r,o]=n.useState(!0),[i,c]=n.useState(!1),[d,u]=n.useState(!1);Gy(n.useRef(null),()=>i&&c(!1),[]);const m=n.useCallback(async()=>{const e=await caches.open("tts-responses"),t=await e.keys();o(0===t.length)},[]);n.useEffect(()=>{m()},[m]);const p=n.useCallback(async()=>{u(!0);const e=await caches.open("tts-responses");await e.keys().then(t=>Promise.all(t.map(t=>e.delete(t)))),u(!1)},[]);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(L_,{className:"font-light",children:t("com_nav_delete_cache_storage")}),l.jsxs(A_,{open:s,onOpenChange:a,children:[l.jsx(O_,{asChild:!0,children:l.jsx(c_,{variant:"destructive",className:"flex items-center justify-center rounded-lg transition-colors duration-200",onClick:()=>a(!0),disabled:e||r,children:t("com_ui_delete")})}),l.jsx(Oj,{showCloseButton:!1,title:t("com_nav_confirm_clear"),className:"max-w-[450px]",main:l.jsx(L_,{className:"text-left text-sm font-medium",children:t("com_nav_clear_cache_confirm_message")}),selection:{selectHandler:p,selectClasses:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",selectText:d?l.jsx(Gb,{}):t("com_ui_delete")}})]})]})},zE=()=>{const e=zf(),[t,s]=n.useState(!1),{newConversation:a}=Mg(),r=(()=>{const e=za();return Fa(()=>ju(),{onSuccess:()=>{e.invalidateQueries([Pd.allConversations])}})})();return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(L_,{className:"font-light",children:e("com_nav_clear_all_chats")}),l.jsxs(A_,{open:t,onOpenChange:s,children:[l.jsx(O_,{asChild:!0,children:l.jsx(c_,{variant:"destructive",className:"flex items-center justify-center rounded-lg transition-colors duration-200",onClick:()=>s(!0),children:e("com_ui_delete")})}),l.jsx(Oj,{showCloseButton:!1,title:e("com_nav_confirm_clear"),className:"max-w-[450px]",main:l.jsx(L_,{className:"text-left text-sm font-medium",children:e("com_nav_clear_conversation_confirm_message")}),selection:{selectHandler:()=>{r.mutate({},{onSuccess:()=>{Sp(),a()}})},selectClasses:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",selectText:r.isLoading?l.jsx(Gb,{}):e("com_ui_delete")}})]})]})},FE={pageSize:25,isPublic:!0,sortBy:"createdAt",sortDirection:"desc",search:""};function VE(){const e=zf(),{showToast:t}=Of(),s=Uy("(max-width: 768px)"),[a,r]=n.useState(FE),[o,i]=n.useState(null),[c,d]=n.useState(!1),[u,m]=n.useState(!1),{data:p,fetchNextPage:h,hasNextPage:x,isFetchingNextPage:f,refetch:g,isLoading:v}=((e,t)=>{const{pageSize:n,isPublic:s,search:a,sortBy:r,sortDirection:o}=e;return Da({queryKey:[Pd.sharedLinks,{pageSize:n,isPublic:s,search:a,sortBy:r,sortDirection:o}],queryFn:({pageParam:e})=>cu({cursor:null==e?void 0:e.toString(),pageSize:n,isPublic:s,search:a,sortBy:r,sortDirection:o}),getNextPageParam:e=>(null==e?void 0:e.nextCursor)??void 0,keepPreviousData:!0,staleTime:3e5,cacheTime:18e5,...t})})(a,{enabled:u,staleTime:0,cacheTime:3e5,refetchOnWindowFocus:!1,refetchOnMount:!1}),b=n.useCallback((e,t)=>{r(n=>({...n,sortBy:e,sortDirection:t}))},[]),y=n.useCallback(e=>{const t=encodeURIComponent(e.trim());r(e=>({...e,search:t}))},[]),_=n.useMemo(()=>Cr(y,300),[y]);n.useEffect(()=>()=>{_.cancel()},[_]);const j=n.useMemo(()=>(null==p?void 0:p.pages)?p.pages.flatMap(e=>e.links.filter(Boolean)):[],[null==p?void 0:p.pages]),w=uf({onSuccess:async()=>{d(!1),i(null),await g()}}),N=n.useCallback(async n=>{const s=n.filter(e=>"string"==typeof e.shareId&&e.shareId.length>0);if(0!==s.length)try{for(const e of s)await w.mutateAsync({shareId:e.shareId});t({message:e(1===s.length?"com_ui_shared_link_delete_success":"com_ui_shared_link_bulk_delete_success"),severity:Wo.SUCCESS})}catch(a){console.error("Failed to delete shared links:",a),t({message:e("com_ui_bulk_delete_error"),severity:Wo.ERROR})}else t({message:e("com_ui_no_valid_items"),severity:Wo.WARNING})},[w,t,e]),C=n.useCallback(async()=>{!0!==x||f||await h()},[h,x,f]),k=n.useCallback(()=>{o&&N([o]),d(!1)},[o,N]),S=n.useMemo(()=>[{accessorKey:"title",header:()=>{const t="title"===a.sortBy,n=a.sortDirection;return l.jsxs(c_,{variant:"ghost",className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",onClick:()=>b("title",t&&"asc"===n?"desc":"asc"),children:[e("com_ui_name"),t&&"asc"===n&&l.jsx(Fn,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),t&&"desc"===n&&l.jsx(Vn,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),!t&&l.jsx(Nn,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})},cell:({row:e})=>{const{title:t,shareId:n}=e.original;return l.jsx("div",{className:"flex items-center gap-2",children:l.jsx(os,{to:`/share/${n}`,target:"_blank",rel:"noopener noreferrer",className:"block truncate text-blue-500 hover:underline",title:t,children:t})})},meta:{size:"35%",mobileSize:"50%"}},{accessorKey:"createdAt",header:()=>{const t="createdAt"===a.sortBy,n=a.sortDirection;return l.jsxs(c_,{variant:"ghost",className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",onClick:()=>b("createdAt",t&&"asc"===n?"desc":"asc"),children:[e("com_ui_date"),t&&"asc"===n&&l.jsx(Fn,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),t&&"desc"===n&&l.jsx(Vn,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"}),!t&&l.jsx(Nn,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})},cell:({row:e})=>{var t;return Em((null==(t=e.original.createdAt)?void 0:t.toString())??"",s)},meta:{size:"10%",mobileSize:"20%"}},{accessorKey:"actions",header:()=>l.jsx(L_,{className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",children:e("com_assistants_actions")}),meta:{size:"7%",mobileSize:"25%"},cell:({row:t})=>l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(rj,{description:e("com_ui_view_source"),render:l.jsx(c_,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:()=>{window.open(`/c/${t.original.conversationId}`,"_blank")},title:e("com_ui_view_source"),children:l.jsx(Un,{className:"size-4"})})}),l.jsx(rj,{description:e("com_ui_delete"),render:l.jsx(c_,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:()=>{i(t.original),d(!0)},title:e("com_ui_delete"),children:l.jsx(Xt,{className:"size-4"})})})]})}],[s,e,a,b]);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:e("com_nav_shared_links")}),l.jsxs(A_,{open:u,onOpenChange:m,children:[l.jsx(O_,{asChild:!0,onClick:()=>m(!0),children:l.jsx(c_,{variant:"outline",children:e("com_ui_manage")})}),l.jsxs(V_,{title:e("com_nav_my_files"),className:"w-11/12 max-w-5xl bg-background text-text-primary shadow-2xl",children:[l.jsx($_,{children:l.jsx(U_,{children:e("com_nav_shared_links")})}),l.jsx(bE,{columns:S,data:j,onDelete:N,filterColumn:"title",hasNextPage:x,isFetchingNextPage:f,fetchNextPage:C,showCheckboxes:!1,onFilterChange:_,filterValue:a.search,isLoading:v})]})]}),l.jsx(A_,{open:c,onOpenChange:d,children:l.jsx(Oj,{showCloseButton:!1,title:e("com_ui_delete_shared_link"),className:"max-w-[450px]",main:l.jsx(l.Fragment,{children:l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsxs(L_,{htmlFor:"dialog-confirm-delete",className:"text-left text-sm font-medium",children:[e("com_ui_delete_confirm")," ",l.jsx("strong",{children:null==o?void 0:o.title})]})})})}),selection:{selectHandler:k,selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 text-white "+(w.isLoading?"cursor-not-allowed opacity-80":""),selectText:w.isLoading?l.jsx(Gb,{}):e("com_ui_delete")}})})]})}const $E=m.memo(function(){const e=n.useRef(null),[t,s]=n.useState(!1);return Gy(e,()=>t&&s(!1),[]),l.jsxs("div",{className:"flex flex-col gap-3 p-1 text-sm text-text-primary",children:[l.jsx("div",{className:"pb-3",children:l.jsx(LE,{})}),l.jsx("div",{className:"pb-3",children:l.jsx(VE,{})}),l.jsx("div",{className:"pb-3",children:l.jsx(OE,{})}),l.jsx("div",{className:"pb-3",children:l.jsx(DE,{})}),l.jsx("div",{className:"pb-3",children:l.jsx(zE,{})})]})});function BE(){const[e,t]=b(sx.codeArtifacts),[n,s]=b(sx.includeShadcnui),[a,r]=b(sx.customPromptMode),o=zf();return l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-medium",children:o("com_ui_artifacts")}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(UE,{id:"codeArtifacts",label:o("com_ui_artifacts_toggle"),checked:e,onCheckedChange:e=>{t(e),e||(s(!1),r(!1))},hoverCardText:"com_nav_info_code_artifacts"}),l.jsx(UE,{id:"includeShadcnui",label:o("com_ui_include_shadcnui"),checked:n,onCheckedChange:e=>{s(e)},hoverCardText:"com_nav_info_include_shadcnui",disabled:!e||a}),l.jsx(UE,{id:"customPromptMode",label:o("com_ui_custom_prompt_mode"),checked:a,onCheckedChange:e=>{r(e),e&&s(!1)},hoverCardText:"com_nav_info_custom_prompt_mode",disabled:!e})]})]})}function UE({id:e,label:t,checked:n,onCheckedChange:s,hoverCardText:a,disabled:r=!1}){return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("div",{className:r?"text-gray-400":"",children:t}),l.jsx(wE,{side:"bottom",text:a})]}),l.jsx(Q_,{id:e,checked:n,onCheckedChange:s,className:"ml-4","data-testid":e,disabled:r})]})}const HE=n.memo(function(){return l.jsx("div",{className:"flex flex-col gap-3 p-1 text-sm text-text-primary",children:l.jsx("div",{className:"pb-3",children:l.jsx(BE,{})})})});function KE(){const[e,t]=b(sx.slashCommand),n=zf();return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:n("com_nav_slash_command_description")}),l.jsx(Q_,{id:"slashCommand",checked:e,onCheckedChange:e=>{t(e)},"data-testid":"slashCommand"})]})}function GE(){const[e,t]=b(sx.plusCommand),n=zf();return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:n("com_nav_plus_command_description")}),l.jsx(Q_,{id:"plusCommand",checked:e,onCheckedChange:e=>{t(e)},className:"ml-4","data-testid":"plusCommand"})]})}function WE(){const[e,t]=b(sx.atCommand),n=zf();return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:n("com_nav_at_command_description")}),l.jsx(Q_,{id:"atCommand",checked:e,onCheckedChange:e=>{t(e)},className:"ml-4","data-testid":"atCommand"})]})}const qE=n.memo(function(){const e=zf(),t=Zv({permissionType:bd.PROMPTS,permission:yd.USE}),n=Zv({permissionType:bd.MULTI_CONVO,permission:yd.USE});return l.jsxs("div",{className:"space-y-4 p-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("h3",{className:"text-lg font-medium text-text-primary",children:e("com_nav_chat_commands")}),l.jsx(wE,{side:"bottom",text:"com_nav_chat_commands_info"})]}),l.jsxs("div",{className:"flex flex-col gap-3 text-sm text-text-primary",children:[l.jsx("div",{className:"pb-3",children:l.jsx(WE,{})}),!0===n&&l.jsx("div",{className:"pb-3",children:l.jsx(GE,{})}),!0===t&&l.jsx("div",{className:"pb-3",children:l.jsx(KE,{})})]})]})});function QE(){const e=zf(),[t,n]=b(sx.UsernameDisplay);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(L_,{className:"font-light",children:e("com_nav_user_name_display")}),l.jsx(wE,{side:"bottom",text:"com_nav_info_user_name_display"})]}),l.jsx(Q_,{id:"UsernameDisplay",checked:t,onCheckedChange:e=>{n(e)},className:"ml-4","data-testid":"UsernameDisplay"})]})}const ZE=({disabled:e=!1})=>{const t=zf(),{user:s,logout:a}=Rg(),{mutate:r,isLoading:o}=cx({onMutate:()=>a()}),[i,c]=n.useState(!1),[d,u]=n.useState(!0),m=n.useCallback(e=>{const t=e.trim().toLowerCase()===(null==s?void 0:s.email.trim().toLowerCase());u(!t)},[null==s?void 0:s.email]);return l.jsx(l.Fragment,{children:l.jsxs(A_,{open:i,onOpenChange:c,children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{children:t("com_nav_delete_account")}),l.jsx(O_,{asChild:!0,children:l.jsx(c_,{variant:"destructive",className:"flex items-center justify-center rounded-lg transition-colors duration-200",onClick:()=>c(!0),disabled:e,children:t("com_ui_delete")})})]}),l.jsxs(V_,{className:"w-11/12 max-w-md",children:[l.jsx($_,{children:l.jsx(U_,{className:"text-lg font-medium leading-6",children:t("com_nav_delete_account_confirm")})}),l.jsx("div",{className:"mb-8 text-sm text-black dark:text-white",children:l.jsxs("ul",{className:"font-semibold text-amber-600",children:[l.jsx("li",{children:t("com_nav_delete_warning")}),l.jsx("li",{children:t("com_nav_delete_data_info")})]})}),l.jsxs("div",{className:"flex-col items-center justify-center",children:[l.jsx("div",{className:"mb-4",children:JE(t("com_nav_delete_account_email_placeholder"),"email-confirm-input",(null==s?void 0:s.email)??"",e=>m(e.target.value))}),YE(()=>{d||r(void 0)},o,d,t)]})]})]})})},JE=(e,t,n,s)=>l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"mb-1 block text-sm font-medium text-black dark:text-white",htmlFor:t,children:e}),l.jsx(M_,{id:t,onChange:s,placeholder:n})]}),YE=(e,t,n,s)=>l.jsx("button",{className:Op("mt-4 flex w-full items-center justify-center rounded-lg bg-surface-tertiary px-4 py-2 transition-all duration-200",n?"cursor-not-allowed opacity-30":"bg-destructive text-destructive-foreground"),onClick:e,disabled:t||n,children:t?l.jsx("div",{className:"flex h-6 justify-center",children:l.jsx(Gb,{className:"icon-sm m-auto"})}):l.jsx(l.Fragment,{children:n?l.jsxs(l.Fragment,{children:[l.jsx(Hn,{className:"size-5"}),l.jsx("span",{className:"ml-2",children:s("com_ui_locked")})]}):l.jsxs(l.Fragment,{children:[l.jsx(Xt,{className:"size-5"}),l.jsx("span",{className:"ml-2",children:s("com_nav_delete_account_button")})]})})});function XE(){const e=y(sx.user),[t,s]=n.useState(1),[a,r]=n.useState(0),o=n.useRef(null),i=n.useRef(null),c=n.useRef(null),[d,u]=n.useState(null),[m,p]=n.useState(!1),{data:h=kl}=Rx({select:e=>El(e)}),x=zf(),{showToast:f}=Of(),{mutate:g,isLoading:v}=(b={onSuccess:t=>{var n;f({message:x("com_ui_upload_success")}),e(e=>({...e,avatar:t.url})),null==(n=c.current)||n.click()},onError:e=>{console.error("Error:",e),f({message:x("com_ui_upload_error"),status:"error"})}},Oa([Ld.avatarUpload],{mutationFn:e=>vu(e),...b||{}}));var b;const _=e=>{if(null!=h.avatarSizeLimit&&e&&e.size<=h.avatarSizeLimit)u(e),s(1),r(0);else{const e=null!=h.avatarSizeLimit?Pm(h.avatarSizeLimit):2;f({message:x("com_ui_upload_invalid_var",{0:e+""}),status:"error"})}},j=n.useCallback(e=>{e.preventDefault();const t=e.dataTransfer.files[0];_(t)},[]),w=n.useCallback(e=>{e.preventDefault()},[]),N=n.useCallback(()=>{u(null),s(1),r(0)},[]);return l.jsxs(A_,{open:m,onOpenChange:e=>{p(e),e||(N(),setTimeout(()=>{var e;null==(e=c.current)||e.focus()},0))},children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{children:x("com_nav_profile_picture")}),l.jsx(O_,{ref:c,children:l.jsxs(c_,{variant:"outline",children:[l.jsx(Kn,{className:"mr-2 flex w-[22px] items-center stroke-1"}),l.jsx("span",{children:x("com_nav_change_picture")})]})})]}),l.jsxs(V_,{className:"w-11/12 max-w-sm",style:{borderRadius:"12px"},children:[l.jsx($_,{children:l.jsx(U_,{className:"text-lg font-medium leading-6 text-text-primary",children:x(null!=d?"com_ui_preview":"com_ui_upload_image")})}),l.jsx("div",{className:"flex flex-col items-center justify-center",children:null!=d?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"relative overflow-hidden rounded-full",children:l.jsx(Gn,{ref:o,image:d,width:250,height:250,border:0,borderRadius:125,color:[255,255,255,.6],scale:t,rotate:a})}),l.jsxs("div",{className:"mt-4 flex w-full flex-col items-center space-y-4",children:[l.jsxs("div",{className:"flex w-full items-center justify-center space-x-4",children:[l.jsx("span",{className:"text-sm",children:x("com_ui_zoom")}),l.jsx(K_,{value:[t],min:1,max:5,step:.001,onValueChange:e=>{s(e[0])},className:"w-2/3 max-w-xs"})]}),l.jsx("button",{onClick:()=>{r(e=>(e+90)%360)},className:"rounded-full bg-gray-200 p-2 transition-colors hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500",children:l.jsx(qt,{className:"h-5 w-5"})})]}),l.jsxs(c_,{className:Op("btn btn-primary mt-4 flex w-full hover:bg-gray-100 dark:hover:bg-gray-700",v?"cursor-not-allowed opacity-90":""),onClick:()=>{if(o.current){o.current.getImageScaledToCanvas().toBlob(e=>{if(e){const t=new FormData;t.append("file",e,"avatar.png"),t.append("manual","true"),g(t)}},"image/png")}},disabled:v,children:[v?l.jsx(Gb,{className:"icon-sm mr-2"}):l.jsx(Wn,{className:"mr-2 h-5 w-5"}),x("com_ui_upload")]})]}):l.jsxs("div",{className:"flex h-64 w-11/12 flex-col items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-transparent dark:border-gray-600",onDrop:j,onDragOver:w,children:[l.jsx(Kn,{className:"mb-4 size-12 text-gray-400"}),l.jsx("p",{className:"mb-2 text-center text-sm text-gray-500 dark:text-gray-400",children:x("com_ui_drag_drop")}),l.jsx(c_,{variant:"secondary",onClick:()=>{var e;null==(e=i.current)||e.click()},children:x("com_ui_select_file")}),l.jsx("input",{ref:i,type:"file",className:"hidden",accept:".png, .jpg, .jpeg",onChange:e=>{var t;const n=null==(t=e.target.files)?void 0:t[0];_(n)}})]})})]})]})}const eM={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},tM=({backupCodes:e,onDownload:t,downloaded:n,onNext:s})=>{const a=zf();return l.jsxs(Dr.div,{...eM,className:"space-y-6",children:[l.jsx(L_,{className:"break-keep text-sm",children:a("com_ui_download_backup_tooltip")}),l.jsx("div",{className:"grid grid-cols-2 gap-4 rounded-xl bg-surface-secondary p-6",children:e.map((e,t)=>l.jsx(Dr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"rounded-lg bg-surface-tertiary p-3",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("span",{className:"hidden text-sm text-text-secondary sm:inline",children:["#",t+1]}),l.jsx("span",{className:"font-mono text-lg",children:e})]})},e))}),l.jsxs("div",{className:"flex gap-4",children:[l.jsxs(c_,{variant:"outline",onClick:t,className:"flex-1 gap-2",children:[l.jsx(dn,{className:"h-4 w-4"}),l.jsx("span",{className:"hidden sm:inline",children:a("com_ui_download_backup")})]}),l.jsx(c_,{onClick:s,disabled:!n,className:"flex-1",children:a("com_ui_complete_setup")})]})]})},nM={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},sM=({secret:e,otpauthUrl:t,onNext:s})=>{const a=zf(),[r,o]=n.useState(!1);return l.jsxs(Dr.div,{...nM,className:"space-y-6",children:[l.jsxs("div",{className:"flex flex-col items-center space-y-6",children:[l.jsx(Dr.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"rounded-2xl bg-white p-4 shadow-lg",children:l.jsx(no,{value:t,size:240})}),l.jsxs("div",{className:"w-full space-y-3",children:[l.jsx(L_,{className:"text-sm font-medium text-text-secondary",children:a("com_ui_secret_key")}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx(M_,{value:e,readOnly:!0,className:"font-mono text-lg tracking-wider"}),l.jsx(c_,{size:"sm",variant:"outline",onClick:async()=>{await navigator.clipboard.writeText(e),o(!0),setTimeout(()=>o(!1),2e3)},className:Op("h-auto shrink-0",r?"cursor-default":""),children:r?l.jsx(se,{className:"size-4"}):l.jsx(Jt,{className:"size-4"})})]})]})]}),l.jsx(c_,{onClick:s,className:"w-full",children:a("com_ui_continue")})]})},aM={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},rM=({token:e,onTokenChange:t,isVerifying:n,onNext:s})=>{const a=zf();return l.jsxs(Dr.div,{...aM,className:"space-y-8",children:[l.jsx("div",{className:"flex justify-center",children:l.jsxs(ij,{value:e,onChange:t,maxLength:6,pattern:$e,className:"gap-2",children:[l.jsx(lj,{children:Array.from({length:3}).map((e,t)=>l.jsx(cj,{index:t},t))}),l.jsx(dj,{}),l.jsx(lj,{children:Array.from({length:3}).map((e,t)=>l.jsx(cj,{index:t+3},t+3))})]})}),l.jsx(c_,{onClick:s,disabled:n||6!==e.length,className:"w-full",children:a("com_ui_verify")})]})},oM={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},iM=({isGenerating:e,onGenerate:t})=>{const n=zf();return l.jsx(Dr.div,{...oM,className:"space-y-6",children:l.jsxs("div",{className:"rounded-xl bg-surface-secondary p-6",children:[l.jsx("h3",{className:"mb-4 flex justify-center text-lg font-medium",children:n("com_ui_2fa_account_security")}),l.jsxs(c_,{variant:"default",onClick:t,className:"flex w-full",disabled:e,children:[e?l.jsx(Gb,{className:"size-5"}):l.jsx(Qt,{className:"size-5"}),n(e?"com_ui_generating":"com_ui_generate_qrcode")]})]})})},lM={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},cM=({onDisable:e,isDisabling:t})=>{const s=zf(),[a,r]=n.useState(""),[o,i]=n.useState(!1);return l.jsxs(Dr.div,{...lM,className:"space-y-8",children:[l.jsx("div",{className:"flex justify-center",children:l.jsx(ij,{value:a,onChange:r,maxLength:o?8:6,pattern:o?Be:$e,className:"gap-2",children:o?l.jsxs(lj,{children:[l.jsx(cj,{index:0}),l.jsx(cj,{index:1}),l.jsx(cj,{index:2}),l.jsx(cj,{index:3}),l.jsx(cj,{index:4}),l.jsx(cj,{index:5}),l.jsx(cj,{index:6}),l.jsx(cj,{index:7})]}):l.jsxs(l.Fragment,{children:[l.jsxs(lj,{children:[l.jsx(cj,{index:0}),l.jsx(cj,{index:1}),l.jsx(cj,{index:2})]}),l.jsx(dj,{}),l.jsxs(lj,{children:[l.jsx(cj,{index:3}),l.jsx(cj,{index:4}),l.jsx(cj,{index:5})]})]})})}),l.jsxs(c_,{variant:"destructive",onClick:()=>e(a,o),disabled:t||a.length!==(o?8:6),className:"w-full rounded-xl px-6 py-3 transition-all disabled:opacity-50",children:[t&&l.jsx(Gb,{className:"mr-2"}),s(t?"com_ui_disabling":"com_ui_2fa_disable")]}),l.jsx("button",{onClick:()=>i(!o),className:"text-sm text-primary hover:underline",children:s(o?"com_ui_use_2fa_code":"com_ui_use_backup_code")})]})},dM=({enabled:e,onChange:t,disabled:n})=>{const s=zf();return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{className:"flex items-center space-x-2",children:l.jsxs(L_,{className:"font-light",children:[" ",s("com_nav_2fa")]})}),l.jsx("div",{className:"flex items-center gap-3",children:l.jsx(c_,{variant:e?"destructive":"outline",onClick:t,disabled:n,children:s(e?"com_ui_2fa_disable":"com_ui_2fa_enable")})})]})},uM={initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1,transition:{duration:.3,ease:"easeOut"}},exit:{opacity:0,scale:.95,transition:{duration:.3,ease:"easeIn"}}},mM=m.memo(()=>{const e=zf(),{user:t}=Rg(),s=y(sx.user),{showToast:a}=Of(),[r,o]=n.useState(""),[i,c]=n.useState(""),[d,u]=n.useState(!1),[m,p]=n.useState(""),[h,x]=n.useState([]),[f,g]=n.useState(!1),[v,b]=n.useState(""),[_,j]=n.useState((null==t?void 0:t.twoFactorEnabled)?"disable":"setup"),{mutate:w}=mx(),{mutate:N,isLoading:C}=dx(),{mutate:k,isLoading:S}=ux(),{mutate:T,isLoading:R}=px(),I=["Setup","Scan QR","Verify","Backup"],E={setup:"Setup",qr:"Scan QR",verify:"Verify",backup:"Backup",disable:""},M=I.indexOf(E[_]),P=n.useCallback(()=>{(null==t?void 0:t.twoFactorEnabled)&&i&&T(void 0,{onError:()=>a({message:e("com_ui_2fa_disable_error"),status:"error"})}),c(""),o(""),x([]),b(""),p(""),j((null==t?void 0:t.twoFactorEnabled)?"disable":"setup"),u(!1)},[t,i,T,e,a]),L=n.useCallback(()=>{N(void 0,{onSuccess:({otpauthUrl:e,backupCodes:t})=>{c(e),o(e.split("secret=")[1].split("&")[0]),x(t),j("qr")},onError:()=>a({message:e("com_ui_2fa_generate_error"),status:"error"})})},[N,e,a]),A=n.useCallback(()=>{v&&k({token:v},{onSuccess:()=>{a({message:e("com_ui_2fa_verified")}),w({token:v},{onSuccess:()=>j("backup"),onError:()=>a({message:e("com_ui_2fa_invalid"),status:"error"})})},onError:()=>a({message:e("com_ui_2fa_invalid"),status:"error"})})},[v,k,w,e,a]),O=n.useCallback(()=>{if(!h.length)return;const e=new Blob([h.join("\n")],{type:"text/plain;charset=utf-8"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="backup-codes.txt",n.click(),URL.revokeObjectURL(t),u(!0)},[h]),D=n.useCallback(()=>{g(!1),j("disable"),a({message:e("com_ui_2fa_enabled")}),s(e=>({...e,backupCodes:h.map(e=>({code:e,codeHash:e,used:!1,usedAt:null})),twoFactorEnabled:!0}))},[s,e,a,h]),z=n.useCallback((t,n)=>{if(!n&&t.trim().length<6)return;if(n&&t.trim().length<8)return;const r={};n?r.backupCode=t.trim():r.token=t.trim(),k(r,{onSuccess:()=>{T(void 0,{onSuccess:()=>{a({message:e("com_ui_2fa_disabled")}),g(!1),s(e=>({...e,totpSecret:"",backupCodes:[],twoFactorEnabled:!1})),j("setup"),c("")},onError:()=>a({message:e("com_ui_2fa_disable_error"),status:"error"})})},onError:()=>a({message:e("com_ui_2fa_invalid"),status:"error"})})},[k,T,a,e,s]);return l.jsxs(A_,{open:f,onOpenChange:e=>{g(e),e||P()},children:[l.jsx(dM,{enabled:!!(null==t?void 0:t.twoFactorEnabled),onChange:()=>g(!0),disabled:S||R||C}),l.jsx(V_,{className:"w-11/12 max-w-lg p-6",children:l.jsx(Or,{mode:"wait",children:l.jsxs(Dr.div,{variants:uM,initial:"initial",animate:"animate",exit:"exit",className:"space-y-6",children:[l.jsxs($_,{children:[l.jsxs(U_,{className:"mb-2 flex items-center gap-3 text-2xl font-bold",children:[l.jsx(qn,{className:"h-6 w-6 text-primary"}),(null==t?void 0:t.twoFactorEnabled)?e("com_ui_2fa_disable"):e("com_ui_2fa_setup")]}),(null==t?void 0:t.twoFactorEnabled)&&"disable"!==_&&l.jsxs("div",{className:"mt-4 space-y-3",children:[l.jsx(oj,{value:I.indexOf(E[_])/(I.length-1)*100,className:"h-2 rounded-full"}),l.jsx("div",{className:"flex justify-between text-sm",children:I.map((e,t)=>l.jsx(Dr.span,{animate:{color:M>=t?"var(--text-primary)":"var(--text-tertiary)"},className:"font-medium",children:e},e))})]})]}),l.jsxs(Or,{mode:"wait",children:["setup"===_&&l.jsx(iM,{isGenerating:C,onGenerate:L,onNext:()=>j("qr"),onError:e=>a({message:e.message,status:"error"})}),"qr"===_&&l.jsx(sM,{secret:r,otpauthUrl:i,onNext:()=>j("verify"),onError:e=>a({message:e.message,status:"error"})}),"verify"===_&&l.jsx(rM,{token:v,onTokenChange:b,isVerifying:S,onNext:A,onError:e=>a({message:e.message,status:"error"})}),"backup"===_&&l.jsx(tM,{backupCodes:h,onDownload:O,downloaded:d,onNext:D,onError:e=>a({message:e.message,status:"error"})}),"disable"===_&&l.jsx(cM,{onDisable:z,isDisabling:R,onError:e=>a({message:e.message,status:"error"})})]})]},_)})})]})}),pM=m.memo(()=>{const e=zf(),{user:t}=Rg(),{showToast:s}=Of(),a=y(sx.user),[r,o]=n.useState(!1),{mutate:i,isLoading:c}=hx(),d=()=>{((t=!1)=>{i(void 0,{onSuccess:n=>{const r=n.backupCodesHash.map(e=>({codeHash:e,used:!1,usedAt:null}));if(a(e=>({...e,backupCodes:r})),s({message:e("com_ui_backup_codes_regenerated"),status:"success"}),!t&&r.length){const e=n.backupCodes.join("\n"),t=new Blob([e],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="backup-codes.txt",a.click(),URL.revokeObjectURL(s)}},onError:()=>s({message:e("com_ui_backup_codes_regenerate_error"),status:"error"})})})(!1)};return l.jsxs(A_,{open:r,onOpenChange:o,children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{className:"flex items-center space-x-3",children:l.jsx(L_,{className:"font-light",children:e("com_ui_backup_codes")})}),l.jsx(O_,{asChild:!0,children:l.jsx(c_,{"aria-label":"Show Backup Codes",variant:"outline",children:e("com_ui_show")})})]}),l.jsxs(V_,{className:"w-11/12 max-w-lg",children:[l.jsx(U_,{className:"mb-6 text-2xl font-semibold",children:e("com_ui_backup_codes")}),l.jsx(Or,{children:l.jsx(Dr.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mt-4",children:Array.isArray(null==t?void 0:t.backupCodes)&&(null==t?void 0:t.backupCodes.length)>0?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"grid grid-cols-2 gap-4",children:null==t?void 0:t.backupCodes.map((t,n)=>{const s=t.used,a=`Backup code number ${n+1}, ${s?`used on ${t.usedAt?new Date(t.usedAt).toLocaleDateString():"an unknown date"}`:"not used yet"}`;return l.jsx(Dr.div,{role:"listitem",tabIndex:0,"aria-label":a,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*n},onFocus:()=>{const e=new CustomEvent("announce",{detail:{message:a}});document.dispatchEvent(e)},className:`flex flex-col rounded-xl border p-4 backdrop-blur-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary ${s?"border-red-200 bg-red-50/80 dark:border-red-800 dark:bg-red-900/20":"border-gray-300 bg-white dark:border-gray-600 dark:bg-gray-800"} `,children:l.jsxs("div",{className:"flex items-center justify-between","aria-hidden":"true",children:[l.jsxs("span",{className:"text-sm font-medium text-text-secondary",children:["#",n+1]}),l.jsx(rj,{description:t.usedAt?new Date(t.usedAt).toLocaleDateString():"",disabled:!s,focusable:!1,className:s?"cursor-pointer":"cursor-default",render:l.jsx("span",{className:"rounded-full px-3 py-1 text-sm font-medium "+(s?"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300":"bg-gray-100 text-black dark:bg-gray-700 dark:text-white"),children:e(s?"com_ui_used":"com_ui_not_used")})})]})},t.codeHash)})}),l.jsx("div",{className:"mt-12 flex justify-center",children:l.jsxs(c_,{onClick:d,disabled:c,variant:"default",className:"px-8 py-3 transition-all disabled:opacity-50",children:[c?l.jsx(Gb,{className:"mr-2"}):l.jsx(Qn,{className:"mr-2 h-4 w-4"}),e(c?"com_ui_regenerating":"com_ui_regenerate_backup")]})})]}):l.jsxs("div",{className:"flex flex-col items-center gap-4 p-6 text-center",children:[l.jsx(Zn,{className:"h-12 w-12 text-text-primary"}),l.jsx("p",{className:"text-lg text-text-secondary",children:e("com_ui_no_backup_codes")}),l.jsxs(c_,{onClick:d,disabled:c,variant:"default",className:"px-8 py-3 transition-all disabled:opacity-50",children:[c&&l.jsx(Gb,{className:"mr-2"}),e("com_ui_generate_backup")]})]})})})]})]})});const hM=m.memo(function(){var e,t;const n=Rg();return l.jsxs("div",{className:"flex flex-col gap-3 p-1 text-sm text-text-primary",children:[l.jsx("div",{className:"pb-3",children:l.jsx(QE,{})}),l.jsx("div",{className:"pb-3",children:l.jsx(XE,{})}),"local"===(null==(e=null==n?void 0:n.user)?void 0:e.provider)&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"pb-3",children:l.jsx(mM,{})}),(null==(t=null==n?void 0:n.user)?void 0:t.twoFactorEnabled)&&l.jsx("div",{className:"pb-3",children:l.jsx(pM,{})})]}),l.jsx("div",{className:"pb-3",children:l.jsx(ZE,{})})]})}),xM=({tokenCredits:e})=>{const t=zf();return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(L_,{className:"font-light",children:t("com_nav_balance")}),l.jsx(wE,{side:"bottom",text:"com_nav_info_balance"})]}),l.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",role:"note",children:void 0!==e?e.toFixed(2):"0.00"})]})},fM=({lastRefill:e,refillAmount:t,refillIntervalUnit:n,refillIntervalValue:s})=>{const a=zf(),r=e?new Date(e):null,o=r?((e,t,n)=>{const s=new Date(e);switch(n){case"seconds":s.setSeconds(s.getSeconds()+t);break;case"minutes":s.setMinutes(s.getMinutes()+t);break;case"hours":s.setHours(s.getHours()+t);break;case"days":s.setDate(s.getDate()+t);break;case"weeks":s.setDate(s.getDate()+7*t);break;case"months":s.setMonth(s.getMonth()+t)}return s})(r,s,n):null;return l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-medium",children:a("com_nav_balance_auto_refill_settings")}),l.jsxs("div",{className:"mb-1 flex justify-between text-sm",children:[l.jsx("span",{children:a("com_nav_balance_last_refill")}),l.jsx("span",{children:r?r.toLocaleString():"-"})]}),l.jsxs("div",{className:"mb-1 flex justify-between text-sm",children:[l.jsx("span",{children:a("com_nav_balance_refill_amount")}),l.jsx("span",{children:void 0!==t?t:"-"})]}),l.jsxs("div",{className:"mb-1 flex justify-between text-sm",children:[l.jsx("span",{children:a("com_nav_balance_interval")}),l.jsxs("span",{children:[a("com_nav_balance_every")," ",s," ",((e,t)=>{let n;switch(t){case"seconds":n=1===e?"com_nav_balance_second":"com_nav_balance_seconds";break;case"minutes":n=1===e?"com_nav_balance_minute":"com_nav_balance_minutes";break;case"hours":n=1===e?"com_nav_balance_hour":"com_nav_balance_hours";break;case"days":n=1===e?"com_nav_balance_day":"com_nav_balance_days";break;case"weeks":n=1===e?"com_nav_balance_week":"com_nav_balance_weeks";break;case"months":n=1===e?"com_nav_balance_month":"com_nav_balance_months";break;default:n="com_nav_balance_seconds"}return a(n)})(s,n)]})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(L_,{className:"font-light",children:a("com_nav_balance_next_refill")}),l.jsx(wE,{side:"bottom",text:"com_nav_balance_next_refill_info"})]}),l.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",role:"note",children:o?o.toLocaleString():"-"})]})]})};const gM=m.memo(function(){var e;const t=zf(),{isAuthenticated:n}=Rg(),{data:s}=Sx(),a=Bx({enabled:!!n&&!!(null==(e=null==s?void 0:s.balance)?void 0:e.enabled)}).data,{tokenCredits:r=0,autoRefillEnabled:o=!1,lastRefill:i,refillAmount:c,refillIntervalUnit:d,refillIntervalValue:u}=a??{},m=void 0!==i&&void 0!==c&&void 0!==d&&void 0!==u;return l.jsxs("div",{className:"flex flex-col gap-4 p-4 text-sm text-text-primary",children:[l.jsx(xM,{tokenCredits:r}),o?m?l.jsx(fM,{lastRefill:i,refillAmount:c,refillIntervalUnit:d,refillIntervalValue:u}):l.jsx("div",{className:"text-sm text-red-600",children:t("com_nav_balance_auto_refill_error")}):l.jsx("div",{className:"text-sm text-gray-600",children:t("com_nav_balance_auto_refill_disabled")})]})});function vM({onCheckedChange:e}){const t=zf(),[n,s]=b(sx.cloudBrowserVoices),[a]=b(sx.textToSpeech);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:t("com_nav_enable_cloud_browser_voice")}),l.jsx(Q_,{id:"CloudBrowserVoices",checked:n,onCheckedChange:t=>{s(t),e&&e(t)},className:"ml-4","data-testid":"CloudBrowserVoices",disabled:!a})]})}function bM({onCheckedChange:e}){const t=zf(),[n,s]=b(sx.automaticPlayback);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:t("com_nav_automatic_playback")}),l.jsx(Q_,{id:"AutomaticPlayback",checked:n,onCheckedChange:t=>{s(t),e&&e(t)},className:"ml-4","data-testid":"AutomaticPlayback"})]})}function yM({onCheckedChange:e}){const t=zf(),[n,s]=b(sx.textToSpeech);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:l.jsx("strong",{children:t("com_nav_text_to_speech")})}),l.jsx(Q_,{id:"TextToSpeech",checked:n,onCheckedChange:t=>{s(t),e&&e(t)},className:"ml-4","data-testid":"TextToSpeech"})]})}const _M=({external:e})=>{const t=zf(),[n,s]=b(sx.engineTTS),a=e?[{value:"browser",label:t("com_nav_browser")},{value:"external",label:t("com_nav_external")}]:[{value:"browser",label:t("com_nav_browser")}];return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:t("com_nav_engine")}),l.jsx(fj,{value:n,onChange:e=>{s(e)},options:a,sizeClasses:"w-[180px]",testId:"EngineTTSDropdown",className:"z-50"})]})};function jM({onCheckedChange:e}){const t=zf(),[n,s]=b(sx.cacheTTS),[a]=b(sx.textToSpeech);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:t("com_nav_enable_cache_tts")}),l.jsx(Q_,{id:"CacheTTS",checked:n,onCheckedChange:t=>{s(t),e&&e(t)},className:"ml-4","data-testid":"CacheTTS",disabled:!a})]})}const wM={[$o.browser]:function(){const e=zf(),{voices:t=[]}=Bf(),[n,s]=b(sx.voice);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:e("com_nav_voice_select")}),l.jsx(fj,{value:n??"",options:t,onChange:e=>{Dp.log("Browser Voice changed:",e);const t="string"==typeof e?e:null==e?void 0:e.value;if(null!=t)return s(t.toString())},sizeClasses:"min-w-[200px] !max-w-[400px] [--anchor-max-width:400px]",testId:"BrowserVoiceDropdown",className:"z-50"},`browser-voice-dropdown-${t.length}`)]})},[$o.external]:function(){const e=zf(),{voices:t=[]}=$f(),[n,s]=b(sx.voice);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:e("com_nav_voice_select")}),l.jsx(fj,{value:n??"",options:t,onChange:e=>{Dp.log("External Voice changed:",e);const t="string"==typeof e?e:null==e?void 0:e.value;if(null!=t)return s(t.toString())},sizeClasses:"min-w-[200px] !max-w-[400px] [--anchor-max-width:400px]",testId:"ExternalVoiceDropdown",className:"z-50"},`external-voice-dropdown-${t.length}`)]})}};function NM(){const e=_(sx.engineTTS),t=wM[e];return t?l.jsx(t,{}):null}function CM(){const e=zf(),t=_(sx.textToSpeech),[n,s]=b(sx.playbackRate);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:e("com_nav_playback_rate")}),l.jsx("div",{className:"w-2"}),l.jsxs("small",{className:"opacity-40",children:["(",e("com_endpoint_default_with_num",{0:"1"}),")"]})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(K_,{value:[n??1],onValueChange:e=>s(e[0]),onDoubleClick:()=>s(null),min:.1,max:2,step:.1,className:"ml-4 flex h-4 w-24",disabled:!t}),l.jsx("div",{className:"w-2"}),l.jsx(P_,{value:n??1,disabled:!t,onChange:e=>s(e?e[0]:0),min:.1,max:2,className:Op(Wp,Op(qp,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]})]})}function kM(){const e=zf(),t=_(sx.speechToText),[n,s]=b(sx.autoSendText);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:e("com_nav_auto_send_text")}),l.jsx("div",{className:"w-2"}),l.jsxs("small",{className:"opacity-40",children:["(",e("com_nav_auto_send_text_disabled"),")"]})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(K_,{value:[n??-1],onValueChange:e=>s(e[0]),onDoubleClick:()=>s(-1),min:-1,max:60,step:1,className:"ml-4 flex h-4 w-24",disabled:!t}),l.jsx("div",{className:"w-2"}),l.jsx(P_,{value:`${n} s`,disabled:!t,onChange:e=>s(e?e[0]:0),min:-1,max:60,className:Op(Wp,Op(qp,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]})]})}function SM({onCheckedChange:e}){const t=zf(),[n,s]=b(sx.speechToText);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:l.jsx("strong",{children:t("com_nav_speech_to_text")})}),l.jsx(Q_,{id:"SpeechToText",checked:n,onCheckedChange:t=>{s(t),e&&e(t)},className:"ml-4","data-testid":"SpeechToText"})]})}const TM=({external:e})=>{const t=zf(),[n,s]=b(sx.engineSTT),a=e?[{value:"browser",label:t("com_nav_browser")},{value:"external",label:t("com_nav_external")}]:[{value:"browser",label:t("com_nav_browser")}];return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:t("com_nav_engine")}),l.jsx(fj,{value:n,onChange:e=>{s(e)},options:a,sizeClasses:"w-[180px]",testId:"EngineSTTDropdown",className:"z-50"})]})};function RM(){const e=zf(),t=_(sx.speechToText),[n,s]=b(sx.decibelValue);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:e("com_nav_db_sensitivity")}),l.jsx("div",{className:"w-2"}),l.jsxs("small",{className:"opacity-40",children:["(",e("com_endpoint_default_with_num",{0:"-45"}),")"]})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(K_,{value:[n??-45],onValueChange:e=>s(e[0]),onDoubleClick:()=>s(-45),min:-100,max:-30,step:1,className:"ml-4 flex h-4 w-24",disabled:!t}),l.jsx("div",{className:"w-2"}),l.jsx(P_,{value:n,disabled:!t,onChange:e=>s(e?e[0]:0),min:-100,max:-30,className:Op(Wp,Op(qp,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]})]})}function IM({onCheckedChange:e}){const t=zf(),[n,s]=b(sx.autoTranscribeAudio),a=_(sx.speechToText);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:t("com_nav_auto_transcribe_audio")}),l.jsx(Q_,{id:"AutoTranscribeAudio",checked:n,onCheckedChange:t=>{s(t),e&&e(t)},className:"ml-4","data-testid":"AutoTranscribeAudio",disabled:!a})]})}function EM(){const e=zf(),[t,n]=b(sx.languageSTT);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:e("com_nav_language")}),l.jsx(fj,{value:t,onChange:e=>{n(e)},options:[{value:"af",label:"Afrikaans"},{value:"eu",label:"Basque"},{value:"bg",label:"Bulgarian"},{value:"ca",label:"Catalan"},{value:"ar-EG",label:"Arabic (Egypt)"},{value:"ar-JO",label:"Arabic (Jordan)"},{value:"ar-KW",label:"Arabic (Kuwait)"},{value:"ar-LB",label:"Arabic (Lebanon)"},{value:"ar-QA",label:"Arabic (Qatar)"},{value:"ar-AE",label:"Arabic (UAE)"},{value:"ar-MA",label:"Arabic (Morocco)"},{value:"ar-IQ",label:"Arabic (Iraq)"},{value:"ar-DZ",label:"Arabic (Algeria)"},{value:"ar-BH",label:"Arabic (Bahrain)"},{value:"ar-LY",label:"Arabic (Libya)"},{value:"ar-OM",label:"Arabic (Oman)"},{value:"ar-SA",label:"Arabic (Saudi Arabia)"},{value:"ar-TN",label:"Arabic (Tunisia)"},{value:"ar-YE",label:"Arabic (Yemen)"},{value:"cs",label:"Czech"},{value:"nl-NL",label:"Dutch"},{value:"en-AU",label:"English (Australia)"},{value:"en-CA",label:"English (Canada)"},{value:"en-IN",label:"English (India)"},{value:"en-NZ",label:"English (New Zealand)"},{value:"en-ZA",label:"English (South Africa)"},{value:"en-GB",label:"English (UK)"},{value:"en-US",label:"English (US)"},{value:"et-EE",label:"Estonian"},{value:"fi",label:"Finnish"},{value:"fr-FR",label:"French"},{value:"gl",label:"Galician"},{value:"de-DE",label:"German"},{value:"el-GR",label:"Greek"},{value:"he",label:"Hebrew"},{value:"hu",label:"Hungarian"},{value:"is",label:"Icelandic"},{value:"it-IT",label:"Italian"},{value:"id",label:"Indonesian"},{value:"ja",label:"Japanese"},{value:"ko",label:"Korean"},{value:"la",label:"Latin"},{value:"lv-LV",label:"Latvian"},{value:"lt-LT",label:"Lithuanian"},{value:"zh-CN",label:"Mandarin Chinese"},{value:"zh-TW",label:"Taiwanese"},{value:"zh-HK",label:"Cantonese"},{value:"ms-MY",label:"Malaysian"},{value:"no-NO",label:"Norwegian"},{value:"pl",label:"Polish"},{value:"xx-piglatin",label:"Pig Latin"},{value:"pt-PT",label:"Portuguese"},{value:"pt-br",label:"Portuguese (Brasil)"},{value:"ro-RO",label:"Romanian"},{value:"ru",label:"Russian"},{value:"sr-SP",label:"Serbian"},{value:"sk",label:"Slovak"},{value:"es-AR",label:"Spanish (Argentina)"},{value:"es-BO",label:"Spanish (Bolivia)"},{value:"es-CL",label:"Spanish (Chile)"},{value:"es-CO",label:"Spanish (Colombia)"},{value:"es-CR",label:"Spanish (Costa Rica)"},{value:"es-DO",label:"Spanish (Dominican Republic)"},{value:"es-EC",label:"Spanish (Ecuador)"},{value:"es-SV",label:"Spanish (El Salvador)"},{value:"es-GT",label:"Spanish (Guatemala)"},{value:"es-HN",label:"Spanish (Honduras)"},{value:"es-MX",label:"Spanish (Mexico)"},{value:"es-NI",label:"Spanish (Nicaragua)"},{value:"es-PA",label:"Spanish (Panama)"},{value:"es-PY",label:"Spanish (Paraguay)"},{value:"es-PE",label:"Spanish (Peru)"},{value:"es-PR",label:"Spanish (Puerto Rico)"},{value:"es-ES",label:"Spanish (Spain)"},{value:"es-US",label:"Spanish (US)"},{value:"es-UY",label:"Spanish (Uruguay)"},{value:"es-VE",label:"Spanish (Venezuela)"},{value:"sv-SE",label:"Swedish"},{value:"tr",label:"Turkish"},{value:"zu",label:"Zulu"}],sizeClasses:"[--anchor-max-height:256px]",testId:"LanguageSTTDropdown",className:"z-50"})]})}function MM({onCheckedChange:e}){const t=zf(),[n,s]=b(sx.conversationMode),a=_(sx.speechToText),r=_(sx.textToSpeech),[,o]=b(sx.autoSendText),[,i]=b(sx.decibelValue),[,c]=b(sx.autoTranscribeAudio);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:l.jsx("strong",{children:t("com_nav_conversation_mode")})}),l.jsx("div",{className:"flex items-center justify-between",children:l.jsx(Q_,{id:"ConversationMode",checked:n,onCheckedChange:t=>{c(t),o(3),i(-45),s(t),e&&e(t)},className:"ml-4","data-testid":"ConversationMode",disabled:!r||!a})})]})}const PM=m.memo(function(){const e=zf(),[t,s]=n.useState(!1),{data:a}=eg(),r=Uy("(max-width: 767px)"),[o,i]=n.useState(!1),[c,d]=n.useState(!1),[u,m]=b(sx.advancedMode),[p,h]=b(sx.autoTranscribeAudio),[x,f]=b(sx.conversationMode),[g,v]=b(sx.speechToText),[y,_]=b(sx.textToSpeech),[j,w]=b(sx.cacheTTS),[N,C]=b(sx.engineSTT),[k,S]=b(sx.languageSTT),[T,R]=b(sx.decibelValue),[I,E]=b(sx.autoSendText),[M,P]=b(sx.engineTTS),[L,A]=b(sx.voice),[O,D]=b(sx.cloudBrowserVoices),[z,F]=b(sx.languageTTS),[V,$]=b(sx.automaticPlayback),[B,H]=b(sx.playbackRate),K=n.useCallback((e,t)=>{const n={sttExternal:{value:o,setFunc:i},ttsExternal:{value:c,setFunc:d},conversationMode:{value:x,setFunc:f},advancedMode:{value:u,setFunc:m},speechToText:{value:g,setFunc:v},textToSpeech:{value:y,setFunc:_},cacheTTS:{value:j,setFunc:w},engineSTT:{value:N,setFunc:C},languageSTT:{value:k,setFunc:S},autoTranscribeAudio:{value:p,setFunc:h},decibelValue:{value:T,setFunc:R},autoSendText:{value:I,setFunc:E},engineTTS:{value:M,setFunc:P},voice:{value:L,setFunc:A},cloudBrowserVoices:{value:O,setFunc:D},languageTTS:{value:z,setFunc:F},automaticPlayback:{value:V,setFunc:$},playbackRate:{value:B,setFunc:H}}[e];n&&n.setFunc(t)},[o,c,x,u,g,y,j,N,k,p,T,I,M,L,O,z,V,B,i,d,f,m,v,_,w,C,S,h,R,E,P,A,D,F,$,H]);return n.useEffect(()=>{a&&"not_found"!==a.message&&Object.entries(a).forEach(([e,t])=>{null===localStorage.getItem(e)&&"sttExternal"!==e&&"ttsExternal"!==e?K(e,t):"sttExternal"!==e&&"ttsExternal"!==e||K(e,t)})},[a]),n.useEffect(()=>{["browser","external"].includes(M)||P("browser")},[M,P]),Dp.log({sttExternal:o,ttsExternal:c}),Gy(n.useRef(null),()=>t&&s(!1),[]),l.jsxs(da,{defaultValue:"simple",orientation:"horizontal",value:u?"advanced":"simple",children:[l.jsx("div",{className:"sticky -top-1 z-50 mb-4 bg-white dark:bg-gray-700",children:l.jsxs(ea,{className:"flex justify-center bg-background",children:[l.jsxs(ta,{onClick:()=>m(!1),className:Op("group m-1 flex items-center justify-center gap-2 bg-transparent px-4 py-2 text-sm text-text-secondary transition-all duration-200 ease-in-out radix-state-active:bg-secondary radix-state-active:text-foreground radix-state-active:shadow-lg",r?"flex-row rounded-lg":"rounded-xl","w-full"),value:"simple",style:{userSelect:"none"},children:[l.jsx(U,{}),e("com_ui_simple")]}),l.jsxs(ta,{onClick:()=>m(!0),className:Op("group m-1 flex items-center justify-center gap-2 bg-transparent px-4 py-2 text-sm text-text-secondary transition-all duration-200 ease-in-out radix-state-active:bg-secondary radix-state-active:text-foreground radix-state-active:shadow-lg",r?"flex-row rounded-lg":"rounded-xl","w-full"),value:"advanced",style:{userSelect:"none"},children:[l.jsx(Jn,{}),e("com_ui_advanced")]})]})}),l.jsx(na,{value:"simple",children:l.jsxs("div",{className:"flex flex-col gap-3 text-sm text-text-primary",children:[l.jsx(SM,{}),l.jsx(TM,{external:o}),l.jsx(EM,{}),l.jsx("div",{className:"h-px bg-border-medium",role:"none"}),l.jsx(yM,{}),l.jsx(_M,{external:c}),l.jsx(NM,{})]})}),l.jsx(na,{value:"advanced",children:l.jsxs("div",{className:"flex flex-col gap-3 text-sm text-text-primary",children:[l.jsx(MM,{}),l.jsx("div",{className:"mt-2 h-px bg-border-medium",role:"none"}),l.jsx(SM,{}),l.jsx(TM,{external:o}),l.jsx(EM,{}),l.jsx("div",{className:"pb-2",children:l.jsx(IM,{})}),p&&l.jsx("div",{className:"pb-2",children:l.jsx(RM,{})}),l.jsx("div",{className:"pb-2",children:l.jsx(kM,{})}),l.jsx("div",{className:"h-px bg-border-medium",role:"none"}),l.jsx("div",{className:"pb-3",children:l.jsx(yM,{})}),l.jsx(bM,{}),l.jsx(_M,{external:c}),l.jsx(NM,{}),"browser"===M&&l.jsx("div",{className:"pb-2",children:l.jsx(vM,{})}),l.jsx("div",{className:"pb-2",children:l.jsx(CM,{})}),l.jsx(jM,{})]})})]})});function LM({setNavVisible:e}){const t=zf(),n=Aa(),{newConversation:s}=Mg(),a=_(sx.conversationByIndex(0)),{title:r="New Chat"}=a||{};return l.jsxs("div",{className:"bg-token-main-surface-primary sticky top-0 z-10 flex min-h-[40px] items-center justify-center bg-white pl-1 dark:bg-gray-800 dark:text-white md:hidden",children:[l.jsxs("button",{type:"button","data-testid":"mobile-header-new-chat-button","aria-label":t("com_nav_open_sidebar"),className:"m-1 inline-flex size-10 items-center justify-center rounded-full hover:bg-surface-hover",onClick:()=>e(e=>(localStorage.setItem("navVisible",JSON.stringify(!e)),!e)),children:[l.jsx("span",{className:"sr-only",children:t("com_nav_open_sidebar")}),l.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-md",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 8C3 7.44772 3.44772 7 4 7H20C20.5523 7 21 7.44772 21 8C21 8.55228 20.5523 9 20 9H4C3.44772 9 3 8.55228 3 8ZM3 16C3 15.4477 3.44772 15 4 15H14C14.5523 15 15 15.4477 15 16C15 16.5523 14.5523 17 14 17H4C3.44772 17 3 16.5523 3 16Z",fill:"currentColor"})})]}),l.jsx("h1",{className:"flex-1 overflow-hidden text-ellipsis whitespace-nowrap text-center text-sm font-normal",children:r??t("com_ui_new_chat")}),l.jsx("button",{type:"button","aria-label":t("com_ui_new_chat"),className:"m-1 inline-flex size-10 items-center justify-center rounded-full hover:bg-surface-hover",onClick:()=>{n.setQueryData([Pd.messages,(null==a?void 0:a.conversationId)??Zc.NEW_CONVO],[]),n.invalidateQueries([Pd.messages]),s()},children:l.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-md",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.7929 2.79289C18.0118 1.57394 19.9882 1.57394 21.2071 2.79289C22.4261 4.01184 22.4261 5.98815 21.2071 7.20711L12.7071 15.7071C12.5196 15.8946 12.2652 16 12 16H9C8.44772 16 8 15.5523 8 15V12C8 11.7348 8.10536 11.4804 8.29289 11.2929L16.7929 2.79289ZM19.7929 4.20711C19.355 3.7692 18.645 3.7692 18.2071 4.2071L10 12.4142V14H11.5858L19.7929 5.79289C20.2308 5.35499 20.2308 4.64501 19.7929 4.20711ZM6 5C5.44772 5 5 5.44771 5 6V18C5 18.5523 5.44772 19 6 19H18C18.5523 19 19 18.5523 19 18V14C19 13.4477 19.4477 13 20 13C20.5523 13 21 13.4477 21 14V18C21 19.6569 19.6569 21 18 21H6C4.34315 21 3 19.6569 3 18V6C3 4.34314 4.34315 3 6 3H10C10.5523 3 11 3.44771 11 4C11 4.55228 10.5523 5 10 5H6Z",fill:"currentColor"})})})]})}const AM=n.forwardRef((e,t)=>{const s=zf(),a=N(),r=Aa(),o=k(),{isSmallScreen:i}=e,[c,d]=n.useState(""),u=n.useRef(null),[m,p]=n.useState(!1),{newConversation:h}=Mg(),[x,f]=b(sx.search),g=n.useCallback(()=>{a.pathname.includes("/search")&&(h({disableFocus:!0}),o("/c/new",{replace:!0}))},[h,a.pathname,o]),v=n.useCallback(()=>{var e;p(!1),d(""),f(e=>({...e,query:"",debouncedQuery:"",isTyping:!1})),g(),null==(e=u.current)||e.focus()},[f,g]),y=n.useCallback(e=>{e&&r.invalidateQueries([Pd.messages])},[r]),_=n.useMemo(()=>Cr(e=>{f(t=>({...t,debouncedQuery:e,isTyping:!1})),y(e)},500),[f,y]);return n.useEffect(()=>{x.isTyping&&!x.isSearching&&x.debouncedQuery===x.query&&f(e=>({...e,isTyping:!1}))},[x.isTyping,x.isSearching,x.debouncedQuery,x.query,f]),l.jsxs("div",{ref:t,className:Op("group relative mt-1 flex h-10 cursor-pointer items-center gap-3 rounded-lg border-border-medium px-3 py-2 text-text-primary transition-colors duration-200 focus-within:bg-surface-hover hover:bg-surface-hover",!0===i?"mb-2 h-14 rounded-xl":""),children:[l.jsx(Oe,{className:"absolute left-3 h-4 w-4 text-text-secondary group-focus-within:text-text-primary group-hover:text-text-primary"}),l.jsx("input",{type:"text",ref:u,className:"m-0 mr-0 w-full border-none bg-transparent p-0 pl-7 text-sm leading-tight placeholder-text-secondary placeholder-opacity-100 focus-visible:outline-none group-focus-within:placeholder-text-primary group-hover:placeholder-text-primary",value:c,onChange:e=>{const t=e.target.value;p(t.length>0),d(t),f(e=>({...e,query:t,isTyping:!0})),_(t),t.length>0&&"/search"!==a.pathname?o("/search",{replace:!0}):0===t.length&&"/search"===a.pathname&&o("/c/new",{replace:!0})},onKeyDown:e=>{"Space"===e.code&&e.stopPropagation()},"aria-label":s("com_nav_search_placeholder"),placeholder:s("com_nav_search_placeholder"),onKeyUp:e=>{const{value:t}=e.target;"Backspace"===e.key&&""===t&&v()},onFocus:()=>f(e=>({...e,isSearching:!0})),onBlur:()=>f(e=>({...e,isSearching:!1})),autoComplete:"off",dir:"auto"}),l.jsx("button",{type:"button","aria-label":`${s("com_ui_clear")} ${s("com_ui_search")}`,className:Op("absolute right-[7px] flex h-5 w-5 items-center justify-center rounded-full border-none bg-transparent p-0 transition-opacity duration-200",m?"opacity-100":"opacity-0",!0===i?"right-[16px]":""),onClick:v,tabIndex:m?0:-1,disabled:!m,children:l.jsx(re,{className:"h-5 w-5 cursor-pointer"})})]})});const OM=n.lazy(()=>zo(()=>import("./BookmarkNav.C-AY-f8K.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]))),DM=n.lazy(()=>zo(()=>import("./AccountSettings.BX_UYV36.js"),__vite__mapDeps([30,1,2,3,4,5,6,9,10,7,8,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]))),zM="260px",FM=n.memo(({navVisible:e,toggleNavVisible:t})=>l.jsx("div",{id:"mobile-nav-mask-toggle",role:"button",tabIndex:0,className:"nav-mask transition-opacity duration-200 ease-in-out "+(e?"active opacity-100":"opacity-0"),onClick:t,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||t()},"aria-label":"Toggle navigation"})),VM=n.memo(function({index:e=0,toggleNav:t,subHeaders:s,isSmallScreen:a,headerButtons:r}){const o=Aa(),{newConversation:i}=Mg(e),c=k(),d=zf(),{conversation:u}=sx.useCreateConversationAtom(e),m=n.useCallback(e=>{0!==e.button||!e.ctrlKey&&!e.metaKey?(o.setQueryData([Pd.messages,(null==u?void 0:u.conversationId)??Zc.NEW_CONVO],[]),o.invalidateQueries([Pd.messages]),i(),c("/c/new",{state:{focusChat:!0}}),a&&t()):window.open("/c/new","_blank")},[o,u,i,c,t,a]);return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-center justify-between py-[2px] md:py-2",children:[l.jsx(rj,{description:d("com_nav_close_sidebar"),render:l.jsxs(c_,{size:"icon",variant:"outline","data-testid":"close-sidebar-button","aria-label":d("com_nav_close_sidebar"),className:"rounded-full border-none bg-transparent p-2 hover:bg-surface-hover md:rounded-xl",onClick:t,children:[l.jsx(Hb,{className:"max-md:hidden"}),l.jsx(Kb,{className:"m-1 inline-flex size-10 items-center justify-center md:hidden"})]})}),l.jsxs("div",{className:"flex",children:[r,l.jsx(rj,{description:d("com_ui_new_chat"),render:l.jsx(c_,{size:"icon",variant:"outline","data-testid":"nav-new-chat-button","aria-label":d("com_ui_new_chat"),className:"rounded-full border-none bg-transparent p-2 hover:bg-surface-hover md:rounded-xl",onClick:m,children:l.jsx(Cy,{className:"icon-md md:h-6 md:w-6"})})})]})]}),null!=s?s:null]})}),$M=n.memo(({navVisible:e,setNavVisible:t})=>{const s=zf(),{isAuthenticated:a}=Rg(),[r,o]=n.useState(zM),i=Uy("(max-width: 768px)"),[c,d]=Ky("newUser",!0),[u,m]=n.useState(!1),[p,h]=n.useState([]),x=Zv({permissionType:bd.BOOKMARKS,permission:yd.USE}),f=_(sx.search),{data:g,fetchNextPage:v,isFetchingNextPage:b,isLoading:y,isFetching:j,refetch:w}=Zx({tags:0===p.length?void 0:p,search:f.debouncedQuery||void 0},{enabled:a,staleTime:3e4,cacheTime:3e5}),N=n.useMemo(()=>{if((null==g?void 0:g.pages)&&g.pages.length>0){return null!==g.pages[g.pages.length-1].nextCursor}return!1},[null==g?void 0:g.pages]),C=n.useRef(null),k=n.useRef(null),{moveToTop:S}=Iv({setShowLoading:m,fetchNextPage:async e=>N?v(e):Promise.resolve({}),isFetchingNext:b}),T=n.useMemo(()=>g?g.pages.flatMap(e=>e.conversations):[],[g]),R=n.useCallback(()=>{t(e=>(localStorage.setItem("navVisible",JSON.stringify(!e)),!e)),c&&d(!1)},[c,t,d]),I=n.useCallback(()=>{i&&R()},[i,R]);n.useEffect(()=>{if(i){null===localStorage.getItem("navVisible")&&R(),o("320px")}else o(zM)},[i,R]),n.useEffect(()=>{w()},[p,w]);const E=n.useCallback(()=>{!b&&N&&v()},[b,N,v]),M=n.useMemo(()=>!0===f.enabled&&l.jsx(AM,{isSmallScreen:i}),[f.enabled,i]),P=n.useMemo(()=>x&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"mt-1.5"}),l.jsx(n.Suspense,{fallback:null,children:l.jsx(OM,{tags:p,setTags:h,isSmallScreen:i})})]}),[x,p,i]),[L,A]=n.useState(!!f.query&&(f.isTyping||y||j));return n.useEffect(()=>{f.isTyping?A(!0):y||j?f.query&&(y||j)&&A(!0):A(!1)},[f.query,f.isTyping,y,j]),l.jsxs(l.Fragment,{children:[l.jsx("div",{"data-testid":"nav",className:Op("nav active max-w-[320px] flex-shrink-0 transform overflow-x-hidden bg-surface-primary-alt transition-all duration-200 ease-in-out","md:max-w-[260px]"),style:{width:e?r:"0px",transform:e?"translateX(0)":"translateX(-100%)"},children:l.jsx("div",{className:"h-full w-[320px] md:w-[260px]",children:l.jsx("div",{className:"flex h-full flex-col",children:l.jsx("div",{className:"flex h-full flex-col transition-opacity duration-200 ease-in-out "+(e?"opacity-100":"opacity-0"),children:l.jsx("div",{className:"flex h-full flex-col",children:l.jsxs("nav",{id:"chat-history-nav","aria-label":s("com_ui_chat_history"),className:"flex h-full flex-col px-2 pb-3.5 md:px-3",children:[l.jsxs("div",{className:"flex flex-1 flex-col",ref:C,children:[l.jsx(VM,{subHeaders:M,toggleNav:R,headerButtons:P,isSmallScreen:i}),l.jsx(lS,{conversations:T,moveToTop:S,toggleNav:I,containerRef:k,loadMoreConversations:E,isLoading:b||u||y,isSearchLoading:L})]}),l.jsx(n.Suspense,{fallback:null,children:l.jsx(DM,{})})]})})})})})}),i&&l.jsx(FM,{navVisible:e,toggleNavVisible:R})]})});$M.displayName="Nav",n.forwardRef((e,t)=>{const{svg:n,text:s,clickHandler:a,disabled:r,className:o=""}=e,i={className:Op("w-full flex gap-2 rounded p-2.5 text-sm cursor-pointer group items-center transition-colors duration-200 text-text-primary",o,{"opacity-50 pointer-events-none":r})};return a&&(i.onClick=a),l.jsxs("button",{...i,ref:t,children:[n(),s]})});const BM=n.forwardRef((e,t)=>{const{id:n,value:s,label:a,subLabel:r,onChange:o,labelClassName:i="",inputClassName:c=""}=e,d=zf();return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:Op("mt-4 flex flex-row",i),children:[l.jsx(L_,{htmlFor:n,className:"text-left text-sm font-medium",children:a}),L_&&l.jsx(L_,{className:"mx-1 text-right text-sm text-text-secondary",children:r}),l.jsx("br",{})]}),l.jsx("div",{className:"h-1"}),l.jsx(M_,{id:n,"data-testid":`input-${n}`,value:s??"",onChange:o,ref:t,placeholder:`${d("com_endpoint_config_value")} ${a}`,className:Op("flex h-10 max-h-10 w-full resize-none px-3 py-2")})]})}),UM=({onFileSelected:e,className:t="",containerClassName:s="",successText:a=null,invalidText:r=null,validator:o=null,text:i=null,id:c="1"})=>{const[d,u]=n.useState("text-gray-600"),[m,p]=n.useState(null),h=zf();let x;return x=m?"success"===m?a??h("com_ui_upload_success"):r??h("com_ui_upload_invalid"):i??h("com_ui_import"),l.jsxs("label",{htmlFor:`file-upload-${c}`,className:Op("mr-1 flex h-auto cursor-pointer items-center rounded bg-transparent px-2 py-1 text-xs font-normal transition-colors hover:bg-gray-100 hover:text-black dark:bg-transparent dark:text-gray-300 dark:hover:bg-gray-700 dark:hover:text-white",d,s),children:[l.jsx(Yn,{className:"mr-1 flex w-[22px] items-center stroke-1"}),l.jsx("span",{className:"flex text-xs",children:x}),l.jsx("input",{id:`file-upload-${c}`,value:"",type:"file",className:Op("hidden",t),accept:".json",onChange:t=>{var n;const s=null==(n=t.target.files)?void 0:n[0];if(!s)return;const a=new FileReader;a.onload=t=>{var n;const s=JSON.parse(null==(n=t.target)?void 0:n.result);if(o&&!o(s))return p("invalid"),void u("text-red-600");o&&(p("success"),u("text-black dark:text-white")),e(s)},a.readAsText(s)}})]})},HM=mr({client_email:pr().email().min(3),project_id:pr().min(3),private_key:pr().min(601)}),KM=e=>HM.safeParse(e).success,GM=({endpoint:e,userProvideURL:t})=>{const{control:n}=Pr(),s=e===vi.azureOpenAI;return l.jsxs("form",{className:"flex-wrap",children:[!s&&l.jsx(Ir,{name:"apiKey",control:n,render:({field:e})=>l.jsx(BM,{id:"apiKey",...e,label:(s?"Azure q":"")+"OpenAI API Key",labelClassName:"mb-1",inputClassName:"mb-2"})}),s&&l.jsxs(l.Fragment,{children:[l.jsx(Ir,{name:"azureOpenAIApiKey",control:n,render:({field:e})=>l.jsx(BM,{id:"azureOpenAIApiKey",...e,label:"Azure OpenAI API Key",labelClassName:"mb-1"})}),l.jsx("div",{className:"mt-3"}),l.jsx(Ir,{name:"azureOpenAIApiInstanceName",control:n,render:({field:e})=>l.jsx(BM,{id:"azureOpenAIApiInstanceName",...e,label:"Azure OpenAI Instance Name",labelClassName:"mb-1"})}),l.jsx("div",{className:"mt-3"}),l.jsx(Ir,{name:"azureOpenAIApiDeploymentName",control:n,render:({field:e})=>l.jsx(BM,{id:"azureOpenAIApiDeploymentName",...e,label:"Azure OpenAI Deployment Name",labelClassName:"mb-1"})}),l.jsx("div",{className:"mt-3"}),l.jsx(Ir,{name:"azureOpenAIApiVersion",control:n,render:({field:e})=>l.jsx(BM,{id:"azureOpenAIApiVersion",...e,label:"Azure OpenAI API Version",labelClassName:"mb-1"})})]}),t&&l.jsx("div",{className:"mt-3",children:l.jsx(Ir,{name:"baseURL",control:n,render:({field:e})=>l.jsx(BM,{id:"baseURL",...e,label:"API Base URL",subLabel:"(Optional)",labelClassName:"mb-1"})})})]})};const WM=n.memo(function({endpoint:e}){const t=zf();return{[vi.google]:l.jsxs(l.Fragment,{children:[l.jsxs("small",{className:"mt-4 break-all text-text-secondary",children:[t("com_endpoint_config_google_service_key"),": ",t("com_endpoint_config_key_google_need_to")," ",l.jsx("a",{target:"_blank",href:"https://console.cloud.google.com/vertex-ai",rel:"noreferrer",className:"text-blue-700 underline dark:text-blue-400",children:t("com_endpoint_config_key_google_vertex_ai")})," ",t("com_endpoint_config_key_google_vertex_api")," ",l.jsx("a",{target:"_blank",href:"https://console.cloud.google.com/projectselector/iam-admin/serviceaccounts/create?walkthrough_id=iam--create-service-account#step_index=1",rel:"noreferrer",className:"text-blue-700 underline dark:text-blue-400",children:t("com_endpoint_config_key_google_service_account")}),". ",t("com_endpoint_config_key_google_vertex_api_role")]}),l.jsxs("small",{className:"break-all text-text-secondary",children:[t("com_endpoint_config_google_api_key"),": ",t("com_endpoint_config_google_api_info")," ",l.jsx("a",{target:"_blank",href:"https://makersuite.google.com/app/apikey",rel:"noreferrer",className:"text-blue-700 underline dark:text-blue-400",children:t("com_endpoint_config_click_here")})," "]})]})}[e]||null}),qM={[vi.google]:({userKey:e,setUserKey:t})=>{const n=zf(),{getMultiKey:s,setMultiKey:a}=function(e){return{getMultiKey:function(e,t){return ei(t)?JSON.parse(t)[e]:""},setMultiKey:function(t,n,s){let a={};ei(s)&&(a=JSON.parse(s)),a[t]=n,e(JSON.stringify(a))}}}(t);return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex flex-row",children:[l.jsx(L_,{htmlFor:qc.GOOGLE_SERVICE_KEY,className:"text-left text-sm font-medium",children:n("com_endpoint_config_google_service_key")}),l.jsx(L_,{className:"mx-1 text-right text-sm text-text-secondary",children:n("com_endpoint_config_google_cloud_platform")}),l.jsx("br",{})]}),l.jsx(UM,{id:qc.GOOGLE_SERVICE_KEY,className:"w-full",containerClassName:"dark:bg-gray-700 h-10 max-h-10 w-full resize-none py-2 dark:ring-1 dark:ring-gray-600",text:n("com_endpoint_config_key_import_json_key"),successText:n("com_endpoint_config_key_import_json_key_success"),invalidText:n("com_endpoint_config_key_import_json_key_invalid"),validator:KM,onFileSelected:t=>{a(qc.GOOGLE_SERVICE_KEY,JSON.stringify(t),e)}}),l.jsx(BM,{id:qc.GOOGLE_API_KEY,value:s(qc.GOOGLE_API_KEY,e)??"",onChange:t=>a(qc.GOOGLE_API_KEY,t.target.value??"",e),label:n("com_endpoint_config_google_api_key"),subLabel:n("com_endpoint_config_google_gemini_api")})]})},[vi.openAI]:GM,[vi.custom]:({endpoint:e,userProvideURL:t})=>{const{control:n}=Pr();return l.jsxs("form",{className:"flex-wrap",children:[l.jsx(Ir,{name:"apiKey",control:n,render:({field:t})=>l.jsx(BM,{id:"apiKey",...t,label:`${e} API Key`,labelClassName:"mb-1",inputClassName:"mb-2"})}),t&&l.jsx(Ir,{name:"baseURL",control:n,render:({field:t})=>l.jsx(BM,{id:"baseURL",...t,label:`${e} API URL`,labelClassName:"mb-1"})})]})},[vi.azureOpenAI]:GM,[vi.gptPlugins]:GM,[vi.assistants]:GM,[vi.azureAssistants]:GM,default:({userKey:e,setUserKey:t,endpoint:n})=>{const s=zf();return l.jsx(BM,{id:n,value:e??"",onChange:e=>t(e.target.value??""),label:s("com_endpoint_config_key_name")})}},QM=new Set([vi.openAI,vi.custom,vi.azureOpenAI,vi.gptPlugins,vi.assistants,vi.azureAssistants]),ZM={THIRTY_MINUTES:{label:"in 30 minutes",value:18e5},TWO_HOURS:{label:"in 2 hours",value:72e5},TWELVE_HOURS:{label:"in 12 hours",value:432e5},ONE_DAY:{label:"in 1 day",value:864e5},ONE_WEEK:{label:"in 7 days",value:6048e5},ONE_MONTH:{label:"in 30 days",value:2592e6},NEVER:{label:"never",value:0}},JM=({open:e,onOpenChange:t,endpoint:s,endpointType:a,userProvideURL:r})=>{const o=Rr({defaultValues:{apiKey:"",baseURL:"",azureOpenAIApiKey:"",azureOpenAIApiInstanceName:"",azureOpenAIApiDeploymentName:"",azureOpenAIApiVersion:""}}),[i,c]=n.useState(""),{data:d}=kx(),[u,m]=n.useState(ZM.TWELVE_HOURS.label),{getExpiry:p,saveUserKey:h}=Cg(s),{showToast:x}=Of(),f=zf(),g=Object.values(ZM),v=qM[a??s]??qM.default,b=p(),y=null==d?void 0:d[s];return l.jsx(A_,{open:e,onOpenChange:t,children:l.jsx(Oj,{title:`${f("com_endpoint_config_key_for")} ${Oc[s]??s}`,className:"w-11/12 max-w-2xl",showCancelButton:!1,main:l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsx("small",{className:"text-red-600",children:"never"===b?f("com_endpoint_config_key_never_expires"):`${f("com_endpoint_config_key_encryption")} ${new Date(b??0).toLocaleString()}`}),l.jsx(fj,{label:"Expires ",value:u,onChange:e=>{m(e)},options:g.map(e=>e.label),sizeClasses:"w-[185px]",portal:!1}),l.jsx("div",{className:"mt-2"}),l.jsx(Ar,{...o,children:l.jsx(v,{userKey:i,setUserKey:c,endpoint:s===vi.gptPlugins&&(null==y?void 0:y.azure)?vi.azureOpenAI:s,userProvideURL:r})}),l.jsx(WM,{endpoint:s})]}),selection:{selectHandler:()=>{const e=g.find(e=>e.label===u);let n;n=0===(null==e?void 0:e.value)?null:Date.now()+(e?e.value:0);const l=e=>{h(e,n),t(!1)};QM.has(s)||QM.has(a??"")?o.handleSubmit(e=>{const n=s===vi.azureOpenAI,a=n||s===vi.openAI||s===vi.gptPlugins||ji(s);n&&(e.apiKey="n/a");const i=Object.keys(e).filter(t=>!(!n&&t.startsWith("azure"))&&((!a||"baseURL"!==t)&&(!("baseURL"===t&&!r)&&""===e[t])));if(i.length>0)return x({message:"The following fields are required: "+i.join(", "),status:"error"}),void t(!0);const{apiKey:c,baseURL:d,...u}=e,m={apiKey:c,baseURL:d};n&&(m.apiKey=JSON.stringify({azureOpenAIApiKey:u.azureOpenAIApiKey,azureOpenAIApiInstanceName:u.azureOpenAIApiInstanceName,azureOpenAIApiDeploymentName:u.azureOpenAIApiDeploymentName,azureOpenAIApiVersion:u.azureOpenAIApiVersion})),l(JSON.stringify(m)),o.reset()})():(l(i),c(""))},selectClasses:"btn btn-primary",selectText:f("com_ui_submit")},leftButtons:l.jsx(AE,{endpoint:s,disabled:!b,setDialogOpen:t})})})},YM=({keyDialogOpen:e,keyDialogEndpoint:t,onOpenChange:n,endpointsConfig:s})=>l.jsx(l.Fragment,{children:t&&l.jsx(JM,{open:e,endpoint:t,endpointType:fp(s,t,"type"),onOpenChange:n,userProvideURL:fp(s,t,"userProvideURL")})});function XM(){const e=zf(),{isBrandMode:t,defaultModel:s,hideModelSwitcher:a}=function(){const e=y(sx.endpointsConfig),t=y(sx.modelsConfig),{data:s=Hy,isLoading:a}=La({queryKey:[Pd.brandConfig],queryFn:async()=>{const e=await fetch("/api/brand/config");if(!e.ok)throw new Error("Failed to fetch brand config");return e.json()},enabled:!0,staleTime:1/0,cacheTime:1/0});return n.useEffect(()=>{if(!s.enabled||a)return;e({[s.name]:{type:"custom",userProvide:!1,userProvideURL:!1,order:0,models:s.availableModels,iconURL:s.logoUrl}});const n={[s.name]:s.availableModels.map(e=>e.id)};t(n),s.appTitle&&"undefined"!=typeof document&&(document.title=s.appTitle),s.brandColor&&"undefined"!=typeof document&&document.documentElement.style.setProperty("--brand-color",s.brandColor)},[s,a,e,t]),{brandConfig:s,isBrandMode:s.enabled,isLoading:a,brandName:s.name,hideModelSwitcher:s.hideModelSwitcher,hideEndpointMenu:s.hideEndpointMenu,hideApiKeyInput:s.hideApiKeyInput,hideAdvancedSettings:s.hideAdvancedSettings,defaultModel:s.defaultModel}}(),{modelSpecs:r,mappedEndpoints:o,endpointsConfig:i,searchValue:c,searchResults:d,selectedValues:u,setSearchValue:p,setSelectedValues:h,keyDialogOpen:x,onOpenChange:f,keyDialogEndpoint:g}=eE(),v=n.useMemo(()=>function({mappedEndpoints:e,selectedValues:t,modelSpecs:n,endpointsConfig:s}){var a;const{endpoint:r,model:o,modelSpec:i}=t;if(i){const e=n.find(e=>e.name===i);if(!e)return null;const{showIconInHeader:t=!0}=e;return t?m.createElement(YI,{currentSpec:e,endpointsConfig:s}):null}if(r&&o){const t=e.find(e=>e.value===r);if(!t)return null;if(null==(a=t.modelIcons)?void 0:a[o]){const e=t.modelIcons[o];return m.createElement("div",{className:"h-5 w-5 overflow-hidden rounded-full"},m.createElement("img",{src:e,alt:o,className:"h-full w-full object-cover"}))}return t.icon||m.createElement(Ln,{size:20,className:"icon-md shrink-0 text-text-primary"})}if(r){const t=e.find(e=>e.value===r);return(null==t?void 0:t.icon)||null}return null}({mappedEndpoints:o??[],selectedValues:u,modelSpecs:r,endpointsConfig:i}),[o,u,r,i]),b=n.useMemo(()=>(({localize:e,mappedEndpoints:t,selectedValues:n,modelSpecs:s})=>{if(n.modelSpec){const t=s.find(e=>e.name===n.modelSpec);return(null==t?void 0:t.label)||(null==t?void 0:t.name)||e("com_ui_select_model")}if(n.model&&n.endpoint){const s=t.find(e=>e.value===n.endpoint);return s?wi(s.value)&&s.agentNames&&s.agentNames[n.model]?s.agentNames[n.model]:ji(s.value)&&s.assistantNames&&s.assistantNames[n.model]?s.assistantNames[n.model]:n.model:e("com_ui_select_model")}if(n.endpoint){const s=t.find(e=>e.value===n.endpoint);return(null==s?void 0:s.label)||e("com_ui_select_model")}return e("com_ui_select_model")})({localize:e,modelSpecs:r,selectedValues:u,mappedEndpoints:o}),[e,r,u,o]),_=l.jsxs("button",{className:"my-1 flex h-10 w-full max-w-[70vw] items-center justify-center gap-2 rounded-xl border border-border-light bg-surface-secondary px-3 py-2 text-sm text-text-primary hover:bg-surface-tertiary","aria-label":e("com_ui_select_model"),children:[v&&m.isValidElement(v)&&l.jsx("div",{className:"flex flex-shrink-0 items-center justify-center overflow-hidden",children:v}),l.jsx("span",{className:"flex-grow truncate text-left",children:b})]});return t&&a?l.jsx("div",{className:"relative flex w-full max-w-md flex-col items-center gap-2",children:l.jsxs("div",{className:"my-1 flex h-10 w-full max-w-[70vw] items-center justify-center gap-2 rounded-xl border border-border-light bg-surface-secondary px-3 py-2 text-sm text-text-primary",children:[v&&m.isValidElement(v)&&l.jsx("div",{className:"flex flex-shrink-0 items-center justify-center overflow-hidden",children:v}),l.jsx("span",{className:"flex-grow truncate text-left",children:b||s})]})}):l.jsxs("div",{className:"relative flex w-full max-w-md flex-col items-center gap-2",children:[l.jsx(nE,{values:u,onValuesChange:e=>{h({endpoint:e.endpoint||"",model:e.model||"",modelSpec:e.modelSpec||""})},onSearch:e=>p(e),combobox:l.jsx("input",{placeholder:e("com_endpoint_search_models")}),trigger:_,children:d?mE(d,e,c):l.jsxs(l.Fragment,{children:[(j=r,w=u.modelSpec||"",j&&0!==j.length?j.map(e=>l.jsx(rE,{spec:e,isSelected:w===e.name},e.name)):null),dE(o??[])]})}),l.jsx(YM,{keyDialogOpen:x,onOpenChange:f,endpointsConfig:i||{},keyDialogEndpoint:g||void 0})]});var j,w}function eP({startupConfig:e}){return l.jsx(tE,{startupConfig:e,children:l.jsx(XM,{})})}function tP({buttonClass:e,iconClass:t="",endpoint:n,endpointType:s,model:a}){const{conversation:r,optionSettings:o,setOptionSettings:i,showAgentSettings:c,setShowAgentSettings:d}=rg(),u=zf(),[m,p]=b(sx.currentSettingsView),{model:h,endpoint:x,endpointType:f}=r??{},g=s??n??f??x??"",v=a??h,y=/gemini|learnlm|gemma/.test(v??"")??!1,_=(!y&&(null==v?void 0:v.toLowerCase().includes("chat")))??!1,j=!y&&!_&&/code|text/.test(v??""),{showExamples:w}=o,N=!y&&!j&&_,C={[vi.google]:[{label:u(!0===w?"com_hide_examples":"com_show_examples"),buttonClass:!0===y||j?"disabled":"",handler:()=>{p(Kl.default),i(e=>({...e,showExamples:!e.showExamples}))},icon:l.jsx(Xb,{className:Op("mr-1 w-[14px]",t)})}],[vi.gptPlugins]:[{label:u(c?"com_show_completion_settings":"com_show_agent_settings"),buttonClass:"",handler:()=>{p(Kl.default),d(e=>!e)},icon:l.jsx($b,{className:Op("mr-1 w-[14px]",t),size:24})}]};if(!g)return null;if(g===vi.google&&!N)return null;Kl.default,Op("mr-1 h-6 w-[14px]",t),Kl.advanced,Op("mr-1 h-6 w-[14px]",t);const k=C[g]??[];return l.jsxs("div",{className:"flex w-full justify-between",children:[l.jsx("div",{className:"flex items-center justify-start",children:k.map((t,n)=>l.jsxs(c_,{type:"button",className:Op(t.buttonClass,"border border-gray-300/50 focus:ring-1 focus:ring-black dark:border-gray-500/50 dark:focus:ring-white","ml-1 h-full bg-transparent px-2 py-1 text-xs font-normal text-black hover:bg-gray-100 hover:text-black dark:bg-transparent dark:text-white dark:hover:bg-gray-600 dark:hover:text-white",e??""),onClick:t.handler,children:[t.icon,t.label]},`button-${n}`))}),null]})}const nP=({exportPreset:e,submitPreset:t})=>{const s=zf(),a=Aa(),{preset:r,setPreset:o}=rg(),{setOption:i,setOptions:c,setAgentOption:d}=yv(r),[u,m]=vv({setOption:i,optionKey:"title",initialValue:null==r?void 0:r.title}),[p,h]=b(sx.presetModalVisible),{data:x=[]}=kx({select:gp}),f=n.useMemo(()=>x.filter(e=>!wi(e)),[x]);n.useEffect(()=>{var e,t;if(!r)return;if(wi(r.endpoint))return;const n=r.endpoint??"";if(!n)return;const s=a.getQueryData([Pd.models]);if(!s)return;const o=s[n];o&&o.length&&r.model!==o[0]&&(o.includes(r.model??"")||(console.log("setting model",o[0]),i("model")(o[0])),(null==(e=r.agentOptions)?void 0:e.model)!==o[0]&&null!=(null==(t=r.agentOptions)?void 0:t.model)&&r.agentOptions.model&&!o.includes(r.agentOptions.model)&&(console.log("setting agent model",o[0]),d("model")(o[0])))},[r,a,i,d]);const g=n.useCallback(e=>{if(!c)return console.warn("setOptions is not defined");const{newEndpointType:t}=bp({newEndpoint:e,modularChat:!0,conversation:null,endpointsConfig:a.getQueryData([Pd.endpoints])??{}});c({endpoint:e,endpointType:t})},[a,c]),{endpoint:v,endpointType:y,model:_}=r||{},j=v??"";return j?wi(j)?null:l.jsx(A_,{open:p,onOpenChange:e=>{h(e),e||o(null)},children:l.jsxs(V_,{className:"h-[100dvh] max-h-[100dvh] w-full max-w-full overflow-y-auto bg-white dark:border-gray-700 dark:bg-gray-850 dark:text-gray-300 md:h-auto md:max-h-[90vh] md:max-w-[75vw] md:rounded-lg lg:max-w-[950px]",children:[l.jsx(U_,{children:`${s("com_ui_edit")} ${s("com_endpoint_preset")} - ${null==r?void 0:r.title}`}),l.jsxs("div",{className:"flex w-full flex-col gap-2 px-1 pb-4 md:gap-4",children:[l.jsxs("div",{className:"grid w-full gap-2 md:grid-cols-2 md:gap-4",children:[l.jsxs("div",{className:"flex w-full flex-col",children:[l.jsx(L_,{htmlFor:"preset-name",className:"mb-1 text-left text-sm font-medium",children:s("com_endpoint_preset_name")}),l.jsx(M_,{id:"preset-name",value:m??"",onChange:u,placeholder:s("com_endpoint_set_custom_name"),className:Op(Wp,"flex h-10 max-h-10 w-full resize-none px-3 py-2",Kp)})]}),l.jsxs("div",{className:"flex w-full flex-col",children:[l.jsx(L_,{htmlFor:"endpoint",className:"mb-1 text-left text-sm font-medium",children:s("com_endpoint")}),l.jsx(Lj,{value:j||"",setValue:g,showLabel:!1,emptyTitle:!0,searchPlaceholder:s("com_endpoint_search"),availableValues:f})]})]}),l.jsx("div",{className:"flex w-full",children:l.jsx(tP,{buttonClass:"ml-0 w-full border border-border-medium p-2 h-[40px] justify-center mt-0",iconClass:"hidden lg:block w-4",endpoint:j,endpointType:y,model:_})}),l.jsx("div",{className:"w-full border-t border-border-medium"}),l.jsx("div",{className:"w-full flex-1",children:l.jsx(uN,{conversation:r,setOption:i,isPreset:!0,className:"text-text-primary"})}),l.jsxs("div",{className:"flex justify-end gap-2 border-t border-border-medium pt-2 md:pt-4",children:[l.jsx("button",{onClick:e,className:"rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 md:px-4",children:s("com_endpoint_export")}),l.jsx("button",{onClick:t,className:"rounded-md bg-white px-3 py-2 text-sm font-medium text-black hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2 md:px-4 dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 dark:focus:ring-white border border-gray-300 dark:border-gray-600",children:s("com_ui_save")})]})]})]})}):null},sP=()=>l.jsx("div",{role:"separator","aria-orientation":"horizontal",className:"my-1.5 border-b bg-gray-200 dark:border-gray-700"}),aP=({presets:e,onSetDefaultPreset:t,onSelectPreset:n,onChangePreset:s,onDeletePreset:a,clearAllPresets:r,onFileSelected:o})=>{const{data:i}=kx(),c=_(sx.defaultPreset),d=zf();return l.jsxs(l.Fragment,{children:[l.jsx("div",{role:"menuitem",className:"pointer-none group m-1.5 flex h-8 min-w-[170px] gap-2 rounded px-5 py-2.5 !pr-3 text-sm !opacity-100 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 md:min-w-[240px]",tabIndex:-1,children:l.jsxs("div",{className:"flex h-full grow items-center justify-end gap-2",children:[l.jsx("label",{htmlFor:"default-preset",className:"w-40 truncate rounded bg-transparent py-1 text-xs font-medium text-gray-600 transition-colors dark:bg-transparent dark:text-gray-300 sm:w-72",children:c?`${d("com_endpoint_preset_default_item")} ${c.title}`:d("com_endpoint_preset_default_none")}),l.jsxs(v_,{children:[l.jsx(b_,{asChild:!0,children:l.jsxs("label",{htmlFor:"file-upload",className:"mr-1 flex h-[32px] cursor-pointer items-center rounded bg-transparent px-2 py-1 text-xs font-medium text-gray-600 transition-colors hover:bg-gray-100 hover:text-red-700 dark:bg-transparent dark:text-gray-300 dark:hover:bg-gray-700 dark:hover:text-red-700",children:[l.jsx("svg",{width:"24",height:"24",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:"mr-1 flex w-[22px] items-center",children:l.jsx("path",{d:"M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0M9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1M6.854 7.146 8 8.293l1.146-1.147a.5.5 0 1 1 .708.708L8.707 9l1.147 1.146a.5.5 0 0 1-.708.708L8 9.707l-1.146 1.147a.5.5 0 0 1-.708-.708L7.293 9 6.146 7.854a.5.5 0 1 1 .708-.708"})}),d("com_ui_clear")," ",d("com_ui_all")]})}),l.jsx(OR,{showCloseButton:!1,title:`${d("com_ui_clear")} ${d("com_endpoint_presets")}`,className:"max-w-[450px]",main:l.jsx(l.Fragment,{children:l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(L_,{htmlFor:"preset-item-clear-all",className:"text-left text-sm font-medium",children:d("com_endpoint_presets_clear_warning")})})})}),selection:{selectHandler:r,selectClasses:"bg-red-600 hover:bg-red-700 dark:hover:bg-red-600 text-white",selectText:d("com_ui_clear")}}),l.jsx(UM,{onFileSelected:o})]})]})}),e&&0===e.length&&l.jsx("div",{role:"menuitem",className:"pointer-none group m-1.5 flex h-8 min-w-[170px] gap-2 rounded px-5 py-2.5 !pr-3 text-sm !opacity-100 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 md:min-w-[240px]",tabIndex:-1,children:l.jsx("div",{className:"flex h-full grow items-center justify-end gap-2 text-gray-600 dark:text-gray-300",children:d("com_endpoint_no_presets")})}),l.jsx(Ia,{flipKey:null==e?void 0:e.map(e=>null==e?void 0:e.presetId).filter(e=>e).join("."),children:e&&e.length>0&&e.map((r,o)=>{const d=(null==r?void 0:r.presetId)??"";if(!r||!d)return null;const u=Np({endpoint:r.endpoint,endpointsConfig:i}),m=By[u];return l.jsx(ja,{asChild:!0,children:l.jsxs("div",{children:[l.jsx(Ea,{flipId:d,children:l.jsx(Aj,{textClassName:"text-xs max-w-[150px] sm:max-w-[200px] truncate md:max-w-full ",title:ap(r),onClick:()=>n(r),icon:null!=m&&l.jsx(m,{context:"menu-item",iconURL:fp(i,r.endpoint,"iconURL"),className:"icon-md mr-1 dark:text-white",endpoint:r.endpoint}),selected:!1,"data-testid":`preset-item-${r}`,children:l.jsxs("div",{className:"flex h-full items-center justify-end gap-1",children:[l.jsx("button",{className:Op("m-0 h-full rounded-md bg-transparent p-2 text-gray-400 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",(null==c?void 0:c.presetId)===d?"":"sm:invisible sm:group-hover:visible"),onClick:e=>{e.preventDefault(),e.stopPropagation(),t(r,(null==c?void 0:c.presetId)===d)},children:l.jsx(my,{unpin:(null==c?void 0:c.presetId)===d})}),l.jsx("button",{className:"m-0 h-full rounded-md p-2 text-gray-400 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 sm:invisible sm:group-hover:visible",onClick:e=>{e.preventDefault(),e.stopPropagation(),s(r)},children:l.jsx(Bb,{})}),l.jsx("button",{className:"m-0 h-full rounded-md p-2 text-gray-400 hover:text-gray-600 dark:text-gray-400 dark:hover:text-gray-200 sm:invisible sm:group-hover:visible",onClick:e=>{e.preventDefault(),e.stopPropagation(),a(r)},children:l.jsx(py,{})})]})},`preset-item-${d}`)}),o!==e.length-1&&l.jsx(sP,{})]},`preset-${d}`)},`preset-${d}`)})})]})},rP=()=>{const e=zf(),{presetsQuery:t,onSetDefaultPreset:n,onFileSelected:s,onSelectPreset:a,onChangePreset:r,clearAllPresets:o,onDeletePreset:i,submitPreset:c,exportPreset:d}=gv(),{preset:u}=rg();return l.jsxs(fa,{children:[l.jsx(ca,{asChild:!0,children:l.jsx(rj,{id:"presets-button","aria-label":e("com_endpoint_examples"),description:e("com_endpoint_examples"),tabIndex:0,role:"button","data-testid":"presets-button",className:"inline-flex size-10 flex-shrink-0 items-center justify-center rounded-xl border border-border-light bg-transparent text-text-primary transition-all ease-in-out hover:bg-surface-tertiary disabled:pointer-events-none disabled:opacity-50 radix-state-open:bg-surface-tertiary",children:l.jsx(Xn,{size:16,"aria-label":"Preset Icon"})})}),l.jsx(ha,{children:l.jsx("div",{style:{position:"fixed",left:"0px",top:"0px",transform:"translate3d(268px, 50px, 0px)",minWidth:"max-content",zIndex:"auto"},children:l.jsx(xa,{side:"bottom",align:"center",className:"mt-2 max-h-[495px] overflow-x-hidden rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-700 dark:text-white md:min-w-[400px]",children:l.jsx(aP,{presets:t.data,onSetDefaultPreset:n,onSelectPreset:a,onChangePreset:r,onDeletePreset:i,clearAllPresets:o,onFileSelected:s})})})}),u&&l.jsx(nP,{submitPreset:c,exportPreset:d})]})};function oP({setNavVisible:e}){const t=zf();return l.jsx(rj,{description:t("com_nav_open_sidebar"),render:l.jsx(c_,{size:"icon",variant:"outline","data-testid":"open-sidebar-button","aria-label":t("com_nav_open_sidebar"),className:"rounded-xl border border-border-light bg-surface-secondary p-2 hover:bg-surface-hover max-md:hidden",onClick:()=>e(e=>(localStorage.setItem("navVisible",JSON.stringify(!e)),!e)),children:l.jsx(Hb,{})})})}function iP(){const e=zf(),t=Aa(),{conversation:n,newConversation:s}=rg();return l.jsx(rj,{description:e("com_ui_new_chat"),render:l.jsx(c_,{size:"icon",variant:"outline","data-testid":"wide-header-new-chat-button","aria-label":e("com_ui_new_chat"),className:"rounded-xl border border-border-light bg-surface-secondary p-2 hover:bg-surface-hover max-md:hidden",onClick:e=>{0!==e.button||!e.ctrlKey&&!e.metaKey?(t.setQueryData([Pd.messages,(null==n?void 0:n.conversationId)??Zc.NEW_CONVO],[]),t.invalidateQueries([Pd.messages]),s()):window.open("/c/new","_blank")},children:l.jsx(Cy,{})})})}function lP({isSharedButtonEnabled:e}){const t=zf(),[s,a]=n.useState(!1),[r,o]=n.useState(!1),[i,c]=n.useState(!1),d=n.useId(),u=n.useRef(null),m=n.useRef(null),p=Uy("(max-width: 768px)"),h=_(sx.conversationByIndex(0));if(!1===(h&&null!=h.conversationId&&"new"!==h.conversationId&&"search"!==h.conversationId))return null;const x=[{label:t("com_ui_share"),onClick:()=>{c(!0)},icon:l.jsx(We,{className:"icon-md mr-2 text-text-secondary"}),show:e,hideOnClick:!1,ref:u,render:e=>l.jsx("button",{...e})},{label:t("com_endpoint_export"),onClick:()=>{a(!0)},icon:l.jsx(Wn,{className:"icon-md mr-2 text-text-secondary"}),hideOnClick:!1,ref:m,render:e=>l.jsx("button",{...e})}];return l.jsxs(l.Fragment,{children:[l.jsx(kj,{portal:!0,menuId:d,focusLoop:!0,unmountOnHide:!0,isOpen:r,setIsOpen:o,trigger:l.jsx(rj,{description:t("com_endpoint_export_share"),render:l.jsx(Qe,{id:"export-menu-button","aria-label":"Export options",className:"inline-flex size-10 flex-shrink-0 items-center justify-center rounded-xl border border-border-light bg-transparent text-text-primary transition-all ease-in-out hover:bg-surface-tertiary disabled:pointer-events-none disabled:opacity-50 radix-state-open:bg-surface-tertiary",children:l.jsx(We,{className:"icon-md text-text-secondary","aria-hidden":"true",focusable:"false"})})}),items:x,className:p?"":"absolute right-0 top-0 mt-2"}),l.jsx(hE,{open:s,onOpenChange:a,conversation:h,triggerRef:m,"aria-label":t("com_ui_export_convo_modal")}),l.jsx(eS,{triggerRef:u,conversationId:h.conversationId??"",open:i,onOpenChange:c})]})}const cP=()=>{const e=zf(),t=Aa(),{showToast:s}=Of(),a=_(sx.conversationByIndex(0))||void 0,r=(null==a?void 0:a.conversationId)??"",o=(e=>{const t=y(sx.updateConversationSelector(e)),{updateTagsInConversation:n}=qx();return s=>{e&&(n(e,s),t({tags:s}))}})(r),i=null==a?void 0:a.tags,c=null!=(null==a?void 0:a.expiredAt),d=n.useId(),[u,m]=n.useState(!1),[p,h]=n.useState(!1),x=((e,t)=>{const n=Yx(),{updateTagsInConversation:s}=qx();return Oa(t=>Mu(e,t),{onSuccess:(a,...r)=>{var o;n.refetch(),s(e,a),null==(o=null==t?void 0:t.onSuccess)||o.call(t,a,...r)},onError:null==t?void 0:t.onError,onMutate:null==t?void 0:t.onMutate})})(r,{onSuccess:(e,t)=>{o(e);const n=document.getElementById(t.tag);console.log("tagElement",n),n&&setTimeout(()=>n.focus(),2)},onError:()=>{s({message:"Error adding bookmark",severity:Wo.ERROR})},onMutate:e=>{const t=document.getElementById(e.tag);console.log("tagElement",t),t&&setTimeout(()=>t.focus(),2)}}),{data:f}=Yx(),g=Boolean(a&&r&&r!==Zc.NEW_CONVO&&"search"!==r),v=n.useCallback(e=>{if(void 0===e||""===e||!r)return void s({message:"Invalid tag or conversationId",severity:Wo.ERROR});Dp.log("tag_mutation","BookmarkMenu - handleSubmit: tags before setting",i);const n=(t.getQueryData([Pd.conversationTags])??[]).map(e=>e.tag),a=null==i?void 0:i.filter(e=>n.includes(e));Dp.log("tag_mutation","BookmarkMenu - handleSubmit: tags after filtering",a);const o=!0===(null==a?void 0:a.includes(e))?a.filter(t=>t!==e):[...a??[],e];Dp.log("tag_mutation","BookmarkMenu - handleSubmit: tags after",o),x.mutate({tags:o,tag:e})},[i,r,x,t,s]),b=n.useRef(null),j=n.useMemo(()=>{const t=[{id:"%___new___bookmark___%",label:e("com_ui_bookmarks_new"),icon:l.jsx(wn,{className:"size-4"}),hideOnClick:!1,ref:b,render:e=>l.jsx("button",{...e}),onClick:()=>h(!0)}];if(f)for(const e of f){const n=null==i?void 0:i.includes(e.tag);t.push({id:e.tag,label:e.tag,hideOnClick:!1,icon:!0===n?l.jsx(wa,{className:"size-4"}):l.jsx(Na,{className:"size-4"}),onClick:()=>v(e.tag),disabled:x.isLoading})}return t},[i,f,v,x.isLoading,e]);if(!g)return null;if(c)return null;return l.jsxs(Jg.Provider,{value:{bookmarks:f||[]},children:[l.jsx(kj,{portal:!0,menuId:d,focusLoop:!0,isOpen:u,unmountOnHide:!0,setIsOpen:m,keyPrefix:`${r}-bookmark-`,trigger:l.jsx(rj,{description:e("com_ui_bookmarks_add"),render:l.jsx(Qe,{id:"bookmark-menu-button","aria-label":e("com_ui_bookmarks_add"),className:Op("mt-text-sm flex size-10 flex-shrink-0 items-center justify-center gap-2 rounded-xl border border-border-light text-sm transition-colors duration-200 hover:bg-surface-hover",u?"bg-surface-hover":""),"data-testid":"bookmark-menu",children:x.isLoading?l.jsx(Gb,{"aria-label":"Spinner"}):((null==i?void 0:i.length)??0)>0?l.jsx(wa,{className:"icon-sm","aria-label":"Filled Bookmark"}):l.jsx(Na,{className:"icon-sm","aria-label":"Bookmark"})})}),items:j}),l.jsx(mR,{tags:i,open:p,setTags:o,setOpen:h,triggerRef:b,conversationId:r,context:"BookmarkMenu - BookmarkEditDialog"})]})};function dP(){const e=zf(),[t,n]=b(sx.isTemporary),{conversation:s,isSubmitting:a}=rg(),r={icon:es,label:"com_ui_temporary",atom:sx.isTemporary},o=v(()=>()=>{n(!t)},[t]);return Array.isArray(null==s?void 0:s.messages)&&s.messages.length>=1||a?null:l.jsx("div",{className:"relative flex flex-wrap items-center gap-2",children:l.jsx(rj,{description:e(r.label),render:l.jsx("button",{onClick:o,"aria-label":e(r.label),className:Op("inline-flex size-10 flex-shrink-0 items-center justify-center rounded-xl border border-border-light text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",t?"bg-surface-active shadow-md":"bg-transparent shadow-sm hover:bg-surface-hover hover:shadow-md","active:shadow-inner"),children:r.icon&&l.jsx(r.icon,{className:Op("relative h-5 w-5 md:h-4 md:w-4",!1)})})})})}function uP(){const{conversation:e}=rg(),{setConversation:t}=Kg(),n=zf();return e?ji(e.endpoint)?null:l.jsx(rj,{id:"add-multi-conversation-button","aria-label":n("com_ui_add_multi_conversation"),description:n("com_ui_add_multi_conversation"),tabIndex:0,role:"button",onClick:()=>{const{title:n,...s}=e??{};t({...s,title:""});const a=document.getElementById(Bo);a&&a.focus()},"data-testid":"parameters-button",className:"inline-flex size-10 flex-shrink-0 items-center justify-center rounded-xl border border-border-light bg-transparent text-text-primary transition-all ease-in-out hover:bg-surface-tertiary disabled:pointer-events-none disabled:opacity-50 radix-state-open:bg-surface-tertiary",children:l.jsx(St,{size:16,"aria-label":"Plus Icon"})}):null}const mP=Pc().interface;function pP(){const{data:e}=Sx(),{navVisible:t,setNavVisible:s}=Ve(),a=n.useMemo(()=>(null==e?void 0:e.interface)??mP,[e]),r=Zv({permissionType:bd.BOOKMARKS,permission:yd.USE}),o=Zv({permissionType:bd.MULTI_CONVO,permission:yd.USE}),i=Uy("(max-width: 768px)");return l.jsxs("div",{className:"sticky top-0 z-10 flex h-14 w-full items-center justify-between bg-white p-2 font-semibold text-text-primary dark:bg-gray-800",children:[l.jsxs("div",{className:"hide-scrollbar flex w-full items-center justify-between gap-2 overflow-x-auto",children:[l.jsxs("div",{className:"mx-1 flex items-center gap-2",children:[l.jsxs("div",{className:`flex items-center gap-2 ${i?"":"transition-all duration-200 ease-in-out"} ${t?"pointer-events-none translate-x-[-100px] opacity-0":"translate-x-0 opacity-100"}`,children:[l.jsx(oP,{setNavVisible:s}),l.jsx(iP,{})]}),l.jsxs("div",{className:`flex items-center gap-2 ${i?"":"transition-all duration-200 ease-in-out"} ${t?"translate-x-[-100px]":"translate-x-0"}`,children:[l.jsx(eP,{startupConfig:e}),!0===a.presets&&a.modelSelect&&l.jsx(rP,{}),!0===r&&l.jsx(cP,{}),!0===o&&l.jsx(uP,{}),i&&l.jsxs(l.Fragment,{children:[l.jsx(lP,{isSharedButtonEnabled:(null==e?void 0:e.sharedLinksEnabled)??!1}),l.jsx(dP,{})]})]})]}),!i&&l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(lP,{isSharedButtonEnabled:(null==e?void 0:e.sharedLinksEnabled)??!1}),l.jsx(dP,{})]})]}),l.jsx("div",{})]})}function hP(){return l.jsx("div",{className:"relative flex-1 overflow-hidden overflow-y-auto",children:l.jsx("div",{className:"relative flex h-full items-center justify-center",children:l.jsx(Gb,{className:"text-text-primary"})})})}const xP=n.memo(function({index:e=0}){const{conversationId:t}=M(),s=_(sx.submissionByIndex(e)),a=_(sx.submissionByIndex(e+1)),r=_(sx.centerFormOnLanding),o=Ug(),{data:i=null,isLoading:c}=Fx(t??"",{select:n.useCallback(e=>{const t=zp({messages:e,fileMap:o});return 0===(null==t?void 0:t.length)?null:t??null},[o]),enabled:!!o}),d=Pg(e,t),u=Ag({rootIndex:e});Ab(s,d,!1),Ab(a,u,!0);const m=Rr({defaultValues:{text:""}});let p;const h=!(i&&0!==i.length||t!==Zc.NEW_CONVO&&t),x=(!i||0===i.length)&&null!=t;return p=c&&t!==Zc.NEW_CONVO?l.jsx(hP,{}):!c&&!x||h?h?l.jsx(JI,{centerFormOnLanding:r}):l.jsx(RS,{messagesTree:i}):l.jsx(hP,{}),l.jsx(Qg,{...m,children:l.jsx(ag.Provider,{value:d,children:l.jsx(Hg.Provider,{value:u,children:l.jsx(uI,{children:l.jsxs("div",{className:"flex h-full w-full flex-col",children:[!c&&l.jsx(pP,{}),l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:Op("flex flex-col",h?"flex-1 items-center justify-end sm:justify-center":"h-full overflow-y-auto"),children:[p,l.jsxs("div",{className:Op("w-full",h&&"max-w-3xl transition-all duration-200 xl:max-w-4xl"),children:[l.jsx(QI,{index:e}),h?l.jsx(Vk,{}):l.jsx(Dk,{})]})]}),h&&l.jsx(Dk,{})]})]})})})})})});function fP(){const{data:e}=Sx(),{isAuthenticated:t,user:s}=function(){const{user:e,isAuthenticated:t}=Rg(),s=k();return n.useEffect(()=>{const e=setTimeout(()=>{t||s("/login",{replace:!0})},300);return()=>{clearTimeout(e)}},[t,s]),{user:e,isAuthenticated:t}}(),a=v(({set:e})=>t=>{e(Xh.isTemporary,t)},[]);Dg({startupConfig:e,user:s});const{conversationId:r=""}=M();!function(e){const t=n.useRef(null),s=w(sx.visibleArtifacts);n.useEffect(()=>{e!==t.current&&(Dp.log("conversation","Conversation ID change"),s()),t.current=e},[e,s])}(r);const{hasSetConversation:o,conversation:i}=sx.useCreateConversationAtom(0),{newConversation:c}=Mg(),d=Gf({enabled:t,refetchOnMount:"always"}),u=((e,t)=>{const n=Aa();return La([Pd.conversation,e],()=>{const t=ep(n.getQueryData([Pd.allConversations],{exact:!1}),e);return t&&null!=t.messages?t:Nu(e)},{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t})})(r,{enabled:t&&r!==Zc.NEW_CONVO&&!o.current}),m=kx({enabled:t}),p=ig(),h=!(!i||!i.expiredAt);return n.useEffect(()=>{r===Zc.NEW_CONVO||h?h&&a(h):a(!1)},[r,h,a]),n.useEffect(()=>{var t;if((e&&!o.current&&!(null==(t=d.data)?void 0:t.initial))??!1)if(r===Zc.NEW_CONVO&&m.data&&d.data){const t=yp(e);Dp.log("conversation","ChatRoute, new convo effect",i),c({modelsData:d.data,template:i||void 0,...t?{preset:_p(t)}:{}}),o.current=!0}else if(u.data&&m.data&&d.data)Dp.log("conversation","ChatRoute initialConvoQuery",u.data),c({template:u.data,preset:u.data,modelsData:d.data,keepLatestMessage:!0}),o.current=!0;else if(r===Zc.NEW_CONVO&&p[vi.assistants]&&p[vi.azureAssistants]){const t=yp(e);Dp.log("conversation","ChatRoute new convo, assistants effect",i),c({modelsData:d.data,template:i||void 0,...t?{preset:_p(t)}:{}}),o.current=!0}else p[vi.assistants]&&p[vi.azureAssistants]&&(Dp.log("conversation","ChatRoute convo, assistants effect",u.data),c({template:u.data,preset:u.data,modelsData:d.data,keepLatestMessage:!0}),o.current=!0)},[e,u.data,m.data,d.data,p]),m.isLoading||d.isLoading?l.jsx("div",{className:"flex h-screen items-center justify-center","aria-live":"polite",role:"status",children:l.jsx(Gb,{className:"text-text-primary"})}):t?(null==i?void 0:i.conversationId)===Zc.SEARCH?null:((null==i?void 0:i.conversationId)===r||i)&&r?l.jsx(uv,{conversationId:i.conversationId??"",children:l.jsx(xP,{index:0})}):null:null}const gP=m.forwardRef((e,t)=>l.jsx("div",{className:Op("relative flex w-full grow overflow-hidden bg-white dark:bg-gray-800",e.className),children:l.jsx("div",{className:"transition-width relative h-full w-full flex-1 overflow-auto bg-white dark:bg-gray-800",children:l.jsx("div",{className:"flex h-full flex-col",role:"presentation",tabIndex:0,children:l.jsx("div",{className:"flex-1 overflow-hidden overflow-y-auto",children:l.jsx("div",{className:"dark:gpt-dark-gray relative h-full",children:l.jsx("div",{ref:t,style:{height:"100%",overflowY:"auto",width:"100%"},children:l.jsxs("div",{className:"flex flex-col pb-9 text-sm dark:bg-transparent",children:[e.children,l.jsx("div",{className:"dark:gpt-dark-gray group h-0 w-full flex-shrink-0 dark:border-gray-800/50"})]})})})})})})}));function vP({message:e}){const t=zf(),n=Aa(),s=_(sx.search),{navigateToConvo:a}=bv(),r=e.conversationId??"";return r?l.jsx("div",{className:"visible mt-0 flex items-center justify-center gap-1 self-end text-text-secondary lg:justify-start",children:l.jsxs("button",{type:"button",className:"ml-0 flex cursor-pointer items-center gap-1.5 rounded-md p-1 text-xs hover:text-text-primary hover:underline",onClick:async t=>{if(t.preventDefault(),!r)return;let o=e.title??"",i=n.getQueryData([Pd.conversation,r]);const l=n.getQueryData([Pd.allConversations,{search:s.debouncedQuery}]);!i&&l&&(i=ep(l,r)),o||(o=(null==i?void 0:i.title)??""),document.title=o,a(i??{conversationId:r,title:o},{resetLatestMessage:!0})},title:t("com_ui_go_to_conversation"),children:[l.jsx(ts,{className:"icon-sm"}),e.title]})}):null}const bP=({iconData:e})=>l.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-end",children:l.jsx("div",{className:"pt-0.5",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:l.jsx(yS,{iconData:e})})})}),yP=({message:e,messageLabel:t,fontSize:n})=>l.jsxs("div",{className:Op("relative flex w-11/12 flex-col",e.isCreatedByUser?"":"agent-turn"),children:[l.jsx("div",{className:Op("select-none font-semibold",n),children:t}),l.jsx(Rk,{message:e}),l.jsxs(Pk,{classes:"text-xs",children:[l.jsx(ak,{message:e}),l.jsx(vP,{message:e})]})]});function _P({message:e}){const t=_(sx.UsernameDisplay),s=_(sx.fontSize),{user:a}=Rg(),r=zf(),o=n.useMemo(()=>({endpoint:(null==e?void 0:e.endpoint)??"",model:(null==e?void 0:e.model)??"",iconURL:(null==e?void 0:e.iconURL)??"",isCreatedByUser:(null==e?void 0:e.isCreatedByUser)??!1}),[null==e?void 0:e.endpoint,null==e?void 0:e.model,null==e?void 0:e.iconURL,null==e?void 0:e.isCreatedByUser]),i=n.useMemo(()=>(null==e?void 0:e.isCreatedByUser)?t?((null==a?void 0:a.name)??"")||((null==a?void 0:a.username)??""):r("com_user_message"):(null==e?void 0:e.sender)??"",[null==e?void 0:e.isCreatedByUser,null==e?void 0:e.sender,t,null==a?void 0:a.name,null==a?void 0:a.username,r]);return e?l.jsx("div",{className:"text-token-text-primary w-full bg-transparent",children:l.jsx("div",{className:"m-auto p-4 py-2 md:gap-6",children:l.jsxs("div",{className:"final-completion group mx-auto flex flex-1 gap-3 md:max-w-3xl md:px-5 lg:max-w-[40rem] lg:px-1 xl:max-w-[48rem] xl:px-5",children:[l.jsx(bP,{iconData:o}),l.jsx(yP,{message:e,messageLabel:i,fontSize:s})]})})}):null}function jP(){var e;const t=zf(),s=Ug(),{showToast:a}=Of(),{isAuthenticated:r}=Rg(),o=_(sx.search),i=o.debouncedQuery,{data:c,isLoading:d,isError:u,fetchNextPage:m,isFetchingNextPage:p,hasNextPage:h}=Jx({search:i||void 0},{enabled:r&&!!i,staleTime:3e4,cacheTime:3e5}),{containerRef:x}=Iv({nextCursor:null==(e=null==c?void 0:c.pages[c.pages.length-1])?void 0:e.nextCursor,setShowLoading:()=>({}),fetchNextPage:m,isFetchingNext:p}),f=n.useMemo(()=>{const e=zp({messages:(null==c?void 0:c.pages.flatMap(e=>e.messages))||[],fileMap:s});return 0===(null==e?void 0:e.length)?null:e??null},[s,null==c?void 0:c.pages]);n.useEffect(()=>{u&&i&&a({message:"An error occurred during search",status:"error"})},[u,i,a]);return o.isTyping||d||p?l.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:l.jsx(Gb,{className:"text-text-primary"})}):i?l.jsxs(gP,{ref:x,className:"relative flex h-full pt-4",children:[f&&0===f.length||null==f?l.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:l.jsx("div",{className:"rounded-lg bg-white p-6 text-lg text-gray-500 dark:border-gray-800/50 dark:bg-gray-800 dark:text-gray-300",children:t("com_ui_nothing_found")})}):l.jsxs(l.Fragment,{children:[f.map(e=>l.jsx(_P,{message:e},e.messageId)),p&&l.jsx("div",{className:"flex justify-center py-4",children:l.jsx(Gb,{className:"text-text-primary"})})]}),l.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-[5%] bg-gradient-to-t from-gray-50 to-transparent dark:from-gray-800"})]}):null}const wP=({open:e,onOpenChange:t,onAccept:s,onDecline:a,title:r,modalContent:o})=>{const i=zf(),{showToast:c}=Of(),d=Sf({onSuccess:()=>{s(),t(!1)},onError:()=>{c({message:"Failed to accept terms"})}}),u=n.useMemo(()=>"string"==typeof o?o:Array.isArray(o)?o.join("\n"):"",[o]);return l.jsx(A_,{open:e,onOpenChange:n=>{e&&!n||t(n)},children:l.jsx(OR,{title:r??i("com_ui_terms_and_conditions"),className:"w-11/12 max-w-3xl sm:w-3/4 md:w-1/2 lg:w-2/5",showCloseButton:!1,showCancelButton:!1,main:l.jsx("section",{tabIndex:0,className:"max-h-[60vh] overflow-y-auto p-4","aria-label":i("com_ui_terms_and_conditions"),children:l.jsx("div",{className:"prose dark:prose-invert w-full max-w-none !text-text-primary",children:""!==u?l.jsx(AN,{content:u}):l.jsx("p",{children:i("com_ui_no_terms_content")})})}),buttons:l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:()=>{a(),t(!1)},className:"inline-flex h-10 items-center justify-center rounded-lg border border-border-heavy bg-surface-secondary px-4 py-2 text-sm text-text-primary hover:bg-surface-active",children:i("com_ui_decline")}),l.jsx("button",{onClick:()=>{d.mutate()},className:"inline-flex h-10 items-center justify-center rounded-lg border border-border-heavy bg-surface-secondary px-4 py-2 text-sm text-text-primary hover:bg-gray-100 hover:text-black focus:bg-gray-100 focus:text-black dark:hover:bg-gray-700 dark:focus:bg-gray-700 dark:hover:text-white dark:focus:text-white",children:i("com_ui_accept")})]})})})};function NP(){var e,t,s,a;const[r,o]=n.useState(!1),[i,c]=n.useState(0),[d,u]=n.useState(()=>{const e=localStorage.getItem("navVisible");return null===e||JSON.parse(e)}),{isAuthenticated:m,logout:p}=Rg();Wx(m);const h=function({isAuthenticated:e}){const{data:t={}}=ef(vi.assistants,void 0,{select:e=>Zo(e.data),enabled:e}),{data:n={}}=ef(vi.azureAssistants,void 0,{select:e=>Zo(e.data),enabled:e});return{[vi.assistants]:t,[vi.azureAssistants]:n}}({isAuthenticated:m}),x=function({isAuthenticated:e}){const{data:t=null}=gx(void 0,{select:e=>function(e){const t={};for(const n of e)t[n.id]=n;return t}(e.data),enabled:e});return n.useMemo(()=>null!==t?t:void 0,[t])}({isAuthenticated:m}),f=function({isAuthenticated:e}){const{data:t}=Tx({select:Qo,enabled:e});return t}({isAuthenticated:m}),{data:g}=Sx(),{data:v}=lf({enabled:m&&!0===(null==(t=null==(e=null==g?void 0:g.interface)?void 0:e.termsOfService)?void 0:t.modalAcceptance)});!function(e){const t=y(sx.search),s=Ux({enabled:e});n.useEffect(()=>{!0===s.data?t(e=>({...e,enabled:s.data})):s.isError&&Dp.error("Failed to get search enabled: ",s.error)},[s.data,s.error,s.isError,t])}(m),n.useEffect(()=>{v&&o(!v.termsAccepted)},[v]);return m?l.jsx(ah,{children:l.jsx(Bg.Provider,{value:f,children:l.jsxs(nv.Provider,{value:h,children:[l.jsxs(lg.Provider,{value:x,children:[l.jsx(rw,{onHeightChange:c}),l.jsx("div",{className:"flex",style:{height:`calc(100dvh - ${i}px)`},children:l.jsxs("div",{className:"relative z-0 flex h-full w-full overflow-hidden",children:[l.jsx($M,{navVisible:d,setNavVisible:u}),l.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col overflow-hidden",children:[l.jsx(LM,{setNavVisible:u}),l.jsx(He,{context:{navVisible:d,setNavVisible:u}})]})]})})]}),!0===(null==(a=null==(s=null==g?void 0:g.interface)?void 0:s.termsOfService)?void 0:a.modalAcceptance)&&l.jsx(wP,{open:r,onOpenChange:o,onAccept:()=>{o(!1)},onDecline:()=>{o(!1),p("/login?redirect=false")},title:g.interface.termsOfService.modalTitle,modalContent:g.interface.termsOfService.modalContent})]})})}):null}const CP=()=>l.jsxs(Tg,{children:[l.jsx(He,{}),l.jsx(Wj,{})]}),kP=is([{path:"share/:shareId",element:l.jsx(Fk,{}),errorElement:l.jsx(nw,{})},{path:"oauth",errorElement:l.jsx(nw,{}),children:[{path:"success",element:l.jsx(Yj,{})},{path:"error",element:l.jsx(Xj,{})}]},{path:"/",element:l.jsx(cw,{}),errorElement:l.jsx(nw,{}),children:[{path:"register",element:l.jsx(Hj,{})},{path:"forgot-password",element:l.jsx(Zj,{})},{path:"reset-password",element:l.jsx(Kj,{})}]},{path:"verify",element:l.jsx(Gj,{}),errorElement:l.jsx(nw,{})},{element:l.jsx(CP,{}),errorElement:l.jsx(nw,{}),children:[{path:"/",element:l.jsx(dw,{}),children:[{path:"login",element:l.jsx(Uj,{})},{path:"login/2fa",element:l.jsx(Jj,{})}]},sk,{path:"/",element:l.jsx(NP,{}),children:[{index:!0,element:l.jsx(Pt,{to:"/c/new",replace:!0})},{path:"c/:conversationId?",element:l.jsx(fP,{})},{path:"search",element:l.jsx(jP,{})}]}]}]),SP=()=>{const{setError:e}=zb(),t=new Wa({queryCache:new qa({onError:t=>{var n;401===(null==(n=null==t?void 0:t.response)?void 0:n.status)&&e(t)}})});return l.jsx(Qa,{client:t,children:l.jsx(ns,{children:l.jsx(Qy,{children:l.jsx(Cv,{children:l.jsx(Ca,{children:l.jsx(Df,{children:l.jsxs(Ma,{backend:Pa,children:[l.jsx(ls,{router:kP}),l.jsx(Za,{initialIsOpen:!1,position:"top-right"}),l.jsx(Wy,{}),l.jsx(ka,{className:"pointer-events-none fixed inset-0 z-[1000] mx-auto my-2 flex max-w-[560px] flex-col items-stretch justify-start md:pb-5"})]})})})})})})})},TP=()=>l.jsxs(Tv,{children:[l.jsx(SP,{}),l.jsx("iframe",{src:"/assets/silence.mp3",allow:"autoplay",id:"audio",title:"audio-silence",style:{display:"none"}})]}),RP=document.getElementById("root");ss.createRoot(RP).render(l.jsx(Db,{children:l.jsx(TP,{})}));export{ej as $,hM as A,Jg as B,PE as C,Ub as D,x_ as E,g_ as F,uy as G,d_ as H,jT as I,Im as J,fN as K,Em as L,Ml as M,xy as N,fy as O,bd as P,Pd as Q,Pl as R,Gb as S,rj as T,Ny as U,py as V,M_ as W,f_ as X,Z_ as Y,J_ as Z,X_ as _,zf as a,Y_ as a0,tj as a1,Tx as a2,A_ as a3,V_ as a4,$_ as a5,U_ as a6,Rg as a7,Bx as a8,sb as a9,Px as b,Op as c,sx as d,Mv as e,Of as f,Eu as g,rx as h,Dx as i,Q_ as j,Zv as k,yd as l,Uy as m,Sx as n,Qc as o,TE as p,HE as q,qE as r,PM as s,$E as t,Yg as u,gM as v,u_ as w,m_ as x,c_ as y,h_ as z};
